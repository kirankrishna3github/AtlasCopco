*&---------------------------------------------------------------------*
*& Report  ZVBUVDEL
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*

REPORT  ZVBUVDEL.
TABLES:
  VBAK,
  VBAP,
  VBUV.
DATA:
  BEGIN OF VBAKKEYTAB OCCURS 0,
    VBELN LIKE VBAK-VBELN,
  END OF VBAKKEYTAB,
  BEGIN OF VBAPKEYTAB OCCURS 0,
    VBELN LIKE VBAP-VBELN,
    POSNR LIKE VBAP-POSNR,
  END OF VBAPKEYTAB,
  VBUVDELTAB LIKE VBUV OCCURS 0,
  VBUVDELNUM TYPE I.
INCLUDE RVDIREKT.
SELECT-OPTIONS:
  DOCUMENT FOR VBAK-VBELN MATCHCODE OBJECT VMVA.
PARAMETERS:
  UPDATE DEFAULT ''.
SELECT VBELN FROM VBAK INTO TABLE VBAKKEYTAB WHERE VBELN IN DOCUMENT.
SORT VBAKKEYTAB.
SELECT VBELN POSNR FROM VBAP INTO TABLE VBAPKEYTAB
                   WHERE VBELN IN DOCUMENT.
SORT VBAPKEYTAB.
SELECT * FROM VBUV WHERE VBELN IN DOCUMENT AND POSNR NE '000000'.
  READ TABLE VBAKKEYTAB TRANSPORTING NO FIELDS BINARY SEARCH
             WITH KEY VBELN = VBUV-VBELN.
  CHECK SY-SUBRC EQ 0.
  READ TABLE VBAPKEYTAB TRANSPORTING NO FIELDS BINARY SEARCH
             WITH KEY VBELN = VBUV-VBELN  POSNR = VBUV-POSNR.
  CHECK SY-SUBRC NE 0.
  APPEND VBUV TO VBUVDELTAB.
ENDSELECT.
SORT VBUVDELTAB.
LOOP AT VBUVDELTAB INTO VBUV.
  WRITE: / VBUV.
ENDLOOP.
DESCRIBE TABLE VBUVDELTAB LINES VBUVDELNUM.
WRITE: / VBUVDELNUM, 'obsolete VBUV-entries'.
CHECK UPDATE EQ CHARX.
DELETE VBUV FROM TABLE VBUVDELTAB.
WRITE: 'deleted'.

*Selection text£º
*DOCUMENT:D       .
*UPDATE:        Update (if X)
