REPORT ZAL_ABAP message-id 26 line-size 255
no standard page heading.
* ZCP1_PLICSTDETD.
PARAMETER DOWNLOAD(1) DEFAULT 'S' lower case. "N-svr,Y-clnt
PARAMETER EXECMODE(1) DEFAULT 'B' lower case. "D-dlg,B-btch
PARAMETER OUT_DIR(48) DEFAULT "output file dir
'/var/load/CD1/UK/read' lower case.
PARAMETER IN_DIR(48) DEFAULT "input file dir
'/var/load/CD1/UK/read' lower case.
PARAMETER P_DEST TYPE RFCDES-RFCDEST DEFAULT
'NONE'.
PARAMETER P_PROGID TYPE RFCOPT-RFCEXEC DEFAULT
SPACE.
PARAMETER P_GWHOST TYPE RFCOPT-RFCGWHOST DEFAULT
SPACE.
PARAMETER P_GWSERV TYPE RFCOPT-RFCGWSERV DEFAULT
SPACE.
PARAMETER P_SRVFM(30) DEFAULT "Server Callback function
SPACE.
PARAMETER P_PKGSZ TYPE I DEFAULT "Stream package size
5000.
PARAMETER P_SNC_ON(1) DEFAULT "X-on SPACE-off
SPACE.

PARAMETER $PARAM1 TYPE D.

PARAMETER $PARAM2 TYPE D.

PARAMETER P_DF_VK(40) DEFAULT "ABAP data flow object key
'' lower case.
PARAMETER P_DI_GEN(40) DEFAULT "DI version that generated ABAP
'' lower case.

*** Machine generated ABAP. Do not modify.            ***
*** (C)Copyright Business Objects S.A.  All rights reserved. ***
*
* Date Time:
*    12/24/15 07:24:10
* SAP used for generated this ABAP:
*    Release: 701
*    Host   : 10.25.3.82
*
* ABAP Dataflow Name:
*    DF_R3_CTS_LZ_SAP_CP1_PLICSTDET_D
* ABAP Dataflow comments:
*  SAP source : COSS / PMSDO / AUFK
* ABAP program name in SAP:
*  ZCP1_PLICSTDETD
* Generated ABAP file name:
*    //AIRSBEAP0512/D$/Data/SAPLogistics/VAL/ABAP/ZCP1_PLICSTDETD
TABLES COSS.
TABLES PMSDO.
TABLES AUFK.
TABLES ZSTC_SALES_COMP.

DATA: begin of ITAB5 occurs 0,
MANDT(3) TYPE C,
LEDNR(2) TYPE C,
OBJNR(22) TYPE C,
GJAHR(4) TYPE N,
WRTTP(2) TYPE C,
VERSN(3) TYPE C,
KSTAR(10) TYPE C,
HRKFT(14) TYPE C,
VRGNG(4) TYPE C,
PAROB(22) TYPE C,
USPOB(22) TYPE C,
BEKNZ(1) TYPE C,
TWAER(5) TYPE C,
PERBL(3) TYPE N,
MEINH(3) TYPE C,
WTG001(16) TYPE P DECIMALS 2,
WTG002(16) TYPE P DECIMALS 2,
WTG003(16) TYPE P DECIMALS 2,
WTG004(16) TYPE P DECIMALS 2,
WTG005(16) TYPE P DECIMALS 2,
WTG006(16) TYPE P DECIMALS 2,
WTG007(16) TYPE P DECIMALS 2,
WTG008(16) TYPE P DECIMALS 2,
WTG009(16) TYPE P DECIMALS 2,
WTG010(16) TYPE P DECIMALS 2,
WTG011(16) TYPE P DECIMALS 2,
WTG012(16) TYPE P DECIMALS 2,
WTG013(16) TYPE P DECIMALS 2,
WTG014(16) TYPE P DECIMALS 2,
WTG015(16) TYPE P DECIMALS 2,
WTG016(16) TYPE P DECIMALS 2,
WOG001(16) TYPE P DECIMALS 2,
WOG002(16) TYPE P DECIMALS 2,
WOG003(16) TYPE P DECIMALS 2,
WOG004(16) TYPE P DECIMALS 2,
WOG005(16) TYPE P DECIMALS 2,
WOG006(16) TYPE P DECIMALS 2,
WOG007(16) TYPE P DECIMALS 2,
WOG008(16) TYPE P DECIMALS 2,
WOG009(16) TYPE P DECIMALS 2,
WOG010(16) TYPE P DECIMALS 2,
WOG011(16) TYPE P DECIMALS 2,
WOG012(16) TYPE P DECIMALS 2,
WOG013(16) TYPE P DECIMALS 2,
WOG014(16) TYPE P DECIMALS 2,
WOG015(16) TYPE P DECIMALS 2,
WOG016(16) TYPE P DECIMALS 2,
WKG001(16) TYPE P DECIMALS 2,
WKG002(16) TYPE P DECIMALS 2,
WKG003(16) TYPE P DECIMALS 2,
WKG004(16) TYPE P DECIMALS 2,
WKG005(16) TYPE P DECIMALS 2,
WKG006(16) TYPE P DECIMALS 2,
WKG007(16) TYPE P DECIMALS 2,
WKG008(16) TYPE P DECIMALS 2,
WKG009(16) TYPE P DECIMALS 2,
WKG010(16) TYPE P DECIMALS 2,
WKG011(16) TYPE P DECIMALS 2,
WKG012(16) TYPE P DECIMALS 2,
WKG013(16) TYPE P DECIMALS 2,
WKG014(16) TYPE P DECIMALS 2,
WKG015(16) TYPE P DECIMALS 2,
WKG016(16) TYPE P DECIMALS 2,
WKF001(16) TYPE P DECIMALS 2,
WKF002(16) TYPE P DECIMALS 2,
WKF003(16) TYPE P DECIMALS 2,
WKF004(16) TYPE P DECIMALS 2,
WKF005(16) TYPE P DECIMALS 2,
WKF006(16) TYPE P DECIMALS 2,
WKF007(16) TYPE P DECIMALS 2,
WKF008(16) TYPE P DECIMALS 2,
WKF009(16) TYPE P DECIMALS 2,
WKF010(16) TYPE P DECIMALS 2,
WKF011(16) TYPE P DECIMALS 2,
WKF012(16) TYPE P DECIMALS 2,
WKF013(16) TYPE P DECIMALS 2,
WKF014(16) TYPE P DECIMALS 2,
WKF015(16) TYPE P DECIMALS 2,
WKF016(16) TYPE P DECIMALS 2,
PAG001(16) TYPE P DECIMALS 2,
PAG002(16) TYPE P DECIMALS 2,
PAG003(16) TYPE P DECIMALS 2,
PAG004(16) TYPE P DECIMALS 2,
PAG005(16) TYPE P DECIMALS 2,
PAG006(16) TYPE P DECIMALS 2,
PAG007(16) TYPE P DECIMALS 2,
PAG008(16) TYPE P DECIMALS 2,
PAG009(16) TYPE P DECIMALS 2,
PAG010(16) TYPE P DECIMALS 2,
PAG011(16) TYPE P DECIMALS 2,
PAG012(16) TYPE P DECIMALS 2,
PAG013(16) TYPE P DECIMALS 2,
PAG014(16) TYPE P DECIMALS 2,
PAG015(16) TYPE P DECIMALS 2,
PAG016(16) TYPE P DECIMALS 2,
PAF001(16) TYPE P DECIMALS 2,
PAF002(16) TYPE P DECIMALS 2,
PAF003(16) TYPE P DECIMALS 2,
PAF004(16) TYPE P DECIMALS 2,
PAF005(16) TYPE P DECIMALS 2,
PAF006(16) TYPE P DECIMALS 2,
PAF007(16) TYPE P DECIMALS 2,
PAF008(16) TYPE P DECIMALS 2,
PAF009(16) TYPE P DECIMALS 2,
PAF010(16) TYPE P DECIMALS 2,
PAF011(16) TYPE P DECIMALS 2,
PAF012(16) TYPE P DECIMALS 2,
PAF013(16) TYPE P DECIMALS 2,
PAF014(16) TYPE P DECIMALS 2,
PAF015(16) TYPE P DECIMALS 2,
PAF016(16) TYPE P DECIMALS 2,
MEG001(16) TYPE P DECIMALS 3,
MEG002(16) TYPE P DECIMALS 3,
MEG003(16) TYPE P DECIMALS 3,
MEG004(16) TYPE P DECIMALS 3,
MEG005(16) TYPE P DECIMALS 3,
MEG006(16) TYPE P DECIMALS 3,
MEG007(16) TYPE P DECIMALS 3,
MEG008(16) TYPE P DECIMALS 3,
MEG009(16) TYPE P DECIMALS 3,
MEG010(16) TYPE P DECIMALS 3,
MEG011(16) TYPE P DECIMALS 3,
MEG012(16) TYPE P DECIMALS 3,
MEG013(16) TYPE P DECIMALS 3,
MEG014(16) TYPE P DECIMALS 3,
MEG015(16) TYPE P DECIMALS 3,
MEG016(16) TYPE P DECIMALS 3,
MEF001(16) TYPE P DECIMALS 3,
MEF002(16) TYPE P DECIMALS 3,
MEF003(16) TYPE P DECIMALS 3,
MEF004(16) TYPE P DECIMALS 3,
MEF005(16) TYPE P DECIMALS 3,
MEF006(16) TYPE P DECIMALS 3,
MEF007(16) TYPE P DECIMALS 3,
MEF008(16) TYPE P DECIMALS 3,
MEF009(16) TYPE P DECIMALS 3,
MEF010(16) TYPE P DECIMALS 3,
MEF011(16) TYPE P DECIMALS 3,
MEF012(16) TYPE P DECIMALS 3,
MEF013(16) TYPE P DECIMALS 3,
MEF014(16) TYPE P DECIMALS 3,
MEF015(16) TYPE P DECIMALS 3,
MEF016(16) TYPE P DECIMALS 3,
MUV001(1) TYPE C,
MUV002(1) TYPE C,
MUV003(1) TYPE C,
MUV004(1) TYPE C,
MUV005(1) TYPE C,
MUV006(1) TYPE C,
MUV007(1) TYPE C,
MUV008(1) TYPE C,
MUV009(1) TYPE C,
MUV010(1) TYPE C,
MUV011(1) TYPE C,
MUV012(1) TYPE C,
MUV013(1) TYPE C,
MUV014(1) TYPE C,
MUV015(1) TYPE C,
MUV016(1) TYPE C,
BELTP(1) TYPE N,
TIMESTMP(16) TYPE P DECIMALS 0,
BUKRS(4) TYPE C,
FKBER(16) TYPE C,
SEGMENT(10) TYPE C,
GEBER(10) TYPE C,
GRANT_NBR(20) TYPE C,
VKORG(4) TYPE C,
AUFNR(12) TYPE C,
BEMOT(2) TYPE C,
WAERS(5) TYPE C,
Z_BUKRS(4) TYPE C,
Z_VKORG(4) TYPE C,
Z_WERKS(4) TYPE C,
Z_EKORG(4) TYPE C,
Z_MAMUSERCMPY(4) TYPE C,
Z_REGION(40) TYPE C,
Z_COUNTRY(40) TYPE C,
Z_COUNTRYDSCR(255) TYPE C,
Z_SALESCOMPANY(40) TYPE C,
Z_SALESCMPDSCR(255) TYPE C.
DATA: end of ITAB5.

data: append_flag(1) value ' ',
      cntbuf type i,
      delimleng type i,last_batch(1) value ' '.

CONSTANTS C_DF_VK(40) VALUE '1667'.
CONSTANTS C_DI_GEN(40) VALUE '14.2.3.660'.
DATA WARN_MSG(50).


DATA: gv_directory     TYPE epsdirnam  VALUE '/var/load/xxx/UK/read/',
      gv_logsys        LIKE tbdlst-logsys.

start-of-selection.
* Logical system
  CALL FUNCTION 'OWN_LOGICAL_SYSTEM_GET'
    IMPORTING
      own_logical_system             = gv_logsys
    EXCEPTIONS
      own_logical_system_not_defined = 1
      OTHERS                         = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
         WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    STOP.
  ENDIF.
  REPLACE 'xxx' IN out_dir WITH gv_logsys(3).
  REPLACE 'xxx' IN in_dir WITH gv_logsys(3).


  IF DOWNLOAD = 'S' OR
     DOWNLOAD = 'N' OR
     DOWNLOAD = 'Y'.
      .
  ELSE.
     DATA: m_xfer_err_msg(700).
     CONCATENATE
'ABAP program does not recognize this new '
'data transfer method: ' DOWNLOAD
'. Regenerate the ABAP program and upload to this system.'
     INTO m_xfer_err_msg.
     MESSAGE  E240(S#) WITH m_xfer_err_msg.
  ENDIF.

  IF EXECMODE = 'B' OR
     EXECMODE = 'D'.
      .
  ELSE.
     DATA: m_exec_err_msg(700).
     CONCATENATE
'ABAP program does not recognize this new '
'execution option: ' EXECMODE
'. Regenerate the ABAP program and upload to this system.'
     INTO m_exec_err_msg.
     MESSAGE  E240(S#) WITH m_exec_err_msg.
  ENDIF.

  IF DOWNLOAD = 'S'.
     PERFORM CONNECT_RFCDEST_TO_PROGID.
  ENDIF.



PERFORM FORM5.
last_batch = 'X'.
PERFORM FORM6.
FREE ITAB5.
  IF DOWNLOAD = 'S'.
     PERFORM DISCONNECT_RFCDEST_FROM_PROGID.
  ENDIF.


end-of-selection.

CLEAR WARN_MSG.

IF NOT P_DF_VK IS INITIAL.
  IF P_DF_VK <> C_DF_VK.
     CONCATENATE '$$Warning$'
                 C_DF_VK
                 '$' INTO WARN_MSG.
  ENDIF.
ENDIF.
IF NOT P_DI_GEN IS INITIAL.
  IF P_DI_GEN <> C_DI_GEN.
     IF WARN_MSG IS INITIAL.
       CONCATENATE '$$Warning$$'
                   C_DI_GEN
                   INTO WARN_MSG.
     ELSE.
       CONCATENATE WARN_MSG
                   C_DI_GEN
                   INTO WARN_MSG.
     ENDIF.
  ENDIF.
ENDIF.

IF NOT WARN_MSG IS INITIAL.
  IF EXECMODE = 'D'.
    WRITE WARN_MSG.
    NEW-LINE.
  ELSE.
    MESSAGE S240(S#) with WARN_MSG.
  ENDIF.
ENDIF.


write  '* Program Complete *'.
write  '(C)Copyright Business Objects S.A.  All rights reserved.'.

FORM FORM5.
DATA ALTMP256(3) TYPE C.
DATA ALTMP257(2) TYPE C.
DATA ALTMP258(22) TYPE C.
DATA ALTMP259(4) TYPE N.
DATA ALTMP260(2) TYPE C.
DATA ALTMP261(3) TYPE C.
DATA ALTMP262(10) TYPE C.
DATA ALTMP263(14) TYPE C.
DATA ALTMP264(4) TYPE C.
DATA ALTMP265(22) TYPE C.
DATA ALTMP266(22) TYPE C.
DATA ALTMP267(1) TYPE C.
DATA ALTMP268(5) TYPE C.
DATA ALTMP269(3) TYPE N.
DATA ALTMP270(3) TYPE C.
DATA ALTMP271(16) TYPE P DECIMALS 2.
DATA ALTMP272(16) TYPE P DECIMALS 2.
DATA ALTMP273(16) TYPE P DECIMALS 2.
DATA ALTMP274(16) TYPE P DECIMALS 2.
DATA ALTMP275(16) TYPE P DECIMALS 2.
DATA ALTMP276(16) TYPE P DECIMALS 2.
DATA ALTMP277(16) TYPE P DECIMALS 2.
DATA ALTMP278(16) TYPE P DECIMALS 2.
DATA ALTMP279(16) TYPE P DECIMALS 2.
DATA ALTMP280(16) TYPE P DECIMALS 2.
DATA ALTMP281(16) TYPE P DECIMALS 2.
DATA ALTMP282(16) TYPE P DECIMALS 2.
DATA ALTMP283(16) TYPE P DECIMALS 2.
DATA ALTMP284(16) TYPE P DECIMALS 2.
DATA ALTMP285(16) TYPE P DECIMALS 2.
DATA ALTMP286(16) TYPE P DECIMALS 2.
DATA ALTMP287(16) TYPE P DECIMALS 2.
DATA ALTMP288(16) TYPE P DECIMALS 2.
DATA ALTMP289(16) TYPE P DECIMALS 2.
DATA ALTMP290(16) TYPE P DECIMALS 2.
DATA ALTMP291(16) TYPE P DECIMALS 2.
DATA ALTMP292(16) TYPE P DECIMALS 2.
DATA ALTMP293(16) TYPE P DECIMALS 2.
DATA ALTMP294(16) TYPE P DECIMALS 2.
DATA ALTMP295(16) TYPE P DECIMALS 2.
DATA ALTMP296(16) TYPE P DECIMALS 2.
DATA ALTMP297(16) TYPE P DECIMALS 2.
DATA ALTMP298(16) TYPE P DECIMALS 2.
DATA ALTMP299(16) TYPE P DECIMALS 2.
DATA ALTMP300(16) TYPE P DECIMALS 2.
DATA ALTMP301(16) TYPE P DECIMALS 2.
DATA ALTMP302(16) TYPE P DECIMALS 2.
DATA ALTMP303(16) TYPE P DECIMALS 2.
DATA ALTMP304(16) TYPE P DECIMALS 2.
DATA ALTMP305(16) TYPE P DECIMALS 2.
DATA ALTMP306(16) TYPE P DECIMALS 2.
DATA ALTMP307(16) TYPE P DECIMALS 2.
DATA ALTMP308(16) TYPE P DECIMALS 2.
DATA ALTMP309(16) TYPE P DECIMALS 2.
DATA ALTMP310(16) TYPE P DECIMALS 2.
DATA ALTMP311(16) TYPE P DECIMALS 2.
DATA ALTMP312(16) TYPE P DECIMALS 2.
DATA ALTMP313(16) TYPE P DECIMALS 2.
DATA ALTMP314(16) TYPE P DECIMALS 2.
DATA ALTMP315(16) TYPE P DECIMALS 2.
DATA ALTMP316(16) TYPE P DECIMALS 2.
DATA ALTMP317(16) TYPE P DECIMALS 2.
DATA ALTMP318(16) TYPE P DECIMALS 2.
DATA ALTMP319(16) TYPE P DECIMALS 2.
DATA ALTMP320(16) TYPE P DECIMALS 2.
DATA ALTMP321(16) TYPE P DECIMALS 2.
DATA ALTMP322(16) TYPE P DECIMALS 2.
DATA ALTMP323(16) TYPE P DECIMALS 2.
DATA ALTMP324(16) TYPE P DECIMALS 2.
DATA ALTMP325(16) TYPE P DECIMALS 2.
DATA ALTMP326(16) TYPE P DECIMALS 2.
DATA ALTMP327(16) TYPE P DECIMALS 2.
DATA ALTMP328(16) TYPE P DECIMALS 2.
DATA ALTMP329(16) TYPE P DECIMALS 2.
DATA ALTMP330(16) TYPE P DECIMALS 2.
DATA ALTMP331(16) TYPE P DECIMALS 2.
DATA ALTMP332(16) TYPE P DECIMALS 2.
DATA ALTMP333(16) TYPE P DECIMALS 2.
DATA ALTMP334(16) TYPE P DECIMALS 2.
DATA ALTMP335(16) TYPE P DECIMALS 2.
DATA ALTMP336(16) TYPE P DECIMALS 2.
DATA ALTMP337(16) TYPE P DECIMALS 2.
DATA ALTMP338(16) TYPE P DECIMALS 2.
DATA ALTMP339(16) TYPE P DECIMALS 2.
DATA ALTMP340(16) TYPE P DECIMALS 2.
DATA ALTMP341(16) TYPE P DECIMALS 2.
DATA ALTMP342(16) TYPE P DECIMALS 2.
DATA ALTMP343(16) TYPE P DECIMALS 2.
DATA ALTMP344(16) TYPE P DECIMALS 2.
DATA ALTMP345(16) TYPE P DECIMALS 2.
DATA ALTMP346(16) TYPE P DECIMALS 2.
DATA ALTMP347(16) TYPE P DECIMALS 2.
DATA ALTMP348(16) TYPE P DECIMALS 2.
DATA ALTMP349(16) TYPE P DECIMALS 2.
DATA ALTMP350(16) TYPE P DECIMALS 2.
DATA ALTMP351(16) TYPE P DECIMALS 2.
DATA ALTMP352(16) TYPE P DECIMALS 2.
DATA ALTMP353(16) TYPE P DECIMALS 2.
DATA ALTMP354(16) TYPE P DECIMALS 2.
DATA ALTMP355(16) TYPE P DECIMALS 2.
DATA ALTMP356(16) TYPE P DECIMALS 2.
DATA ALTMP357(16) TYPE P DECIMALS 2.
DATA ALTMP358(16) TYPE P DECIMALS 2.
DATA ALTMP359(16) TYPE P DECIMALS 2.
DATA ALTMP360(16) TYPE P DECIMALS 2.
DATA ALTMP361(16) TYPE P DECIMALS 2.
DATA ALTMP362(16) TYPE P DECIMALS 2.
DATA ALTMP363(16) TYPE P DECIMALS 2.
DATA ALTMP364(16) TYPE P DECIMALS 2.
DATA ALTMP365(16) TYPE P DECIMALS 2.
DATA ALTMP366(16) TYPE P DECIMALS 2.
DATA ALTMP367(16) TYPE P DECIMALS 3.
DATA ALTMP368(16) TYPE P DECIMALS 3.
DATA ALTMP369(16) TYPE P DECIMALS 3.
DATA ALTMP370(16) TYPE P DECIMALS 3.
DATA ALTMP371(16) TYPE P DECIMALS 3.
DATA ALTMP372(16) TYPE P DECIMALS 3.
DATA ALTMP373(16) TYPE P DECIMALS 3.
DATA ALTMP374(16) TYPE P DECIMALS 3.
DATA ALTMP375(16) TYPE P DECIMALS 3.
DATA ALTMP376(16) TYPE P DECIMALS 3.
DATA ALTMP377(16) TYPE P DECIMALS 3.
DATA ALTMP378(16) TYPE P DECIMALS 3.
DATA ALTMP379(16) TYPE P DECIMALS 3.
DATA ALTMP380(16) TYPE P DECIMALS 3.
DATA ALTMP381(16) TYPE P DECIMALS 3.
DATA ALTMP382(16) TYPE P DECIMALS 3.
DATA ALTMP383(16) TYPE P DECIMALS 3.
DATA ALTMP384(16) TYPE P DECIMALS 3.
DATA ALTMP385(16) TYPE P DECIMALS 3.
DATA ALTMP386(16) TYPE P DECIMALS 3.
DATA ALTMP387(16) TYPE P DECIMALS 3.
DATA ALTMP388(16) TYPE P DECIMALS 3.
DATA ALTMP389(16) TYPE P DECIMALS 3.
DATA ALTMP390(16) TYPE P DECIMALS 3.
DATA ALTMP391(16) TYPE P DECIMALS 3.
DATA ALTMP392(16) TYPE P DECIMALS 3.
DATA ALTMP393(16) TYPE P DECIMALS 3.
DATA ALTMP394(16) TYPE P DECIMALS 3.
DATA ALTMP395(16) TYPE P DECIMALS 3.
DATA ALTMP396(16) TYPE P DECIMALS 3.
DATA ALTMP397(16) TYPE P DECIMALS 3.
DATA ALTMP398(16) TYPE P DECIMALS 3.
DATA ALTMP399(1) TYPE C.
DATA ALTMP400(1) TYPE C.
DATA ALTMP401(1) TYPE C.
DATA ALTMP402(1) TYPE C.
DATA ALTMP403(1) TYPE C.
DATA ALTMP404(1) TYPE C.
DATA ALTMP405(1) TYPE C.
DATA ALTMP406(1) TYPE C.
DATA ALTMP407(1) TYPE C.
DATA ALTMP408(1) TYPE C.
DATA ALTMP409(1) TYPE C.
DATA ALTMP410(1) TYPE C.
DATA ALTMP411(1) TYPE C.
DATA ALTMP412(1) TYPE C.
DATA ALTMP413(1) TYPE C.
DATA ALTMP414(1) TYPE C.
DATA ALTMP415(1) TYPE N.
DATA ALTMP416(16) TYPE P DECIMALS 0.
DATA ALTMP417(4) TYPE C.
DATA ALTMP418(16) TYPE C.
DATA ALTMP419(10) TYPE C.
DATA ALTMP420(10) TYPE C.
DATA ALTMP421(20) TYPE C.
DATA ALTMP422(4) TYPE C.
DATA ALTMP423(12) TYPE C.
DATA ALTMP424(2) TYPE C.
DATA ALTMP425(5) TYPE C.
DATA ALTMP426(4) TYPE C.
DATA ALTMP427(4) TYPE C.
DATA ALTMP428(4) TYPE C.
DATA ALTMP429(4) TYPE C.
DATA ALTMP430(4) TYPE C.
DATA ALTMP431(40) TYPE C.
DATA ALTMP432(40) TYPE C.
DATA ALTMP433(255) TYPE C.
DATA ALTMP434(40) TYPE C.
DATA ALTMP435(255) TYPE C.

DATA COSS9MANDT LIKE COSS-MANDT.
DATA COSS9LEDNR LIKE COSS-LEDNR.
DATA COSS9OBJNR LIKE COSS-OBJNR.
DATA COSS9GJAHR LIKE COSS-GJAHR.
DATA COSS9WRTTP LIKE COSS-WRTTP.
DATA COSS9VERSN LIKE COSS-VERSN.
DATA COSS9KSTAR LIKE COSS-KSTAR.
DATA COSS9HRKFT LIKE COSS-HRKFT.
DATA COSS9VRGNG LIKE COSS-VRGNG.
DATA COSS9PAROB LIKE COSS-PAROB.
DATA COSS9USPOB LIKE COSS-USPOB.
DATA COSS9BEKNZ LIKE COSS-BEKNZ.
DATA COSS9TWAER LIKE COSS-TWAER.
DATA COSS9PERBL LIKE COSS-PERBL.
DATA COSS9MEINH LIKE COSS-MEINH.
DATA COSS9WTG001 LIKE COSS-WTG001.
DATA COSS9WTG002 LIKE COSS-WTG002.
DATA COSS9WTG003 LIKE COSS-WTG003.
DATA COSS9WTG004 LIKE COSS-WTG004.
DATA COSS9WTG005 LIKE COSS-WTG005.
DATA COSS9WTG006 LIKE COSS-WTG006.
DATA COSS9WTG007 LIKE COSS-WTG007.
DATA COSS9WTG008 LIKE COSS-WTG008.
DATA COSS9WTG009 LIKE COSS-WTG009.
DATA COSS9WTG010 LIKE COSS-WTG010.
DATA COSS9WTG011 LIKE COSS-WTG011.
DATA COSS9WTG012 LIKE COSS-WTG012.
DATA COSS9WTG013 LIKE COSS-WTG013.
DATA COSS9WTG014 LIKE COSS-WTG014.
DATA COSS9WTG015 LIKE COSS-WTG015.
DATA COSS9WTG016 LIKE COSS-WTG016.
DATA COSS9WOG001 LIKE COSS-WOG001.
DATA COSS9WOG002 LIKE COSS-WOG002.
DATA COSS9WOG003 LIKE COSS-WOG003.
DATA COSS9WOG004 LIKE COSS-WOG004.
DATA COSS9WOG005 LIKE COSS-WOG005.
DATA COSS9WOG006 LIKE COSS-WOG006.
DATA COSS9WOG007 LIKE COSS-WOG007.
DATA COSS9WOG008 LIKE COSS-WOG008.
DATA COSS9WOG009 LIKE COSS-WOG009.
DATA COSS9WOG010 LIKE COSS-WOG010.
DATA COSS9WOG011 LIKE COSS-WOG011.
DATA COSS9WOG012 LIKE COSS-WOG012.
DATA COSS9WOG013 LIKE COSS-WOG013.
DATA COSS9WOG014 LIKE COSS-WOG014.
DATA COSS9WOG015 LIKE COSS-WOG015.
DATA COSS9WOG016 LIKE COSS-WOG016.
DATA COSS9WKG001 LIKE COSS-WKG001.
DATA COSS9WKG002 LIKE COSS-WKG002.
DATA COSS9WKG003 LIKE COSS-WKG003.
DATA COSS9WKG004 LIKE COSS-WKG004.
DATA COSS9WKG005 LIKE COSS-WKG005.
DATA COSS9WKG006 LIKE COSS-WKG006.
DATA COSS9WKG007 LIKE COSS-WKG007.
DATA COSS9WKG008 LIKE COSS-WKG008.
DATA COSS9WKG009 LIKE COSS-WKG009.
DATA COSS9WKG010 LIKE COSS-WKG010.
DATA COSS9WKG011 LIKE COSS-WKG011.
DATA COSS9WKG012 LIKE COSS-WKG012.
DATA COSS9WKG013 LIKE COSS-WKG013.
DATA COSS9WKG014 LIKE COSS-WKG014.
DATA COSS9WKG015 LIKE COSS-WKG015.
DATA COSS9WKG016 LIKE COSS-WKG016.
DATA COSS9WKF001 LIKE COSS-WKF001.
DATA COSS9WKF002 LIKE COSS-WKF002.
DATA COSS9WKF003 LIKE COSS-WKF003.
DATA COSS9WKF004 LIKE COSS-WKF004.
DATA COSS9WKF005 LIKE COSS-WKF005.
DATA COSS9WKF006 LIKE COSS-WKF006.
DATA COSS9WKF007 LIKE COSS-WKF007.
DATA COSS9WKF008 LIKE COSS-WKF008.
DATA COSS9WKF009 LIKE COSS-WKF009.
DATA COSS9WKF010 LIKE COSS-WKF010.
DATA COSS9WKF011 LIKE COSS-WKF011.
DATA COSS9WKF012 LIKE COSS-WKF012.
DATA COSS9WKF013 LIKE COSS-WKF013.
DATA COSS9WKF014 LIKE COSS-WKF014.
DATA COSS9WKF015 LIKE COSS-WKF015.
DATA COSS9WKF016 LIKE COSS-WKF016.
DATA COSS9PAG001 LIKE COSS-PAG001.
DATA COSS9PAG002 LIKE COSS-PAG002.
DATA COSS9PAG003 LIKE COSS-PAG003.
DATA COSS9PAG004 LIKE COSS-PAG004.
DATA COSS9PAG005 LIKE COSS-PAG005.
DATA COSS9PAG006 LIKE COSS-PAG006.
DATA COSS9PAG007 LIKE COSS-PAG007.
DATA COSS9PAG008 LIKE COSS-PAG008.
DATA COSS9PAG009 LIKE COSS-PAG009.
DATA COSS9PAG010 LIKE COSS-PAG010.
DATA COSS9PAG011 LIKE COSS-PAG011.
DATA COSS9PAG012 LIKE COSS-PAG012.
DATA COSS9PAG013 LIKE COSS-PAG013.
DATA COSS9PAG014 LIKE COSS-PAG014.
DATA COSS9PAG015 LIKE COSS-PAG015.
DATA COSS9PAG016 LIKE COSS-PAG016.
DATA COSS9PAF001 LIKE COSS-PAF001.
DATA COSS9PAF002 LIKE COSS-PAF002.
DATA COSS9PAF003 LIKE COSS-PAF003.
DATA COSS9PAF004 LIKE COSS-PAF004.
DATA COSS9PAF005 LIKE COSS-PAF005.
DATA COSS9PAF006 LIKE COSS-PAF006.
DATA COSS9PAF007 LIKE COSS-PAF007.
DATA COSS9PAF008 LIKE COSS-PAF008.
DATA COSS9PAF009 LIKE COSS-PAF009.
DATA COSS9PAF010 LIKE COSS-PAF010.
DATA COSS9PAF011 LIKE COSS-PAF011.
DATA COSS9PAF012 LIKE COSS-PAF012.
DATA COSS9PAF013 LIKE COSS-PAF013.
DATA COSS9PAF014 LIKE COSS-PAF014.
DATA COSS9PAF015 LIKE COSS-PAF015.
DATA COSS9PAF016 LIKE COSS-PAF016.
DATA COSS9MEG001 LIKE COSS-MEG001.
DATA COSS9MEG002 LIKE COSS-MEG002.
DATA COSS9MEG003 LIKE COSS-MEG003.
DATA COSS9MEG004 LIKE COSS-MEG004.
DATA COSS9MEG005 LIKE COSS-MEG005.
DATA COSS9MEG006 LIKE COSS-MEG006.
DATA COSS9MEG007 LIKE COSS-MEG007.
DATA COSS9MEG008 LIKE COSS-MEG008.
DATA COSS9MEG009 LIKE COSS-MEG009.
DATA COSS9MEG010 LIKE COSS-MEG010.
DATA COSS9MEG011 LIKE COSS-MEG011.
DATA COSS9MEG012 LIKE COSS-MEG012.
DATA COSS9MEG013 LIKE COSS-MEG013.
DATA COSS9MEG014 LIKE COSS-MEG014.
DATA COSS9MEG015 LIKE COSS-MEG015.
DATA COSS9MEG016 LIKE COSS-MEG016.
DATA COSS9MEF001 LIKE COSS-MEF001.
DATA COSS9MEF002 LIKE COSS-MEF002.
DATA COSS9MEF003 LIKE COSS-MEF003.
DATA COSS9MEF004 LIKE COSS-MEF004.
DATA COSS9MEF005 LIKE COSS-MEF005.
DATA COSS9MEF006 LIKE COSS-MEF006.
DATA COSS9MEF007 LIKE COSS-MEF007.
DATA COSS9MEF008 LIKE COSS-MEF008.
DATA COSS9MEF009 LIKE COSS-MEF009.
DATA COSS9MEF010 LIKE COSS-MEF010.
DATA COSS9MEF011 LIKE COSS-MEF011.
DATA COSS9MEF012 LIKE COSS-MEF012.
DATA COSS9MEF013 LIKE COSS-MEF013.
DATA COSS9MEF014 LIKE COSS-MEF014.
DATA COSS9MEF015 LIKE COSS-MEF015.
DATA COSS9MEF016 LIKE COSS-MEF016.
DATA COSS9MUV001 LIKE COSS-MUV001.
DATA COSS9MUV002 LIKE COSS-MUV002.
DATA COSS9MUV003 LIKE COSS-MUV003.
DATA COSS9MUV004 LIKE COSS-MUV004.
DATA COSS9MUV005 LIKE COSS-MUV005.
DATA COSS9MUV006 LIKE COSS-MUV006.
DATA COSS9MUV007 LIKE COSS-MUV007.
DATA COSS9MUV008 LIKE COSS-MUV008.
DATA COSS9MUV009 LIKE COSS-MUV009.
DATA COSS9MUV010 LIKE COSS-MUV010.
DATA COSS9MUV011 LIKE COSS-MUV011.
DATA COSS9MUV012 LIKE COSS-MUV012.
DATA COSS9MUV013 LIKE COSS-MUV013.
DATA COSS9MUV014 LIKE COSS-MUV014.
DATA COSS9MUV015 LIKE COSS-MUV015.
DATA COSS9MUV016 LIKE COSS-MUV016.
DATA COSS9BELTP LIKE COSS-BELTP.
DATA COSS9TIMESTMP LIKE COSS-TIMESTMP.
DATA COSS9BUKRS LIKE COSS-BUKRS.
DATA COSS9FKBER LIKE COSS-FKBER.
DATA COSS9SEGMENT LIKE COSS-SEGMENT.
DATA COSS9GEBER LIKE COSS-GEBER.
DATA COSS9GRANT_NBR LIKE COSS-GRANT_NBR.
DATA PMSDO9VKORG LIKE PMSDO-VKORG.
DATA AUFK9AUFNR LIKE AUFK-AUFNR.
DATA AUFK9BEMOT LIKE AUFK-BEMOT.
DATA AUFK9WAERS LIKE AUFK-WAERS.
DATA ZSTC_SALE_019BUKRS LIKE ZSTC_SALES_COMP-BUKRS.
DATA ZSTC_SALE_019VKORG LIKE ZSTC_SALES_COMP-VKORG.
DATA ZSTC_SALE_019WERKS LIKE ZSTC_SALES_COMP-WERKS.
DATA ZSTC_SALE_019EKORG LIKE ZSTC_SALES_COMP-EKORG.
DATA ZSTC_SALE_019MAMUSERCMPY LIKE ZSTC_SALES_COMP-MAMUSERCMPY.
DATA ZSTC_SALE_019REGION LIKE ZSTC_SALES_COMP-REGION.
DATA ZSTC_SALE_019COUNTRY LIKE ZSTC_SALES_COMP-COUNTRY.
DATA ZSTC_SALE_019COUNTRYDSCR LIKE ZSTC_SALES_COMP-COUNTRYDSCR.
DATA ZSTC_SALE_019SALESCOMPANY LIKE ZSTC_SALES_COMP-SALESCOMPANY.
DATA ZSTC_SALE_019SALESCMPDSCR LIKE ZSTC_SALES_COMP-SALESCMPDSCR.
DATA AUFK9IDAT3 LIKE AUFK-IDAT3.
DATA AUFK9OBJNR LIKE AUFK-OBJNR.
DATA PMSDO9OBJNR LIKE PMSDO-OBJNR.



SELECT
  COSS9~MANDT
  COSS9~LEDNR
  COSS9~OBJNR
  COSS9~GJAHR
  COSS9~WRTTP
  COSS9~VERSN
  COSS9~KSTAR
  COSS9~HRKFT
  COSS9~VRGNG
  COSS9~PAROB
  COSS9~USPOB
  COSS9~BEKNZ
  COSS9~TWAER
  COSS9~PERBL
  COSS9~MEINH
  COSS9~WTG001
  COSS9~WTG002
  COSS9~WTG003
  COSS9~WTG004
  COSS9~WTG005
  COSS9~WTG006
  COSS9~WTG007
  COSS9~WTG008
  COSS9~WTG009
  COSS9~WTG010
  COSS9~WTG011
  COSS9~WTG012
  COSS9~WTG013
  COSS9~WTG014
  COSS9~WTG015
  COSS9~WTG016
  COSS9~WOG001
  COSS9~WOG002
  COSS9~WOG003
  COSS9~WOG004
  COSS9~WOG005
  COSS9~WOG006
  COSS9~WOG007
  COSS9~WOG008
  COSS9~WOG009
  COSS9~WOG010
  COSS9~WOG011
  COSS9~WOG012
  COSS9~WOG013
  COSS9~WOG014
  COSS9~WOG015
  COSS9~WOG016
  COSS9~WKG001
  COSS9~WKG002
  COSS9~WKG003
  COSS9~WKG004
  COSS9~WKG005
  COSS9~WKG006
  COSS9~WKG007
  COSS9~WKG008
  COSS9~WKG009
  COSS9~WKG010
  COSS9~WKG011
  COSS9~WKG012
  COSS9~WKG013
  COSS9~WKG014
  COSS9~WKG015
  COSS9~WKG016
  COSS9~WKF001
  COSS9~WKF002
  COSS9~WKF003
  COSS9~WKF004
  COSS9~WKF005
  COSS9~WKF006
  COSS9~WKF007
  COSS9~WKF008
  COSS9~WKF009
  COSS9~WKF010
  COSS9~WKF011
  COSS9~WKF012
  COSS9~WKF013
  COSS9~WKF014
  COSS9~WKF015
  COSS9~WKF016
  COSS9~PAG001
  COSS9~PAG002
  COSS9~PAG003
  COSS9~PAG004
  COSS9~PAG005
  COSS9~PAG006
  COSS9~PAG007
  COSS9~PAG008
  COSS9~PAG009
  COSS9~PAG010
  COSS9~PAG011
  COSS9~PAG012
  COSS9~PAG013
  COSS9~PAG014
  COSS9~PAG015
  COSS9~PAG016
  COSS9~PAF001
  COSS9~PAF002
  COSS9~PAF003
  COSS9~PAF004
  COSS9~PAF005
  COSS9~PAF006
  COSS9~PAF007
  COSS9~PAF008
  COSS9~PAF009
  COSS9~PAF010
  COSS9~PAF011
  COSS9~PAF012
  COSS9~PAF013
  COSS9~PAF014
  COSS9~PAF015
  COSS9~PAF016
  COSS9~MEG001
  COSS9~MEG002
  COSS9~MEG003
  COSS9~MEG004
  COSS9~MEG005
  COSS9~MEG006
  COSS9~MEG007
  COSS9~MEG008
  COSS9~MEG009
  COSS9~MEG010
  COSS9~MEG011
  COSS9~MEG012
  COSS9~MEG013
  COSS9~MEG014
  COSS9~MEG015
  COSS9~MEG016
  COSS9~MEF001
  COSS9~MEF002
  COSS9~MEF003
  COSS9~MEF004
  COSS9~MEF005
  COSS9~MEF006
  COSS9~MEF007
  COSS9~MEF008
  COSS9~MEF009
  COSS9~MEF010
  COSS9~MEF011
  COSS9~MEF012
  COSS9~MEF013
  COSS9~MEF014
  COSS9~MEF015
  COSS9~MEF016
  COSS9~MUV001
  COSS9~MUV002
  COSS9~MUV003
  COSS9~MUV004
  COSS9~MUV005
  COSS9~MUV006
  COSS9~MUV007
  COSS9~MUV008
  COSS9~MUV009
  COSS9~MUV010
  COSS9~MUV011
  COSS9~MUV012
  COSS9~MUV013
  COSS9~MUV014
  COSS9~MUV015
  COSS9~MUV016
  COSS9~BELTP
  COSS9~TIMESTMP
  COSS9~BUKRS
  COSS9~FKBER
  COSS9~SEGMENT
  COSS9~GEBER
  COSS9~GRANT_NBR
  PMSDO9~VKORG
  AUFK9~AUFNR
  AUFK9~BEMOT
  AUFK9~WAERS
  ZSTC_SALE_019~BUKRS
  ZSTC_SALE_019~VKORG
  ZSTC_SALE_019~WERKS
  ZSTC_SALE_019~EKORG
  ZSTC_SALE_019~MAMUSERCMPY
  ZSTC_SALE_019~REGION
  ZSTC_SALE_019~COUNTRY
  ZSTC_SALE_019~COUNTRYDSCR
  ZSTC_SALE_019~SALESCOMPANY
  ZSTC_SALE_019~SALESCMPDSCR
  AUFK9~IDAT3
  AUFK9~OBJNR
  PMSDO9~OBJNR
into (COSS9MANDT,
  COSS9LEDNR,
  COSS9OBJNR,
  COSS9GJAHR,
  COSS9WRTTP,
  COSS9VERSN,
  COSS9KSTAR,
  COSS9HRKFT,
  COSS9VRGNG,
  COSS9PAROB,
  COSS9USPOB,
  COSS9BEKNZ,
  COSS9TWAER,
  COSS9PERBL,
  COSS9MEINH,
  COSS9WTG001,
  COSS9WTG002,
  COSS9WTG003,
  COSS9WTG004,
  COSS9WTG005,
  COSS9WTG006,
  COSS9WTG007,
  COSS9WTG008,
  COSS9WTG009,
  COSS9WTG010,
  COSS9WTG011,
  COSS9WTG012,
  COSS9WTG013,
  COSS9WTG014,
  COSS9WTG015,
  COSS9WTG016,
  COSS9WOG001,
  COSS9WOG002,
  COSS9WOG003,
  COSS9WOG004,
  COSS9WOG005,
  COSS9WOG006,
  COSS9WOG007,
  COSS9WOG008,
  COSS9WOG009,
  COSS9WOG010,
  COSS9WOG011,
  COSS9WOG012,
  COSS9WOG013,
  COSS9WOG014,
  COSS9WOG015,
  COSS9WOG016,
  COSS9WKG001,
  COSS9WKG002,
  COSS9WKG003,
  COSS9WKG004,
  COSS9WKG005,
  COSS9WKG006,
  COSS9WKG007,
  COSS9WKG008,
  COSS9WKG009,
  COSS9WKG010,
  COSS9WKG011,
  COSS9WKG012,
  COSS9WKG013,
  COSS9WKG014,
  COSS9WKG015,
  COSS9WKG016,
  COSS9WKF001,
  COSS9WKF002,
  COSS9WKF003,
  COSS9WKF004,
  COSS9WKF005,
  COSS9WKF006,
  COSS9WKF007,
  COSS9WKF008,
  COSS9WKF009,
  COSS9WKF010,
  COSS9WKF011,
  COSS9WKF012,
  COSS9WKF013,
  COSS9WKF014,
  COSS9WKF015,
  COSS9WKF016,
  COSS9PAG001,
  COSS9PAG002,
  COSS9PAG003,
  COSS9PAG004,
  COSS9PAG005,
  COSS9PAG006,
  COSS9PAG007,
  COSS9PAG008,
  COSS9PAG009,
  COSS9PAG010,
  COSS9PAG011,
  COSS9PAG012,
  COSS9PAG013,
  COSS9PAG014,
  COSS9PAG015,
  COSS9PAG016,
  COSS9PAF001,
  COSS9PAF002,
  COSS9PAF003,
  COSS9PAF004,
  COSS9PAF005,
  COSS9PAF006,
  COSS9PAF007,
  COSS9PAF008,
  COSS9PAF009,
  COSS9PAF010,
  COSS9PAF011,
  COSS9PAF012,
  COSS9PAF013,
  COSS9PAF014,
  COSS9PAF015,
  COSS9PAF016,
  COSS9MEG001,
  COSS9MEG002,
  COSS9MEG003,
  COSS9MEG004,
  COSS9MEG005,
  COSS9MEG006,
  COSS9MEG007,
  COSS9MEG008,
  COSS9MEG009,
  COSS9MEG010,
  COSS9MEG011,
  COSS9MEG012,
  COSS9MEG013,
  COSS9MEG014,
  COSS9MEG015,
  COSS9MEG016,
  COSS9MEF001,
  COSS9MEF002,
  COSS9MEF003,
  COSS9MEF004,
  COSS9MEF005,
  COSS9MEF006,
  COSS9MEF007,
  COSS9MEF008,
  COSS9MEF009,
  COSS9MEF010,
  COSS9MEF011,
  COSS9MEF012,
  COSS9MEF013,
  COSS9MEF014,
  COSS9MEF015,
  COSS9MEF016,
  COSS9MUV001,
  COSS9MUV002,
  COSS9MUV003,
  COSS9MUV004,
  COSS9MUV005,
  COSS9MUV006,
  COSS9MUV007,
  COSS9MUV008,
  COSS9MUV009,
  COSS9MUV010,
  COSS9MUV011,
  COSS9MUV012,
  COSS9MUV013,
  COSS9MUV014,
  COSS9MUV015,
  COSS9MUV016,
  COSS9BELTP,
  COSS9TIMESTMP,
  COSS9BUKRS,
  COSS9FKBER,
  COSS9SEGMENT,
  COSS9GEBER,
  COSS9GRANT_NBR,
  PMSDO9VKORG,
  AUFK9AUFNR,
  AUFK9BEMOT,
  AUFK9WAERS,
  ZSTC_SALE_019BUKRS,
  ZSTC_SALE_019VKORG,
  ZSTC_SALE_019WERKS,
  ZSTC_SALE_019EKORG,
  ZSTC_SALE_019MAMUSERCMPY,
  ZSTC_SALE_019REGION,
  ZSTC_SALE_019COUNTRY,
  ZSTC_SALE_019COUNTRYDSCR,
  ZSTC_SALE_019SALESCOMPANY,
  ZSTC_SALE_019SALESCMPDSCR,
  AUFK9IDAT3,
  AUFK9OBJNR,
  PMSDO9OBJNR)
FROM PMSDO AS PMSDO9
 INNER JOIN COSS AS COSS9
 ON ( PMSDO9~OBJNR = COSS9~OBJNR )
 INNER JOIN ZSTC_SALES_COMP AS ZSTC_SALE_019
 ON ( PMSDO9~VKORG = ZSTC_SALE_019~VKORG )
 INNER JOIN AUFK AS AUFK9
 ON ( AUFK9~OBJNR = COSS9~OBJNR )
WHERE ( NOT ( ( PMSDO9~VKORG like '%04' ) )
 AND ( NOT ( ( PMSDO9~VKORG like '%03' ) )
 AND ( NOT ( ( PMSDO9~VKORG like '%02' ) )
 AND ( ( ( AUFK9~IDAT3 <= $PARAM1 )
 OR ( AUFK9~IDAT3 >= $PARAM2 ) )
 AND ( ( COSS9~GJAHR > 2001 )
 AND ( ( COSS9~BELTP = 1 )
 AND ( COSS9~WRTTP = '01' ) ) ) ) ) ) ).
ALTMP256 = COSS9MANDT.
ALTMP257 = COSS9LEDNR.
ALTMP258 = COSS9OBJNR.
ALTMP259 = COSS9GJAHR.
ALTMP260 = COSS9WRTTP.
ALTMP261 = COSS9VERSN.
ALTMP262 = COSS9KSTAR.
ALTMP263 = COSS9HRKFT.
ALTMP264 = COSS9VRGNG.
ALTMP265 = COSS9PAROB.
ALTMP266 = COSS9USPOB.
ALTMP267 = COSS9BEKNZ.
ALTMP268 = COSS9TWAER.
ALTMP269 = COSS9PERBL.
ALTMP270 = COSS9MEINH.
ALTMP271 = COSS9WTG001.
ALTMP272 = COSS9WTG002.
ALTMP273 = COSS9WTG003.
ALTMP274 = COSS9WTG004.
ALTMP275 = COSS9WTG005.
ALTMP276 = COSS9WTG006.
ALTMP277 = COSS9WTG007.
ALTMP278 = COSS9WTG008.
ALTMP279 = COSS9WTG009.
ALTMP280 = COSS9WTG010.
ALTMP281 = COSS9WTG011.
ALTMP282 = COSS9WTG012.
ALTMP283 = COSS9WTG013.
ALTMP284 = COSS9WTG014.
ALTMP285 = COSS9WTG015.
ALTMP286 = COSS9WTG016.
ALTMP287 = COSS9WOG001.
ALTMP288 = COSS9WOG002.
ALTMP289 = COSS9WOG003.
ALTMP290 = COSS9WOG004.
ALTMP291 = COSS9WOG005.
ALTMP292 = COSS9WOG006.
ALTMP293 = COSS9WOG007.
ALTMP294 = COSS9WOG008.
ALTMP295 = COSS9WOG009.
ALTMP296 = COSS9WOG010.
ALTMP297 = COSS9WOG011.
ALTMP298 = COSS9WOG012.
ALTMP299 = COSS9WOG013.
ALTMP300 = COSS9WOG014.
ALTMP301 = COSS9WOG015.
ALTMP302 = COSS9WOG016.
ALTMP303 = COSS9WKG001.
ALTMP304 = COSS9WKG002.
ALTMP305 = COSS9WKG003.
ALTMP306 = COSS9WKG004.
ALTMP307 = COSS9WKG005.
ALTMP308 = COSS9WKG006.
ALTMP309 = COSS9WKG007.
ALTMP310 = COSS9WKG008.
ALTMP311 = COSS9WKG009.
ALTMP312 = COSS9WKG010.
ALTMP313 = COSS9WKG011.
ALTMP314 = COSS9WKG012.
ALTMP315 = COSS9WKG013.
ALTMP316 = COSS9WKG014.
ALTMP317 = COSS9WKG015.
ALTMP318 = COSS9WKG016.
ALTMP319 = COSS9WKF001.
ALTMP320 = COSS9WKF002.
ALTMP321 = COSS9WKF003.
ALTMP322 = COSS9WKF004.
ALTMP323 = COSS9WKF005.
ALTMP324 = COSS9WKF006.
ALTMP325 = COSS9WKF007.
ALTMP326 = COSS9WKF008.
ALTMP327 = COSS9WKF009.
ALTMP328 = COSS9WKF010.
ALTMP329 = COSS9WKF011.
ALTMP330 = COSS9WKF012.
ALTMP331 = COSS9WKF013.
ALTMP332 = COSS9WKF014.
ALTMP333 = COSS9WKF015.
ALTMP334 = COSS9WKF016.
ALTMP335 = COSS9PAG001.
ALTMP336 = COSS9PAG002.
ALTMP337 = COSS9PAG003.
ALTMP338 = COSS9PAG004.
ALTMP339 = COSS9PAG005.
ALTMP340 = COSS9PAG006.
ALTMP341 = COSS9PAG007.
ALTMP342 = COSS9PAG008.
ALTMP343 = COSS9PAG009.
ALTMP344 = COSS9PAG010.
ALTMP345 = COSS9PAG011.
ALTMP346 = COSS9PAG012.
ALTMP347 = COSS9PAG013.
ALTMP348 = COSS9PAG014.
ALTMP349 = COSS9PAG015.
ALTMP350 = COSS9PAG016.
ALTMP351 = COSS9PAF001.
ALTMP352 = COSS9PAF002.
ALTMP353 = COSS9PAF003.
ALTMP354 = COSS9PAF004.
ALTMP355 = COSS9PAF005.
ALTMP356 = COSS9PAF006.
ALTMP357 = COSS9PAF007.
ALTMP358 = COSS9PAF008.
ALTMP359 = COSS9PAF009.
ALTMP360 = COSS9PAF010.
ALTMP361 = COSS9PAF011.
ALTMP362 = COSS9PAF012.
ALTMP363 = COSS9PAF013.
ALTMP364 = COSS9PAF014.
ALTMP365 = COSS9PAF015.
ALTMP366 = COSS9PAF016.
ALTMP367 = COSS9MEG001.
ALTMP368 = COSS9MEG002.
ALTMP369 = COSS9MEG003.
ALTMP370 = COSS9MEG004.
ALTMP371 = COSS9MEG005.
ALTMP372 = COSS9MEG006.
ALTMP373 = COSS9MEG007.
ALTMP374 = COSS9MEG008.
ALTMP375 = COSS9MEG009.
ALTMP376 = COSS9MEG010.
ALTMP377 = COSS9MEG011.
ALTMP378 = COSS9MEG012.
ALTMP379 = COSS9MEG013.
ALTMP380 = COSS9MEG014.
ALTMP381 = COSS9MEG015.
ALTMP382 = COSS9MEG016.
ALTMP383 = COSS9MEF001.
ALTMP384 = COSS9MEF002.
ALTMP385 = COSS9MEF003.
ALTMP386 = COSS9MEF004.
ALTMP387 = COSS9MEF005.
ALTMP388 = COSS9MEF006.
ALTMP389 = COSS9MEF007.
ALTMP390 = COSS9MEF008.
ALTMP391 = COSS9MEF009.
ALTMP392 = COSS9MEF010.
ALTMP393 = COSS9MEF011.
ALTMP394 = COSS9MEF012.
ALTMP395 = COSS9MEF013.
ALTMP396 = COSS9MEF014.
ALTMP397 = COSS9MEF015.
ALTMP398 = COSS9MEF016.
ALTMP399 = COSS9MUV001.
ALTMP400 = COSS9MUV002.
ALTMP401 = COSS9MUV003.
ALTMP402 = COSS9MUV004.
ALTMP403 = COSS9MUV005.
ALTMP404 = COSS9MUV006.
ALTMP405 = COSS9MUV007.
ALTMP406 = COSS9MUV008.
ALTMP407 = COSS9MUV009.
ALTMP408 = COSS9MUV010.
ALTMP409 = COSS9MUV011.
ALTMP410 = COSS9MUV012.
ALTMP411 = COSS9MUV013.
ALTMP412 = COSS9MUV014.
ALTMP413 = COSS9MUV015.
ALTMP414 = COSS9MUV016.
ALTMP415 = COSS9BELTP.
ALTMP416 = COSS9TIMESTMP.
ALTMP417 = COSS9BUKRS.
ALTMP418 = COSS9FKBER.
ALTMP419 = COSS9SEGMENT.
ALTMP420 = COSS9GEBER.
ALTMP421 = COSS9GRANT_NBR.
ALTMP422 = PMSDO9VKORG.
ALTMP423 = AUFK9AUFNR.
ALTMP424 = AUFK9BEMOT.
ALTMP425 = AUFK9WAERS.
ALTMP426 = ZSTC_SALE_019BUKRS.
ALTMP427 = ZSTC_SALE_019VKORG.
ALTMP428 = ZSTC_SALE_019WERKS.
ALTMP429 = ZSTC_SALE_019EKORG.
ALTMP430 = ZSTC_SALE_019MAMUSERCMPY.
ALTMP431 = ZSTC_SALE_019REGION.
ALTMP432 = ZSTC_SALE_019COUNTRY.
ALTMP433 = ZSTC_SALE_019COUNTRYDSCR.
ALTMP434 = ZSTC_SALE_019SALESCOMPANY.
ALTMP435 = ZSTC_SALE_019SALESCMPDSCR.
 move ALTMP256 to ITAB5-MANDT.
 move ALTMP257 to ITAB5-LEDNR.
 move ALTMP258 to ITAB5-OBJNR.
 move ALTMP259 to ITAB5-GJAHR.
 move ALTMP260 to ITAB5-WRTTP.
 move ALTMP261 to ITAB5-VERSN.
 move ALTMP262 to ITAB5-KSTAR.
 move ALTMP263 to ITAB5-HRKFT.
 move ALTMP264 to ITAB5-VRGNG.
 move ALTMP265 to ITAB5-PAROB.
 move ALTMP266 to ITAB5-USPOB.
 move ALTMP267 to ITAB5-BEKNZ.
 move ALTMP268 to ITAB5-TWAER.
 move ALTMP269 to ITAB5-PERBL.
 move ALTMP270 to ITAB5-MEINH.
 move ALTMP271 to ITAB5-WTG001.
 move ALTMP272 to ITAB5-WTG002.
 move ALTMP273 to ITAB5-WTG003.
 move ALTMP274 to ITAB5-WTG004.
 move ALTMP275 to ITAB5-WTG005.
 move ALTMP276 to ITAB5-WTG006.
 move ALTMP277 to ITAB5-WTG007.
 move ALTMP278 to ITAB5-WTG008.
 move ALTMP279 to ITAB5-WTG009.
 move ALTMP280 to ITAB5-WTG010.
 move ALTMP281 to ITAB5-WTG011.
 move ALTMP282 to ITAB5-WTG012.
 move ALTMP283 to ITAB5-WTG013.
 move ALTMP284 to ITAB5-WTG014.
 move ALTMP285 to ITAB5-WTG015.
 move ALTMP286 to ITAB5-WTG016.
 move ALTMP287 to ITAB5-WOG001.
 move ALTMP288 to ITAB5-WOG002.
 move ALTMP289 to ITAB5-WOG003.
 move ALTMP290 to ITAB5-WOG004.
 move ALTMP291 to ITAB5-WOG005.
 move ALTMP292 to ITAB5-WOG006.
 move ALTMP293 to ITAB5-WOG007.
 move ALTMP294 to ITAB5-WOG008.
 move ALTMP295 to ITAB5-WOG009.
 move ALTMP296 to ITAB5-WOG010.
 move ALTMP297 to ITAB5-WOG011.
 move ALTMP298 to ITAB5-WOG012.
 move ALTMP299 to ITAB5-WOG013.
 move ALTMP300 to ITAB5-WOG014.
 move ALTMP301 to ITAB5-WOG015.
 move ALTMP302 to ITAB5-WOG016.
 move ALTMP303 to ITAB5-WKG001.
 move ALTMP304 to ITAB5-WKG002.
 move ALTMP305 to ITAB5-WKG003.
 move ALTMP306 to ITAB5-WKG004.
 move ALTMP307 to ITAB5-WKG005.
 move ALTMP308 to ITAB5-WKG006.
 move ALTMP309 to ITAB5-WKG007.
 move ALTMP310 to ITAB5-WKG008.
 move ALTMP311 to ITAB5-WKG009.
 move ALTMP312 to ITAB5-WKG010.
 move ALTMP313 to ITAB5-WKG011.
 move ALTMP314 to ITAB5-WKG012.
 move ALTMP315 to ITAB5-WKG013.
 move ALTMP316 to ITAB5-WKG014.
 move ALTMP317 to ITAB5-WKG015.
 move ALTMP318 to ITAB5-WKG016.
 move ALTMP319 to ITAB5-WKF001.
 move ALTMP320 to ITAB5-WKF002.
 move ALTMP321 to ITAB5-WKF003.
 move ALTMP322 to ITAB5-WKF004.
 move ALTMP323 to ITAB5-WKF005.
 move ALTMP324 to ITAB5-WKF006.
 move ALTMP325 to ITAB5-WKF007.
 move ALTMP326 to ITAB5-WKF008.
 move ALTMP327 to ITAB5-WKF009.
 move ALTMP328 to ITAB5-WKF010.
 move ALTMP329 to ITAB5-WKF011.
 move ALTMP330 to ITAB5-WKF012.
 move ALTMP331 to ITAB5-WKF013.
 move ALTMP332 to ITAB5-WKF014.
 move ALTMP333 to ITAB5-WKF015.
 move ALTMP334 to ITAB5-WKF016.
 move ALTMP335 to ITAB5-PAG001.
 move ALTMP336 to ITAB5-PAG002.
 move ALTMP337 to ITAB5-PAG003.
 move ALTMP338 to ITAB5-PAG004.
 move ALTMP339 to ITAB5-PAG005.
 move ALTMP340 to ITAB5-PAG006.
 move ALTMP341 to ITAB5-PAG007.
 move ALTMP342 to ITAB5-PAG008.
 move ALTMP343 to ITAB5-PAG009.
 move ALTMP344 to ITAB5-PAG010.
 move ALTMP345 to ITAB5-PAG011.
 move ALTMP346 to ITAB5-PAG012.
 move ALTMP347 to ITAB5-PAG013.
 move ALTMP348 to ITAB5-PAG014.
 move ALTMP349 to ITAB5-PAG015.
 move ALTMP350 to ITAB5-PAG016.
 move ALTMP351 to ITAB5-PAF001.
 move ALTMP352 to ITAB5-PAF002.
 move ALTMP353 to ITAB5-PAF003.
 move ALTMP354 to ITAB5-PAF004.
 move ALTMP355 to ITAB5-PAF005.
 move ALTMP356 to ITAB5-PAF006.
 move ALTMP357 to ITAB5-PAF007.
 move ALTMP358 to ITAB5-PAF008.
 move ALTMP359 to ITAB5-PAF009.
 move ALTMP360 to ITAB5-PAF010.
 move ALTMP361 to ITAB5-PAF011.
 move ALTMP362 to ITAB5-PAF012.
 move ALTMP363 to ITAB5-PAF013.
 move ALTMP364 to ITAB5-PAF014.
 move ALTMP365 to ITAB5-PAF015.
 move ALTMP366 to ITAB5-PAF016.
 move ALTMP367 to ITAB5-MEG001.
 move ALTMP368 to ITAB5-MEG002.
 move ALTMP369 to ITAB5-MEG003.
 move ALTMP370 to ITAB5-MEG004.
 move ALTMP371 to ITAB5-MEG005.
 move ALTMP372 to ITAB5-MEG006.
 move ALTMP373 to ITAB5-MEG007.
 move ALTMP374 to ITAB5-MEG008.
 move ALTMP375 to ITAB5-MEG009.
 move ALTMP376 to ITAB5-MEG010.
 move ALTMP377 to ITAB5-MEG011.
 move ALTMP378 to ITAB5-MEG012.
 move ALTMP379 to ITAB5-MEG013.
 move ALTMP380 to ITAB5-MEG014.
 move ALTMP381 to ITAB5-MEG015.
 move ALTMP382 to ITAB5-MEG016.
 move ALTMP383 to ITAB5-MEF001.
 move ALTMP384 to ITAB5-MEF002.
 move ALTMP385 to ITAB5-MEF003.
 move ALTMP386 to ITAB5-MEF004.
 move ALTMP387 to ITAB5-MEF005.
 move ALTMP388 to ITAB5-MEF006.
 move ALTMP389 to ITAB5-MEF007.
 move ALTMP390 to ITAB5-MEF008.
 move ALTMP391 to ITAB5-MEF009.
 move ALTMP392 to ITAB5-MEF010.
 move ALTMP393 to ITAB5-MEF011.
 move ALTMP394 to ITAB5-MEF012.
 move ALTMP395 to ITAB5-MEF013.
 move ALTMP396 to ITAB5-MEF014.
 move ALTMP397 to ITAB5-MEF015.
 move ALTMP398 to ITAB5-MEF016.
 move ALTMP399 to ITAB5-MUV001.
 move ALTMP400 to ITAB5-MUV002.
 move ALTMP401 to ITAB5-MUV003.
 move ALTMP402 to ITAB5-MUV004.
 move ALTMP403 to ITAB5-MUV005.
 move ALTMP404 to ITAB5-MUV006.
 move ALTMP405 to ITAB5-MUV007.
 move ALTMP406 to ITAB5-MUV008.
 move ALTMP407 to ITAB5-MUV009.
 move ALTMP408 to ITAB5-MUV010.
 move ALTMP409 to ITAB5-MUV011.
 move ALTMP410 to ITAB5-MUV012.
 move ALTMP411 to ITAB5-MUV013.
 move ALTMP412 to ITAB5-MUV014.
 move ALTMP413 to ITAB5-MUV015.
 move ALTMP414 to ITAB5-MUV016.
 move ALTMP415 to ITAB5-BELTP.
 move ALTMP416 to ITAB5-TIMESTMP.
 move ALTMP417 to ITAB5-BUKRS.
 move ALTMP418 to ITAB5-FKBER.
 move ALTMP419 to ITAB5-SEGMENT.
 move ALTMP420 to ITAB5-GEBER.
 move ALTMP421 to ITAB5-GRANT_NBR.
 move ALTMP422 to ITAB5-VKORG.
 move ALTMP423 to ITAB5-AUFNR.
 move ALTMP424 to ITAB5-BEMOT.
 move ALTMP425 to ITAB5-WAERS.
 move ALTMP426 to ITAB5-Z_BUKRS.
 move ALTMP427 to ITAB5-Z_VKORG.
 move ALTMP428 to ITAB5-Z_WERKS.
 move ALTMP429 to ITAB5-Z_EKORG.
 move ALTMP430 to ITAB5-Z_MAMUSERCMPY.
 move ALTMP431 to ITAB5-Z_REGION.
 move ALTMP432 to ITAB5-Z_COUNTRY.
 move ALTMP433 to ITAB5-Z_COUNTRYDSCR.
 move ALTMP434 to ITAB5-Z_SALESCOMPANY.
 move ALTMP435 to ITAB5-Z_SALESCMPDSCR.
 append ITAB5.
 cntbuf = cntbuf + 1.
 if download = 'N'.
  if cntbuf > 5000.
    perform FORM6.
    clear cntbuf.
    refresh ITAB5.
    append_flag = 'A'.
  endif.
 endif.
 if download = 'S'.
  if cntbuf > P_PKGSZ.
    perform FORM6.
    clear cntbuf.
    refresh ITAB5.
  endif.
 endif.
ENDSELECT.
ENDFORM.

FORM FORM6.
data: outfile(512), ldfile(50).
ldfile = 'CTS_LZ_SAP_CP1_PLICSTDET_D'.
concatenate out_dir ldfile into outfile
  separated by '/'.
  IF DOWNLOAD = 'S'.
     DATA: error_message(700),mtext(800),iEOP(1).
     CALL FUNCTION P_SRVFM
          DESTINATION P_DEST
          KEEPING LOGICAL UNIT OF WORK
          EXPORTING
            EOS = last_batch
          IMPORTING
            EOP = iEOP
          TABLES
            E_TABLE = ITAB5
          EXCEPTIONS
            READ_ERROR = 1
            SYSTEM_FAILURE = 2
            MESSAGE error_message
            COMMUNICATION_FAILURE = 3
            MESSAGE error_message
            OTHERS = 4.

     IF sy-subrc ne 0.
        Case sy-subrc.
        when 1.
        CONCATENATE
        'Data Services read error. '
        'Check Data Services error log.'
        INTO mtext.
        MESSAGE  E240(S#) WITH mtext.
        when 2.
        CONCATENATE
'SAP System Failure while calling DS remote function: '
      error_message INTO mtext.
        MESSAGE  E240(S#) WITH mtext.
        when 3.
        CONCATENATE
'SAP System Failure while calling DS remote function: '
      error_message INTO mtext.
        MESSAGE  E240(S#) WITH mtext.
        when 4.
        MESSAGE  E240(S#) WITH
'Other SAP System Failure while calling DS remote function.'.
        endcase.
      ENDIF.
      IF iEOP = 'X'.
         PERFORM DISCONNECT_RFCDEST_FROM_PROGID.
         LEAVE PROGRAM.
       ENDIF.
  ELSE.
data  dlmtlen type i value '1'.
data xdlmtlen type i value '1'.
data:
  ht(1) type c,
  xht(1) type x,
  conv type ref to cl_abap_conv_in_ce.
xht = '7F'.
conv = cl_abap_conv_in_ce=>create(
  encoding = '1100'
  input = xht
).
call method conv->read(
  exporting n    = xdlmtlen
  importing data = ht
            len = dlmtlen
).
data return_code type i.
 perform write_delimited_file
           tables   ITAB5
           using    outfile
                    append_flag
                    ht
                    dlmtlen
                    download
           changing return_code.

  case return_code.
    when 1.
      IF EXECMODE = 'D'.
        WRITE: /5 'No line selected'.
      ELSE.
        MESSAGE E047(S#).
      ENDIF.
    when 2.
      IF EXECMODE = 'D'.
        WRITE: /5 'Open File Error -- ', 25 OUTFILE.
      ELSE.
        MESSAGE  E084(E0) WITH OUTFILE.
      ENDIF.
    when 3.
      IF EXECMODE = 'D'.
        WRITE: /5 'Data exceed length limit (8192) '.
      ELSE.
        MESSAGE  E240(S#) WITH
             'Data exceed length limit (8192) '.
      ENDIF.
    when 4.
      IF EXECMODE = 'D'.
        WRITE: /5 'Call function WS_DOWNLOAD error'.
      ELSE.
        MESSAGE  E240(S#) WITH
             'Call function WS_DOWNLOAD error'.
      ENDIF.
  endcase.
 ENDIF.
ENDFORM.

FORM SUBSTRING USING SRC BEG LEN CHANGING RET.

DATA: VA1 TYPE I.
DATA: VA2 TYPE I.
DATA: VA3 TYPE I.

VA3 = STRLEN( SRC ).

IF  BEG = 0.   VA1 = 0.
ELSE.
  IF  BEG < 0.
    VA1 = VA3 + BEG.
    IF  VA1 < 0.   VA1 = 0.
    ENDIF.
  ELSE.          VA1 = BEG - 1.
  ENDIF.
ENDIF.

IF  LEN < 0.   VA2 = 0.
ELSE.          VA2 = VA3 - VA1.
ENDIF.

IF  VA2 > LEN. VA2 = LEN.
ENDIF.

IF  VA2 < 1.   MOVE ''           TO RET.
ELSE.          MOVE SRC+VA1(VA2) TO RET.
ENDIF.

ENDFORM.

form write_delimited_file
           tables   datatab
           using    file
                    append
                    delimit
                    dlength
                    dwnload
          changing rc.

  data: type1,
        appd(1),
        temp(32),
        time1(8),
        date1(10),
        output(8192),
        rcount type i,
        offset type i,
        tablen type i,
        maxlen type i value '8192'.

  data: begin of clientab occurs 0,
             output(8192),
          end of clientab.

  field-symbols: <f>.
  field-symbols <delim1>.
  data delim2(16).
  data l_filename type string.

  appd = append.
  if appd is not initial.
     appd = 'X'.
  endif.
  move file to l_filename.
  describe table datatab lines tablen.


  if dwnload = 'Y'.
     clear clientab. refresh clientab.
     rcount = 0.
  else.
     if appd = space.
   open dataset file for output in text mode ENCODING UTF-8.
     else.
    open dataset file for appending in text mode ENCODING UTF-8.
     endif.
     if sy-subrc <> 0.
         rc = 2. exit.
     endif.
  endif.

  loop at datatab.
    clear: tablen, offset, output.
    do.
      assign component sy-index of
         structure datatab to <f>.
      if sy-subrc <> 0. exit. endif.
      if sy-index > 1.
         assign delimit(dlength) TO <delim1> CASTING TYPE C.
         delim2 = <delim1>.
         write delim2(dlength) to output+offset(dlength).
         add dlength to offset.
      endif.

      describe field <f> type type1.

      if type1 = 'I' or type1 = 'N'.
          type1 = 'P'.
      endif.

      case type1.
        when 'D'.
          if <f> = '00000000'.
             <f> = ' '.
          else.
             move <f> to time1.
             assign time1 to <f>.
          endif.
        when 'F'.
          if <f> = '0.0'.
            temp = '0.0'.
          else.
             write <f> to temp exponent 0.
          endif.
          condense temp no-gaps.
          translate temp using ',.'.
          assign temp to <f>.
        when 'P'.
          if <f> < 0.
             write '-' to output+offset(1).
             add 1 to offset.
             <f> = <f> * ( -1 ).
          endif.
          move <f> to temp.
          condense temp no-gaps.
          translate temp using ',.'.
          assign temp to <f>.
      endcase.

      sy-fdpos = strlen( <f> ).

      tablen = offset + sy-fdpos.
      if tablen > maxlen.
         rc = 3. exit.
      endif.
      write <f> to output+offset(sy-fdpos).
      add sy-fdpos to offset.
    enddo.

    if dwnload = 'Y'.
       clientab-output = output.
       append clientab.
       rcount = rcount + 1.
       if rcount >= 50.
          SY-BATCH = SPACE.
          CALL FUNCTION 'GUI_DOWNLOAD'
            EXPORTING
              FILENAME = l_filename
              FILETYPE = 'ASC'
              CODEPAGE = '4110'
              APPEND   = appd
              WRITE_FIELD_SEPARATOR = 'X'
*            IMPORTING
*              FILELENGTH =
            TABLES
              DATA_TAB = clientab
            EXCEPTIONS
              OTHERS = 1.
          if sy-subrc <> 0.
             rc = 4.
          endif.
          clear clientab. refresh clientab.
          rcount = 0. appd = 'A'.
       endif.
    else.
       transfer output to file.
    endif.
  endloop.

  if dwnload = 'Y'.
       SY-BATCH = SPACE.
       CALL FUNCTION 'GUI_DOWNLOAD'
         EXPORTING
           FILENAME = l_filename
           FILETYPE = 'ASC'
              CODEPAGE = '4110'
           APPEND   = appd
           WRITE_FIELD_SEPARATOR = 'X'
*         IMPORTING
*           FILELENGTH =
         TABLES
           DATA_TAB = clientab
         EXCEPTIONS
           OTHERS = 1.
          if sy-subrc <> 0.
             rc = 4.
          endif.
  else.
       close dataset file.
  endif.
endform.

FORM CONNECT_RFCDEST_TO_PROGID.
 INCLUDE rfctypes.

 DATA: len     type i,
       R3NAME(4),
       SYSTNR(2),
       uid     LIKE SYS_UID,
       options LIKE RFCOPT,
       isunicode  TYPE n.

 DATA: NTOTAL     LIKE GWY_STRUCT-NOREG,
       GWY_GWHOST LIKE GWY_STRUCT-GWHOST,
       GWY_GWSERV LIKE GWY_STRUCT-GWSERV,
       GWY_TPNAME LIKE GWY_SYSTEM-TPNAME.

 TABLES: RFCSI.

* Check program ID
 IF P_PROGID = SPACE.							
    RAISE INVALID_PROGRAM_ID.
 ENDIF.

* determine if the RFC destination authority
  CALL FUNCTION 'RFC_READ_TCPIP_DESTINATION'
       EXPORTING destination = P_DEST
                 authority_check = 'X'
  IMPORTING rfcunicode = isunicode.

* Use current gateway if no info exits
 IF P_GWHOST = SPACE OR P_GWSERV = SPACE.
  CALL FUNCTION 'RFC_SYSTEM_INFO'
      IMPORTING
          RFCSI_EXPORT = RFCSI.

  len = strlen( rfcsi-rfcdest ) - 2.
  systnr = rfcsi-rfcdest+len.
  len = len - 1 - 3.
  r3name = rfcsi-rfcdest+len(3).
  len = len - 1.
  options-rfcgwhost = rfcsi-rfcdest(len).
  CONCATENATE 'sapgw' SYSTNR INTO options-rfcgwserv.
 ELSE.
   options-rfcgwhost = P_GWHOST.
   options-rfcgwserv = P_GWSERV.
 ENDIF.

* Parameters for GWY function call
  GWY_GWHOST = OPTIONS-RFCGWHOST.
  GWY_GWSERV = OPTIONS-RFCGWSERV.
  GWY_TPNAME = P_PROGID.

* Check gateway and server program registered
  CALL FUNCTION 'GWY_GET_NO_REG_PROGRAMS'
     EXPORTING
        GWHOST      = GWY_GWHOST
        GWSERV      = GWY_GWSERV
        TPNAME      = GWY_TPNAME
     IMPORTING
        NOREG_TOTAL = NTOTAL
     EXCEPTIONS
        OTHERS      = 1.

  IF sy-subrc NE 0.
     raise CONNECT_TO_GATEWAY_FAILED.
  ENDIF.

  IF NTOTAL = 0.
     raise SERVER_NOT_REGISTERED.
  ENDIF.

  IF NTOTAL GT 1.
     raise DUPLICATE_REG_PROGRAMS.
  ENDIF.

* build new connection to a registered server
  options-rfcexec   = gwy_tpname.
  options-rfcgwhost = gwy_gwhost.
  options-rfcgwserv = gwy_gwserv.
  options-rfchost   = '%%RFCSERVER%%'.
  IF P_SNC_ON = 'X'.
    options-rfcsnc  = 'X'.
  ENDIF.

  CALL 'RFCControl' ID 'CODE' FIELD 'O'
                    ID 'DESTINATION' FIELD P_DEST
                    ID 'TYPE' FIELD rfctype_external_tcp
                    ID 'OPTIONS' FIELD options.

  IF sy-subrc NE 0.
     RAISE CONNECT_TO_REG_SERVER_FAILED.
   ENDIF.

* and set exclusive mode to keep server owned
  CALL FUNCTION 'SYSTEM_SET_REG_SERVER_PROPERTY'
      EXPORTING  destination = P_DEST
                 exclusiv    = 'Y'
      EXCEPTIONS connect_to_reg_server_failed = 1
                 exclusiv_not_supported       = 2.

  IF SY-SUBRC NE 0.
     CASE SY-SUBRC.
          WHEN 1.
              RAISE CONNECT_TO_REG_SERVER_FAILED.
          WHEN 2.
              RAISE EXCLUSIV_NOT_SUPPORTED.
     ENDCASE.
  ENDIF.

ENDFORM.

FORM DISCONNECT_RFCDEST_FROM_PROGID.
* set exclusive mode to E to end the session
  CALL FUNCTION 'SYSTEM_SET_REG_SERVER_PROPERTY'
     EXPORTING
         destination = P_DEST
         exclusiv    = 'E'
     EXCEPTIONS
         connect_to_reg_server_failed = 1				
         exclusiv_not_supported       = 2.
ENDFORM.
