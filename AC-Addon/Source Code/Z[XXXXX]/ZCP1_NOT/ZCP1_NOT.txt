REPORT ZAL_ABAP message-id 26 line-size 255
no standard page heading.
* ZCP1_NOT.
PARAMETER DOWNLOAD(1) DEFAULT 'S' lower case. "N-svr,Y-clnt
PARAMETER EXECMODE(1) DEFAULT 'B' lower case. "D-dlg,B-btch
PARAMETER OUT_DIR(48) DEFAULT "output file dir
'/var/load/CD1/UK/read' lower case.
PARAMETER IN_DIR(48) DEFAULT "input file dir
'/var/load/CD1/UK/read' lower case.
PARAMETER P_DEST TYPE RFCDES-RFCDEST DEFAULT
'NONE'.
PARAMETER P_PROGID TYPE RFCOPT-RFCEXEC DEFAULT
SPACE.
PARAMETER P_GWHOST TYPE RFCOPT-RFCGWHOST DEFAULT
SPACE.
PARAMETER P_GWSERV TYPE RFCOPT-RFCGWSERV DEFAULT
SPACE.
PARAMETER P_SRVFM(30) DEFAULT "Server Callback function
SPACE.
PARAMETER P_PKGSZ TYPE I DEFAULT "Stream package size
5000.
PARAMETER P_SNC_ON(1) DEFAULT "X-on SPACE-off
SPACE.

PARAMETER P_DF_VK(40) DEFAULT "ABAP data flow object key
'' lower case.
PARAMETER P_DI_GEN(40) DEFAULT "DI version that generated ABAP
'' lower case.

*** Machine generated ABAP. Do not modify.            ***
*** (C)Copyright Business Objects S.A.  All rights reserved. ***
*
* Date Time:
*    12/24/15 07:43:09
* SAP used for generated this ABAP:
*    Release: 701
*    Host   : 10.25.3.82
*
* ABAP Dataflow Name:
*    DF_R3_CTS_LZ_SAP_CP1_QMEL_NOT_I
* ABAP program name in SAP:
*  ZCP1_NOT
* Generated ABAP file name:
*    //AIRSBEAP0512/D$/Data/SAPLogistics/VAL/ABAP/ZCP1_NOT
TABLES QMEL.
TABLES QMIH.
TABLES ILOA.
TABLES ZSTC_SALES_COMP.

DATA: begin of ITAB5 occurs 0,
QMNUM(12) TYPE C,
MANDT(3) TYPE C,
QMART(2) TYPE C,
QMTXT(40) TYPE C,
ARTPR(2) TYPE C,
PRIOK(1) TYPE C,
ERNAM(12) TYPE C,
ERDAT TYPE D,
AENAM(12) TYPE C,
AEDAT TYPE D,
QMDAT TYPE D,
QMNAM(12) TYPE C,
STRMN TYPE D,
LTRMN TYPE D,
WAERS(5) TYPE C,
AUFNR(12) TYPE C,
VERID(4) TYPE C,
RM_MATNR(18) TYPE C,
RM_WERKS(4) TYPE C,
SA_AUFNR(12) TYPE C,
MATNR(18) TYPE C,
REVLV(2) TYPE C,
MATKL(9) TYPE C,
PRDHA(18) TYPE C,
KZKRI(1) TYPE C,
KZDKZ(1) TYPE C,
KUNUM(10) TYPE C,
FEKNZ(1) TYPE C,
MAKNZ(1) TYPE C,
OBJNR(22) TYPE C,
QMDAB TYPE D,
RBNR(9) TYPE C,
RBNRI(1) TYPE C,
INDTX(1) TYPE C,
KZMLA(1) TYPE C,
HERKZ(2) TYPE C,
BEZDT TYPE D,
LIFNUM(10) TYPE C,
BUNAME(12) TYPE C,
VBELN(10) TYPE C,
BSTNK(35) TYPE C,
BSTDK TYPE D,
SPART(2) TYPE C,
VKORG(4) TYPE C,
VTWEG(2) TYPE C,
ADRNR(10) TYPE C,
MAWERK(4) TYPE C,
QMKAT(1) TYPE C,
QMGRP(8) TYPE C,
QMCOD(4) TYPE C,
AUSWIRK(4) TYPE C,
TEILEV(4) TYPE C,
PRUEFLOS(12) TYPE N,
CHARG(10) TYPE C,
LGORTCHARG(4) TYPE C,
LICHN(15) TYPE C,
HERSTELLER(10) TYPE C,
EMATNR(18) TYPE C,
EKORG(4) TYPE C,
BKGRP(3) TYPE C,
LGORTVORG(4) TYPE C,
FERTAUFNR(12) TYPE C,
FERTAUFPL(10) TYPE N,
EBELN(10) TYPE C,
EBELP(5) TYPE N,
MJAHR(4) TYPE N,
MBLNR(10) TYPE C,
MBLPO(4) TYPE N,
LS_KDAUF(10) TYPE C,
LS_KDPOS(6) TYPE N,
LS_VBELN(10) TYPE C,
LS_POSNR(6) TYPE N,
CROBJTY(2) TYPE C,
ARBPL(8) TYPE N,
ARBPLWERK(4) TYPE C,
FEART(8) TYPE C,
PNLKN(8) TYPE N,
MGEIG(16) TYPE P DECIMALS 3,
MGFRD(16) TYPE P DECIMALS 3,
MGEIN(3) TYPE C,
BZMNG(16) TYPE P DECIMALS 3,
RKMNG(16) TYPE P DECIMALS 3,
RGMNG(16) TYPE P DECIMALS 3,
RKDAT TYPE D,
COAUFNR(12) TYPE C,
QWRNUM(12) TYPE C,
REFNUM(20) TYPE C,
KDMAT(35) TYPE C,
IDNLF(35) TYPE C,
SERIALNR(18) TYPE C,
KZLOESCH(1) TYPE C,
PRODDAT TYPE D,
DEVICEID(40) TYPE C,
VKBUR(4) TYPE C,
VKGRP(3) TYPE C,
AUTKZ(1) TYPE C,
BEDID(12) TYPE N,
BEDZL(8) TYPE N,
PROFIL_TYP(2) TYPE C,
PROFIL_ID(8) TYPE N,
HANDLE(22) TYPE C,
TSEGFL(1) TYPE C,
TSEGTP(10) TYPE C,
TZONSO(6) TYPE C,
TZONID(1) TYPE C,
FUNKTION(4) TYPE C,
/SAPSMOSS/INSTN(10) TYPE C,
/SAPSMOSS/MNUMM(24) TYPE N,
/SAPSMOSS/OSSYS(10) TYPE C,
/SAPSMOSS/DBSYS(10) TYPE C,
/SAPSMOSS/REL(10) TYPE C,
/SAPSMOSS/COMP(20) TYPE C,
/SAPSMOSS/FRONT(10) TYPE C,
/SAPSMOSS/SYSTYP(1) TYPE C,
/SAPSMOSS/ADDID(10) TYPE C,
/SAPSMOSS/ADDREL(10) TYPE C,
/SAPSMOSS/TSTMP(14) TYPE N,
/SAPSMOSS/STATUS(1) TYPE C,
/SAPSMOSS/ERDAT TYPE D,
/SAPSMOSS/SYSID(8) TYPE C,
/SAPSMOSS/MANDT(3) TYPE C,
PSP_NR(8) TYPE N,
ESTIMATED_COSTS(16) TYPE P DECIMALS 2,
CLAIMED_COSTS(16) TYPE P DECIMALS 2,
RESULT_COSTS(16) TYPE P DECIMALS 2,
CHANCE(2) TYPE N,
OPPONENT(2) TYPE C,
KALNR(12) TYPE N,
KALVAR(4) TYPE C,
OBJNR_REAL(22) TYPE C,
OBJNR_STAT(22) TYPE C,
PHASE(1) TYPE C,
/ISDFPS/OBJNR(22) TYPE C,
LOGSYSTEM(10) TYPE C,
/ISDFPS/MEQUI(18) TYPE C,
YY_BEMOT(2) TYPE C,
IWERK(4) TYPE C,
ILOAN(12) TYPE C,
ILOAI(1) TYPE C,
EQUNR(18) TYPE C,
BAUTL(18) TYPE C,
EBORT(20) TYPE C,
MSAUS(1) TYPE C,
AUSVN TYPE D,
AUSBS TYPE D,
AUSZT TYPE F,
MAUEH(3) TYPE C,
BTPLN(30) TYPE C,
BEQUI(18) TYPE C,
AUSWK(1) TYPE C,
VERFV(3) TYPE N,
VERFN(3) TYPE N,
VERFM(3) TYPE N,
ANLZV(1) TYPE C,
ANLZN(1) TYPE C,
ANLZE(1) TYPE C,
INSPK(12) TYPE C,
INGRP(3) TYPE C,
WARPL(12) TYPE C,
ABNUM TYPE I,
WAPOS(16) TYPE C,
KDAUF(10) TYPE C,
KDPOS(6) TYPE N,
SCREENTY(4) TYPE C,
PLNTY(1) TYPE C,
PLNNR(8) TYPE C,
PLNAL(2) TYPE C,
REVNR(8) TYPE C,
ZAEHL(8) TYPE N,
TPLNR(30) TYPE C,
Z_BUKRS(4) TYPE C,
Z_VKORG(4) TYPE C,
Z_WERKS(4) TYPE C,
Z_EKORG(4) TYPE C,
Z_MAMUSERCMPY(4) TYPE C,
Z_REGION(40) TYPE C,
Z_COUNTRY(40) TYPE C,
Z_COUNTRYDSCR(255) TYPE C,
Z_SALESCOMPANY(40) TYPE C,
Z_SALESCMPDSCR(255) TYPE C.
DATA: end of ITAB5.

data: append_flag(1) value ' ',
      cntbuf type i,
      delimleng type i,last_batch(1) value ' '.

CONSTANTS C_DF_VK(40) VALUE '1672'.
CONSTANTS C_DI_GEN(40) VALUE '14.2.3.660'.
DATA WARN_MSG(50).


DATA: gv_directory     TYPE epsdirnam  VALUE '/var/load/xxx/UK/read/',
      gv_logsys        LIKE tbdlst-logsys.

start-of-selection.
* Logical system
  CALL FUNCTION 'OWN_LOGICAL_SYSTEM_GET'
    IMPORTING
      own_logical_system             = gv_logsys
    EXCEPTIONS
      own_logical_system_not_defined = 1
      OTHERS                         = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE 'E' NUMBER sy-msgno
         WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    STOP.
  ENDIF.
  REPLACE 'xxx' IN out_dir WITH gv_logsys(3).
  REPLACE 'xxx' IN in_dir WITH gv_logsys(3).


  IF DOWNLOAD = 'S' OR
     DOWNLOAD = 'N' OR
     DOWNLOAD = 'Y'.
      .
  ELSE.
     DATA: m_xfer_err_msg(700).
     CONCATENATE
'ABAP program does not recognize this new '
'data transfer method: ' DOWNLOAD
'. Regenerate the ABAP program and upload to this system.'
     INTO m_xfer_err_msg.
     MESSAGE  E240(S#) WITH m_xfer_err_msg.
  ENDIF.

  IF EXECMODE = 'B' OR
     EXECMODE = 'D'.
      .
  ELSE.
     DATA: m_exec_err_msg(700).
     CONCATENATE
'ABAP program does not recognize this new '
'execution option: ' EXECMODE
'. Regenerate the ABAP program and upload to this system.'
     INTO m_exec_err_msg.
     MESSAGE  E240(S#) WITH m_exec_err_msg.
  ENDIF.

  IF DOWNLOAD = 'S'.
     PERFORM CONNECT_RFCDEST_TO_PROGID.
  ENDIF.



PERFORM FORM5.
last_batch = 'X'.
PERFORM FORM6.
FREE ITAB5.
  IF DOWNLOAD = 'S'.
     PERFORM DISCONNECT_RFCDEST_FROM_PROGID.
  ENDIF.


end-of-selection.

CLEAR WARN_MSG.

IF NOT P_DF_VK IS INITIAL.
  IF P_DF_VK <> C_DF_VK.
     CONCATENATE '$$Warning$'
                 C_DF_VK
                 '$' INTO WARN_MSG.
  ENDIF.
ENDIF.
IF NOT P_DI_GEN IS INITIAL.
  IF P_DI_GEN <> C_DI_GEN.
     IF WARN_MSG IS INITIAL.
       CONCATENATE '$$Warning$$'
                   C_DI_GEN
                   INTO WARN_MSG.
     ELSE.
       CONCATENATE WARN_MSG
                   C_DI_GEN
                   INTO WARN_MSG.
     ENDIF.
  ENDIF.
ENDIF.

IF NOT WARN_MSG IS INITIAL.
  IF EXECMODE = 'D'.
    WRITE WARN_MSG.
    NEW-LINE.
  ELSE.
    MESSAGE S240(S#) with WARN_MSG.
  ENDIF.
ENDIF.


write  '* Program Complete *'.
write  '(C)Copyright Business Objects S.A.  All rights reserved.'.

FORM FORM5.
DATA ALTMP1072(12) TYPE C.
DATA ALTMP1073(3) TYPE C.
DATA ALTMP1074(2) TYPE C.
DATA ALTMP1075(40) TYPE C.
DATA ALTMP1076(2) TYPE C.
DATA ALTMP1077(1) TYPE C.
DATA ALTMP1078(12) TYPE C.
DATA ALTMP1079 TYPE D.
DATA ALTMP1080(12) TYPE C.
DATA ALTMP1081 TYPE D.
DATA ALTMP1082 TYPE D.
DATA ALTMP1083(12) TYPE C.
DATA ALTMP1084 TYPE D.
DATA ALTMP1085 TYPE D.
DATA ALTMP1086(5) TYPE C.
DATA ALTMP1087(12) TYPE C.
DATA ALTMP1088(4) TYPE C.
DATA ALTMP1089(18) TYPE C.
DATA ALTMP1090(4) TYPE C.
DATA ALTMP1091(12) TYPE C.
DATA ALTMP1092(18) TYPE C.
DATA ALTMP1093(2) TYPE C.
DATA ALTMP1094(9) TYPE C.
DATA ALTMP1095(18) TYPE C.
DATA ALTMP1096(1) TYPE C.
DATA ALTMP1097(1) TYPE C.
DATA ALTMP1098(10) TYPE C.
DATA ALTMP1099(1) TYPE C.
DATA ALTMP1100(1) TYPE C.
DATA ALTMP1101(22) TYPE C.
DATA ALTMP1102 TYPE D.
DATA ALTMP1103(9) TYPE C.
DATA ALTMP1104(1) TYPE C.
DATA ALTMP1105(1) TYPE C.
DATA ALTMP1106(1) TYPE C.
DATA ALTMP1107(2) TYPE C.
DATA ALTMP1108 TYPE D.
DATA ALTMP1109(10) TYPE C.
DATA ALTMP1110(12) TYPE C.
DATA ALTMP1111(10) TYPE C.
DATA ALTMP1112(35) TYPE C.
DATA ALTMP1113 TYPE D.
DATA ALTMP1114(2) TYPE C.
DATA ALTMP1115(4) TYPE C.
DATA ALTMP1116(2) TYPE C.
DATA ALTMP1117(10) TYPE C.
DATA ALTMP1118(4) TYPE C.
DATA ALTMP1119(1) TYPE C.
DATA ALTMP1120(8) TYPE C.
DATA ALTMP1121(4) TYPE C.
DATA ALTMP1122(4) TYPE C.
DATA ALTMP1123(4) TYPE C.
DATA ALTMP1124(12) TYPE N.
DATA ALTMP1125(10) TYPE C.
DATA ALTMP1126(4) TYPE C.
DATA ALTMP1127(15) TYPE C.
DATA ALTMP1128(10) TYPE C.
DATA ALTMP1129(18) TYPE C.
DATA ALTMP1130(4) TYPE C.
DATA ALTMP1131(3) TYPE C.
DATA ALTMP1132(4) TYPE C.
DATA ALTMP1133(12) TYPE C.
DATA ALTMP1134(10) TYPE N.
DATA ALTMP1135(10) TYPE C.
DATA ALTMP1136(5) TYPE N.
DATA ALTMP1137(4) TYPE N.
DATA ALTMP1138(10) TYPE C.
DATA ALTMP1139(4) TYPE N.
DATA ALTMP1140(10) TYPE C.
DATA ALTMP1141(6) TYPE N.
DATA ALTMP1142(10) TYPE C.
DATA ALTMP1143(6) TYPE N.
DATA ALTMP1144(2) TYPE C.
DATA ALTMP1145(8) TYPE N.
DATA ALTMP1146(4) TYPE C.
DATA ALTMP1147(8) TYPE C.
DATA ALTMP1148(8) TYPE N.
DATA ALTMP1149(16) TYPE P DECIMALS 3.
DATA ALTMP1150(16) TYPE P DECIMALS 3.
DATA ALTMP1151(3) TYPE C.
DATA ALTMP1152(16) TYPE P DECIMALS 3.
DATA ALTMP1153(16) TYPE P DECIMALS 3.
DATA ALTMP1154(16) TYPE P DECIMALS 3.
DATA ALTMP1155 TYPE D.
DATA ALTMP1156(12) TYPE C.
DATA ALTMP1157(12) TYPE C.
DATA ALTMP1158(20) TYPE C.
DATA ALTMP1159(35) TYPE C.
DATA ALTMP1160(35) TYPE C.
DATA ALTMP1161(18) TYPE C.
DATA ALTMP1162(1) TYPE C.
DATA ALTMP1163 TYPE D.
DATA ALTMP1164(40) TYPE C.
DATA ALTMP1165(4) TYPE C.
DATA ALTMP1166(3) TYPE C.
DATA ALTMP1167(1) TYPE C.
DATA ALTMP1168(12) TYPE N.
DATA ALTMP1169(8) TYPE N.
DATA ALTMP1170(2) TYPE C.
DATA ALTMP1171(8) TYPE N.
DATA ALTMP1172(22) TYPE C.
DATA ALTMP1173(1) TYPE C.
DATA ALTMP1174(10) TYPE C.
DATA ALTMP1175(6) TYPE C.
DATA ALTMP1176(1) TYPE C.
DATA ALTMP1177(4) TYPE C.
DATA ALTMP1178(10) TYPE C.
DATA ALTMP1179(24) TYPE N.
DATA ALTMP1180(10) TYPE C.
DATA ALTMP1181(10) TYPE C.
DATA ALTMP1182(10) TYPE C.
DATA ALTMP1183(20) TYPE C.
DATA ALTMP1184(10) TYPE C.
DATA ALTMP1185(1) TYPE C.
DATA ALTMP1186(10) TYPE C.
DATA ALTMP1187(10) TYPE C.
DATA ALTMP1188(14) TYPE N.
DATA ALTMP1189(1) TYPE C.
DATA ALTMP1190 TYPE D.
DATA ALTMP1191(8) TYPE C.
DATA ALTMP1192(3) TYPE C.
DATA ALTMP1193(8) TYPE N.
DATA ALTMP1194(16) TYPE P DECIMALS 2.
DATA ALTMP1195(16) TYPE P DECIMALS 2.
DATA ALTMP1196(16) TYPE P DECIMALS 2.
DATA ALTMP1197(2) TYPE N.
DATA ALTMP1198(2) TYPE C.
DATA ALTMP1199(12) TYPE N.
DATA ALTMP1200(4) TYPE C.
DATA ALTMP1201(22) TYPE C.
DATA ALTMP1202(22) TYPE C.
DATA ALTMP1203(1) TYPE C.
DATA ALTMP1204(22) TYPE C.
DATA ALTMP1205(10) TYPE C.
DATA ALTMP1206(18) TYPE C.
DATA ALTMP1207(2) TYPE C.
DATA ALTMP1208(4) TYPE C.
DATA ALTMP1209(12) TYPE C.
DATA ALTMP1210(1) TYPE C.
DATA ALTMP1211(18) TYPE C.
DATA ALTMP1212(18) TYPE C.
DATA ALTMP1213(20) TYPE C.
DATA ALTMP1214(1) TYPE C.
DATA ALTMP1215 TYPE D.
DATA ALTMP1216 TYPE D.
DATA ALTMP1217 TYPE F.
DATA ALTMP1218(3) TYPE C.
DATA ALTMP1219(30) TYPE C.
DATA ALTMP1220(18) TYPE C.
DATA ALTMP1221(1) TYPE C.
DATA ALTMP1222(3) TYPE N.
DATA ALTMP1223(3) TYPE N.
DATA ALTMP1224(3) TYPE N.
DATA ALTMP1225(1) TYPE C.
DATA ALTMP1226(1) TYPE C.
DATA ALTMP1227(1) TYPE C.
DATA ALTMP1228(12) TYPE C.
DATA ALTMP1229(3) TYPE C.
DATA ALTMP1230(12) TYPE C.
DATA ALTMP1231 TYPE I.
DATA ALTMP1232(16) TYPE C.
DATA ALTMP1233(10) TYPE C.
DATA ALTMP1234(6) TYPE N.
DATA ALTMP1235(4) TYPE C.
DATA ALTMP1236(1) TYPE C.
DATA ALTMP1237(8) TYPE C.
DATA ALTMP1238(2) TYPE C.
DATA ALTMP1239(8) TYPE C.
DATA ALTMP1240(8) TYPE N.
DATA ALTMP1241(30) TYPE C.
DATA ALTMP1242(4) TYPE C.
DATA ALTMP1243(4) TYPE C.
DATA ALTMP1244(4) TYPE C.
DATA ALTMP1245(4) TYPE C.
DATA ALTMP1246(4) TYPE C.
DATA ALTMP1247(40) TYPE C.
DATA ALTMP1248(40) TYPE C.
DATA ALTMP1249(255) TYPE C.
DATA ALTMP1250(40) TYPE C.
DATA ALTMP1251(255) TYPE C.

DATA QMEL9QMNUM LIKE QMEL-QMNUM.
DATA QMEL9MANDT LIKE QMEL-MANDT.
DATA QMEL9QMART LIKE QMEL-QMART.
DATA QMEL9QMTXT LIKE QMEL-QMTXT.
DATA QMEL9ARTPR LIKE QMEL-ARTPR.
DATA QMEL9PRIOK LIKE QMEL-PRIOK.
DATA QMEL9ERNAM LIKE QMEL-ERNAM.
DATA QMEL9ERDAT LIKE QMEL-ERDAT.
DATA QMEL9AENAM LIKE QMEL-AENAM.
DATA QMEL9AEDAT LIKE QMEL-AEDAT.
DATA QMEL9QMDAT LIKE QMEL-QMDAT.
DATA QMEL9QMNAM LIKE QMEL-QMNAM.
DATA QMEL9STRMN LIKE QMEL-STRMN.
DATA QMEL9LTRMN LIKE QMEL-LTRMN.
DATA QMEL9WAERS LIKE QMEL-WAERS.
DATA QMEL9AUFNR LIKE QMEL-AUFNR.
DATA QMEL9VERID LIKE QMEL-VERID.
DATA QMEL9RM_MATNR LIKE QMEL-RM_MATNR.
DATA QMEL9RM_WERKS LIKE QMEL-RM_WERKS.
DATA QMEL9SA_AUFNR LIKE QMEL-SA_AUFNR.
DATA QMEL9MATNR LIKE QMEL-MATNR.
DATA QMEL9REVLV LIKE QMEL-REVLV.
DATA QMEL9MATKL LIKE QMEL-MATKL.
DATA QMEL9PRDHA LIKE QMEL-PRDHA.
DATA QMEL9KZKRI LIKE QMEL-KZKRI.
DATA QMEL9KZDKZ LIKE QMEL-KZDKZ.
DATA QMEL9KUNUM LIKE QMEL-KUNUM.
DATA QMEL9FEKNZ LIKE QMEL-FEKNZ.
DATA QMEL9MAKNZ LIKE QMEL-MAKNZ.
DATA QMEL9OBJNR LIKE QMEL-OBJNR.
DATA QMEL9QMDAB LIKE QMEL-QMDAB.
DATA QMEL9RBNR LIKE QMEL-RBNR.
DATA QMEL9RBNRI LIKE QMEL-RBNRI.
DATA QMEL9INDTX LIKE QMEL-INDTX.
DATA QMEL9KZMLA LIKE QMEL-KZMLA.
DATA QMEL9HERKZ LIKE QMEL-HERKZ.
DATA QMEL9BEZDT LIKE QMEL-BEZDT.
DATA QMEL9LIFNUM LIKE QMEL-LIFNUM.
DATA QMEL9BUNAME LIKE QMEL-BUNAME.
DATA QMEL9VBELN LIKE QMEL-VBELN.
DATA QMEL9BSTNK LIKE QMEL-BSTNK.
DATA QMEL9BSTDK LIKE QMEL-BSTDK.
DATA QMEL9SPART LIKE QMEL-SPART.
DATA QMEL9VKORG LIKE QMEL-VKORG.
DATA QMEL9VTWEG LIKE QMEL-VTWEG.
DATA QMEL9ADRNR LIKE QMEL-ADRNR.
DATA QMEL9MAWERK LIKE QMEL-MAWERK.
DATA QMEL9QMKAT LIKE QMEL-QMKAT.
DATA QMEL9QMGRP LIKE QMEL-QMGRP.
DATA QMEL9QMCOD LIKE QMEL-QMCOD.
DATA QMEL9AUSWIRK LIKE QMEL-AUSWIRK.
DATA QMEL9TEILEV LIKE QMEL-TEILEV.
DATA QMEL9PRUEFLOS LIKE QMEL-PRUEFLOS.
DATA QMEL9CHARG LIKE QMEL-CHARG.
DATA QMEL9LGORTCHARG LIKE QMEL-LGORTCHARG.
DATA QMEL9LICHN LIKE QMEL-LICHN.
DATA QMEL9HERSTELLER LIKE QMEL-HERSTELLER.
DATA QMEL9EMATNR LIKE QMEL-EMATNR.
DATA QMEL9EKORG LIKE QMEL-EKORG.
DATA QMEL9BKGRP LIKE QMEL-BKGRP.
DATA QMEL9LGORTVORG LIKE QMEL-LGORTVORG.
DATA QMEL9FERTAUFNR LIKE QMEL-FERTAUFNR.
DATA QMEL9FERTAUFPL LIKE QMEL-FERTAUFPL.
DATA QMEL9EBELN LIKE QMEL-EBELN.
DATA QMEL9EBELP LIKE QMEL-EBELP.
DATA QMEL9MJAHR LIKE QMEL-MJAHR.
DATA QMEL9MBLNR LIKE QMEL-MBLNR.
DATA QMEL9MBLPO LIKE QMEL-MBLPO.
DATA QMEL9LS_KDAUF LIKE QMEL-LS_KDAUF.
DATA QMEL9LS_KDPOS LIKE QMEL-LS_KDPOS.
DATA QMEL9LS_VBELN LIKE QMEL-LS_VBELN.
DATA QMEL9LS_POSNR LIKE QMEL-LS_POSNR.
DATA QMEL9CROBJTY LIKE QMEL-CROBJTY.
DATA QMEL9ARBPL LIKE QMEL-ARBPL.
DATA QMEL9ARBPLWERK LIKE QMEL-ARBPLWERK.
DATA QMEL9FEART LIKE QMEL-FEART.
DATA QMEL9PNLKN LIKE QMEL-PNLKN.
DATA QMEL9MGEIG LIKE QMEL-MGEIG.
DATA QMEL9MGFRD LIKE QMEL-MGFRD.
DATA QMEL9MGEIN LIKE QMEL-MGEIN.
DATA QMEL9BZMNG LIKE QMEL-BZMNG.
DATA QMEL9RKMNG LIKE QMEL-RKMNG.
DATA QMEL9RGMNG LIKE QMEL-RGMNG.
DATA QMEL9RKDAT LIKE QMEL-RKDAT.
DATA QMEL9COAUFNR LIKE QMEL-COAUFNR.
DATA QMEL9QWRNUM LIKE QMEL-QWRNUM.
DATA QMEL9REFNUM LIKE QMEL-REFNUM.
DATA QMEL9KDMAT LIKE QMEL-KDMAT.
DATA QMEL9IDNLF LIKE QMEL-IDNLF.
DATA QMEL9SERIALNR LIKE QMEL-SERIALNR.
DATA QMEL9KZLOESCH LIKE QMEL-KZLOESCH.
DATA QMEL9PRODDAT LIKE QMEL-PRODDAT.
DATA QMEL9DEVICEID LIKE QMEL-DEVICEID.
DATA QMEL9VKBUR LIKE QMEL-VKBUR.
DATA QMEL9VKGRP LIKE QMEL-VKGRP.
DATA QMEL9AUTKZ LIKE QMEL-AUTKZ.
DATA QMEL9BEDID LIKE QMEL-BEDID.
DATA QMEL9BEDZL LIKE QMEL-BEDZL.
DATA QMEL9PROFIL_TYP LIKE QMEL-PROFIL_TYP.
DATA QMEL9PROFIL_ID LIKE QMEL-PROFIL_ID.
DATA QMEL9HANDLE LIKE QMEL-HANDLE.
DATA QMEL9TSEGFL LIKE QMEL-TSEGFL.
DATA QMEL9TSEGTP LIKE QMEL-TSEGTP.
DATA QMEL9TZONSO LIKE QMEL-TZONSO.
DATA QMEL9TZONID LIKE QMEL-TZONID.
DATA QMEL9FUNKTION LIKE QMEL-FUNKTION.
DATA QMEL9/SAPSMOSS/INSTN LIKE QMEL-/SAPSMOSS/INSTN.
DATA QMEL9/SAPSMOSS/MNUMM LIKE QMEL-/SAPSMOSS/MNUMM.
DATA QMEL9/SAPSMOSS/OSSYS LIKE QMEL-/SAPSMOSS/OSSYS.
DATA QMEL9/SAPSMOSS/DBSYS LIKE QMEL-/SAPSMOSS/DBSYS.
DATA QMEL9/SAPSMOSS/REL LIKE QMEL-/SAPSMOSS/REL.
DATA QMEL9/SAPSMOSS/COMP LIKE QMEL-/SAPSMOSS/COMP.
DATA QMEL9/SAPSMOSS/FRONT LIKE QMEL-/SAPSMOSS/FRONT.
DATA QMEL9/SAPSMOSS/SYSTYP LIKE QMEL-/SAPSMOSS/SYSTYP.
DATA QMEL9/SAPSMOSS/ADDID LIKE QMEL-/SAPSMOSS/ADDID.
DATA QMEL9/SAPSMOSS/ADDREL LIKE QMEL-/SAPSMOSS/ADDREL.
DATA QMEL9/SAPSMOSS/TSTMP LIKE QMEL-/SAPSMOSS/TSTMP.
DATA QMEL9/SAPSMOSS/STATUS LIKE QMEL-/SAPSMOSS/STATUS.
DATA QMEL9/SAPSMOSS/ERDAT LIKE QMEL-/SAPSMOSS/ERDAT.
DATA QMEL9/SAPSMOSS/SYSID LIKE QMEL-/SAPSMOSS/SYSID.
DATA QMEL9/SAPSMOSS/MANDT LIKE QMEL-/SAPSMOSS/MANDT.
DATA QMEL9PSP_NR LIKE QMEL-PSP_NR.
DATA QMEL9ESTIMATED_COSTS LIKE QMEL-ESTIMATED_COSTS.
DATA QMEL9CLAIMED_COSTS LIKE QMEL-CLAIMED_COSTS.
DATA QMEL9RESULT_COSTS LIKE QMEL-RESULT_COSTS.
DATA QMEL9CHANCE LIKE QMEL-CHANCE.
DATA QMEL9OPPONENT LIKE QMEL-OPPONENT.
DATA QMEL9KALNR LIKE QMEL-KALNR.
DATA QMEL9KALVAR LIKE QMEL-KALVAR.
DATA QMEL9OBJNR_REAL LIKE QMEL-OBJNR_REAL.
DATA QMEL9OBJNR_STAT LIKE QMEL-OBJNR_STAT.
DATA QMEL9PHASE LIKE QMEL-PHASE.
DATA QMEL9/ISDFPS/OBJNR LIKE QMEL-/ISDFPS/OBJNR.
DATA QMEL9LOGSYSTEM LIKE QMEL-LOGSYSTEM.
DATA QMEL9/ISDFPS/MEQUI LIKE QMEL-/ISDFPS/MEQUI.
DATA QMEL9YY_BEMOT LIKE QMEL-YY_BEMOT.
DATA QMIH9IWERK LIKE QMIH-IWERK.
DATA QMIH9ILOAN LIKE QMIH-ILOAN.
DATA QMIH9ILOAI LIKE QMIH-ILOAI.
DATA QMIH9EQUNR LIKE QMIH-EQUNR.
DATA QMIH9BAUTL LIKE QMIH-BAUTL.
DATA QMIH9EBORT LIKE QMIH-EBORT.
DATA QMIH9MSAUS LIKE QMIH-MSAUS.
DATA QMIH9AUSVN LIKE QMIH-AUSVN.
DATA QMIH9AUSBS LIKE QMIH-AUSBS.
DATA QMIH9AUSZT LIKE QMIH-AUSZT.
DATA QMIH9MAUEH LIKE QMIH-MAUEH.
DATA QMIH9BTPLN LIKE QMIH-BTPLN.
DATA QMIH9BEQUI LIKE QMIH-BEQUI.
DATA QMIH9AUSWK LIKE QMIH-AUSWK.
DATA QMIH9VERFV LIKE QMIH-VERFV.
DATA QMIH9VERFN LIKE QMIH-VERFN.
DATA QMIH9VERFM LIKE QMIH-VERFM.
DATA QMIH9ANLZV LIKE QMIH-ANLZV.
DATA QMIH9ANLZN LIKE QMIH-ANLZN.
DATA QMIH9ANLZE LIKE QMIH-ANLZE.
DATA QMIH9INSPK LIKE QMIH-INSPK.
DATA QMIH9INGRP LIKE QMIH-INGRP.
DATA QMIH9WARPL LIKE QMIH-WARPL.
DATA QMIH9ABNUM LIKE QMIH-ABNUM.
DATA QMIH9WAPOS LIKE QMIH-WAPOS.
DATA QMIH9KDAUF LIKE QMIH-KDAUF.
DATA QMIH9KDPOS LIKE QMIH-KDPOS.
DATA QMIH9SCREENTY LIKE QMIH-SCREENTY.
DATA QMIH9PLNTY LIKE QMIH-PLNTY.
DATA QMIH9PLNNR LIKE QMIH-PLNNR.
DATA QMIH9PLNAL LIKE QMIH-PLNAL.
DATA QMIH9REVNR LIKE QMIH-REVNR.
DATA QMIH9ZAEHL LIKE QMIH-ZAEHL.
DATA ILOA9TPLNR LIKE ILOA-TPLNR.
DATA ZSTC_SALE_019BUKRS LIKE ZSTC_SALES_COMP-BUKRS.
DATA ZSTC_SALE_019VKORG LIKE ZSTC_SALES_COMP-VKORG.
DATA ZSTC_SALE_019WERKS LIKE ZSTC_SALES_COMP-WERKS.
DATA ZSTC_SALE_019EKORG LIKE ZSTC_SALES_COMP-EKORG.
DATA ZSTC_SALE_019MAMUSERCMPY LIKE ZSTC_SALES_COMP-MAMUSERCMPY.
DATA ZSTC_SALE_019REGION LIKE ZSTC_SALES_COMP-REGION.
DATA ZSTC_SALE_019COUNTRY LIKE ZSTC_SALES_COMP-COUNTRY.
DATA ZSTC_SALE_019COUNTRYDSCR LIKE ZSTC_SALES_COMP-COUNTRYDSCR.
DATA ZSTC_SALE_019SALESCOMPANY LIKE ZSTC_SALES_COMP-SALESCOMPANY.
DATA ZSTC_SALE_019SALESCMPDSCR LIKE ZSTC_SALES_COMP-SALESCMPDSCR.
DATA ILOA9ILOAN LIKE ILOA-ILOAN.
DATA QMIH9QMNUM LIKE QMIH-QMNUM.



SELECT
  QMEL9~QMNUM
  QMEL9~MANDT
  QMEL9~QMART
  QMEL9~QMTXT
  QMEL9~ARTPR
  QMEL9~PRIOK
  QMEL9~ERNAM
  QMEL9~ERDAT
  QMEL9~AENAM
  QMEL9~AEDAT
  QMEL9~QMDAT
  QMEL9~QMNAM
  QMEL9~STRMN
  QMEL9~LTRMN
  QMEL9~WAERS
  QMEL9~AUFNR
  QMEL9~VERID
  QMEL9~RM_MATNR
  QMEL9~RM_WERKS
  QMEL9~SA_AUFNR
  QMEL9~MATNR
  QMEL9~REVLV
  QMEL9~MATKL
  QMEL9~PRDHA
  QMEL9~KZKRI
  QMEL9~KZDKZ
  QMEL9~KUNUM
  QMEL9~FEKNZ
  QMEL9~MAKNZ
  QMEL9~OBJNR
  QMEL9~QMDAB
  QMEL9~RBNR
  QMEL9~RBNRI
  QMEL9~INDTX
  QMEL9~KZMLA
  QMEL9~HERKZ
  QMEL9~BEZDT
  QMEL9~LIFNUM
  QMEL9~BUNAME
  QMEL9~VBELN
  QMEL9~BSTNK
  QMEL9~BSTDK
  QMEL9~SPART
  QMEL9~VKORG
  QMEL9~VTWEG
  QMEL9~ADRNR
  QMEL9~MAWERK
  QMEL9~QMKAT
  QMEL9~QMGRP
  QMEL9~QMCOD
  QMEL9~AUSWIRK
  QMEL9~TEILEV
  QMEL9~PRUEFLOS
  QMEL9~CHARG
  QMEL9~LGORTCHARG
  QMEL9~LICHN
  QMEL9~HERSTELLER
  QMEL9~EMATNR
  QMEL9~EKORG
  QMEL9~BKGRP
  QMEL9~LGORTVORG
  QMEL9~FERTAUFNR
  QMEL9~FERTAUFPL
  QMEL9~EBELN
  QMEL9~EBELP
  QMEL9~MJAHR
  QMEL9~MBLNR
  QMEL9~MBLPO
  QMEL9~LS_KDAUF
  QMEL9~LS_KDPOS
  QMEL9~LS_VBELN
  QMEL9~LS_POSNR
  QMEL9~CROBJTY
  QMEL9~ARBPL
  QMEL9~ARBPLWERK
  QMEL9~FEART
  QMEL9~PNLKN
  QMEL9~MGEIG
  QMEL9~MGFRD
  QMEL9~MGEIN
  QMEL9~BZMNG
  QMEL9~RKMNG
  QMEL9~RGMNG
  QMEL9~RKDAT
  QMEL9~COAUFNR
  QMEL9~QWRNUM
  QMEL9~REFNUM
  QMEL9~KDMAT
  QMEL9~IDNLF
  QMEL9~SERIALNR
  QMEL9~KZLOESCH
  QMEL9~PRODDAT
  QMEL9~DEVICEID
  QMEL9~VKBUR
  QMEL9~VKGRP
  QMEL9~AUTKZ
  QMEL9~BEDID
  QMEL9~BEDZL
  QMEL9~PROFIL_TYP
  QMEL9~PROFIL_ID
  QMEL9~HANDLE
  QMEL9~TSEGFL
  QMEL9~TSEGTP
  QMEL9~TZONSO
  QMEL9~TZONID
  QMEL9~FUNKTION
  QMEL9~/SAPSMOSS/INSTN
  QMEL9~/SAPSMOSS/MNUMM
  QMEL9~/SAPSMOSS/OSSYS
  QMEL9~/SAPSMOSS/DBSYS
  QMEL9~/SAPSMOSS/REL
  QMEL9~/SAPSMOSS/COMP
  QMEL9~/SAPSMOSS/FRONT
  QMEL9~/SAPSMOSS/SYSTYP
  QMEL9~/SAPSMOSS/ADDID
  QMEL9~/SAPSMOSS/ADDREL
  QMEL9~/SAPSMOSS/TSTMP
  QMEL9~/SAPSMOSS/STATUS
  QMEL9~/SAPSMOSS/ERDAT
  QMEL9~/SAPSMOSS/SYSID
  QMEL9~/SAPSMOSS/MANDT
  QMEL9~PSP_NR
  QMEL9~ESTIMATED_COSTS
  QMEL9~CLAIMED_COSTS
  QMEL9~RESULT_COSTS
  QMEL9~CHANCE
  QMEL9~OPPONENT
  QMEL9~KALNR
  QMEL9~KALVAR
  QMEL9~OBJNR_REAL
  QMEL9~OBJNR_STAT
  QMEL9~PHASE
  QMEL9~/ISDFPS/OBJNR
  QMEL9~LOGSYSTEM
  QMEL9~/ISDFPS/MEQUI
  QMEL9~YY_BEMOT
  QMIH9~IWERK
  QMIH9~ILOAN
  QMIH9~ILOAI
  QMIH9~EQUNR
  QMIH9~BAUTL
  QMIH9~EBORT
  QMIH9~MSAUS
  QMIH9~AUSVN
  QMIH9~AUSBS
  QMIH9~AUSZT
  QMIH9~MAUEH
  QMIH9~BTPLN
  QMIH9~BEQUI
  QMIH9~AUSWK
  QMIH9~VERFV
  QMIH9~VERFN
  QMIH9~VERFM
  QMIH9~ANLZV
  QMIH9~ANLZN
  QMIH9~ANLZE
  QMIH9~INSPK
  QMIH9~INGRP
  QMIH9~WARPL
  QMIH9~ABNUM
  QMIH9~WAPOS
  QMIH9~KDAUF
  QMIH9~KDPOS
  QMIH9~SCREENTY
  QMIH9~PLNTY
  QMIH9~PLNNR
  QMIH9~PLNAL
  QMIH9~REVNR
  QMIH9~ZAEHL
  ILOA9~TPLNR
  ZSTC_SALE_019~BUKRS
  ZSTC_SALE_019~VKORG
  ZSTC_SALE_019~WERKS
  ZSTC_SALE_019~EKORG
  ZSTC_SALE_019~MAMUSERCMPY
  ZSTC_SALE_019~REGION
  ZSTC_SALE_019~COUNTRY
  ZSTC_SALE_019~COUNTRYDSCR
  ZSTC_SALE_019~SALESCOMPANY
  ZSTC_SALE_019~SALESCMPDSCR
  ILOA9~ILOAN
  QMIH9~QMNUM
into (QMEL9QMNUM,
  QMEL9MANDT,
  QMEL9QMART,
  QMEL9QMTXT,
  QMEL9ARTPR,
  QMEL9PRIOK,
  QMEL9ERNAM,
  QMEL9ERDAT,
  QMEL9AENAM,
  QMEL9AEDAT,
  QMEL9QMDAT,
  QMEL9QMNAM,
  QMEL9STRMN,
  QMEL9LTRMN,
  QMEL9WAERS,
  QMEL9AUFNR,
  QMEL9VERID,
  QMEL9RM_MATNR,
  QMEL9RM_WERKS,
  QMEL9SA_AUFNR,
  QMEL9MATNR,
  QMEL9REVLV,
  QMEL9MATKL,
  QMEL9PRDHA,
  QMEL9KZKRI,
  QMEL9KZDKZ,
  QMEL9KUNUM,
  QMEL9FEKNZ,
  QMEL9MAKNZ,
  QMEL9OBJNR,
  QMEL9QMDAB,
  QMEL9RBNR,
  QMEL9RBNRI,
  QMEL9INDTX,
  QMEL9KZMLA,
  QMEL9HERKZ,
  QMEL9BEZDT,
  QMEL9LIFNUM,
  QMEL9BUNAME,
  QMEL9VBELN,
  QMEL9BSTNK,
  QMEL9BSTDK,
  QMEL9SPART,
  QMEL9VKORG,
  QMEL9VTWEG,
  QMEL9ADRNR,
  QMEL9MAWERK,
  QMEL9QMKAT,
  QMEL9QMGRP,
  QMEL9QMCOD,
  QMEL9AUSWIRK,
  QMEL9TEILEV,
  QMEL9PRUEFLOS,
  QMEL9CHARG,
  QMEL9LGORTCHARG,
  QMEL9LICHN,
  QMEL9HERSTELLER,
  QMEL9EMATNR,
  QMEL9EKORG,
  QMEL9BKGRP,
  QMEL9LGORTVORG,
  QMEL9FERTAUFNR,
  QMEL9FERTAUFPL,
  QMEL9EBELN,
  QMEL9EBELP,
  QMEL9MJAHR,
  QMEL9MBLNR,
  QMEL9MBLPO,
  QMEL9LS_KDAUF,
  QMEL9LS_KDPOS,
  QMEL9LS_VBELN,
  QMEL9LS_POSNR,
  QMEL9CROBJTY,
  QMEL9ARBPL,
  QMEL9ARBPLWERK,
  QMEL9FEART,
  QMEL9PNLKN,
  QMEL9MGEIG,
  QMEL9MGFRD,
  QMEL9MGEIN,
  QMEL9BZMNG,
  QMEL9RKMNG,
  QMEL9RGMNG,
  QMEL9RKDAT,
  QMEL9COAUFNR,
  QMEL9QWRNUM,
  QMEL9REFNUM,
  QMEL9KDMAT,
  QMEL9IDNLF,
  QMEL9SERIALNR,
  QMEL9KZLOESCH,
  QMEL9PRODDAT,
  QMEL9DEVICEID,
  QMEL9VKBUR,
  QMEL9VKGRP,
  QMEL9AUTKZ,
  QMEL9BEDID,
  QMEL9BEDZL,
  QMEL9PROFIL_TYP,
  QMEL9PROFIL_ID,
  QMEL9HANDLE,
  QMEL9TSEGFL,
  QMEL9TSEGTP,
  QMEL9TZONSO,
  QMEL9TZONID,
  QMEL9FUNKTION,
  QMEL9/SAPSMOSS/INSTN,
  QMEL9/SAPSMOSS/MNUMM,
  QMEL9/SAPSMOSS/OSSYS,
  QMEL9/SAPSMOSS/DBSYS,
  QMEL9/SAPSMOSS/REL,
  QMEL9/SAPSMOSS/COMP,
  QMEL9/SAPSMOSS/FRONT,
  QMEL9/SAPSMOSS/SYSTYP,
  QMEL9/SAPSMOSS/ADDID,
  QMEL9/SAPSMOSS/ADDREL,
  QMEL9/SAPSMOSS/TSTMP,
  QMEL9/SAPSMOSS/STATUS,
  QMEL9/SAPSMOSS/ERDAT,
  QMEL9/SAPSMOSS/SYSID,
  QMEL9/SAPSMOSS/MANDT,
  QMEL9PSP_NR,
  QMEL9ESTIMATED_COSTS,
  QMEL9CLAIMED_COSTS,
  QMEL9RESULT_COSTS,
  QMEL9CHANCE,
  QMEL9OPPONENT,
  QMEL9KALNR,
  QMEL9KALVAR,
  QMEL9OBJNR_REAL,
  QMEL9OBJNR_STAT,
  QMEL9PHASE,
  QMEL9/ISDFPS/OBJNR,
  QMEL9LOGSYSTEM,
  QMEL9/ISDFPS/MEQUI,
  QMEL9YY_BEMOT,
  QMIH9IWERK,
  QMIH9ILOAN,
  QMIH9ILOAI,
  QMIH9EQUNR,
  QMIH9BAUTL,
  QMIH9EBORT,
  QMIH9MSAUS,
  QMIH9AUSVN,
  QMIH9AUSBS,
  QMIH9AUSZT,
  QMIH9MAUEH,
  QMIH9BTPLN,
  QMIH9BEQUI,
  QMIH9AUSWK,
  QMIH9VERFV,
  QMIH9VERFN,
  QMIH9VERFM,
  QMIH9ANLZV,
  QMIH9ANLZN,
  QMIH9ANLZE,
  QMIH9INSPK,
  QMIH9INGRP,
  QMIH9WARPL,
  QMIH9ABNUM,
  QMIH9WAPOS,
  QMIH9KDAUF,
  QMIH9KDPOS,
  QMIH9SCREENTY,
  QMIH9PLNTY,
  QMIH9PLNNR,
  QMIH9PLNAL,
  QMIH9REVNR,
  QMIH9ZAEHL,
  ILOA9TPLNR,
  ZSTC_SALE_019BUKRS,
  ZSTC_SALE_019VKORG,
  ZSTC_SALE_019WERKS,
  ZSTC_SALE_019EKORG,
  ZSTC_SALE_019MAMUSERCMPY,
  ZSTC_SALE_019REGION,
  ZSTC_SALE_019COUNTRY,
  ZSTC_SALE_019COUNTRYDSCR,
  ZSTC_SALE_019SALESCOMPANY,
  ZSTC_SALE_019SALESCMPDSCR,
  ILOA9ILOAN,
  QMIH9QMNUM)
FROM QMEL AS QMEL9
 INNER JOIN QMIH AS QMIH9
 ON ( QMEL9~QMNUM = QMIH9~QMNUM )
 INNER JOIN ZSTC_SALES_COMP AS ZSTC_SALE_019
 ON ( QMEL9~VKORG = ZSTC_SALE_019~VKORG )
 INNER JOIN ILOA AS ILOA9
 ON ( QMIH9~ILOAN = ILOA9~ILOAN )
WHERE ( ( QMEL9~VTWEG = '11' )
 AND ( NOT ( ( QMEL9~VKORG like '%04' ) )
 AND ( NOT ( ( QMEL9~VKORG like '%03' ) )
 AND NOT ( ( QMEL9~VKORG like '%02' ) ) ) ) ).
ALTMP1072 = QMEL9QMNUM.
ALTMP1073 = QMEL9MANDT.
ALTMP1074 = QMEL9QMART.
ALTMP1075 = QMEL9QMTXT.
ALTMP1076 = QMEL9ARTPR.
ALTMP1077 = QMEL9PRIOK.
ALTMP1078 = QMEL9ERNAM.
ALTMP1079 = QMEL9ERDAT.
ALTMP1080 = QMEL9AENAM.
ALTMP1081 = QMEL9AEDAT.
ALTMP1082 = QMEL9QMDAT.
ALTMP1083 = QMEL9QMNAM.
ALTMP1084 = QMEL9STRMN.
ALTMP1085 = QMEL9LTRMN.
ALTMP1086 = QMEL9WAERS.
ALTMP1087 = QMEL9AUFNR.
ALTMP1088 = QMEL9VERID.
ALTMP1089 = QMEL9RM_MATNR.
ALTMP1090 = QMEL9RM_WERKS.
ALTMP1091 = QMEL9SA_AUFNR.
ALTMP1092 = QMEL9MATNR.
ALTMP1093 = QMEL9REVLV.
ALTMP1094 = QMEL9MATKL.
ALTMP1095 = QMEL9PRDHA.
ALTMP1096 = QMEL9KZKRI.
ALTMP1097 = QMEL9KZDKZ.
ALTMP1098 = QMEL9KUNUM.
ALTMP1099 = QMEL9FEKNZ.
ALTMP1100 = QMEL9MAKNZ.
ALTMP1101 = QMEL9OBJNR.
ALTMP1102 = QMEL9QMDAB.
ALTMP1103 = QMEL9RBNR.
ALTMP1104 = QMEL9RBNRI.
ALTMP1105 = QMEL9INDTX.
ALTMP1106 = QMEL9KZMLA.
ALTMP1107 = QMEL9HERKZ.
ALTMP1108 = QMEL9BEZDT.
ALTMP1109 = QMEL9LIFNUM.
ALTMP1110 = QMEL9BUNAME.
ALTMP1111 = QMEL9VBELN.
ALTMP1112 = QMEL9BSTNK.
ALTMP1113 = QMEL9BSTDK.
ALTMP1114 = QMEL9SPART.
ALTMP1115 = QMEL9VKORG.
ALTMP1116 = QMEL9VTWEG.
ALTMP1117 = QMEL9ADRNR.
ALTMP1118 = QMEL9MAWERK.
ALTMP1119 = QMEL9QMKAT.
ALTMP1120 = QMEL9QMGRP.
ALTMP1121 = QMEL9QMCOD.
ALTMP1122 = QMEL9AUSWIRK.
ALTMP1123 = QMEL9TEILEV.
ALTMP1124 = QMEL9PRUEFLOS.
ALTMP1125 = QMEL9CHARG.
ALTMP1126 = QMEL9LGORTCHARG.
ALTMP1127 = QMEL9LICHN.
ALTMP1128 = QMEL9HERSTELLER.
ALTMP1129 = QMEL9EMATNR.
ALTMP1130 = QMEL9EKORG.
ALTMP1131 = QMEL9BKGRP.
ALTMP1132 = QMEL9LGORTVORG.
ALTMP1133 = QMEL9FERTAUFNR.
ALTMP1134 = QMEL9FERTAUFPL.
ALTMP1135 = QMEL9EBELN.
ALTMP1136 = QMEL9EBELP.
ALTMP1137 = QMEL9MJAHR.
ALTMP1138 = QMEL9MBLNR.
ALTMP1139 = QMEL9MBLPO.
ALTMP1140 = QMEL9LS_KDAUF.
ALTMP1141 = QMEL9LS_KDPOS.
ALTMP1142 = QMEL9LS_VBELN.
ALTMP1143 = QMEL9LS_POSNR.
ALTMP1144 = QMEL9CROBJTY.
ALTMP1145 = QMEL9ARBPL.
ALTMP1146 = QMEL9ARBPLWERK.
ALTMP1147 = QMEL9FEART.
ALTMP1148 = QMEL9PNLKN.
ALTMP1149 = QMEL9MGEIG.
ALTMP1150 = QMEL9MGFRD.
ALTMP1151 = QMEL9MGEIN.
ALTMP1152 = QMEL9BZMNG.
ALTMP1153 = QMEL9RKMNG.
ALTMP1154 = QMEL9RGMNG.
ALTMP1155 = QMEL9RKDAT.
ALTMP1156 = QMEL9COAUFNR.
ALTMP1157 = QMEL9QWRNUM.
ALTMP1158 = QMEL9REFNUM.
ALTMP1159 = QMEL9KDMAT.
ALTMP1160 = QMEL9IDNLF.
ALTMP1161 = QMEL9SERIALNR.
ALTMP1162 = QMEL9KZLOESCH.
ALTMP1163 = QMEL9PRODDAT.
ALTMP1164 = QMEL9DEVICEID.
ALTMP1165 = QMEL9VKBUR.
ALTMP1166 = QMEL9VKGRP.
ALTMP1167 = QMEL9AUTKZ.
ALTMP1168 = QMEL9BEDID.
ALTMP1169 = QMEL9BEDZL.
ALTMP1170 = QMEL9PROFIL_TYP.
ALTMP1171 = QMEL9PROFIL_ID.
ALTMP1172 = QMEL9HANDLE.
ALTMP1173 = QMEL9TSEGFL.
ALTMP1174 = QMEL9TSEGTP.
ALTMP1175 = QMEL9TZONSO.
ALTMP1176 = QMEL9TZONID.
ALTMP1177 = QMEL9FUNKTION.
ALTMP1178 = QMEL9/SAPSMOSS/INSTN.
ALTMP1179 = QMEL9/SAPSMOSS/MNUMM.
ALTMP1180 = QMEL9/SAPSMOSS/OSSYS.
ALTMP1181 = QMEL9/SAPSMOSS/DBSYS.
ALTMP1182 = QMEL9/SAPSMOSS/REL.
ALTMP1183 = QMEL9/SAPSMOSS/COMP.
ALTMP1184 = QMEL9/SAPSMOSS/FRONT.
ALTMP1185 = QMEL9/SAPSMOSS/SYSTYP.
ALTMP1186 = QMEL9/SAPSMOSS/ADDID.
ALTMP1187 = QMEL9/SAPSMOSS/ADDREL.
ALTMP1188 = QMEL9/SAPSMOSS/TSTMP.
ALTMP1189 = QMEL9/SAPSMOSS/STATUS.
ALTMP1190 = QMEL9/SAPSMOSS/ERDAT.
ALTMP1191 = QMEL9/SAPSMOSS/SYSID.
ALTMP1192 = QMEL9/SAPSMOSS/MANDT.
ALTMP1193 = QMEL9PSP_NR.
ALTMP1194 = QMEL9ESTIMATED_COSTS.
ALTMP1195 = QMEL9CLAIMED_COSTS.
ALTMP1196 = QMEL9RESULT_COSTS.
ALTMP1197 = QMEL9CHANCE.
ALTMP1198 = QMEL9OPPONENT.
ALTMP1199 = QMEL9KALNR.
ALTMP1200 = QMEL9KALVAR.
ALTMP1201 = QMEL9OBJNR_REAL.
ALTMP1202 = QMEL9OBJNR_STAT.
ALTMP1203 = QMEL9PHASE.
ALTMP1204 = QMEL9/ISDFPS/OBJNR.
ALTMP1205 = QMEL9LOGSYSTEM.
ALTMP1206 = QMEL9/ISDFPS/MEQUI.
ALTMP1207 = QMEL9YY_BEMOT.
ALTMP1208 = QMIH9IWERK.
ALTMP1209 = QMIH9ILOAN.
ALTMP1210 = QMIH9ILOAI.
ALTMP1211 = QMIH9EQUNR.
ALTMP1212 = QMIH9BAUTL.
ALTMP1213 = QMIH9EBORT.
ALTMP1214 = QMIH9MSAUS.
ALTMP1215 = QMIH9AUSVN.
ALTMP1216 = QMIH9AUSBS.
ALTMP1217 = QMIH9AUSZT.
ALTMP1218 = QMIH9MAUEH.
ALTMP1219 = QMIH9BTPLN.
ALTMP1220 = QMIH9BEQUI.
ALTMP1221 = QMIH9AUSWK.
ALTMP1222 = QMIH9VERFV.
ALTMP1223 = QMIH9VERFN.
ALTMP1224 = QMIH9VERFM.
ALTMP1225 = QMIH9ANLZV.
ALTMP1226 = QMIH9ANLZN.
ALTMP1227 = QMIH9ANLZE.
ALTMP1228 = QMIH9INSPK.
ALTMP1229 = QMIH9INGRP.
ALTMP1230 = QMIH9WARPL.
ALTMP1231 = QMIH9ABNUM.
ALTMP1232 = QMIH9WAPOS.
ALTMP1233 = QMIH9KDAUF.
ALTMP1234 = QMIH9KDPOS.
ALTMP1235 = QMIH9SCREENTY.
ALTMP1236 = QMIH9PLNTY.
ALTMP1237 = QMIH9PLNNR.
ALTMP1238 = QMIH9PLNAL.
ALTMP1239 = QMIH9REVNR.
ALTMP1240 = QMIH9ZAEHL.
ALTMP1241 = ILOA9TPLNR.
ALTMP1242 = ZSTC_SALE_019BUKRS.
ALTMP1243 = ZSTC_SALE_019VKORG.
ALTMP1244 = ZSTC_SALE_019WERKS.
ALTMP1245 = ZSTC_SALE_019EKORG.
ALTMP1246 = ZSTC_SALE_019MAMUSERCMPY.
ALTMP1247 = ZSTC_SALE_019REGION.
ALTMP1248 = ZSTC_SALE_019COUNTRY.
ALTMP1249 = ZSTC_SALE_019COUNTRYDSCR.
ALTMP1250 = ZSTC_SALE_019SALESCOMPANY.
ALTMP1251 = ZSTC_SALE_019SALESCMPDSCR.
 move ALTMP1072 to ITAB5-QMNUM.
 move ALTMP1073 to ITAB5-MANDT.
 move ALTMP1074 to ITAB5-QMART.
 move ALTMP1075 to ITAB5-QMTXT.
 move ALTMP1076 to ITAB5-ARTPR.
 move ALTMP1077 to ITAB5-PRIOK.
 move ALTMP1078 to ITAB5-ERNAM.
 move ALTMP1079 to ITAB5-ERDAT.
 move ALTMP1080 to ITAB5-AENAM.
 move ALTMP1081 to ITAB5-AEDAT.
 move ALTMP1082 to ITAB5-QMDAT.
 move ALTMP1083 to ITAB5-QMNAM.
 move ALTMP1084 to ITAB5-STRMN.
 move ALTMP1085 to ITAB5-LTRMN.
 move ALTMP1086 to ITAB5-WAERS.
 move ALTMP1087 to ITAB5-AUFNR.
 move ALTMP1088 to ITAB5-VERID.
 move ALTMP1089 to ITAB5-RM_MATNR.
 move ALTMP1090 to ITAB5-RM_WERKS.
 move ALTMP1091 to ITAB5-SA_AUFNR.
 move ALTMP1092 to ITAB5-MATNR.
 move ALTMP1093 to ITAB5-REVLV.
 move ALTMP1094 to ITAB5-MATKL.
 move ALTMP1095 to ITAB5-PRDHA.
 move ALTMP1096 to ITAB5-KZKRI.
 move ALTMP1097 to ITAB5-KZDKZ.
 move ALTMP1098 to ITAB5-KUNUM.
 move ALTMP1099 to ITAB5-FEKNZ.
 move ALTMP1100 to ITAB5-MAKNZ.
 move ALTMP1101 to ITAB5-OBJNR.
 move ALTMP1102 to ITAB5-QMDAB.
 move ALTMP1103 to ITAB5-RBNR.
 move ALTMP1104 to ITAB5-RBNRI.
 move ALTMP1105 to ITAB5-INDTX.
 move ALTMP1106 to ITAB5-KZMLA.
 move ALTMP1107 to ITAB5-HERKZ.
 move ALTMP1108 to ITAB5-BEZDT.
 move ALTMP1109 to ITAB5-LIFNUM.
 move ALTMP1110 to ITAB5-BUNAME.
 move ALTMP1111 to ITAB5-VBELN.
 move ALTMP1112 to ITAB5-BSTNK.
 move ALTMP1113 to ITAB5-BSTDK.
 move ALTMP1114 to ITAB5-SPART.
 move ALTMP1115 to ITAB5-VKORG.
 move ALTMP1116 to ITAB5-VTWEG.
 move ALTMP1117 to ITAB5-ADRNR.
 move ALTMP1118 to ITAB5-MAWERK.
 move ALTMP1119 to ITAB5-QMKAT.
 move ALTMP1120 to ITAB5-QMGRP.
 move ALTMP1121 to ITAB5-QMCOD.
 move ALTMP1122 to ITAB5-AUSWIRK.
 move ALTMP1123 to ITAB5-TEILEV.
 move ALTMP1124 to ITAB5-PRUEFLOS.
 move ALTMP1125 to ITAB5-CHARG.
 move ALTMP1126 to ITAB5-LGORTCHARG.
 move ALTMP1127 to ITAB5-LICHN.
 move ALTMP1128 to ITAB5-HERSTELLER.
 move ALTMP1129 to ITAB5-EMATNR.
 move ALTMP1130 to ITAB5-EKORG.
 move ALTMP1131 to ITAB5-BKGRP.
 move ALTMP1132 to ITAB5-LGORTVORG.
 move ALTMP1133 to ITAB5-FERTAUFNR.
 move ALTMP1134 to ITAB5-FERTAUFPL.
 move ALTMP1135 to ITAB5-EBELN.
 move ALTMP1136 to ITAB5-EBELP.
 move ALTMP1137 to ITAB5-MJAHR.
 move ALTMP1138 to ITAB5-MBLNR.
 move ALTMP1139 to ITAB5-MBLPO.
 move ALTMP1140 to ITAB5-LS_KDAUF.
 move ALTMP1141 to ITAB5-LS_KDPOS.
 move ALTMP1142 to ITAB5-LS_VBELN.
 move ALTMP1143 to ITAB5-LS_POSNR.
 move ALTMP1144 to ITAB5-CROBJTY.
 move ALTMP1145 to ITAB5-ARBPL.
 move ALTMP1146 to ITAB5-ARBPLWERK.
 move ALTMP1147 to ITAB5-FEART.
 move ALTMP1148 to ITAB5-PNLKN.
 move ALTMP1149 to ITAB5-MGEIG.
 move ALTMP1150 to ITAB5-MGFRD.
 move ALTMP1151 to ITAB5-MGEIN.
 move ALTMP1152 to ITAB5-BZMNG.
 move ALTMP1153 to ITAB5-RKMNG.
 move ALTMP1154 to ITAB5-RGMNG.
 move ALTMP1155 to ITAB5-RKDAT.
 move ALTMP1156 to ITAB5-COAUFNR.
 move ALTMP1157 to ITAB5-QWRNUM.
 move ALTMP1158 to ITAB5-REFNUM.
 move ALTMP1159 to ITAB5-KDMAT.
 move ALTMP1160 to ITAB5-IDNLF.
 move ALTMP1161 to ITAB5-SERIALNR.
 move ALTMP1162 to ITAB5-KZLOESCH.
 move ALTMP1163 to ITAB5-PRODDAT.
 move ALTMP1164 to ITAB5-DEVICEID.
 move ALTMP1165 to ITAB5-VKBUR.
 move ALTMP1166 to ITAB5-VKGRP.
 move ALTMP1167 to ITAB5-AUTKZ.
 move ALTMP1168 to ITAB5-BEDID.
 move ALTMP1169 to ITAB5-BEDZL.
 move ALTMP1170 to ITAB5-PROFIL_TYP.
 move ALTMP1171 to ITAB5-PROFIL_ID.
 move ALTMP1172 to ITAB5-HANDLE.
 move ALTMP1173 to ITAB5-TSEGFL.
 move ALTMP1174 to ITAB5-TSEGTP.
 move ALTMP1175 to ITAB5-TZONSO.
 move ALTMP1176 to ITAB5-TZONID.
 move ALTMP1177 to ITAB5-FUNKTION.
 move ALTMP1178 to ITAB5-/SAPSMOSS/INSTN.
 move ALTMP1179 to ITAB5-/SAPSMOSS/MNUMM.
 move ALTMP1180 to ITAB5-/SAPSMOSS/OSSYS.
 move ALTMP1181 to ITAB5-/SAPSMOSS/DBSYS.
 move ALTMP1182 to ITAB5-/SAPSMOSS/REL.
 move ALTMP1183 to ITAB5-/SAPSMOSS/COMP.
 move ALTMP1184 to ITAB5-/SAPSMOSS/FRONT.
 move ALTMP1185 to ITAB5-/SAPSMOSS/SYSTYP.
 move ALTMP1186 to ITAB5-/SAPSMOSS/ADDID.
 move ALTMP1187 to ITAB5-/SAPSMOSS/ADDREL.
 move ALTMP1188 to ITAB5-/SAPSMOSS/TSTMP.
 move ALTMP1189 to ITAB5-/SAPSMOSS/STATUS.
 move ALTMP1190 to ITAB5-/SAPSMOSS/ERDAT.
 move ALTMP1191 to ITAB5-/SAPSMOSS/SYSID.
 move ALTMP1192 to ITAB5-/SAPSMOSS/MANDT.
 move ALTMP1193 to ITAB5-PSP_NR.
 move ALTMP1194 to ITAB5-ESTIMATED_COSTS.
 move ALTMP1195 to ITAB5-CLAIMED_COSTS.
 move ALTMP1196 to ITAB5-RESULT_COSTS.
 move ALTMP1197 to ITAB5-CHANCE.
 move ALTMP1198 to ITAB5-OPPONENT.
 move ALTMP1199 to ITAB5-KALNR.
 move ALTMP1200 to ITAB5-KALVAR.
 move ALTMP1201 to ITAB5-OBJNR_REAL.
 move ALTMP1202 to ITAB5-OBJNR_STAT.
 move ALTMP1203 to ITAB5-PHASE.
 move ALTMP1204 to ITAB5-/ISDFPS/OBJNR.
 move ALTMP1205 to ITAB5-LOGSYSTEM.
 move ALTMP1206 to ITAB5-/ISDFPS/MEQUI.
 move ALTMP1207 to ITAB5-YY_BEMOT.
 move ALTMP1208 to ITAB5-IWERK.
 move ALTMP1209 to ITAB5-ILOAN.
 move ALTMP1210 to ITAB5-ILOAI.
 move ALTMP1211 to ITAB5-EQUNR.
 move ALTMP1212 to ITAB5-BAUTL.
 move ALTMP1213 to ITAB5-EBORT.
 move ALTMP1214 to ITAB5-MSAUS.
 move ALTMP1215 to ITAB5-AUSVN.
 move ALTMP1216 to ITAB5-AUSBS.
 move ALTMP1217 to ITAB5-AUSZT.
 move ALTMP1218 to ITAB5-MAUEH.
 move ALTMP1219 to ITAB5-BTPLN.
 move ALTMP1220 to ITAB5-BEQUI.
 move ALTMP1221 to ITAB5-AUSWK.
 move ALTMP1222 to ITAB5-VERFV.
 move ALTMP1223 to ITAB5-VERFN.
 move ALTMP1224 to ITAB5-VERFM.
 move ALTMP1225 to ITAB5-ANLZV.
 move ALTMP1226 to ITAB5-ANLZN.
 move ALTMP1227 to ITAB5-ANLZE.
 move ALTMP1228 to ITAB5-INSPK.
 move ALTMP1229 to ITAB5-INGRP.
 move ALTMP1230 to ITAB5-WARPL.
 move ALTMP1231 to ITAB5-ABNUM.
 move ALTMP1232 to ITAB5-WAPOS.
 move ALTMP1233 to ITAB5-KDAUF.
 move ALTMP1234 to ITAB5-KDPOS.
 move ALTMP1235 to ITAB5-SCREENTY.
 move ALTMP1236 to ITAB5-PLNTY.
 move ALTMP1237 to ITAB5-PLNNR.
 move ALTMP1238 to ITAB5-PLNAL.
 move ALTMP1239 to ITAB5-REVNR.
 move ALTMP1240 to ITAB5-ZAEHL.
 move ALTMP1241 to ITAB5-TPLNR.
 move ALTMP1242 to ITAB5-Z_BUKRS.
 move ALTMP1243 to ITAB5-Z_VKORG.
 move ALTMP1244 to ITAB5-Z_WERKS.
 move ALTMP1245 to ITAB5-Z_EKORG.
 move ALTMP1246 to ITAB5-Z_MAMUSERCMPY.
 move ALTMP1247 to ITAB5-Z_REGION.
 move ALTMP1248 to ITAB5-Z_COUNTRY.
 move ALTMP1249 to ITAB5-Z_COUNTRYDSCR.
 move ALTMP1250 to ITAB5-Z_SALESCOMPANY.
 move ALTMP1251 to ITAB5-Z_SALESCMPDSCR.
 append ITAB5.
 cntbuf = cntbuf + 1.
 if download = 'N'.
  if cntbuf > 5000.
    perform FORM6.
    clear cntbuf.
    refresh ITAB5.
    append_flag = 'A'.
  endif.
 endif.
 if download = 'S'.
  if cntbuf > P_PKGSZ.
    perform FORM6.
    clear cntbuf.
    refresh ITAB5.
  endif.
 endif.
ENDSELECT.
ENDFORM.

FORM FORM6.
data: outfile(512), ldfile(50).
ldfile = 'CTS_LZ_SAP_CP1_NOT'.
concatenate out_dir ldfile into outfile
  separated by '/'.
  IF DOWNLOAD = 'S'.
     DATA: error_message(700),mtext(800),iEOP(1).
     CALL FUNCTION P_SRVFM
          DESTINATION P_DEST
          KEEPING LOGICAL UNIT OF WORK
          EXPORTING
            EOS = last_batch
          IMPORTING
            EOP = iEOP
          TABLES
            E_TABLE = ITAB5
          EXCEPTIONS
            READ_ERROR = 1
            SYSTEM_FAILURE = 2
            MESSAGE error_message
            COMMUNICATION_FAILURE = 3
            MESSAGE error_message
            OTHERS = 4.

     IF sy-subrc ne 0.
        Case sy-subrc.
        when 1.
        CONCATENATE
        'Data Services read error. '
        'Check Data Services error log.'
        INTO mtext.
        MESSAGE  E240(S#) WITH mtext.
        when 2.
        CONCATENATE
'SAP System Failure while calling DS remote function: '
      error_message INTO mtext.
        MESSAGE  E240(S#) WITH mtext.
        when 3.
        CONCATENATE
'SAP System Failure while calling DS remote function: '
      error_message INTO mtext.
        MESSAGE  E240(S#) WITH mtext.
        when 4.
        MESSAGE  E240(S#) WITH
'Other SAP System Failure while calling DS remote function.'.
        endcase.
      ENDIF.
      IF iEOP = 'X'.
         PERFORM DISCONNECT_RFCDEST_FROM_PROGID.
         LEAVE PROGRAM.
       ENDIF.
  ELSE.
data  dlmtlen type i value '1'.
data xdlmtlen type i value '1'.
data:
  ht(1) type c,
  xht(1) type x,
  conv type ref to cl_abap_conv_in_ce.
xht = '7F'.
conv = cl_abap_conv_in_ce=>create(
  encoding = '1100'
  input = xht
).
call method conv->read(
  exporting n    = xdlmtlen
  importing data = ht
            len = dlmtlen
).
data return_code type i.
 perform write_delimited_file
           tables   ITAB5
           using    outfile
                    append_flag
                    ht
                    dlmtlen
                    download
           changing return_code.

  case return_code.
    when 1.
      IF EXECMODE = 'D'.
        WRITE: /5 'No line selected'.
      ELSE.
        MESSAGE E047(S#).
      ENDIF.
    when 2.
      IF EXECMODE = 'D'.
        WRITE: /5 'Open File Error -- ', 25 OUTFILE.
      ELSE.
        MESSAGE  E084(E0) WITH OUTFILE.
      ENDIF.
    when 3.
      IF EXECMODE = 'D'.
        WRITE: /5 'Data exceed length limit (8192) '.
      ELSE.
        MESSAGE  E240(S#) WITH
             'Data exceed length limit (8192) '.
      ENDIF.
    when 4.
      IF EXECMODE = 'D'.
        WRITE: /5 'Call function WS_DOWNLOAD error'.
      ELSE.
        MESSAGE  E240(S#) WITH
             'Call function WS_DOWNLOAD error'.
      ENDIF.
  endcase.
 ENDIF.
ENDFORM.

FORM SUBSTRING USING SRC BEG LEN CHANGING RET.

DATA: VA1 TYPE I.
DATA: VA2 TYPE I.
DATA: VA3 TYPE I.

VA3 = STRLEN( SRC ).

IF  BEG = 0.   VA1 = 0.
ELSE.
  IF  BEG < 0.
    VA1 = VA3 + BEG.
    IF  VA1 < 0.   VA1 = 0.
    ENDIF.
  ELSE.          VA1 = BEG - 1.
  ENDIF.
ENDIF.

IF  LEN < 0.   VA2 = 0.
ELSE.          VA2 = VA3 - VA1.
ENDIF.

IF  VA2 > LEN. VA2 = LEN.
ENDIF.

IF  VA2 < 1.   MOVE ''           TO RET.
ELSE.          MOVE SRC+VA1(VA2) TO RET.
ENDIF.

ENDFORM.

form write_delimited_file
           tables   datatab
           using    file
                    append
                    delimit
                    dlength
                    dwnload
          changing rc.

  data: type1,
        appd(1),
        temp(32),
        time1(8),
        date1(10),
        output(8192),
        rcount type i,
        offset type i,
        tablen type i,
        maxlen type i value '8192'.

  data: begin of clientab occurs 0,
             output(8192),
          end of clientab.

  field-symbols: <f>.
  field-symbols <delim1>.
  data delim2(16).
  data l_filename type string.

  appd = append.
  if appd is not initial.
     appd = 'X'.
  endif.
  move file to l_filename.
  describe table datatab lines tablen.


  if dwnload = 'Y'.
     clear clientab. refresh clientab.
     rcount = 0.
  else.
     if appd = space.
   open dataset file for output in text mode ENCODING UTF-8.
     else.
    open dataset file for appending in text mode ENCODING UTF-8.
     endif.
     if sy-subrc <> 0.
         rc = 2. exit.
     endif.
  endif.

  loop at datatab.
    clear: tablen, offset, output.
    do.
      assign component sy-index of
         structure datatab to <f>.
      if sy-subrc <> 0. exit. endif.
      if sy-index > 1.
         assign delimit(dlength) TO <delim1> CASTING TYPE C.
         delim2 = <delim1>.
         write delim2(dlength) to output+offset(dlength).
         add dlength to offset.
      endif.

      describe field <f> type type1.

      if type1 = 'I' or type1 = 'N'.
          type1 = 'P'.
      endif.

      case type1.
        when 'D'.
          if <f> = '00000000'.
             <f> = ' '.
          else.
             move <f> to time1.
             assign time1 to <f>.
          endif.
        when 'F'.
          if <f> = '0.0'.
            temp = '0.0'.
          else.
             write <f> to temp exponent 0.
          endif.
          condense temp no-gaps.
          translate temp using ',.'.
          assign temp to <f>.
        when 'P'.
          if <f> < 0.
             write '-' to output+offset(1).
             add 1 to offset.
             <f> = <f> * ( -1 ).
          endif.
          move <f> to temp.
          condense temp no-gaps.
          translate temp using ',.'.
          assign temp to <f>.
      endcase.

      sy-fdpos = strlen( <f> ).

      tablen = offset + sy-fdpos.
      if tablen > maxlen.
         rc = 3. exit.
      endif.
      write <f> to output+offset(sy-fdpos).
      add sy-fdpos to offset.
    enddo.

    if dwnload = 'Y'.
       clientab-output = output.
       append clientab.
       rcount = rcount + 1.
       if rcount >= 50.
          SY-BATCH = SPACE.
          CALL FUNCTION 'GUI_DOWNLOAD'
            EXPORTING
              FILENAME = l_filename
              FILETYPE = 'ASC'
              CODEPAGE = '4110'
              APPEND   = appd
              WRITE_FIELD_SEPARATOR = 'X'
*            IMPORTING
*              FILELENGTH =
            TABLES
              DATA_TAB = clientab
            EXCEPTIONS
              OTHERS = 1.
          if sy-subrc <> 0.
             rc = 4.
          endif.
          clear clientab. refresh clientab.
          rcount = 0. appd = 'A'.
       endif.
    else.
       transfer output to file.
    endif.
  endloop.

  if dwnload = 'Y'.
       SY-BATCH = SPACE.
       CALL FUNCTION 'GUI_DOWNLOAD'
         EXPORTING
           FILENAME = l_filename
           FILETYPE = 'ASC'
              CODEPAGE = '4110'
           APPEND   = appd
           WRITE_FIELD_SEPARATOR = 'X'
*         IMPORTING
*           FILELENGTH =
         TABLES
           DATA_TAB = clientab
         EXCEPTIONS
           OTHERS = 1.
          if sy-subrc <> 0.
             rc = 4.
          endif.
  else.
       close dataset file.
  endif.
endform.

FORM CONNECT_RFCDEST_TO_PROGID.
 INCLUDE rfctypes.

 DATA: len     type i,
       R3NAME(4),
       SYSTNR(2),
       uid     LIKE SYS_UID,
       options LIKE RFCOPT,
       isunicode  TYPE n.

 DATA: NTOTAL     LIKE GWY_STRUCT-NOREG,
       GWY_GWHOST LIKE GWY_STRUCT-GWHOST,
       GWY_GWSERV LIKE GWY_STRUCT-GWSERV,
       GWY_TPNAME LIKE GWY_SYSTEM-TPNAME.

 TABLES: RFCSI.

* Check program ID
 IF P_PROGID = SPACE.							
    RAISE INVALID_PROGRAM_ID.
 ENDIF.

* determine if the RFC destination authority
  CALL FUNCTION 'RFC_READ_TCPIP_DESTINATION'
       EXPORTING destination = P_DEST
                 authority_check = 'X'
  IMPORTING rfcunicode = isunicode.

* Use current gateway if no info exits
 IF P_GWHOST = SPACE OR P_GWSERV = SPACE.
  CALL FUNCTION 'RFC_SYSTEM_INFO'
      IMPORTING
          RFCSI_EXPORT = RFCSI.

  len = strlen( rfcsi-rfcdest ) - 2.
  systnr = rfcsi-rfcdest+len.
  len = len - 1 - 3.
  r3name = rfcsi-rfcdest+len(3).
  len = len - 1.
  options-rfcgwhost = rfcsi-rfcdest(len).
  CONCATENATE 'sapgw' SYSTNR INTO options-rfcgwserv.
 ELSE.
   options-rfcgwhost = P_GWHOST.
   options-rfcgwserv = P_GWSERV.
 ENDIF.

* Parameters for GWY function call
  GWY_GWHOST = OPTIONS-RFCGWHOST.
  GWY_GWSERV = OPTIONS-RFCGWSERV.
  GWY_TPNAME = P_PROGID.

* Check gateway and server program registered
  CALL FUNCTION 'GWY_GET_NO_REG_PROGRAMS'
     EXPORTING
        GWHOST      = GWY_GWHOST
        GWSERV      = GWY_GWSERV
        TPNAME      = GWY_TPNAME
     IMPORTING
        NOREG_TOTAL = NTOTAL
     EXCEPTIONS
        OTHERS      = 1.

  IF sy-subrc NE 0.
     raise CONNECT_TO_GATEWAY_FAILED.
  ENDIF.

  IF NTOTAL = 0.
     raise SERVER_NOT_REGISTERED.
  ENDIF.

  IF NTOTAL GT 1.
     raise DUPLICATE_REG_PROGRAMS.
  ENDIF.

* build new connection to a registered server
  options-rfcexec   = gwy_tpname.
  options-rfcgwhost = gwy_gwhost.
  options-rfcgwserv = gwy_gwserv.
  options-rfchost   = '%%RFCSERVER%%'.
  IF P_SNC_ON = 'X'.
    options-rfcsnc  = 'X'.
  ENDIF.

  CALL 'RFCControl' ID 'CODE' FIELD 'O'
                    ID 'DESTINATION' FIELD P_DEST
                    ID 'TYPE' FIELD rfctype_external_tcp
                    ID 'OPTIONS' FIELD options.

  IF sy-subrc NE 0.
     RAISE CONNECT_TO_REG_SERVER_FAILED.
   ENDIF.

* and set exclusive mode to keep server owned
  CALL FUNCTION 'SYSTEM_SET_REG_SERVER_PROPERTY'
      EXPORTING  destination = P_DEST
                 exclusiv    = 'Y'
      EXCEPTIONS connect_to_reg_server_failed = 1
                 exclusiv_not_supported       = 2.

  IF SY-SUBRC NE 0.
     CASE SY-SUBRC.
          WHEN 1.
              RAISE CONNECT_TO_REG_SERVER_FAILED.
          WHEN 2.
              RAISE EXCLUSIV_NOT_SUPPORTED.
     ENDCASE.
  ENDIF.

ENDFORM.

FORM DISCONNECT_RFCDEST_FROM_PROGID.
* set exclusive mode to E to end the session
  CALL FUNCTION 'SYSTEM_SET_REG_SERVER_PROPERTY'
     EXPORTING
         destination = P_DEST
         exclusiv    = 'E'
     EXCEPTIONS
         connect_to_reg_server_failed = 1				
         exclusiv_not_supported       = 2.
ENDFORM.
