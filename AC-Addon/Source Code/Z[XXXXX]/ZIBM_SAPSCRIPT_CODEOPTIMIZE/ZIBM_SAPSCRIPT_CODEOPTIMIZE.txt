*&---------------------------------------------------------------------*
*& Report       ZIBM_SAPSCRIPT_CODEOPTIMIZE
*& Description  Code Optimzer - SAPScript
*& Owner        IBM India
*& Version      3.2
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*
REPORT  zibm_sapscript_codeoptimize NO STANDARD PAGE HEADING
                               LINE-SIZE 120  .

************************************************************************
*Tables Declaration
************************************************************************
TABLES:
  sscrfields, " Fields on selection screens
  tadir,      " To retrieve dev class
  t002,       " Language keys
  t000,       " Clients
  smp_dyntxt, " Menu Painter
  dd04l,      " Data elements
  stxh,       " Form table
  trdir,      " program table
  ttdtg,      " Sapscript standard symbols table
  ttxsy,      " Sapscript system symbols
  dd03l.      " Table Fields


************************************************************************
*Types
************************************************************************
TYPES: BEGIN OF ty_error_table,
        error_index(3)  TYPE  n,
        error_desc(50)  TYPE  c,
        total_error(3)  TYPE  n,
       END OF ty_error_table.

TYPES: BEGIN OF dtls_error_table,
        chkflg(1)       TYPE c,
        error_index(3)  TYPE n,
        error_field(40) TYPE c,
        scrn_field(132) TYPE c,
        error_desc(60)  TYPE c,
        line_no(4)      TYPE c,
        page_no(10)     TYPE c,
       END OF dtls_error_table.

TYPES: BEGIN OF ty_elements,
        elements(15)    TYPE c,
        program         TYPE sy-repid,
        line            TYPE i,
       END OF ty_elements.

TYPES: BEGIN OF ty_subroutine_pool,
           subrt_name     TYPE sy-repid,
           subrt_prog(30) TYPE c ,
           window         TYPE tdwindow,
           line           TYPE i,
       END OF ty_subroutine_pool.

TYPES: BEGIN OF l_var_1,
          var_tab     TYPE tabname,
          var(22)     TYPE c,
          window      TYPE tdwindow,
          line        TYPE i,
          flag        TYPE c,
       END OF l_var_1.

TYPES: BEGIN OF ty_variable,
          var     TYPE  fieldname,
          type    TYPE  tabname,
       END OF ty_variable.

TYPES: BEGIN OF ty_types_fields,
          type        TYPE tabname,
          struct_fld  TYPE fieldname,
       END OF ty_types_fields.

TYPES: BEGIN OF ty_types,
          type  TYPE  string,
          field TYPE  string,
       END OF ty_types.

TYPES: BEGIN OF ty_tables,
          field  TYPE  tabname,
       END OF ty_tables.

TYPES: BEGIN OF ty_win_ovlap,
           window    TYPE tdwindow,
           page      TYPE tdpage,
           x1(4)        TYPE p  DECIMALS 2,
           y1(4)        TYPE p  DECIMALS 2,
           x2(4)        TYPE p  DECIMALS 2,
           y2(4)        TYPE p  DECIMALS 2,
        END OF ty_win_ovlap.

TYPES: BEGIN OF ty_logo_std_txt,
           include_var TYPE string,
           std_txt_id  TYPE string,
           std_txt_obj TYPE string,
           lang        TYPE string,
           window         TYPE tdwindow,
           line           TYPE i,
       END OF ty_logo_std_txt.

TYPES: BEGIN OF ty_logo_std,
           include_var TYPE string,
           std_logo_obj TYPE string,
           lang        TYPE string,
           window         TYPE tdwindow,
           line           TYPE i,
       END OF ty_logo_std.

TYPES: BEGIN OF ty_var_chk,
           field      TYPE string,
       END OF ty_var_chk.

TYPES: BEGIN OF ty_field_chk,
           tabname(30)   TYPE c,
           fieldname(30) TYPE c,
       END OF ty_field_chk.


*******************************************
CONSTANTS: percntg(2) TYPE p VALUE 10.
********************************************

************************************************************************
*Internal tables
************************************************************************
DATA :  BEGIN OF it_source OCCURS 1000,
         line(255),         "statements of the program being tested
        END OF it_source.

DATA:  it_form_lines    TYPE TABLE OF tline,
       it_pages         TYPE TABLE OF itctg,
       it_page_windows  TYPE TABLE OF itcth,
       it_paragraphs    TYPE TABLE OF itcdp,
       it_strings       TYPE TABLE OF itcds,
       it_tabs          TYPE TABLE OF itcdq,
       it_windows       TYPE TABLE OF itctw,
*       it_source        TYPE ddbt_val,
       it_variable      TYPE TABLE OF ty_variable WITH HEADER LINE,
       it_elements      TYPE TABLE OF ty_elements WITH HEADER LINE,
       it_error_table   TYPE TABLE OF ty_error_table,
       it_wrng_table    TYPE TABLE OF ty_error_table,
       it_bdctab        TYPE TABLE OF bdcdata,
       it_dtls_error_table TYPE TABLE OF dtls_error_table,
       it_subroutine_pool  TYPE TABLE OF ty_subroutine_pool,
       it_var1             TYPE TABLE OF l_var_1,
       it_types            TYPE TABLE OF ty_types WITH HEADER LINE,
       it_tables           TYPE TABLE OF ty_tables WITH HEADER LINE,
       it_win_ovlap1       TYPE TABLE OF ty_win_ovlap,
       it_win_ovlap2       TYPE TABLE OF ty_win_ovlap,
       it_logo_std_txt     TYPE TABLE OF ty_logo_std_txt,
       it_logo_std         TYPE TABLE OF ty_logo_std,
       it_stxh             TYPE TABLE OF stxh,
       it_stxbitmaps       TYPE TABLE OF stxbitmaps,
       it_types_fields     TYPE TABLE OF ty_types_fields.

DATA : BEGIN OF it_program OCCURS 0,
         program TYPE program,
       END OF it_program.

DATA: BEGIN OF st_cts,
         l_tskno LIKE e071-trkorr,
         l_treq  LIKE e070-strkorr,
         l_pkg   LIKE tadir-devclass,
       END OF st_cts.

DATA: wa_tokens      TYPE stoken,
      w_ucomm LIKE sy-ucomm,  "user command
      wa_statements  TYPE sstmnt.
************************************************************************
*Work area
************************************************************************
DATA: wa_form_header      TYPE itcta,
      wa_form_lines       TYPE tline,
      wa_paragraphs       TYPE itcdp,
      wa_strings          TYPE itcds,
      wa_header           TYPE thead,
      wa_windows          TYPE itctw,
      wa_page_windows     TYPE itcth,
      wa_pages            TYPE itctg,
      wa_error_table      TYPE ty_error_table,
      wa_bdctab           TYPE bdcdata,
      wa_dtls_error_table TYPE dtls_error_table,
      wa_elements         TYPE ty_elements,
      wa_subroutine_pool  TYPE ty_subroutine_pool,
      wa_win_ovlap1       TYPE ty_win_ovlap,
      wa_win_ovlap2       TYPE ty_win_ovlap,
      wa_logo_std         TYPE ty_logo_std,
      wa_logo_std_txt     TYPE ty_logo_std_txt,
      wa_types_fields     TYPE ty_types_fields.


************************************************************************
*Global variables
************************************************************************
DATA: g_status                 TYPE c,
      v_redundant_para_format  TYPE i,
      v_redundant_char_format  TYPE i,
      v_para_font              TYPE i,
      v_char_font              TYPE i,
      v_err_index              TYPE i  VALUE 1,
      v_tran_err               TYPE c  VALUE IS INITIAL,
      v_redundant_form_txtele  TYPE i,
      v_redundant_prog_txtele  TYPE i,
      v_redundant_window       TYPE i,
      v_next_page_attr         TYPE i,
      v_var_not_used           TYPE i,
      v_com_line               TYPE i,
      v_subrt_not_def          TYPE i,
      v_rec_count              TYPE i,
      v_std_txt                TYPE i,
      v_std_logo               TYPE i.


***********************************************************************
*Selection Screen Changed by Subhadeep
***********************************************************************

SELECTION-SCREEN BEGIN OF BLOCK chk3_parm WITH FRAME TITLE text-037.

PARAMETERS  p_script TYPE tdform   OBLIGATORY . "SAP Script name

PARAMETERS  p_client  TYPE sy-mandt DEFAULT sy-mandt OBLIGATORY .

PARAMETERS  p_lang TYPE lang  DEFAULT 'EN' OBLIGATORY .

SELECTION-SCREEN SKIP 1.

SELECTION-SCREEN BEGIN OF BLOCK chk1_parm
                 WITH FRAME TITLE text-017.

SELECTION-SCREEN BEGIN OF LINE.
*Development Class and Trnsport Request
PARAMETERS: dev_tran  AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 2(30) text-018 FOR FIELD dev_tran.
SELECTION-SCREEN POSITION 50.

*Variable Defined in Form but not used
PARAMETERS:  var_dri  AS CHECKBOX DEFAULT 'X' MODIF ID grc.
SELECTION-SCREEN COMMENT 55(40) text-019 FOR FIELD var_dri .
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.

*Redundant Paragraph and Character Format
PARAMETERS : red_par AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 2(30) text-020 FOR FIELD red_par.
SELECTION-SCREEN POSITION 50.
*
*Redundant variables in the Form
PARAMETERS: red_var AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(40) text-021 FOR FIELD red_var.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Text Element in Form not in Driver Program
PARAMETERS : txt_ele AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(35) text-022 FOR FIELD txt_ele.
SELECTION-SCREEN POSITION 50.

*Overlapping of Windows by percentage
PARAMETERS: over_win AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 55(40) text-023 FOR FIELD over_win.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Redundant Description of Window/Paragraph/character
PARAMETERS : red_des AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 2(30) text-024 FOR FIELD red_des.
SELECTION-SCREEN POSITION 50.

*Next Page Attribute
PARAMETERS: nex_page AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 55(40) text-025 FOR FIELD nex_page.
SELECTION-SCREEN END OF LINE.

*SELECTION-SCREEN BEGIN OF LINE.
*PARAMETERS : com_line AS CHECKBOX DEFAULT 'X'. "
*SELECTION-SCREEN COMMENT 2(30) text-026 FOR FIELD com_line.
*SELECTION-SCREEN POSITION 50.

*Form maintained in multiple languages
*PARAMETERS : st_lang AS CHECKBOX DEFAULT ' ' MODIF ID gra.
*SELECTION-SCREEN COMMENT 2(30) text-034 FOR FIELD st_lang.
*SELECTION-SCREEN POSITION 50.



SELECTION-SCREEN BEGIN OF LINE.
*Comment line check
PARAMETERS : pure_com AS CHECKBOX DEFAULT 'X' .
SELECTION-SCREEN COMMENT 2(30) text-028 FOR FIELD pure_com.
SELECTION-SCREEN POSITION 50.

*Font family & size left blank for char & para format *
PARAMETERS: font_fam AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 55(40) text-029 FOR FIELD font_fam MODIF ID gra
.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Redundant window in form
PARAMETERS : win_def AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 2(30) text-030 FOR FIELD win_def.
SELECTION-SCREEN POSITION 50.

*Logo & standard text exists
PARAMETERS: logo_txt AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 55(40) text-031 FOR FIELD logo_txt.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.

*Standard text assigned to a cts
PARAMETERS: st_txt AS CHECKBOX DEFAULT 'X' .
SELECTION-SCREEN COMMENT 2(30) text-033 FOR FIELD st_txt.
SELECTION-SCREEN POSITION 50.

*Existance of subroutine
*PARAMETERS: ex_sub AS CHECKBOX DEFAULT 'X'.
*SELECTION-SCREEN COMMENT 55(40) text-035 FOR FIELD ex_sub.
PARAMETERS: sub_pool AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN COMMENT 55(40) text-027 FOR FIELD sub_pool.

SELECTION-SCREEN END OF LINE.


*SELECTION-SCREEN BEGIN OF LINE.
*
**Subroutine existance in subroutine pool
*PARAMETERS: sub_pool AS CHECKBOX DEFAULT 'X'.
*SELECTION-SCREEN COMMENT 2(30) text-027 FOR FIELD sub_pool.
*SELECTION-SCREEN END OF LINE.

************************START OF COMMENT********COMMENTED BY ARINDAM
*MUKHERJEE ON 17/01/06

*SELECTION-SCREEN BEGIN OF LINE.
**Form maintained in multiple languages
*PARAMETERS : st_lang AS CHECKBOX DEFAULT 'X'.
*SELECTION-SCREEN COMMENT 2(30) text-034 FOR FIELD st_lang.
*SELECTION-SCREEN POSITION 50.
*
**Existance of subroutine
**PARAMETERS: ex_sub AS CHECKBOX DEFAULT 'X'.
**SELECTION-SCREEN COMMENT 55(30) text-035 FOR FIELD ex_sub.
*SELECTION-SCREEN END OF LINE.

***********************END OF COMMENT**********************************8
SELECTION-SCREEN END   OF BLOCK chk1_parm.

PARAMETERS : win_over TYPE i DEFAULT 10.

SELECTION-SCREEN END OF BLOCK chk3_parm.

*checkbox option for driver program existence
PARAMETERS: p_chkdri AS CHECKBOX DEFAULT ' ' USER-COMMAND ucomm.

SELECTION-SCREEN SKIP 1.
**********************************************************

SELECTION-SCREEN BEGIN OF BLOCK chk2_parm WITH FRAME TITLE text-036.

PARAMETERS  g_pname  LIKE sy-repid MODIF ID grp. "Program Name
PARAMETERS  p_status AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Status ofthe Program

**************************************************************
SELECTION-SCREEN SKIP 1.

SELECTION-SCREEN BEGIN OF BLOCK chk_parm
                 WITH FRAME TITLE text-001.
PARAMETERS:
           p_glob(4)   OBLIGATORY DEFAULT 'V_' MODIF ID grp,
           "Standard Global Variabe declaration
           p_loc(4)    OBLIGATORY DEFAULT 'L_' MODIF ID grp,
           "Standard Local Variabe declaration
           p_const(4)  OBLIGATORY DEFAULT 'C_' MODIF ID grp,
           "Standard Constant declaration
           p_para(4)   OBLIGATORY DEFAULT 'P_' MODIF ID grp,
           "Standard parameter declaration
           p_chkb(4) MODIF ID grp,
           "Checkbox declarations
           p_radb(4) MODIF ID grp,
           "Radiobutton declarations
           p_opt(4)    OBLIGATORY DEFAULT 'SO_' MODIF ID grp,
           "Standard select-options declaration
           p_range(4) MODIF ID grp,
           "Standard range table declaration
           p_tabl(4)   OBLIGATORY DEFAULT 'IT_' MODIF ID grp,
           "Standard internal table declaration
           p_struc(10) OBLIGATORY DEFAULT 'ST_' MODIF ID grp,
           "Standard structure declaration
           p_type(10) MODIF ID grp,
           "Standard for type declaration
           p_wa(4)     OBLIGATORY DEFAULT 'WA_' MODIF ID grp
           "Standard for WA declaration
           .
SELECTION-SCREEN END OF BLOCK chk_parm.

SELECTION-SCREEN SKIP 1.

SELECTION-SCREEN BEGIN OF BLOCK chk_parm1
                 WITH FRAME TITLE text-002.

SELECTION-SCREEN BEGIN OF LINE.
*SY-SUBRC Check After SELECT
PARAMETERS: sy_sel   AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-003 FOR FIELD sy_sel.
SELECTION-SCREEN POSITION 50.
*SY-SUBRC Check After READ
PARAMETERS:  sy_read  AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(25) text-004 FOR FIELD sy_read.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Sort before Binary Search
PARAMETERS : sort_bny AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-005 FOR FIELD sort_bny.
SELECTION-SCREEN POSITION 50.
*Binary Search In READ
PARAMETERS: read_bny AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(25) text-006 FOR FIELD read_bny.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Hard coding in WHERE clause
PARAMETERS : hard_wre AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-007 FOR FIELD hard_wre.
SELECTION-SCREEN POSITION 50.
*Half Line Comment Check
PARAMETERS: half_com AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(25) text-008 FOR FIELD half_com.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*No Data Type Specified
PARAMETERS : no_type AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-009 FOR FIELD no_type.
SELECTION-SCREEN POSITION 50.
*No Length Specified
PARAMETERS: no_len AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(25) text-010 FOR FIELD no_len.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*SELECT inside a LOOP
PARAMETERS : sel_loop AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-011 FOR FIELD sel_loop.
SELECTION-SCREEN POSITION 50.
*Data element is not specified
PARAMETERS: no_delm AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(30) text-012 FOR FIELD no_delm.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Sort before delete adjacent
PARAMETERS : del_ajt AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-013 FOR FIELD del_ajt.
SELECTION-SCREEN POSITION 50.
*Check select *
PARAMETERS: sel_star AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(30) text-014 FOR FIELD sel_star.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
*Move-corresponding
PARAMETERS : move_cor AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 2(30) text-015 FOR FIELD move_cor.
SELECTION-SCREEN POSITION 50.
*Into-corresponding
PARAMETERS: into_cor AS CHECKBOX DEFAULT 'X' MODIF ID grp.
SELECTION-SCREEN COMMENT 55(30) text-016 FOR FIELD into_cor.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS : sel_clus AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Select from Cluster Table
SELECTION-SCREEN COMMENT 2(32) text-034 FOR FIELD sel_clus.
SELECTION-SCREEN POSITION 50.

PARAMETERS : hard_br  AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"User Name and Break Points
SELECTION-SCREEN COMMENT 55(30) text-035 FOR FIELD hard_br .


SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS : uname_ck AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"User Name and Break Points
SELECTION-SCREEN COMMENT 2(40) text-036 FOR FIELD uname_ck.
SELECTION-SCREEN POSITION 50.

PARAMETERS : view_chk AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"View Availability for Joined Tables
SELECTION-SCREEN COMMENT 55(30) text-037 FOR FIELD view_chk.

SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS : srt_loop AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Sort Inside Loop Statement
SELECTION-SCREEN COMMENT 2(40) text-038 FOR FIELD srt_loop.
SELECTION-SCREEN POSITION 50.

PARAMETERS : neg_sql  AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Negative SQL Statements in Where Condition
SELECTION-SCREEN COMMENT 55(30) text-039 FOR FIELD neg_sql .

SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS : on_chg AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Usage of ON CHANGE OF Statement
SELECTION-SCREEN COMMENT 2(48) text-040 FOR FIELD on_chg.
SELECTION-SCREEN POSITION 50.

PARAMETERS : tabl_cnt AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"DB Table Hit Count
SELECTION-SCREEN COMMENT 55(45) text-041 FOR FIELD tabl_cnt.

SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS : rang_chk AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Size limit of Ranges Check
SELECTION-SCREEN COMMENT 2(48) text-042 FOR FIELD rang_chk.
SELECTION-SCREEN POSITION 50.

PARAMETERS : int_ini AS CHECKBOX  DEFAULT 'X' MODIF ID grp.
"check for initial before for all entries
SELECTION-SCREEN COMMENT 55(45) text-043 FOR FIELD int_ini.

SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS : stat_lin AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"One stat per line
SELECTION-SCREEN COMMENT 2(48) text-044 FOR FIELD stat_lin.
SELECTION-SCREEN POSITION 50.

PARAMETERS : srt_hash AS CHECKBOX DEFAULT 'X' MODIF ID grp.
"Sort Hash Table
SELECTION-SCREEN COMMENT 55(45) text-045 FOR FIELD srt_hash.

SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN END   OF BLOCK chk_parm1.

SELECTION-SCREEN END OF BLOCK chk2_parm.

SELECTION-SCREEN SKIP 1.

SELECTION-SCREEN BEGIN OF BLOCK dwn WITH FRAME TITLE text-t01.
PARAMETERS html_dwn AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN END OF BLOCK dwn.

SELECTION-SCREEN FUNCTION KEY 1.
SELECTION-SCREEN FUNCTION KEY 2.

**********************************************************************
*Selection Screen Changed by Subhadeep
***********************************************************************

***********************************************************************
*Selection Screen validation
***********************************************************************
INITIALIZATION.
  MOVE '@4B@' TO smp_dyntxt-icon_id .
  MOVE 'Select All' TO smp_dyntxt-quickinfo.
  MOVE smp_dyntxt TO sscrfields-functxt_01.

  MOVE '@4D@' TO smp_dyntxt-icon_id .
  MOVE 'Deselect All' TO smp_dyntxt-quickinfo.
  MOVE smp_dyntxt TO sscrfields-functxt_02.


* Put input off for unused fields in the selection screen
  LOOP AT SCREEN.
    IF screen-group1 = 'GRB'.
      screen-input  = 0.
      MODIFY SCREEN.
    ENDIF.
  ENDLOOP.

AT SELECTION-SCREEN OUTPUT.
*  LOOP AT SCREEN.
*    IF screen-group1 = 'GRA'.
*      screen-input  = 0.
*      MODIFY SCREEN.
*    ENDIF.
*  ENDLOOP.

*Modify selection screen options
  PERFORM modify_screen.

AT SELECTION-SCREEN ON p_script.

  CHECK sy-ucomm = 'ONLI'.

  SELECT *
  UP TO 1 ROWS
  FROM stxh CLIENT SPECIFIED
  WHERE mandt    = p_client
  AND   tdobject = 'FORM'
  AND   tdname   = p_script.
  ENDSELECT.

  IF sy-subrc <> 0.
    MESSAGE 'Form does not exists' TYPE 'E'.
  ENDIF.

*  break abc.
*  SELECT *
*  UP TO 1 ROWS
*  FROM stxh
*  WHERE tdobject = 'FORM'
*  AND   tdname   = p_script.
*  ENDSELECT.
*
*  IF sy-subrc <> 0.
*    MESSAGE 'Form does not exists' TYPE 'E'.
*  ENDIF.

AT SELECTION-SCREEN ON p_client.

  CHECK sy-ucomm = 'ONLI'.

  SELECT *
  UP TO 1 ROWS
  FROM t000
  WHERE mandt = p_client.
  ENDSELECT.

  IF sy-subrc <> 0.
    MESSAGE 'Invalid Client' TYPE 'E'.
  ENDIF.

AT SELECTION-SCREEN ON p_lang.

  CHECK sy-ucomm = 'ONLI'.

  SELECT *
  UP TO 1 ROWS
  FROM t002
  WHERE spras = p_lang.
  ENDSELECT.

  IF sy-subrc <> 0.
*    MESSAGE 'Invalid Language' TYPE 'E'.
  ENDIF.

AT SELECTION-SCREEN ON g_pname.

  IF g_pname IS NOT INITIAL.

    CHECK sy-ucomm = 'ONLI'.

    SELECT *
    UP TO 1 ROWS
    FROM trdir
    WHERE name = g_pname.
    ENDSELECT.

    IF sy-subrc <> 0.
      MESSAGE 'Driver program does not exists' TYPE 'E'.
    ENDIF.

  ENDIF.

AT SELECTION-SCREEN.
  w_ucomm = sy-ucomm.

***********************************************************************
*Events
***********************************************************************

TOP-OF-PAGE.

* Print the report header
  PERFORM print_report_header.

START-OF-SELECTION.

* Get the SAP Script content
  PERFORM get_form_content.

* Check CTS
*  IF dev_tran = 'X'.
*    PERFORM cts_check.
*  ENDIF.

* Get the driver program content
  IF g_pname IS NOT INITIAL.
    PERFORM get_driver_prog_content USING g_pname.
  ENDIF.

* Check redundant paragraph format
  IF red_par = 'X'.
    PERFORM redundant_paragraph_format.
  ENDIF.

* Check reduntand character format
  IF red_par = 'X'.
    PERFORM redundant_character_format .
  ENDIF.


* Check if two windows have same descriptions
  IF red_des = 'X'.
    PERFORM same_windows_description.
  ENDIF.

* Check if two paragraph format have same descriptions
  IF red_des = 'X'.
    PERFORM same_para_description.
  ENDIF.

* Check if two charecter format have same descriptions
  IF red_des = 'X'.
    PERFORM same_char_description.
  ENDIF.

* Check redundant window
  IF win_def = 'X'.
    PERFORM redundant_win_check .
  ENDIF.

* Check if the next page attribute is left blank
  IF nex_page = 'X'.
    PERFORM nxtpg_blank.
  ENDIF.

* Redundant variable check
  IF var_dri = 'X'.
    PERFORM redundant_var_check.
  ENDIF.

* Check redundancy of text element in both form and driver program.
  IF g_pname IS NOT INITIAL AND txt_ele = 'X'.
    PERFORM check_text_element.
  ENDIF.

* Check subroutine pool
  IF sub_pool = 'X'.
    PERFORM subroutine_pool_check.
  ENDIF.

* Check pure comment lines
  IF pure_com = 'X'.
    PERFORM check_com_line.
  ENDIF.

* Check all the variables used in form
  IF g_pname IS NOT INITIAL AND red_var = 'X'.
    PERFORM check_variables.
  ENDIF.

* Check for the window overlapping
  IF over_win = 'X'.
    PERFORM window_overlap_check.
  ENDIF.

* Check if the Standard text and Logo are defined
  IF logo_txt = 'X'.
    PERFORM logo_std_txt_check.
  ENDIF.

***********************CHANGE MADE BY AMUKHER ON 01/11/06*********
* Check if font family & font size is left blank
  IF font_fam = 'X'.
    PERFORM font_existance_check.
    PERFORM char_font_existance_check.
  ENDIF.
**********************END OF CHANGE*************


* Check the syntax of custom driver program
  IF NOT g_pname IS INITIAL.
    IF g_pname+0(1) = 'Z' OR g_pname+0(1) = 'Y'
       OR g_pname+0(5) = 'SAPMZ' OR
       g_pname+0(5) = 'SAPMY' OR
       g_pname+0(5) = 'SAPLY' OR
       g_pname+0(5) = 'SAPLZ'.
      PERFORM check_program_syntax USING g_pname.
    ENDIF.
  ENDIF.

END-OF-SELECTION.

* Show the list of errors
  PERFORM show_list_of_errors.

AT LINE-SELECTION.

  IF  sy-lsind = 1
  AND sy-lilli <> 13
  AND wa_error_table-total_error IS NOT INITIAL.

*   Show detail error list
    PERFORM show_detail_list_error.

  ELSEIF sy-lsind = 2 OR sy-lilli = 13.

    IF  sy-lsind = 1
    AND sy-lilli = 13
    AND sy-cucol >= 1
    AND sy-cucol <= 44.

*     Go to transport request
      IF v_tran_err IS INITIAL.
        PERFORM goto_transport USING sy-lisel+22(20).
      ENDIF.

    ELSEIF sy-lsind = 1
    AND    sy-lilli = 13
    AND    sy-cucol >= 45
    AND    sy-cucol <= 85.

*     Go to SAP Script
      PERFORM goto_script USING  ' '
                                 'RSSCF-TDHEADEROB'
                                 'X'
                                 ' '
                                 ' '
                                 ' '.

    ELSEIF sy-lsind = 2.

      FIND '-' IN wa_dtls_error_table-scrn_field.

      IF sy-subrc = 0.
*       Go to SAP Script
        PERFORM goto_script USING wa_dtls_error_table-chkflg
                                  wa_dtls_error_table-scrn_field
                                  'X'
                                  wa_dtls_error_table-error_field
                                  wa_dtls_error_table-line_no
                                  wa_dtls_error_table-page_no.
      ELSE.
*       Go to program
        PERFORM goto_program USING wa_dtls_error_table-scrn_field
                                   wa_dtls_error_table-line_no.
      ENDIF.

    ENDIF.

  ENDIF.

*&---------------------------------------------------------------------*
*&      Form  get_form_content
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_form_content .

* Get form content
  CALL FUNCTION 'READ_FORM'
    EXPORTING
      client       = p_client
      form         = p_script
    IMPORTING
      form_header  = wa_form_header
      header       = wa_header
    TABLES
      form_lines   = it_form_lines
      pages        = it_pages
      page_windows = it_page_windows
      paragraphs   = it_paragraphs
      strings      = it_strings
      tabs         = it_tabs
      windows      = it_windows.
ENDFORM.                    "get_form_content

*&---------------------------------------------------------------------*
*&      Form  get_driver_prog_content
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_driver_prog_content USING p_prog TYPE program.

  DATA: l_line         TYPE int4,
        l_program_name TYPE program,
        l_tabix_1      TYPE sytabix,
        l_tabix_2      TYPE sytabix,
        l_tabix_3      TYPE sytabix,
        l_tabix_4      TYPE sytabix,
        l_tabix_5      TYPE sytabix,
        l_tabix_6      TYPE sytabix,
        l_tabix_7      TYPE sytabix,
        l_tabix_8      TYPE sytabix,
        l_tabix_9      TYPE sytabix,
        l_tabix_end    TYPE sytabix,
        l_var          TYPE token_str,
        l_row          TYPE token_row,
        l_off          TYPE i,
        l_len          TYPE i,
        l_inside_form  TYPE c,
        l_struct_flag  TYPE c.


  DATA: it_statements  TYPE TABLE OF sstmnt,
        it_tokens      TYPE TABLE OF stoken.

  IF p_status = 'X'.
    g_status = 'A'.
  ELSE.
    g_status = 'I'.
  ENDIF.

  REFRESH it_source.

* Get program content
  READ REPORT p_prog INTO it_source STATE g_status.

* Scan the abap source
  SCAN ABAP-SOURCE it_source STATEMENTS INTO it_statements
                             TOKENS     INTO it_tokens.

  LOOP AT it_tokens INTO wa_tokens.

*----------------------------------------------------------------------
*   Get all the includes
    IF wa_tokens-str = 'INCLUDE'.

      l_line = wa_tokens-row.
      l_tabix_2 = sy-tabix + 2.
      l_tabix_1 = sy-tabix + 1.

      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_2.

      IF sy-subrc = 0 AND wa_tokens-row <> l_line.

        CLEAR wa_tokens.
        READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

        l_program_name = wa_tokens-str.

        READ TABLE it_program WITH KEY program = l_program_name.

        IF sy-subrc <> 0.
          it_program = l_program_name.
          APPEND it_program.
*          WRITE:/ l_program_name.
          PERFORM get_driver_prog_content USING l_program_name.
        ENDIF.

      ELSEIF sy-subrc <> 0.

        CLEAR wa_tokens.
        READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

        l_program_name = wa_tokens-str.

        READ TABLE it_program WITH KEY program = l_program_name.

        IF sy-subrc <> 0.
          it_program = l_program_name.
          APPEND it_program.
*          WRITE:/ l_program_name.
          PERFORM get_driver_prog_content USING l_program_name.
        ENDIF.

      ENDIF.

    ENDIF.
*----------------------------------------------------------------------
*   Get all the variables
    IF wa_tokens-str = 'FORM'.
      CLEAR l_tabix_1.
      l_tabix_1 = sy-tabix + 1.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.
      IF  wa_tokens-str NE 'TYPE'
      AND wa_tokens-str NE 'LIKE'.
        l_inside_form = 'X'.
      ENDIF.
    ELSEIF wa_tokens-str = 'ENDFORM'.
      CLEAR l_inside_form.
    ENDIF.

************************START OF CHANGE********CHANGED BY ARINDAM
*MUKHERJEE ON 23/01/06
    IF wa_tokens-str = 'DATA' AND l_inside_form IS INITIAL.

      CLEAR: l_tabix_1,
             l_tabix_2,
             l_tabix_3,
             l_tabix_4,
             l_tabix_5,
             l_tabix_6,
             l_tabix_7,
             l_tabix_8,
             l_tabix_9.

      l_tabix_1 = sy-tabix + 1.
      l_tabix_2 = sy-tabix + 2.
      l_tabix_3 = sy-tabix + 3.
      l_tabix_4 = sy-tabix + 5.
      l_tabix_5 = sy-tabix + 6.
      l_tabix_6 = sy-tabix + 7.
      l_tabix_7 = sy-tabix + 8.
      l_tabix_8 = sy-tabix + 10.
      l_tabix_9 = sy-tabix + 11.

      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

      IF sy-subrc = 0 AND wa_tokens-str NE 'BEGIN' AND wa_tokens-str NE
      'END'.
        l_row           = wa_tokens-row.
        it_variable-var = wa_tokens-str.
        CLEAR wa_tokens.
        READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_2.

        IF sy-subrc = 0
        AND ( wa_tokens-str = 'TYPE' OR wa_tokens-str = 'LIKE' )
        AND wa_tokens-row = l_row.

          CLEAR wa_tokens.
          READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_3.
***********Check for Table type declarations **************
          IF wa_tokens-str NE 'TABLE' AND wa_tokens-str NE 'STANDARD'.
            it_variable-type = wa_tokens-str.
          ELSEIF wa_tokens-str = 'TABLE'.
            CLEAR wa_tokens.
            READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_5.
***********check if Table is declared with initial size***********
            IF wa_tokens-str = 'INITIAL'.
              CLEAR wa_tokens.
              READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_8.
***********Check if Table is declared with header line************
              IF wa_tokens-str = 'HEADER'.
                CLEAR wa_tokens.
                READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_4.
                it_variable-type = wa_tokens-str.
              ELSE.
***********If table is declared without header line, then it is not
*counted as variable******
                CLEAR it_variable.
              ENDIF.
            ELSE.
              CLEAR wa_tokens.
              READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_6.
              IF wa_tokens-str = 'HEADER'.
                CLEAR wa_tokens.
                READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_4.
                it_variable-type = wa_tokens-str.
              ELSE.
                CLEAR it_variable.
              ENDIF.
            ENDIF.
************************************************************************
*******************************************
          ELSE.
            CLEAR wa_tokens.
            READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_6.
***********check if Standard/Sorted/Hashed Table is declared with
*initial size***********
            IF wa_tokens-str = 'INITIAL'.
              CLEAR wa_tokens.
              READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_9.
***********Check if Standard/Sorted/Hashed Table is declared with header
*line************
              IF wa_tokens-str = 'HEADER'.
                CLEAR wa_tokens.
                READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_5.
                it_variable-type = wa_tokens-str.
              ELSE.
***********If Standard/sorted/Hashed table is declared without header
*line, then it is not counted as variable******
                CLEAR it_variable.
              ENDIF.
            ELSE.
              CLEAR wa_tokens.
              READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_7.
              IF wa_tokens-str = 'HEADER'.
                CLEAR wa_tokens.
                READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_5.
                it_variable-type = wa_tokens-str.
              ELSE.
                CLEAR it_variable.
              ENDIF.
            ENDIF.
          ENDIF.
          IF it_variable IS NOT INITIAL.
            APPEND it_variable .
            CLEAR it_variable.
          ENDIF.
        ENDIF.

      ENDIF.

    ENDIF.
************************END OF CHANGE***************************
    IF wa_tokens-str = 'CONSTANTS' AND l_inside_form IS INITIAL.

      CLEAR l_tabix_1.
      l_tabix_1 = sy-tabix + 1.
      l_row     = wa_tokens-row.
      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

      IF sy-subrc = 0.
        it_variable-var = wa_tokens-str.
        APPEND it_variable.
        CLEAR it_variable.
      ENDIF.

    ENDIF.

    IF wa_tokens-str = 'PARAMETERS' AND l_inside_form IS INITIAL.

      CLEAR l_tabix_1.
      l_tabix_1 = sy-tabix + 1.
      l_row     = wa_tokens-row.
      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

      IF sy-subrc = 0.
        it_variable-var = wa_tokens-str.
        APPEND it_variable.
        CLEAR it_variable.
      ENDIF.

    ENDIF.

    IF wa_tokens-str = 'TYPES' AND l_inside_form IS INITIAL.
      CLEAR: l_tabix_1,
             l_tabix_2,
             l_tabix_3.

      l_tabix_1 = sy-tabix + 1.
      l_tabix_2 = sy-tabix + 2.
      l_tabix_3 = sy-tabix + 3.
      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

      IF sy-subrc = 0 AND wa_tokens-str EQ 'BEGIN'.
        l_struct_flag = 'X'.
        l_row           = wa_tokens-row.
        it_types-type   = 'STRUCTURE'.
        CLEAR wa_tokens.
        READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_2.

        IF sy-subrc = 0
        AND wa_tokens-str = 'OF'
        AND wa_tokens-row = l_row.

          CLEAR wa_tokens.
          READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_3.
          it_types-field = wa_tokens-str.
          APPEND it_types.
        ENDIF.

      ELSEIF sy-subrc = 0 AND wa_tokens-str EQ 'END'.
        CLEAR l_struct_flag.
        CLEAR it_types.
      ELSEIF sy-subrc = 0 AND l_struct_flag = 'X'.
        wa_types_fields-type = it_types-field.
        wa_types_fields-struct_fld = wa_tokens-str.
        APPEND wa_types_fields TO it_types_fields.
        CLEAR wa_types_fields.
      ENDIF.
    ENDIF.

    IF wa_tokens-str = 'TABLES' AND l_inside_form IS INITIAL.
      CLEAR l_tabix_1.
      l_tabix_1 = sy-tabix + 1.
      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

      IF sy-subrc = 0.
        it_tables-field = wa_tokens-str.
        APPEND it_tables.
        CLEAR it_tables.
      ENDIF.
    ENDIF.

*----------------------------------------------------------------------
*   Get all the elements
    IF wa_tokens-str = 'CALL'.
      CLEAR: l_tabix_1,
             l_tabix_2.

      l_tabix_1 = sy-tabix + 1.
      l_tabix_2 = sy-tabix + 2.

      READ TABLE it_statements INTO wa_statements WITH KEY FROM =
      sy-tabix.
      IF sy-subrc = 0.
        l_tabix_end = wa_statements-to.
      ENDIF.

      CLEAR wa_tokens.
      READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

      IF sy-subrc = 0 AND wa_tokens-str = 'FUNCTION'.
        CLEAR wa_tokens.
        READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_2.

        IF sy-subrc = 0 AND wa_tokens-str = '''WRITE_FORM'''.
          CLEAR wa_tokens.
          l_tabix_1 = l_tabix_2 + 1.

          LOOP AT it_tokens INTO wa_tokens FROM l_tabix_1.
            IF sy-tabix > l_tabix_end OR wa_tokens-str = 'EXCEPTIONS'.
              EXIT.
            ELSEIF wa_tokens-str = 'ELEMENT'.
              l_tabix_2 = sy-tabix + 2.
              CLEAR wa_tokens.
              READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_2.

*--------------------------------------------------------------
              IF wa_tokens-str+0(1) <> ''''.
                l_var = wa_tokens-str.
                CLEAR wa_tokens.
                CLEAR l_tabix_1.
                CLEAR l_tabix_2.
                LOOP AT it_tokens INTO wa_tokens WHERE str = l_var.
                  l_row = wa_tokens-row.
                  l_tabix_1 = sy-tabix + 1.
                  l_tabix_2 = sy-tabix + 2.
                  CLEAR wa_tokens.
                  READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_1.

                  IF wa_tokens-str = '=' AND wa_tokens-row = l_row.
                    l_row = wa_tokens-row.
                    CLEAR wa_tokens.

                    READ TABLE it_tokens INTO wa_tokens INDEX l_tabix_2.

                    IF wa_tokens-str+0(1) = '''' AND wa_tokens-row =
                    l_row.
                      it_elements-elements = wa_tokens-str.
                      it_elements-program  = p_prog.
                      it_elements-line     = wa_tokens-row.
                      APPEND it_elements.
                    ENDIF.
                  ENDIF.
                ENDLOOP.
              ELSE.
*--------------------------------------------------------------
                it_elements-elements = wa_tokens-str.
                it_elements-program  = p_prog.
                it_elements-line     = wa_tokens-row.
                APPEND it_elements.
                EXIT.
              ENDIF.
            ENDIF.
          ENDLOOP.
        ENDIF.
      ENDIF.
    ENDIF.

    CLEAR wa_tokens.
*----------------------------------------------------------------------
  ENDLOOP.
************************START OF CHANGE********CHANGED BY ARINDAM
*MUKHERJEE ON 23/01/06
************Remove output specifications from structure fields
  LOOP AT it_types_fields INTO wa_types_fields.
    CLEAR: l_off,
           l_len.
    FIND '(' IN SECTION OFFSET 0 OF wa_types_fields-struct_fld
    MATCH OFFSET l_off MATCH LENGTH l_len.
    IF sy-subrc = 0.
      wa_types_fields-struct_fld = wa_types_fields-struct_fld+0(l_off).
      MODIFY it_types_fields FROM wa_types_fields INDEX sy-tabix.
    ENDIF.
  ENDLOOP.
************************END OF CHANGE***********************************

  SORT it_elements.
  DELETE ADJACENT DUPLICATES FROM it_elements.

ENDFORM.                    " get_driver_program_content

*&---------------------------------------------------------------------*
*&      Form  CTS_CHECK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM cts_check .

* GET THE PACKAGE NAME ATTACHED TO THE FORM.
  SELECT devclass
    INTO st_cts-l_pkg
    UP TO 1 ROWS
    FROM tadir
    WHERE obj_name = p_script
      AND object = 'FORM'.
  ENDSELECT.

  IF st_cts-l_pkg = '$TMP'.
    v_tran_err = 'X'.
  ELSE.

*   GET THE TASK NO. ATTACHED TO THE FORM IF THE DEV CLASS IS NOT $TMP.
    SELECT trkorr
    FROM e071
    UP TO 1 ROWS
    INTO st_cts-l_tskno
    WHERE obj_name = p_script
    AND   object = 'FORM'.
    ENDSELECT.

*   GET THE TRANSPORT REQUEST ATTACHED TO THE
*   FORM FROM THE TASK NO. IN THE PREVIOUS SELECT.
    IF sy-subrc = 0.
      SELECT SINGLE strkorr
      INTO st_cts-l_treq
      FROM e070
      WHERE trkorr = st_cts-l_tskno.

      IF sy-subrc <> 0.
        v_tran_err = 'X'.
      ENDIF.
    ENDIF.

  ENDIF.

ENDFORM.                    " CTS_CHECK

*&---------------------------------------------------------------------*
*&      Form  REDUNDANT_PARAGRAPH_FORMAT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM redundant_paragraph_format .

  DATA: it_form_line_temp   TYPE TABLE OF tline,
        it_paragraphs_temp  TYPE TABLE OF itcdp.

  it_form_line_temp[] = it_form_lines[].

  it_paragraphs_temp[] = it_paragraphs[].

* Give warning message, if the font family and size
* of the paragraph formats are left blank.
  IF font_fam = 'X'.
*PERFORM font_existance_check. ********COMMENTED BY ARINDAM MUKHERJEE ON
*11/01/06
  ENDIF.

  LOOP AT it_form_line_temp INTO wa_form_lines WHERE tdformat = '*'.
    wa_form_lines-tdformat = wa_form_header-tdfirstpar.
  ENDLOOP.

  DELETE it_form_line_temp WHERE tdformat = '=' OR
  tdformat = '(' OR tdformat = '/' OR
  tdformat = '/=' OR tdformat =  '/('
  OR tdformat = '/:' OR tdformat = '/*'
  OR tdformat = '/E'.


  SORT it_form_line_temp BY tdformat.
  DELETE ADJACENT DUPLICATES FROM it_form_line_temp.

  LOOP AT it_form_line_temp INTO wa_form_lines .
    DELETE it_paragraphs_temp WHERE tdpargraph = wa_form_lines-tdformat.
  ENDLOOP.

  IF  it_paragraphs_temp[] IS NOT INITIAL.

    LOOP AT it_paragraphs_temp INTO wa_paragraphs.

      v_redundant_para_format = v_redundant_para_format + 1.

      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_paragraphs-tdpargraph.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDPARAOB'.
      wa_dtls_error_table-error_desc  = 'Unused Paragraph Format'.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

      CLEAR wa_paragraphs.

    ENDLOOP.

    CLEAR wa_error_table.
    wa_error_table-error_index = v_err_index.
    wa_error_table-error_desc  = 'Unused Paragraph Format'.
    wa_error_table-total_error = v_redundant_para_format.
    APPEND wa_error_table TO it_error_table.

  ENDIF.

  v_err_index = v_err_index + 1.

ENDFORM.                    " REDUNDANT_PARAGRAPH_FORMAT

*&---------------------------------------------------------------------*
*&      Form  FONT_EXISTANCE_CHECK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM font_existance_check .

  LOOP AT it_paragraphs INTO wa_paragraphs.
    IF wa_paragraphs-tdfamily IS INITIAL.
      v_para_font = v_para_font + 1.

      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_paragraphs-tdpargraph.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDPARAOB'.
      wa_dtls_error_table-error_desc  =
      'Font family left blank for paragraph format'.
      wa_dtls_error_table-line_no     = ' '.
      APPEND wa_dtls_error_table TO it_dtls_error_table.
      CLEAR wa_dtls_error_table.

    ENDIF.
  ENDLOOP.

****************BEGIN OF COMMENT BY AMUKHER ON
*03/28/06*******************

*  CLEAR wa_error_table.
*  wa_error_table-error_index = v_err_index.
*wa_error_table-error_desc  = 'Font family left blank for paragraph
*format'.
*  wa_error_table-total_error = v_para_font.
*  APPEND wa_error_table TO it_wrng_table.
*  CLEAR wa_error_table.
*
*  v_err_index = v_err_index + 1.

***************END OF COMMENT*******************

  LOOP AT it_paragraphs INTO wa_paragraphs.

    IF wa_paragraphs-tdheight IS INITIAL.
      v_para_font = v_para_font + 1.

      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-chkflg = 'X'.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_paragraphs-tdpargraph.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDPARAOB'.
      wa_dtls_error_table-error_desc  =
      'Font size left blank for paragraph format'.
      wa_dtls_error_table-line_no     = ' '.
      APPEND wa_dtls_error_table TO it_dtls_error_table.
      CLEAR wa_dtls_error_table.

    ENDIF.
    CLEAR wa_paragraphs.
  ENDLOOP.


  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  =
  'Font family/size left blank for paragraph format'.
  wa_error_table-total_error = v_para_font.
  APPEND wa_error_table TO it_wrng_table.
  CLEAR wa_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " FONT_EXISTANCE_CHECK

*&---------------------------------------------------------------------*
*&      Form  REDUNDANT_CHARACTER_FORMAT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM redundant_character_format .

* Give warning message, if the font family and size
* of the character formats are left blank.
  IF font_fam ='X'.
*PERFORM char_font_existance_check **********COMMENTED BY ARINDAM
*MUKHERJEE ON 11/01/06
  ENDIF.

  DATA: wa_tab(2)  TYPE c,
        wa_tab1(2) TYPE c.

  DATA: it_form_line_temp  TYPE TABLE OF tline,
        it_strings_temp    TYPE TABLE OF itcds.

  DATA: BEGIN OF it_char_used OCCURS 0,
          l(2) TYPE c,
        END OF it_char_used.

  it_form_line_temp[] = it_form_lines.
  it_strings_temp[]   = it_strings.

  LOOP AT it_form_line_temp INTO wa_form_lines.
    SPLIT wa_form_lines-tdline AT '<' INTO wa_tab wa_tab1.
    IF wa_tab1 IS NOT INITIAL.
      TRANSLATE wa_tab1 TO UPPER CASE.
      IF wa_tab1+1(1) = '>'.
        APPEND wa_tab1(1) TO it_char_used.
      ELSE.
        APPEND wa_tab1 TO it_char_used.
      ENDIF.
    ENDIF.
  ENDLOOP.


  LOOP AT it_char_used .
    DELETE it_strings_temp WHERE tdstring = it_char_used-l.
  ENDLOOP.

  IF it_strings_temp[] IS  NOT INITIAL.

    LOOP AT it_strings_temp INTO wa_strings.
      v_redundant_char_format = v_redundant_char_format + 1.

      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_strings-tdstring.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDSTRINGOB'.
      wa_dtls_error_table-error_desc  = 'Unused character format'.
      wa_dtls_error_table-line_no     = ' '.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDLOOP.
  ENDIF.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Unused Character Format'.
  wa_error_table-total_error = v_redundant_char_format.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " REDUNDANT_CHARACTER_FORMAT
*&---------------------------------------------------------------------*
*&      Form  CHAR_FONT_EXISTANCE_CHECK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM char_font_existance_check .

  LOOP AT it_strings INTO wa_strings.
    IF wa_strings-tdfamily IS INITIAL.
      v_char_font = v_char_font + 1.

      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_strings-tdstring.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDSTRINGOB'.
      wa_dtls_error_table-error_desc  =
      'Font family left blank for character format'.
      wa_dtls_error_table-line_no     = ' '.
      APPEND wa_dtls_error_table TO it_dtls_error_table.
      CLEAR wa_dtls_error_table.
    ENDIF.

  ENDLOOP.

****************BEGIN OF COMMENT BY AMUKHER ON
*03/28/06*******************

*  CLEAR wa_error_table.
*  wa_error_table-error_index = v_err_index.
*wa_error_table-error_desc  = 'Font family left blank for character
*format'.
*  wa_error_table-total_error = v_char_font_family.
*  APPEND wa_error_table TO it_wrng_table.
*  CLEAR wa_error_table.
*
*  v_err_index = v_err_index + 1.

****************END OF COMMENT *******************

  LOOP AT it_strings INTO wa_strings.

    IF wa_strings-tdheight IS INITIAL.
      v_char_font = v_char_font + 1.

      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-chkflg = 'X'.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_strings-tdstring.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDSTRINGOB'.
      wa_dtls_error_table-error_desc  =
      'Font size left blank for character format'.
      wa_dtls_error_table-line_no     = ' '.
      APPEND wa_dtls_error_table TO it_dtls_error_table.
      CLEAR wa_dtls_error_table.

    ENDIF.

  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  =
  'Font family/size left blank for character format'.
  wa_error_table-total_error = v_char_font.
  APPEND wa_error_table TO it_wrng_table.
  CLEAR wa_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " CHAR_FONT_EXISTANCE_CHECK
*&---------------------------------------------------------------------*
*&      Form  check_driver_program
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM check_program_syntax USING p_prog TYPE sy-repid.

  SUBMIT zibm_report_codeoptimize
  WITH g_pname  = p_prog
  WITH p_status = p_status
  WITH p_glob   = p_glob
  WITH p_loc    = p_loc
  WITH p_const  = p_const
  WITH p_para   = p_para
  WITH p_chkb   = p_chkb
  WITH p_radb   = p_radb
  WITH p_opt    = p_opt
  WITH p_range  = p_range
  WITH p_tabl   = p_tabl
  WITH p_ltab   = p_tabl
  WITH p_struc  = p_struc
  WITH p_lstr   = p_struc
  WITH p_type   = p_type
  WITH p_wa     = p_wa
  WITH p_lwa    = p_wa
  WITH sy_sel   = sy_sel
  WITH sy_read  = sy_read
  WITH sort_bny = sort_bny
  WITH read_bny = read_bny
  WITH hard_wre = hard_wre
  WITH half_com = half_com
  WITH no_type  = no_type
  WITH no_len   = no_len
  WITH sel_loop = sel_loop
  WITH no_delm  = no_delm
  WITH del_ajt  = del_ajt
  WITH sel_star = sel_star
  WITH move_cor = move_cor
  WITH into_cor = into_cor
  WITH  sel_clus = sel_clus
  WITH  hard_br = hard_br
  WITH  uname_ck = uname_ck
  WITH  view_chk = view_chk
  WITH  srt_loop = srt_loop
  WITH  neg_sql = neg_sql
  WITH  on_chg  = on_chg
  WITH  tabl_cnt = tabl_cnt
  WITH  rang_chk = rang_chk
  WITH  int_ini = int_ini
  WITH  stat_lin = stat_lin
  WITH  srt_hash = srt_hash
  WITH html_dwn = html_dwn
  AND RETURN.

ENDFORM.                    " check_driver_program
*&---------------------------------------------------------------------*
*&      Form  show_list_of_errors
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM show_list_of_errors .

  FORMAT COLOR COL_HEADING.
  ULINE 1(95).
  WRITE:/1 sy-vline,
         2 'Task No',
         22 sy-vline,
         23 'Transport Request',
         44 sy-vline,
         45 'Package',
         95 sy-vline.
  ULINE /1(95).
  FORMAT COLOR OFF.
  FORMAT COLOR COL_NORMAL INTENSIFIED OFF.

  IF v_tran_err IS INITIAL.
    FORMAT COLOR COL_POSITIVE.
    WRITE:/1 sy-vline,
         2 st_cts-l_tskno,
         22 sy-vline,
         23 st_cts-l_treq,
         44 sy-vline,
         45 st_cts-l_pkg,
         95 sy-vline.
    HIDE:st_cts-l_tskno,
         st_cts-l_treq,
         st_cts-l_pkg.
  ELSE.
    FORMAT COLOR COL_NEGATIVE.
    WRITE:/1 sy-vline,
           2 'LOCAL OBJECT - NOT ATTACHED TO CTS',
          44 sy-vline,
          45 st_cts-l_pkg,
          95 sy-vline.
  ENDIF.

  NEW-LINE.
  FORMAT COLOR COL_HEADING.
  ULINE 1(95).
  WRITE:/1 sy-vline,
         2 'Item No',
         10 sy-vline,
         11 'Type of defect',
         71 sy-vline,
         72 'No of defects',
         95 sy-vline.
  ULINE /1(95).
  FORMAT COLOR OFF.
  FORMAT COLOR COL_NORMAL INTENSIFIED OFF.

* Show list of error fields in red
  LOOP AT it_error_table INTO wa_error_table.

    WRITE:/1 sy-vline,
           2 wa_error_table-error_index,
           10 sy-vline,
           11 wa_error_table-error_desc,
           71 sy-vline.
    IF wa_error_table-total_error IS INITIAL.
      FORMAT COLOR COL_POSITIVE.
      WRITE:82 wa_error_table-total_error,
            95 sy-vline.
    ELSE.
      FORMAT COLOR COL_NEGATIVE.

      WRITE:82 wa_error_table-total_error,
            95 sy-vline.
    ENDIF.

    HIDE: wa_error_table-error_index,
          wa_error_table-total_error.

    FORMAT COLOR OFF.
    FORMAT COLOR COL_NORMAL INTENSIFIED OFF.
  ENDLOOP.
  CLEAR wa_error_table.

  IF it_wrng_table[] IS NOT INITIAL.

* Show list of warning fields in yellow
    LOOP AT it_wrng_table INTO wa_error_table.

      WRITE:/1 sy-vline,
             2 wa_error_table-error_index,
             10 sy-vline,
             11 wa_error_table-error_desc,
             71 sy-vline.

      IF wa_error_table-total_error IS INITIAL.
        FORMAT COLOR COL_POSITIVE.
        WRITE:82 wa_error_table-total_error,
              95 sy-vline.
      ELSE.
        FORMAT COLOR COL_TOTAL.

        WRITE:82 wa_error_table-total_error,
              95 sy-vline.
      ENDIF.

      HIDE: wa_error_table-error_index,
            wa_error_table-total_error.

      FORMAT COLOR OFF.
      FORMAT COLOR COL_NORMAL INTENSIFIED OFF.
    ENDLOOP.
    CLEAR wa_error_table.
  ENDIF.

  ULINE /1(95).

ENDFORM.                    " show_list_of_errors
*&---------------------------------------------------------------------*
*&      Form  PRINT_REPORT_HEADER
*&---------------------------------------------------------------------*
*
*----------------------------------------------------------------------*
FORM print_report_header.

  DATA:  l_sub_name  TYPE  sy-repid  VALUE IS INITIAL.

  ULINE /1(150).
  WRITE:/45 'Offshore Delivery Center India , IBM',
        /50 'SAPSCRIPT CODE OPTIMIZER '.
  ULINE /1(150).

  WRITE:/ 'Form Name           : ',
          p_script,
        / 'Driver Program name : ',
          g_pname,
        / 'Client              : ',
          p_client,
        / 'Language            : ',
          p_lang,
        / 'Subroutine Pool Name: '.
  IF it_subroutine_pool IS INITIAL.
    WRITE:  'No subroutine pool used'.
  ELSE.
    LOOP AT it_subroutine_pool INTO wa_subroutine_pool.
      IF wa_subroutine_pool-subrt_name NE l_sub_name.
        l_sub_name = wa_subroutine_pool-subrt_name.
        WRITE: wa_subroutine_pool-subrt_name.
      ENDIF.
      CLEAR wa_subroutine_pool.
    ENDLOOP.
  ENDIF.

  NEW-LINE.

ENDFORM.                    " PRINT_REPORT_HEADER
*&---------------------------------------------------------------------*
*&      Form  SAME_WINDOWS_DESCRIPTION
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*

FORM same_windows_description .

  DATA: v_windows_desc  TYPE  i,
        it_windows_temp TYPE TABLE OF itctw,
        hold_des_new    TYPE tdtext,
        hold_des_old    TYPE tdtext,
        hold_win_new    TYPE tdwindow.

  CLEAR it_windows_temp.
  it_windows_temp[] = it_windows[].

  SORT it_windows_temp BY tdtext.

  LOOP AT it_windows_temp INTO wa_windows.
    hold_des_new = wa_windows-tdtext.
    IF hold_des_new = hold_des_old.
      v_windows_desc = v_windows_desc + 1.
      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      CONCATENATE hold_win_new wa_windows-tdwindow INTO
      wa_dtls_error_table-error_field SEPARATED BY '/'.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
      wa_dtls_error_table-error_desc  = 'Same window descriptions'.
      APPEND wa_dtls_error_table TO it_dtls_error_table.
    ENDIF.
    hold_des_old = hold_des_new.
    hold_win_new = wa_windows-tdwindow.
  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Same window descriptions'.
  wa_error_table-total_error = v_windows_desc.
  APPEND wa_error_table TO it_error_table.
  CLEAR wa_error_table.


  v_err_index = v_err_index + 1.

ENDFORM.                    " SAME_WINDOWS_DESCRIPTION

*&---------------------------------------------------------------------*
*&      Form  SAME_PARA_DESCRIPTION
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*

FORM same_para_description .

  DATA: v_para_desc        TYPE  i,
        it_paragraphs_temp TYPE TABLE OF itcdp,
        hold_des_new       TYPE tdtext,
        hold_des_old       TYPE tdtext.

  CLEAR it_paragraphs_temp.
  it_paragraphs_temp[] = it_paragraphs[].

  SORT it_paragraphs_temp BY tdtext.

  LOOP AT it_paragraphs_temp INTO wa_paragraphs.
    hold_des_new = wa_paragraphs-tdtext.

    IF hold_des_new = hold_des_old.
      v_para_desc = v_para_desc + 1.
      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_paragraphs-tdpargraph.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDPARAOB'.
      wa_dtls_error_table-error_desc  =
      'Same paragraph format descriptions'.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDIF.
    hold_des_old = hold_des_new.
  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Same paragraph format descriptions'.
  wa_error_table-total_error = v_para_desc.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " SAME_PARA_DESCRIPTION

*&---------------------------------------------------------------------*
*&      Form  SAME_CHAR_DESCRIPTION
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*

FORM same_char_description .

  DATA: v_char_desc      TYPE  i,
        it_strings_temp  TYPE TABLE OF itcds,
        hold_des_new     TYPE tdtext,
        hold_des_old     TYPE tdtext.

  CLEAR it_strings_temp.
  it_strings_temp[] = it_strings[].

  SORT it_strings_temp BY tdtext.

  LOOP AT it_strings_temp INTO wa_strings.
    hold_des_new = wa_strings-tdtext.

    IF hold_des_new = hold_des_old.
      v_char_desc = v_char_desc + 1.
      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_field = wa_strings-tdstring.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDSTRINGOB'.
      wa_dtls_error_table-error_desc  =
      'Same character format descriptions'.
      wa_dtls_error_table-line_no     = ' '.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDIF.
    hold_des_old = hold_des_new.
  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Same character format descriptions'.
  wa_error_table-total_error = v_char_desc.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " SAME_CHAR_DESCRIPTION

*&---------------------------------------------------------------------*
*&      Form  show_detail_list_error
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM show_detail_list_error .

  LOOP AT it_dtls_error_table INTO wa_dtls_error_table
  WHERE error_index = wa_error_table-error_index.

    FORMAT COLOR COL_GROUP INTENSIFIED OFF.
    WRITE:/,/ 'Error Description: ',
           20  wa_dtls_error_table-error_desc,
           68 ': ',
           70 wa_dtls_error_table-error_field.
    IF wa_dtls_error_table-line_no IS NOT INITIAL.
      WRITE: 105  'Line No: ',
             115 wa_dtls_error_table-line_no.
    ENDIF.
    IF wa_dtls_error_table-page_no IS NOT INITIAL.
      WRITE: 115 'Page No: ',
             125 wa_dtls_error_table-page_no.
    ENDIF.
    FORMAT COLOR COL_NORMAL INTENSIFIED OFF.

    HIDE: wa_dtls_error_table-chkflg,
          wa_dtls_error_table-scrn_field,
          wa_dtls_error_table-error_field,
          wa_dtls_error_table-page_no,
          wa_dtls_error_table-line_no.
  ENDLOOP.

ENDFORM.                    " show_detail_list_error

*&---------------------------------------------------------------------*
*&      Form  goto_script
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM goto_script USING p_chk      TYPE  c
                       p_fnam     TYPE  c
                       p_val1     TYPE  c
                       p_val2     TYPE  c
                       p_val3     TYPE  c
                       p_val4     TYPE  c.

  DATA: fval_script  TYPE  bdc_fval,
        p_fval       TYPE  bdc_fval,
        p_fname      TYPE  fnam_____4,
        l_subrc      TYPE  sy-subrc,
        l_off        TYPE  i.

  fval_script = p_script.
  p_fval      = p_val1.
  p_fname     = p_fnam.

  REFRESH it_bdctab.

  PERFORM populate_bdc_table
  USING:
  'SAPMSSCF' '1102' 'X' 'RSSCF-TDFORM' fval_script,
  'SAPMSSCF' '1102' ' '  p_fnam        p_val1,
  'SAPMSSCF' '1102' ' ' 'BDC_OKCODE'  '=SHOW'.

***********Start of Change-Changed by AMUKHER*******************
  CASE p_fnam.
    WHEN 'RSSCF-TDHEADEROB'.
      PERFORM populate_bdc_table
      USING 'SAPMSSCF' '1110' 'X' 'BDC_CURSOR'  'TADIR-DEVCLASS'.
    WHEN 'RSSCF-TDPARAOB'.
      CLEAR p_fval.
      p_fval = p_val2.
      IF p_chk IS INITIAL.
        PERFORM populate_bdc_table
        USING:
        'SAPMSSCF' '1120' 'X' 'BDC_CURSOR'  'ITCDP-TDPARGRAPH',
        'SAPMSSCF' '1120' ' ' 'BDC_OKCODE'   '=AFON',
        'SAPMSSCF' '1121' 'X' 'BDC_CURSOR'  'ITCDP-TDFAMILY',
        'SAPMSSCF' '1121' ' ' 'ITCDP-TDPARGRAPH' p_fval,
        'SAPMSSCF' '1121' 'X' 'BDC_CURSOR'  'ITCDP-TDFAMILY'.
      ELSE.
        PERFORM populate_bdc_table
        USING:
        'SAPMSSCF' '1120' 'X' 'BDC_CURSOR'  'ITCDP-TDPARGRAPH',
        'SAPMSSCF' '1120' ' ' 'BDC_OKCODE'   '=AFON',
        'SAPMSSCF' '1121' 'X' 'BDC_CURSOR'  'ITCDP-TDFAMILY',
        'SAPMSSCF' '1121' ' ' 'ITCDP-TDPARGRAPH' p_fval,
        'SAPMSSCF' '1121' 'X' 'BDC_CURSOR'  'RSSCF-TDFONTDEC'.
      ENDIF.

    WHEN 'RSSCF-TDSTRINGOB'.
      CLEAR p_fval.
      p_fval = p_val2.
      IF p_chk IS INITIAL.
        PERFORM populate_bdc_table
        USING:
        'SAPMSSCF' '1130' 'X' 'BDC_CURSOR'  'ITCDS-TDSTRING',
        'SAPMSSCF' '1130' ' ' 'BDC_OKCODE'  '=AFON',
        'SAPMSSCF' '1131' 'X' 'BDC_CURSOR'  'ITCDS-TDFAMILY',
        'SAPMSSCF' '1131' ' ' 'ITCDS-TDSTRING'  p_fval,
        'SAPMSSCF' '1131' 'X' 'BDC_CURSOR'  'ITCDS-TDFAMILY'.
************End of Change-Changed by AMUKHER***********************
      ELSE.
        PERFORM populate_bdc_table
        USING:
        'SAPMSSCF' '1130' 'X' 'BDC_CURSOR'  'ITCDS-TDSTRING',
        'SAPMSSCF' '1130' ' ' 'BDC_OKCODE'  '=AFON',
        'SAPMSSCF' '1131' 'X' 'BDC_CURSOR'  'ITCDS-TDFAMILY',
        'SAPMSSCF' '1131' ' ' 'ITCDS-TDSTRING'  p_fval,
        'SAPMSSCF' '1131' 'X' 'BDC_CURSOR'  'RSSCF-TDFONTDEC'.
      ENDIF.

    WHEN 'RSSCF-TDWINOB'.
      CLEAR p_fval.
      FIND '/' IN SECTION OFFSET 0 OF p_val2 MATCH OFFSET l_off.
      l_subrc = sy-subrc.
      IF l_subrc = 0.
        p_fval = p_val2+0(l_off).
      ELSE.
        p_fval = p_val2.
      ENDIF.

      PERFORM populate_bdc_table
      USING:
      'SAPMSSCF' '1140' 'X' 'BDC_CURSOR'  'ITCTW-TDWINDOW',
      'SAPMSSCF' '1140' ' ' 'ITCTW-TDWINDOW' p_fval,
      'SAPMSSCF' '1140' ' ' 'BDC_OKCODE'  '/00'.

      IF l_subrc = 0 AND p_val3 IS NOT INITIAL.
        CLEAR p_fval.
        p_fval = p_val3.
        PERFORM populate_bdc_table
        USING:
        'SAPMSSCF' '1140' 'X' 'BDC_OKCODE'  '=WIED',
*********
        'SAPLSTXX' '1100' 'X' 'BDC_CURSOR'  'RSTXT-TXLINE(02)',
        'SAPLSTXX' '1100' ' ' 'BDC_OKCODE'  '=XEIN',
        'SAPLWB_CUSTOMIZING' '0999' 'X' 'BDC_CURSOR'
        'RSEUMOD-GRA_FPAINT',
        'SAPLWB_CUSTOMIZING' '0999' ' ' 'BDC_SUBSCR'
        'SAPLWB_CUSTOMIZING                      0800TOOLAREA',
        'SAPLWB_CUSTOMIZING' '0999' ' ' 'RSEUMOD-GRA_EDITOR'  ' ',
        'SAPLWB_CUSTOMIZING' '0999' ' ' 'BDC_OKCODE'  '=CONT',
*********
        'SAPLSTXX' '1100' 'X' 'BDC_CURSOR'  'RSTXT-TXLINE(02)',
        'SAPLSTXX' '1100' ' ' 'BDC_OKCODE'  '=EDPO',
        'SAPLSTXX' '1155' 'X' 'BDC_CURSOR'  'RSTXT-TXLINENR',
        'SAPLSTXX' '1155' ' ' 'RSTXT-TXLINENR' p_fval,
        'SAPLSTXX' '1155' ' ' 'BDC_OKCODE'  '=EDWE',
        'SAPMSSCF' '1140' 'X' 'BDC_OKCODE'  '=BACK'.
      ENDIF.

    WHEN 'RSSCF-TDPAGEOB'.
      CLEAR p_fval.
      p_fval = p_val1.

      PERFORM populate_bdc_table
      USING:
      'SAPMSSCF' '1150' 'X' 'BDC_CURSOR'  'ITCTG-TDPAGE',
      'SAPMSSCF' '1150' ' ' 'ITCTW-TDWINDOW' p_fval,
      'SAPMSSCF' '1150' ' ' 'BDC_OKCODE'  '/00'.

    WHEN 'RSSCF-TDPGWINOB'.
      CLEAR p_fval.
      p_fval = p_val4.

      PERFORM populate_bdc_table
      USING:
      'SAPMSSCF' '1160' 'X' 'BDC_CURSOR'  'RSSCF-TDELINE(03)',
      'SAPMSSCF' '1160' ' ' 'RSTXD-TDPAGE' p_fval,
      'SAPMSSCF' '1160' ' ' 'BDC_OKCODE'  '=PICK'.

  ENDCASE.

  PERFORM populate_bdc_table
  USING 'SAPMSSCF' '1102' 'X' 'BDC_OKCODE'  '=BACK'.

  CALL TRANSACTION 'SE71' USING it_bdctab MODE 'E'.

ENDFORM.                    " goto_script

*&---------------------------------------------------------------------*
*&      Form  goto_transport
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM goto_transport USING p_val TYPE c.

  DATA: p_fval  TYPE  bdc_fval.

  p_fval = p_val.

  REFRESH it_bdctab.

  PERFORM populate_bdc_table
  USING:
  'RDDM0001' '0100' 'X' 'TRDYSE01CM-USERNAME' '*',
  'RDDM0001' '0100' ' ' 'TRDYSE01CM-REQ_CUST' 'X',
  'RDDM0001' '0100' ' ' 'TRDYSE01CM-REQ_WB'   'X',
  'RDDM0001' '0100' ' ' 'TRDYSE01CM-SEL_CHAN' 'X',
  'RDDM0001' '0100' ' ' 'BDC_OKCODE'          '=SNGL',

  'SAPLSTRH' '1200' 'X' 'GV_1200_TRKORR'      p_fval,
  'SAPLSTRH' '1200' ' ' 'BDC_OKCODE'          '=TAKE',
  'RDDM0001' '0100' 'X' 'BDC_OKCODE'          '/EBACK'.

  CALL TRANSACTION 'SE09' USING it_bdctab MODE 'E'.

ENDFORM.                    " goto_transport

*----------------------------------------------------------------------*
*FORM populate_bdc_table
*----------------------------------------------------------------------*
*
*----------------------------------------------------------------------*
FORM populate_bdc_table USING p_program  TYPE  bdc_prog
                              p_dynpro   TYPE  bdc_dynr
                              p_dynbegin TYPE  bdc_start
                              p_fnam     TYPE  fnam_____4
                              p_val      TYPE  bdc_fval.

  CLEAR wa_bdctab.

  wa_bdctab-program    = p_program.
  wa_bdctab-dynpro     = p_dynpro.
  wa_bdctab-dynbegin   = p_dynbegin.
  wa_bdctab-fnam       = p_fnam.
  wa_bdctab-fval       = p_val.

  APPEND wa_bdctab TO it_bdctab.

ENDFORM.                    "populate_bdc_table
*&---------------------------------------------------------------------*
*&      Form  check_text_element
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM check_text_element .

  DATA: l_elements_temp TYPE STANDARD TABLE OF ty_elements
        WITH HEADER LINE.

  DATA: l_it_elements TYPE STANDARD TABLE OF ty_elements
        WITH HEADER LINE.

  DATA: count              TYPE i,
        index1             TYPE i,
        l_length           TYPE i,
        l_form_lines_temp  TYPE STANDARD TABLE OF tline,
        wa_form_lines1     TYPE tline,
        l_form_lines_temp1 TYPE STANDARD TABLE OF tline.


  l_form_lines_temp[] = it_form_lines[].

  l_it_elements[] = it_elements[].

  REFRESH it_elements.

  LOOP AT l_it_elements.
    IF l_it_elements-elements+0(1) = ''''.
      l_length = STRLEN( l_it_elements-elements ).
      l_length = l_length - 2.
      it_elements-elements = l_it_elements-elements+1(l_length).
    ELSE.
      it_elements-elements = l_it_elements-elements.
    ENDIF.
    it_elements-program = l_it_elements-program.
    it_elements-line    = l_it_elements-line.
    APPEND it_elements.
  ENDLOOP.

  l_elements_temp[] = it_elements[].

  DELETE l_form_lines_temp WHERE tdformat <> '/E'.
  l_form_lines_temp1[] = l_form_lines_temp[].

  SORT l_form_lines_temp BY tdline.
  DELETE ADJACENT DUPLICATES FROM l_form_lines_temp COMPARING tdline.

  LOOP AT l_elements_temp.
    DELETE l_form_lines_temp1 WHERE tdline = l_elements_temp-elements.
    IF sy-subrc <> 0.
      v_redundant_form_txtele = v_redundant_form_txtele + 1.
    ENDIF.
  ENDLOOP.

*  v_redundant_form_txtele = sy-tabix - v_redundant_form_txtele.

  LOOP AT l_form_lines_temp INTO wa_form_lines.
    DELETE l_elements_temp WHERE elements = wa_form_lines-tdline.
    IF sy-subrc <> 0.
      v_redundant_prog_txtele = v_redundant_prog_txtele + 1.
    ENDIF.
  ENDLOOP.

*  v_redundant_prog_txtele = sy-tabix - v_redundant_prog_txtele.

  CLEAR wa_error_table.
  index1 = v_err_index.
  wa_error_table-error_index = v_err_index.
 wa_error_table-error_desc  = 'Text element not used in driver program'
 .
  wa_error_table-total_error = v_redundant_prog_txtele.
  APPEND wa_error_table TO it_error_table.

  LOOP AT l_form_lines_temp1 INTO wa_form_lines1.
    LOOP AT it_form_lines INTO wa_form_lines.
      IF wa_form_lines-tdformat = '/W'.
        count = 0.
        wa_dtls_error_table-error_field = wa_form_lines-tdline+0(8).
      ELSE.
        count = count + 1.
        IF wa_form_lines-tdline = wa_form_lines1-tdline.
          wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
          wa_dtls_error_table-error_desc  =
          'Text element not used in driver program'.
          wa_dtls_error_table-line_no     = count.
          wa_dtls_error_table-error_index = v_err_index.
          CONCATENATE wa_dtls_error_table-error_field
                      wa_form_lines-tdline
          INTO wa_dtls_error_table-error_field
          SEPARATED BY '/'.
          APPEND wa_dtls_error_table TO it_dtls_error_table.
          EXIT.
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDLOOP.


  v_err_index = v_err_index + 1.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Text element not defined in form'.
  wa_error_table-total_error = v_redundant_form_txtele.
  APPEND wa_error_table TO it_error_table.

  CLEAR wa_elements.
  LOOP AT l_elements_temp INTO wa_elements.
    CLEAR wa_dtls_error_table.
    wa_dtls_error_table-error_index = v_err_index.
   wa_dtls_error_table-error_desc  = 'Text element not defined in form'
   .
    wa_dtls_error_table-error_field = wa_elements-elements.
    wa_dtls_error_table-scrn_field  = wa_elements-program.
    wa_dtls_error_table-line_no     = wa_elements-line.
    APPEND wa_dtls_error_table TO it_dtls_error_table.
  ENDLOOP.

  v_err_index = v_err_index + 1.


ENDFORM.                    " check_text_element
*&---------------------------------------------------------------------*
*&      Form  goto_program
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_SCRN_FIELD  text
*      -->P_LINE_NO  text
*----------------------------------------------------------------------*
FORM goto_program  USING    p_scrn_field  TYPE c
                            p_line_no     TYPE c.

  DATA: l_program TYPE sy-repid,
        l_line    TYPE i.

  l_program = p_scrn_field.
  l_line    = p_line_no.

  CALL FUNCTION 'RS_TOOL_ACCESS'
    EXPORTING
      operation           = 'SHOW'
      object_name         = l_program
      object_type         = 'P'
      position            = l_line
      version             = g_status
      monitor_activation  = 'X'
    EXCEPTIONS
      not_executed        = 1
      invalid_object_type = 2
      OTHERS              = 3.

ENDFORM.                    " goto_program
*&---------------------------------------------------------------------*
*&      Form  REDUNDANT_WIN_CHECK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM redundant_win_check .

  DATA: it_windows_temp TYPE TABLE OF itctw.

  it_windows_temp[] = it_windows[].

  LOOP AT it_page_windows INTO wa_page_windows.
    DELETE it_windows_temp WHERE tdwindow = wa_page_windows-tdwindow .
  ENDLOOP.

  IF  it_windows_temp IS  NOT INITIAL.
    LOOP AT it_windows_temp INTO wa_windows.

      v_redundant_window = v_redundant_window + 1.
      CLEAR wa_dtls_error_table.
      wa_dtls_error_table-error_index = v_err_index.
     wa_dtls_error_table-error_desc  = 'Window not used in page window'
     .
      wa_dtls_error_table-error_field = wa_windows-tdwindow.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDLOOP.
  ENDIF.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Window not used in page window'.
  wa_error_table-total_error = v_redundant_window.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " REDUNDANT_WIN_CHECK
*&---------------------------------------------------------------------*
*&      Form  NXTPG_BLANK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM nxtpg_blank .

  LOOP AT it_pages INTO wa_pages.

    IF wa_pages-tdnextpage IS INITIAL.

      v_next_page_attr = v_next_page_attr + 1.
      CLEAR wa_dtls_error_table.

      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_desc  =
      'Next page attribute is left blank'.
      wa_dtls_error_table-error_field = wa_pages-tdpage.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDPAGEOB'.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDIF.

  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Next page attribute is left blank'.
  wa_error_table-total_error = v_next_page_attr.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " NXTPG_BLANK
*&---------------------------------------------------------------------*
*&      Form  SUBROUTINE_POOL_CHECK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM subroutine_pool_check .

  DATA: l_len        TYPE  i,
        l_off        TYPE  i,
        l_length     TYPE  i,
        l_line_count TYPE  i,
        l_window     TYPE  tdwindow,
        l_row        TYPE  i,
        l_tabix      TYPE  sy-tabix,
        l_found      TYPE  c.

  DATA: it_form_line_temp TYPE TABLE OF tline.

  DATA: it_statements  TYPE TABLE OF sstmnt,
        it_tokens      TYPE TABLE OF stoken.

  it_form_line_temp[] = it_form_lines[].

  LOOP AT it_form_line_temp INTO wa_form_lines.

    l_line_count = l_line_count + 1.

    IF wa_form_lines-tdformat = '/W'.
      CLEAR l_window.
      l_window = wa_form_lines-tdline+0(8).
      CLEAR l_line_count.
    ELSEIF wa_form_lines-tdformat = '/:'.

      FIND 'PERFORM' IN wa_form_lines-tdline.

      IF sy-subrc = 0 AND wa_form_lines-tdline NE 'ENDPERFORM'.

        FIND ' IN ' IN SECTION OFFSET 8 OF wa_form_lines-tdline
        MATCH OFFSET l_off MATCH LENGTH l_len.

        IF sy-subrc = 0.
          l_length = l_off - 8.
          wa_subroutine_pool-subrt_prog =
          wa_form_lines-tdline+8(l_length).
*          APPEND wa_subroutine_pool TO it_subroutine_pool.

          CLEAR: l_off,
                 l_len,
                 l_length.
        ENDIF.

        FIND 'PROGRAM' IN SECTION OFFSET 0 OF wa_form_lines-tdline
        MATCH OFFSET l_off MATCH LENGTH l_len.

        IF sy-subrc = 0.
          l_off = l_off + l_len + 1.
          l_length = STRLEN( wa_form_lines-tdline ) - l_off.

          wa_subroutine_pool-subrt_name =
          wa_form_lines-tdline+l_off(l_length).
*          APPEND wa_subroutine_pool TO it_subroutine_pool.
        ENDIF.

        wa_subroutine_pool-window = l_window.
        wa_subroutine_pool-line   = l_line_count.
        APPEND wa_subroutine_pool TO it_subroutine_pool.

        CLEAR wa_subroutine_pool.

      ENDIF.
    ENDIF.
  ENDLOOP.

  SORT it_subroutine_pool BY subrt_name subrt_prog.
  DELETE ADJACENT DUPLICATES FROM it_subroutine_pool COMPARING
  subrt_name subrt_prog.

  IF it_subroutine_pool IS NOT INITIAL.


    LOOP AT it_subroutine_pool INTO wa_subroutine_pool
    WHERE subrt_name IS NOT INITIAL.

      REFRESH it_source.

*   Get program content
     READ REPORT wa_subroutine_pool-subrt_name INTO it_source STATE 'A'
     .


*   Scan the abap source
      SCAN ABAP-SOURCE it_source STATEMENTS INTO it_statements
                                 TOKENS     INTO it_tokens.

      LOOP AT it_tokens INTO wa_tokens.
        IF wa_tokens-str = 'FORM'.
          l_row = wa_tokens-row.
          l_tabix = sy-tabix + 1.

          READ TABLE it_tokens INTO wa_tokens INDEX l_tabix.
          IF sy-subrc = 0 AND wa_tokens-row = l_row.
            IF wa_tokens-str = wa_subroutine_pool-subrt_prog.
              l_found = 'X'.
              EXIT.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDLOOP.

      IF l_found NE 'X'.
        v_subrt_not_def = v_subrt_not_def + 1.
        CLEAR wa_dtls_error_table.

        wa_dtls_error_table-error_index = v_err_index.
        wa_dtls_error_table-error_desc  = 'Subroutine not defined'.

        CONCATENATE wa_subroutine_pool-window
                    wa_subroutine_pool-subrt_prog
        INTO wa_dtls_error_table-error_field
        SEPARATED BY '/'.

        wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
        wa_dtls_error_table-line_no     = wa_subroutine_pool-line.
        APPEND wa_dtls_error_table TO it_dtls_error_table.
      ENDIF.

*      IF wa_subroutine_pool-subrt_name+0(1) = 'Z'.
*    PERFORM check_program_syntax USING wa_subroutine_pool-subrt_name
*        .
*      ENDIF.

    ENDLOOP.
  ENDIF.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Subroutine not defined'.
  wa_error_table-total_error = v_subrt_not_def.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " SUBROUTINE_POOL_CHECK
*&---------------------------------------------------------------------*
*&      Form  redundant_var_check
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM redundant_var_check.

  TYPES: BEGIN OF ty_error,
          error_field(10) TYPE c,
          line_no(4)      TYPE c,
          var_nam         TYPE string,
          flag            TYPE c,
         END OF ty_error.

  DATA: l_error  TYPE STANDARD TABLE OF ty_error,
        l_error1 TYPE STANDARD TABLE OF ty_error,
        wa_error TYPE ty_error,
        l_window TYPE tdwindow.

  DATA: l_form_lines_temp    TYPE TABLE OF tline.

  DATA: wa_var1 TYPE l_var_1,
        wa_var  TYPE l_var_1.

  DATA: var1     TYPE string,
        var2     TYPE string,
        var3     TYPE string,
        count    TYPE i,
        l_off    TYPE i,
        l_len    TYPE i,
        l_length TYPE i,
        l_start  TYPE i,
        l_entry  TYPE i.

  l_form_lines_temp[] = it_form_lines[].

  LOOP AT l_form_lines_temp INTO wa_form_lines.
    IF wa_form_lines-tdformat = '/W'.
      count = 0.
      l_window = wa_form_lines-tdline+0(8).
      wa_error-error_field = wa_form_lines-tdline+0(8).
    ELSEIF wa_form_lines-tdformat NE '/W'
    AND    wa_form_lines-tdformat NE '/*'.
      count = count + 1.
      FIND 'DEFINE' IN wa_form_lines-tdline.
      IF sy-subrc = 0.
        FIND '&' IN wa_form_lines-tdline.
        IF sy-subrc = 0.
          SPLIT wa_form_lines-tdline AT '&' INTO var1 wa_error-var_nam
          var3.
          wa_error-line_no = count.
          wa_error-error_field = l_window.
          APPEND wa_error TO l_error.
          CLEAR wa_error.
        ENDIF.
      ELSE.
        FIND '&' IN wa_form_lines-tdline.
        IF sy-subrc = 0.
          PERFORM identify_variables USING wa_form_lines-tdline
                                           l_window
                                           count.
        ENDIF.
      ENDIF.
    ELSE.
      count = count + 1.
    ENDIF.
  ENDLOOP.

***************START OF COMMENT******COMMENTED BY ARINDAM MUKHERJEE ON
*17/01/06

*  LOOP AT it_var1 INTO wa_var.
*    CLEAR: l_off,
*           l_len.
*    FIND '(' IN SECTION OFFSET 0 OF wa_var-var
*    MATCH OFFSET l_off MATCH LENGTH l_len.
*    IF sy-subrc = 0.
*      wa_var-var = wa_var-var+0(l_off).
*      MODIFY it_var1 FROM wa_var INDEX sy-tabix.
*    ENDIF.
*  ENDLOOP.

**************END OF
*COMMENT*********************************************

  SORT it_var1 BY var.
  DELETE ADJACENT DUPLICATES FROM it_var1 COMPARING var.

*******************START OF CHANGE*******CHANGED BY ARINDAM MUKHERJEE ON
*17/01/06***************
*******************Remove offset specifications & ABAP system variables
**********
  LOOP AT it_var1 INTO wa_var.
    l_entry = l_entry + 1.
    CLEAR: l_off,
           l_len.
    FIND '+' IN SECTION OFFSET 0 OF wa_var-var
    MATCH OFFSET l_off MATCH LENGTH l_len.
    IF sy-subrc = 0.
      wa_var-var = wa_var-var+0(l_off).
      MODIFY it_var1 FROM wa_var INDEX l_entry.
    ENDIF.
    IF wa_var-var+0(2) = 'SY'.
      wa_var-flag = 'X'.
      MODIFY it_var1 FROM wa_var.
    ENDIF.
    CLEAR wa_var-var.
  ENDLOOP.

  DELETE it_var1 WHERE flag = 'X'.
*******************END OF
*CHANGE*********************************************
  l_error1[] = l_error[].

  LOOP AT l_error INTO wa_error.
    READ TABLE it_var1 INTO wa_var1 WITH KEY var = wa_error-var_nam
    BINARY SEARCH.
    IF sy-subrc = 0.
      wa_error-flag = 'X'.
      MODIFY l_error FROM wa_error.
    ENDIF.
*    DELETE l_error WHERE var_nam = wa_var1-var.
  ENDLOOP.

  DELETE l_error WHERE flag = 'X'.

  LOOP AT l_error INTO wa_error.
    v_var_not_used = v_var_not_used + 1.

    CLEAR wa_dtls_error_table.
    wa_dtls_error_table-error_index = v_err_index.
    wa_dtls_error_table-error_desc  =
    'Variables defined in form but not used'.

    CONCATENATE wa_error-error_field
                wa_error-var_nam
    INTO wa_dtls_error_table-error_field
    SEPARATED BY '/'.

    wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
    wa_dtls_error_table-line_no     = wa_error-line_no.
    APPEND wa_dtls_error_table TO it_dtls_error_table.

  ENDLOOP.

  CLEAR wa_error.
************************START OF CHANGE********CHANGED BY ARINDAM
*MUKHERJEE ON 17/01/06
*****************Remove text symbols from it_var1*************
  SORT l_error1 BY var_nam.
  LOOP AT it_var1 INTO wa_var.
*    DELETE it_var1 WHERE var = wa_error-var_nam.
    READ TABLE l_error1 INTO wa_error WITH KEY var_nam = wa_var-var
    BINARY SEARCH.
    IF sy-subrc = 0.
      wa_var-flag = 'X'.
      MODIFY it_var1 FROM wa_var.
    ENDIF.
  ENDLOOP.
  DELETE it_var1 WHERE flag = 'X'.
**********************END OF CHANGE***************************
  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Variables defined in form but not used'.
  wa_error_table-total_error = v_var_not_used.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " redundant_var_check
*&---------------------------------------------------------------------*
*&      Form  check_variables
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM check_variables .

  TYPES: BEGIN OF ty_db_field,
           tabname   TYPE tabname,
           fieldname TYPE fieldname,
         END OF ty_db_field.

  DATA: l_db_field  TYPE STANDARD TABLE OF ty_db_field,
        l_db_field1 TYPE STANDARD TABLE OF ty_db_field,
        wa_db_field TYPE ty_db_field,
        wa_var  TYPE l_var_1,
        l_off   TYPE i,
        l_len   TYPE i,
        l_tabix TYPE sytabix,
        l_start TYPE i,
        l_length TYPE i,
        l_found  TYPE c,
        l_field  TYPE string.
************************START OF CHANGE********CHANGED BY ARINDAM
*MUKHERJEE ON 24/01/06
*******************Remove all variables other than program symbols from
*it_var1
  PERFORM form_var_edit.
************************************************************************
********
*SELECT database table/structure names & their corresponding fields into
*2 internal tables
  SELECT tabname fieldname FROM dd03l INTO TABLE l_db_field FOR ALL
  ENTRIES IN
  it_variable WHERE tabname = it_variable-type.

  SELECT tabname fieldname FROM dd03l INTO TABLE l_db_field1 FOR ALL
  ENTRIES IN
  it_tables WHERE tabname = it_tables-field.

  SORT l_db_field BY tabname.
  SORT l_db_field1 BY tabname.
***************************END OF
*CHANGE***********************************

  SORT it_variable BY var.
  DELETE ADJACENT DUPLICATES FROM it_variable COMPARING var.
****************Remove output specifications from program
*variables**********
  LOOP AT it_variable.
    CLEAR: l_off,
           l_len.
    FIND '(' IN SECTION OFFSET 0 OF it_variable-var
    MATCH OFFSET l_off MATCH LENGTH l_len.
    IF sy-subrc = 0.
      it_variable-var = it_variable-var+0(l_off).
      MODIFY it_variable INDEX sy-tabix.
    ENDIF.
  ENDLOOP.
*******Sort tables to be used for binary search************
  SORT it_tables BY field.
  SORT it_types_fields BY type.

************************START OF COMMENT********COMMENTED BY ARINDAM
*MUKHERJEE ON 17/01/06\\

*  LOOP AT it_variable WHERE flag_tab NE 'X' AND flag_wa NE 'X'.
*    DELETE it_var1 WHERE var = it_variable-var.
*  ENDLOOP.

*    FIND '-' IN SECTION OFFSET 0 OF wa_var-var
*    MATCH OFFSET l_off MATCH LENGTH l_len.

*    IF sy-subrc = 0.
*      l_tabix = sy-tabix.
*      l_start = l_off + l_len.
*      l_length = STRLEN( wa_var-var ) - l_start.
*      l_field = wa_var-var+l_start(l_length).
*
*      READ TABLE it_tables WITH KEY field = wa_var-var+0(l_off).
*      IF sy-subrc = 0.
*        DELETE it_var1 INDEX l_tabix.
*      ELSE.
*        READ TABLE it_variable WITH KEY var = wa_var-var+0(l_off).
*        IF sy-subrc = 0.
*          LOOP AT it_types WHERE type = it_variable-type.
*            IF it_types-field = l_field.
*              l_found = 'X'.
*              EXIT.
*            ENDIF.
*          ENDLOOP.
*          IF l_found IS NOT INITIAL.
*            DELETE it_var1 INDEX l_tabix.
*            CLEAR l_found.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*    ENDIF.

************************END OF COMMENT*****************************

************************START OF CHANGE********CHANGED BY ARINDAM
*MUKHERJEE ON 24/01/06
*Identify ordinary variables in forms & check for their declaration in
*driver program
  LOOP AT it_var1 INTO wa_var.
    FIND '-' IN wa_var-var.
    IF sy-subrc <> 0.
      READ TABLE it_variable WITH KEY var = wa_var-var BINARY SEARCH.
      IF sy-subrc = 0.
        wa_var-flag = 'X'.
        MODIFY it_var1 FROM wa_var INDEX sy-tabix.
      ENDIF.
    ELSE.
*Check for table fields in driver program
      SPLIT wa_var-var AT '-' INTO wa_var-var_tab wa_var-var.
      READ TABLE it_variable WITH KEY var = wa_var-var_tab.
      IF sy-subrc = 0.
*Check if table structure is defined with a types statement
        READ TABLE it_types_fields INTO wa_types_fields WITH KEY type =
        it_variable-type.
        IF sy-subrc = 0.
*Check if the field is declared in that structure
          READ TABLE it_types_fields INTO wa_types_fields WITH KEY
          struct_fld = wa_var-var type = it_variable-type.
          IF sy-subrc = 0.
            wa_var-flag = 'X'.
            MODIFY it_var1 FROM wa_var.
          ENDIF.
        ELSE.
*Check if table has a dictionary structure
          READ TABLE l_db_field INTO wa_db_field WITH KEY tabname =
          it_variable-type.
          IF sy-subrc = 0.
*Check if the field is present in that dictionary structure
            READ TABLE l_db_field INTO wa_db_field WITH KEY fieldname =
            wa_var-var tabname = it_variable-type.
            IF sy-subrc = 0.
              wa_var-flag = 'X'.
              MODIFY it_var1 FROM wa_var.
            ENDIF.
          ENDIF.
          CLEAR wa_types_fields.
          CLEAR wa_db_field.
        ENDIF.
      ELSE.
*Check if the table is declared with a tables statement
        READ TABLE it_tables WITH KEY field = wa_var-var_tab BINARY
        SEARCH.
        IF sy-subrc = 0.
*Check if the table is declared in the Data Dictionary
          READ TABLE l_db_field1 INTO wa_db_field WITH KEY tabname =
          wa_var-var_tab BINARY SEARCH.
          IF sy-subrc = 0.
*Check if the field is present in that dictionary table
           READ TABLE l_db_field1 INTO wa_db_field WITH KEY fieldname =
           wa_var-var tabname = wa_var-var_tab.
            IF sy-subrc = 0.
              wa_var-flag = 'X'.
              MODIFY it_var1 FROM wa_var.
            ENDIF.
          ENDIF.
          CLEAR wa_db_field.
        ENDIF.
        CLEAR it_variable.
        CLEAR it_tables.
      ENDIF.
     CONCATENATE wa_var-var_tab wa_var-var INTO wa_var-var SEPARATED BY
     '-'.
      MODIFY it_var1 FROM wa_var.
      CLEAR wa_var.
    ENDIF.
  ENDLOOP.

  DELETE it_var1 WHERE flag = 'X'.
************************END OF
*CHANGE***************************************
  CLEAR v_var_not_used.
  LOOP AT it_var1 INTO wa_var.
    v_var_not_used = v_var_not_used + 1.

    CLEAR wa_dtls_error_table.
    wa_dtls_error_table-error_index = v_err_index.
    wa_dtls_error_table-error_desc  =
    'Redundant var in form-not declared in driver'.

    CONCATENATE wa_var-window
                wa_var-var
    INTO wa_dtls_error_table-error_field
    SEPARATED BY '/'.

    wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
    wa_dtls_error_table-line_no     = wa_var-line.
    APPEND wa_dtls_error_table TO it_dtls_error_table.
  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  =
  'Redundant var in form-not declared in driver'.
  wa_error_table-total_error = v_var_not_used.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " check_variables
*&---------------------------------------------------------------------*
*&      Form  identify_variables
*&---------------------------------------------------------------------*
*       --->p_tdline
*       --->p_window
*       --->p_line
*----------------------------------------------------------------------*
******************START OF CHANGE***********CHANGED BY ARINDAM MUKHERJEE
*ON 17/01/06

FORM identify_variables  USING    p_tdline   TYPE  tdline
                                  p_window   TYPE  tdwindow
                                  p_line     TYPE  i.
  TYPES: BEGIN OF ty_tdline,
            char(1)  TYPE  c,
         END OF ty_tdline.

  TYPES: BEGIN OF ty_var,
            flag(1) TYPE c,
         END OF ty_var.


  DATA: it_tdline  TYPE TABLE OF ty_tdline,
        wa_tdline  TYPE  ty_tdline,
        itab TYPE TABLE OF ty_var,
        wa_tab TYPE ty_var.


  DATA : flag_var,
         entry TYPE i VALUE 0,
         len_str TYPE i,
         wa_var    TYPE  l_var_1,
         l_window TYPE tdwindow,
         l_count  TYPE i.


  len_str = STRLEN( p_tdline ).

*Split form lines into single characters
  DO len_str TIMES.
    wa_tdline-char = p_tdline+l_count(1).
    APPEND wa_tdline TO it_tdline.
    l_count = l_count + 1.
    CLEAR wa_tdline.
  ENDDO.


  LOOP AT it_tdline INTO wa_tdline.

    CASE wa_tdline-char.

      WHEN '&'.


        IF itab IS INITIAL.
          wa_tab-flag = '&'.
          APPEND wa_tab TO itab.
          entry = entry + 1.
        ELSE.
          IF wa_var-var IS NOT INITIAL.
            wa_var-window = p_window.
            wa_var-line = p_line.
            APPEND wa_var TO it_var1.
            CLEAR wa_var.

            READ TABLE itab INTO wa_tab INDEX entry.
            IF sy-subrc = 0.
              IF wa_tab-flag = '&'.
                DELETE itab INDEX entry.
                entry = entry - 1.
              ELSE.
                wa_tab-flag = '&'.
                APPEND wa_tab TO itab.
                entry = entry + 1.
              ENDIF.
            ENDIF.
          ELSE.
            READ TABLE itab INTO wa_tab INDEX entry.
            IF sy-subrc = 0.
              IF wa_tab-flag = '&'.
                DELETE itab INDEX entry.
                entry = entry - 1.
              ELSE.
                wa_tab-flag = '&'.
                APPEND wa_tab TO itab.
                entry = entry + 1.
              ENDIF.
            ENDIF.

          ENDIF.


        ENDIF.

      WHEN ''''.


        IF itab IS INITIAL.
          wa_tab-flag = ''''.
          APPEND wa_tab TO itab.
          entry = entry + 1.
        ELSE.
          IF wa_var-var IS NOT INITIAL.
            wa_var-window = p_window.
            wa_var-line = p_line.
            APPEND wa_var TO it_var1.
            CLEAR wa_var.
            READ TABLE itab INTO wa_tab INDEX entry.
            IF sy-subrc = 0.
              IF wa_tab-flag = ''''.
                DELETE itab INDEX entry.
                entry = entry - 1.
              ELSE.
                wa_tab-flag = ''''.
                APPEND wa_tab TO itab.
                entry = entry + 1.
              ENDIF.
            ENDIF.
          ELSE.
            READ TABLE itab INTO wa_tab INDEX entry.
            IF sy-subrc = 0.
              IF wa_tab-flag = ''''.
                DELETE itab INDEX entry.
                entry = entry - 1.
              ELSE.
                wa_tab-flag = ''''.
                APPEND wa_tab TO itab.
                entry = entry + 1.
              ENDIF.
            ENDIF.

          ENDIF.
        ENDIF.

      WHEN OTHERS.

        IF wa_tdline-char = '('.
          flag_var    = 'X'.
        ELSEIF wa_tdline-char = ')'.
          CLEAR flag_var.
        ELSE.

          IF wa_tdline-char NE '/' AND wa_tdline-char NE ',' AND
          flag_var IS INITIAL.
            READ TABLE itab INTO wa_tab INDEX entry.
            IF sy-subrc = 0.
              IF wa_tab-flag = '&'.
                CONCATENATE wa_var-var wa_tdline-char INTO wa_var-var.
              ENDIF.
            ENDIF.
          ENDIF.
        ENDIF.

    ENDCASE.
  ENDLOOP.

ENDFORM.                    " identify_variables

*******************END OF CHANGE***************************************

******************START OF COMMENT***********COMMENTED BY ARINDAM
*MUKHERJEE ON 17/01/06
*FORM identify_variables  USING    p_tdline   TYPE  tdline
*                                  p_window   TYPE  tdwindow
*                                  p_line     TYPE  i.
*
*  TYPES: BEGIN OF ty_tdline,
*          char(1)  TYPE  c,
*         END OF ty_tdline.
*
*  DATA: l_length     TYPE  i,
*        count        TYPE  i,
*        start_amp    TYPE  i,
*        end_amp      TYPE  i,
*        start_quote  TYPE  i,
*        end_quote    TYPE  i,
*        in_amp       TYPE  c,
*        in_quote     TYPE  c,
*        wa_var       TYPE  l_var_1.
*
*  DATA: it_tdline  TYPE TABLE OF ty_tdline WITH HEADER LINE.
*
*  l_length = STRLEN( p_tdline ).
*
*  DO l_length TIMES.
*    it_tdline-char = p_tdline+count(1).
*    APPEND it_tdline.
*    CLEAR it_tdline.
*    count = count + 1.
*  ENDDO.
*
*  count = 1.
*
*  LOOP AT it_tdline.
*
*    IF it_tdline-char = '&'.
*      IF in_amp IS INITIAL.
*        in_amp = 'X'.
*        start_amp = count.
*      ELSEIF in_amp IS NOT INITIAL
*      AND in_quote IS INITIAL.
*        CLEAR in_amp.
*        end_amp = count.
*      ENDIF.
*
*      IF in_amp IS NOT INITIAL
*      AND in_quote  IS NOT INITIAL.
*        start_amp = count.
*      ENDIF.
*
*    ENDIF.
*
*    IF it_tdline-char = ''''.
*      IF in_quote IS INITIAL.
*        in_quote = 'X'.
*        start_quote = count.
*      ELSE.
*        CLEAR in_quote.
*        end_quote = count.
*      ENDIF.
*    ENDIF.

*    IF in_amp IS NOT INITIAL AND in_quote IS INITIAL
*    AND it_tdline-char NE '&' AND it_tdline-char NE ''''.
*      CONCATENATE wa_var-var
*                  it_tdline-char
*      INTO wa_var-var.
*    ELSEIF in_amp IS INITIAL AND wa_var-var IS NOT INITIAL.
*      wa_var-window = p_window.
*      wa_var-line = p_line.
*      APPEND wa_var TO it_var1.
*      CLEAR wa_var.
*      IF in_quote IS NOT INITIAL AND start_quote < end_amp.
*        in_amp = 'X'.
*        CLEAR in_quote.
*      ENDIF.
*    ENDIF.

*    IF ( ( in_amp IS NOT INITIAL AND in_quote IS INITIAL )
*          OR ( in_amp IS NOT INITIAL AND in_quote IS NOT INITIAL
*               AND start_amp > start_quote ) )
*    AND ( it_tdline-char NE '&' AND it_tdline-char NE '''' ).
*      CONCATENATE wa_var-var
*                  it_tdline-char
*      INTO wa_var-var.
*    ENDIF.
*    IF in_amp IS INITIAL AND wa_var-var IS NOT INITIAL.
*      wa_var-window = p_window.
*      wa_var-line = p_line.
*      APPEND wa_var TO it_var1.
*      CLEAR wa_var.
*    ENDIF.
*
*    count = count + 1.
*
*  ENDLOOP.
******************END OF COMMENT****************************************

*&---------------------------------------------------------------------*
*&      Form  window_overlap_check
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM window_overlap_check .


  DATA: v_win_ovlap            TYPE i,
        l_window_ovlap         TYPE string.

  DATA: a0(4)               TYPE p  DECIMALS 2,
        a1(4)               TYPE p  DECIMALS 2,
        a2(4)               TYPE p  DECIMALS 2,
        per_ovlap1(2)       TYPE p,
        per_ovlap2(2)       TYPE p.

  DATA: w1x1(4)     TYPE p  DECIMALS 2,
        w1x2(4)     TYPE p  DECIMALS 2,
        w1y1(4)     TYPE p  DECIMALS 2,
        w1y2(4)     TYPE p  DECIMALS 2,
        w2x1(4)     TYPE p  DECIMALS 2,
        w2x2(4)     TYPE p  DECIMALS 2,
        w2y1(4)     TYPE p  DECIMALS 2,
        w2y2(4)     TYPE p  DECIMALS 2.

  TYPES: BEGIN OF ty_ovlap,
           win        TYPE string,
           page       TYPE string,
         END OF ty_ovlap.

  DATA: it_page_windows_temp  TYPE TABLE OF itcth.
  DATA: it_window_ovlap          TYPE TABLE OF ty_ovlap,
        wa_window_ovlap          TYPE ty_ovlap.

  LOOP AT it_page_windows INTO wa_page_windows.
    PERFORM unit_conv.
    " Unit conversion of all window dimensions to CM
    APPEND wa_page_windows TO it_page_windows_temp.
  ENDLOOP.

  LOOP AT it_page_windows_temp INTO wa_page_windows.

    wa_win_ovlap1-window = wa_page_windows-tdwindow.
    wa_win_ovlap1-page   = wa_page_windows-tdpage.
    wa_win_ovlap1-x1     = wa_page_windows-tdwleft.
    wa_win_ovlap1-x2     = ( wa_page_windows-tdwleft +
    wa_page_windows-tdwwidth ).
    wa_win_ovlap1-y1     = ( wa_page_windows-tdwtop  +
    wa_page_windows-tdwheight ).
    wa_win_ovlap1-y2     = wa_page_windows-tdwtop.

    APPEND wa_win_ovlap1 TO it_win_ovlap1.

  ENDLOOP.

  SORT it_win_ovlap1 BY window.
*  DELETE ADJACENT DUPLICATES FROM it_win_ovlap1 COMPARING window.
  it_win_ovlap2[] = it_win_ovlap1[].
  LOOP AT it_win_ovlap1 INTO wa_win_ovlap1.

    w2x1 = wa_win_ovlap1-x1.
    w2x2 = wa_win_ovlap1-x2.
    w2y1 = wa_win_ovlap1-y1.
    w2y2 = wa_win_ovlap1-y2.
    IF it_win_ovlap2 IS NOT INITIAL.
      DELETE it_win_ovlap2 WHERE window = wa_win_ovlap1-window AND page
      = wa_win_ovlap1-page .
      LOOP AT it_win_ovlap2 INTO wa_win_ovlap2 WHERE page =
      wa_win_ovlap1-page.
        w1x1 = wa_win_ovlap2-x1.
        w1x2 = wa_win_ovlap2-x2.
        w1y1 = wa_win_ovlap2-y1.
        w1y2 = wa_win_ovlap2-y2.

       IF w2y1 BETWEEN w1y2 AND w1y1 AND w2y2 BETWEEN w1y2 AND w1y1 AND
       w2x1 BETWEEN w1x1 AND w1x2
       AND w2x2 BETWEEN w1x1 AND w1x2.
*WRITE: / 'No Error of window overlapping'.  " One window is completely
*inside another

**********1st SET of conditions***************
       ELSEIF w2y1 BETWEEN w1y2 AND w1y1 AND w2y2 BETWEEN w1y2 AND w1y1
       AND w2x1 LE w1x1 AND
       w2x2 BETWEEN w1x1 AND w1x2.
          a0 = ( w2x2 - w1x1 ) * ( w2y1 - w2y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********2nd SET of conditions***************
       ELSEIF w2y1 BETWEEN w1y2 AND w1y1 AND w2y2 BETWEEN w1y2 AND w1y1
       AND w2x1 BETWEEN w1x1 AND
       w1x2 AND w2x2 GE w1x2.
          a0 = ( w1x2 - w2x1 ) * ( w2y1 - w2y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********3rd SET of conditions***************
       ELSEIF w2x1 BETWEEN w1x1 AND w1x2 AND w2x2 BETWEEN w1x1 AND w1x2
       AND w2y1 GE w1y1 AND
       w2y2 BETWEEN w1y2 AND w1y1.
          a0 = ( w2x2 - w2x1 ) * ( w1y1 - w2y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********4th SET of conditions***************
       ELSEIF w2x1 BETWEEN w1x1 AND w1x2 AND w2x2 BETWEEN w1x1 AND w1x2
       AND w2y1 BETWEEN w1y2 AND
       w1y1 AND w2y2 LE w1y2.
          a0 = ( w2x2 - w2x1 ) * ( w2y1 - w1y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********5th SET of conditions***************
        ELSEIF w2x1 LE w1x1 AND w2x2 BETWEEN w1x1 AND w1x2 AND w2y1 GE
        w1y1 AND w2y2 BETWEEN w1y2
        AND w1y1.
          a0 = ( w2x2 - w1x1 ) * ( w1y1 - w2y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********6th SET of conditions***************
        ELSEIF w2x1 BETWEEN w1x1 AND w1x2 AND w2x2 GE w1x2 AND w2y1 GE
        w1y1 AND w2y2 BETWEEN w1y2
        AND w1y1.
          a0 = ( w1x2 - w2x1 ) * ( w1y1 - w2y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********7th SET of conditions***************
        ELSEIF w2x1 LE w1x1 AND w2x2 BETWEEN w1x1 AND w1x2 AND w2y1
        BETWEEN w1y2 AND w1y1
        AND w2y2 LE w1y2.
          a0 = ( w2x2 - w1x1 ) * ( w2y1 - w1y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********8th SET of conditions***************
        ELSEIF w2x1 BETWEEN w1x1 AND w1x2 AND w2x2 GE w1x2 AND w2y1
        BETWEEN w1y2 AND w1y1
        AND w2y2 LE w1y2.
          a0 = ( w1x2 - w2x1 ) * ( w2y1 - w1y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********9th SET of conditions***************
        ELSEIF w2x1 LE w1x1 AND w2x2 GE w1x2 AND w2y1 BETWEEN w1y2 AND
        w1y1 AND w2y2
        LE w1y2.
          a0 = ( w1x2 - w1x1 ) * ( w2y1 - w1y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********10th SET of conditions***************
        ELSEIF w2x1 BETWEEN w1x1 AND w1x2 AND w2x2 GE w1x2 AND w2y1 GE
        w1y1 AND w2y2
        LE w1y2.
          a0 = ( w1x2 - w2x1 ) * ( w1y1 - w1y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********11th SET of conditions***************
        ELSEIF w2x1 LE w1x1 AND w2x2 BETWEEN w1x1 AND w1x2 AND w2y1 GE
        w1y1 AND w2y2
        LE w1y2.
          a0 = ( w2x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
**********12th SET of conditions***************
        ELSEIF w2x1 LE w1x1 AND w2x2 GE w1x2 AND w2y1 GE w1y1 AND w2y2
        BETWEEN w1y2
        AND w1y1.
          a0 = ( w2x2 - w1x1 ) * ( w1y1 - w2y2 ).
          a1 = ( w1x2 - w1x1 ) * ( w1y1 - w1y2 ).
          a2 = ( w2x2 - w2x1 ) * ( w2y1 - w2y2 ).
**********************************************
*       ELSE.
*WRITE: /  wa_win_ovlap2-window,'is not overlapping with',
*wa_win_ovlap1-window.
        ENDIF.
        IF a1 <> 0 AND a2 <> 0 AND a0 <> 0.
          per_ovlap1 = ( a0 / a1 ) * 100.
          per_ovlap2 = ( a0 / a2 ) * 100.
*         WRITE: / per_ovlap1, per_ovlap2.
          IF per_ovlap1 > percntg AND per_ovlap2 < percntg.
            l_window_ovlap = wa_win_ovlap2-window.
          ELSEIF per_ovlap2 > percntg AND per_ovlap1 < percntg.
            l_window_ovlap = wa_win_ovlap1-window.
          ELSEIF per_ovlap1 > percntg AND per_ovlap2 > percntg.
            CONCATENATE wa_win_ovlap2-window wa_win_ovlap1-window INTO
            l_window_ovlap
            SEPARATED BY '/'.
          ENDIF.

          IF l_window_ovlap IS NOT INITIAL.

            CLEAR wa_window_ovlap.
            wa_window_ovlap-win         = l_window_ovlap.
            wa_window_ovlap-page        = wa_win_ovlap2-page.
            APPEND wa_window_ovlap TO it_window_ovlap.

          ENDIF.

        ENDIF.
        CLEAR: l_window_ovlap,
               a0,
               a1,
               a2,
               per_ovlap1,
               per_ovlap2.
        CLEAR wa_win_ovlap2.
      ENDLOOP.
    ENDIF.

    CLEAR wa_win_ovlap1.
*    DELETE it_win_ovlap2 WHERE window = wa_win_ovlap1-window.
  ENDLOOP.
  DELETE it_win_ovlap1 WHERE window = wa_win_ovlap1-window AND page =
  wa_win_ovlap1-page.


  LOOP AT it_window_ovlap INTO wa_window_ovlap.
    CLEAR wa_dtls_error_table.
    v_win_ovlap = v_win_ovlap + 1.
    wa_dtls_error_table-error_index =  v_err_index.
    wa_dtls_error_table-error_desc  = 'Windows are overlapping'.
    wa_dtls_error_table-error_field =  wa_window_ovlap-win.
    wa_dtls_error_table-scrn_field  = 'RSSCF-TDPGWINOB'.
    wa_dtls_error_table-page_no     =  wa_window_ovlap-page.

    APPEND wa_dtls_error_table TO it_dtls_error_table.
  ENDLOOP.

  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Windows are overlapping'.
  wa_error_table-total_error = v_win_ovlap.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.

ENDFORM.                    " window_overlap_check
*&---------------------------------------------------------------------*
*&      Form  unit_conv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM unit_conv .

*****for left margin************
  IF wa_page_windows-tdwleftu = 'CH'.
    wa_page_windows-tdwleft = ( wa_page_windows-tdwleft /
    wa_form_header-tdcpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwleftu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwleftu = 'LN'.
    wa_page_windows-tdwleft = ( wa_page_windows-tdwleft /
    wa_form_header-tdlpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwleftu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwleftu = 'IN'.
    wa_page_windows-tdwleft = wa_page_windows-tdwleft  * ( 254 / 100 ) .
    wa_page_windows-tdwleftu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwleftu = 'MM'.
    wa_page_windows-tdwleft = wa_page_windows-tdwleft / 10 .
    wa_page_windows-tdwleftu = 'CM'.
  ENDIF.
********************************

**********for upper margin******
  IF wa_page_windows-tdwtopu = 'CH'.
    wa_page_windows-tdwtop = ( wa_page_windows-tdwtop /
    wa_form_header-tdcpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwtopu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwtopu = 'LN'.
    wa_page_windows-tdwtop = ( wa_page_windows-tdwtop /
    wa_form_header-tdlpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwtopu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwtopu = 'IN'.
    wa_page_windows-tdwtop = wa_page_windows-tdwtop  * ( 254 / 100 ) .
    wa_page_windows-tdwtopu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwtopu = 'MM'.
    wa_page_windows-tdwtop = wa_page_windows-tdwtop / 10 .
    wa_page_windows-tdwtopu = 'CM'.
  ENDIF.

********************************

**********for width*************
  IF wa_page_windows-tdwwidthu = 'CH'.
    wa_page_windows-tdwwidth = ( wa_page_windows-tdwwidth /
    wa_form_header-tdcpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwwidthu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwwidthu = 'LN'.
    wa_page_windows-tdwwidth = ( wa_page_windows-tdwwidth /
    wa_form_header-tdlpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwwidthu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwwidthu = 'IN'.
   wa_page_windows-tdwwidth = wa_page_windows-tdwwidth  * ( 254 / 100 )
   .
    wa_page_windows-tdwwidthu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwwidthu = 'MM'.
    wa_page_windows-tdwwidth = wa_page_windows-tdwwidth / 10 .
    wa_page_windows-tdwwidthu = 'CM'.
  ENDIF.

********************************

**********for height*************
  IF wa_page_windows-tdwheightu = 'CH'.
    wa_page_windows-tdwheight = ( wa_page_windows-tdwheight /
    wa_form_header-tdcpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwheightu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwheightu = 'LN'.
    wa_page_windows-tdwheight = ( wa_page_windows-tdwheight /
    wa_form_header-tdlpi ) * ( 254 / 100 ) .
    wa_page_windows-tdwheightu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwheightu = 'IN'.
   wa_page_windows-tdwheight = wa_page_windows-tdwheight  * ( 254 / 100
   ) .
    wa_page_windows-tdwheightu = 'CM'.
  ENDIF.

  IF wa_page_windows-tdwheightu = 'MM'.
    wa_page_windows-tdwheight = wa_page_windows-tdwheight / 10 .
    wa_page_windows-tdwheightu = 'CM'.
  ENDIF.

********************************

ENDFORM.                    " unit_conv
*&---------------------------------------------------------------------*
*&      Form  logo_std_txt_check
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM logo_std_txt_check .

  DATA:   l_len        TYPE  i,
          l_off        TYPE  i,
          l_length     TYPE  i,
          l_length1    TYPE  i,
          l_char       TYPE  c,
          l_line_count TYPE  i,
          count        TYPE  i,
          l_window     TYPE  tdwindow,
          var1         TYPE  string,
          var2         TYPE  string,
          var3         TYPE string.

  DATA: it_form_line_temp TYPE TABLE OF tline,
        it_std_txt     TYPE TABLE OF ty_logo_std_txt,
        it_std_logo     TYPE TABLE OF ty_logo_std.

  it_form_line_temp[] = it_form_lines[].

  LOOP AT it_form_line_temp INTO wa_form_lines.

    IF wa_form_lines-tdformat = '/W'.

      l_window  = wa_form_lines-tdline+0(8).
      count = 0.

    ELSE.

      count = count + 1.

      IF wa_form_lines-tdformat = '/:'.


        FIND 'INCLUDE' IN SECTION OFFSET 0 OF wa_form_lines-tdline
        MATCH OFFSET l_off MATCH LENGTH l_len.

        IF sy-subrc = 0.

          l_off = l_off + l_len + 1.
          l_length = STRLEN( wa_form_lines-tdline ) - l_off.
          wa_logo_std_txt-include_var =
          wa_form_lines-tdline+l_off(l_length).
          l_char = wa_logo_std_txt-include_var+0(1).

          IF l_char = ''''.
            SPLIT wa_logo_std_txt-include_var AT '''' INTO  var3 var1
            var2.
            CLEAR wa_logo_std_txt-include_var.
            wa_logo_std_txt-include_var = var1.


            CLEAR: l_off,
                   l_len,
                   l_length,
                   var1,
                   var2,
                   var3.

            FIND 'OBJECT' IN SECTION OFFSET 0 OF wa_form_lines-tdline
            MATCH OFFSET l_off MATCH LENGTH l_len.

            IF sy-subrc = 0.
              l_off = l_off + l_len + 1.
              l_length = STRLEN( wa_form_lines-tdline ) - l_off.
              wa_logo_std_txt-std_txt_obj =
              wa_form_lines-tdline+l_off(l_length).
              SPLIT wa_logo_std_txt-std_txt_obj AT space INTO var1 var2.
              wa_logo_std_txt-std_txt_obj = var1.


              CLEAR: l_off,
                     l_len,
                     l_length,
                     var1,
                     var2.
            ENDIF.


            FIND 'ID' IN SECTION OFFSET 0 OF wa_form_lines-tdline
            MATCH OFFSET l_off MATCH LENGTH l_len.

            IF sy-subrc = 0.
              l_off = l_off + l_len + 1.
              l_length = STRLEN( wa_form_lines-tdline ) - l_off.
              wa_logo_std_txt-std_txt_id =
              wa_form_lines-tdline+l_off(l_length).
              SPLIT wa_logo_std_txt-std_txt_id AT space INTO var1 var2.
              wa_logo_std_txt-std_txt_id = var1.


              CLEAR: l_off,
                     l_len,
                     l_length,
                     var1,
                     var2.

            ENDIF.

            FIND 'LANGUAGE' IN SECTION OFFSET 0 OF wa_form_lines-tdline
            MATCH OFFSET l_off MATCH LENGTH l_len.

            IF sy-subrc = 0.
              l_off = l_off + l_len + 1.
              l_length = STRLEN( wa_form_lines-tdline ) - l_off.
              wa_logo_std_txt-lang =
              wa_form_lines-tdline+l_off(l_length).
              SPLIT wa_logo_std_txt-lang AT space INTO var1 var2.
              wa_logo_std_txt-lang = var1.


              CLEAR: l_off,
                     l_len,
                     l_length,
                     var1,
                     var2.

            ENDIF.

            wa_logo_std_txt-line = count.
            wa_logo_std_txt-window = l_window .

            APPEND wa_logo_std_txt TO it_logo_std_txt.
            CLEAR wa_logo_std_txt.

          ENDIF.
        ENDIF.

        FIND 'BITMAP' IN SECTION OFFSET 0 OF wa_form_lines-tdline
        MATCH OFFSET l_off MATCH LENGTH l_len.

        IF sy-subrc = 0.

          l_off = l_off + l_len + 1.
          l_length = STRLEN( wa_form_lines-tdline ) - l_off.
         wa_logo_std-include_var = wa_form_lines-tdline+l_off(l_length)
         .
          l_char = wa_logo_std-include_var+0(1).

          IF l_char = ''''.
            SPLIT wa_logo_std-include_var AT '''' INTO  var3 var1 var2.
            CLEAR wa_logo_std-include_var.
            wa_logo_std-include_var = var1.
          ENDIF.

          CLEAR: l_off,
                     l_len,
                     l_length,
                     var1,
                     var2,
                     var3.

          FIND 'OBJECT' IN SECTION OFFSET 0 OF wa_form_lines-tdline
          MATCH OFFSET l_off MATCH LENGTH l_len.

          IF sy-subrc = 0.
            l_off = l_off + l_len + 1.
            l_length = STRLEN( wa_form_lines-tdline ) - l_off.
            wa_logo_std-std_logo_obj =
            wa_form_lines-tdline+l_off(l_length).
            SPLIT wa_logo_std-std_logo_obj AT space INTO var1 var2.
            wa_logo_std-std_logo_obj = var1.


            CLEAR: l_off,
                   l_len,
                   l_length,
                   var1,
                   var2.
          ENDIF.

          wa_logo_std-line = count.
          wa_logo_std-window = l_window .
          APPEND wa_logo_std TO it_logo_std.

        ENDIF.
      ENDIF.
    ENDIF.
  ENDLOOP.


  SELECT * FROM stxh INTO TABLE it_stxh.

  LOOP AT it_logo_std_txt INTO wa_logo_std_txt.
    DELETE it_stxh WHERE tdid = wa_logo_std_txt-std_txt_id
                    AND tdobject = wa_logo_std_txt-std_txt_obj
                    AND tdname = wa_logo_std_txt-include_var.
    IF sy-subrc <> 0.
      APPEND wa_logo_std_txt TO it_std_txt.
      v_std_txt = v_std_txt + 1.

      CLEAR wa_dtls_error_table.

      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_desc  = 'Standard text not defined'.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
      CONCATENATE wa_logo_std_txt-window
                  wa_logo_std_txt-include_var
      INTO wa_dtls_error_table-error_field
      SEPARATED BY '/'.
      wa_dtls_error_table-line_no     = wa_logo_std_txt-line.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDIF.
  ENDLOOP.

  SELECT * FROM stxbitmaps INTO TABLE it_stxbitmaps.

  LOOP AT it_logo_std INTO wa_logo_std.
    DELETE it_stxbitmaps WHERE tdobject = wa_logo_std-std_logo_obj
                    AND tdname = wa_logo_std-include_var.
    IF sy-subrc <> 0.
      APPEND wa_logo_std TO it_std_logo.
      v_std_logo = v_std_logo + 1.

      CLEAR wa_dtls_error_table.

      wa_dtls_error_table-error_index = v_err_index.
      wa_dtls_error_table-error_desc  = 'Logo not defined'.
      wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
      CONCATENATE wa_logo_std-window
                  wa_logo_std-include_var
      INTO wa_dtls_error_table-error_field
      SEPARATED BY '/'.
      wa_dtls_error_table-line_no     = wa_logo_std-line.
      APPEND wa_dtls_error_table TO it_dtls_error_table.

    ENDIF.
  ENDLOOP.


  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Standard text not defined'.
  wa_error_table-total_error = v_std_txt.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.


  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Logo not defined'.
  wa_error_table-total_error = v_std_logo.
  APPEND wa_error_table TO it_error_table.

  v_err_index = v_err_index + 1.


ENDFORM.                    " logo_std_txt_check
*&---------------------------------------------------------------------*
*&      Form  form_var_edit
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*----------------------------------------------------------------------*
******************START OF CHANGE********CODE ADDED BY ARINDAM MUKHERJEE
*ON 19/01/06.
FORM form_var_edit .


  DATA: wa_var   TYPE l_var_1,
        var1(12) TYPE c,
        it_var_chk1 TYPE TABLE OF ty_var_chk INITIAL SIZE 0,
        it_var_chk2 TYPE TABLE OF ty_var_chk INITIAL SIZE 0,
        it_field_chk TYPE TABLE OF ty_field_chk INITIAL SIZE 0,
        wa_var_chk TYPE ty_var_chk,
        wa_field_chk TYPE ty_field_chk.

***************Flag standard symbols in it_var1**********
*Standard symbol table ttdtg
  SELECT varname FROM ttdtg INTO TABLE it_var_chk1
  FOR ALL ENTRIES IN it_var1 WHERE varname = it_var1-var.

***************Flag sapscript system symbols in it_var1************
*System symbols in table ttxsy
  SELECT varname FROM ttxsy INTO TABLE it_var_chk2
  FOR ALL ENTRIES IN it_var1 WHERE varname = it_var1-var.

***************Flag sapscript system symbols in it_var1************
*System symbols in structure sapscript
  SELECT tabname fieldname FROM dd03l INTO TABLE it_field_chk
   WHERE tabname = 'SAPSCRIPT'.

  SORT it_var_chk1 BY field.
  SORT it_var_chk2 BY field.
  SORT it_field_chk BY fieldname.

  LOOP AT it_var1 INTO wa_var.
    FIND '-' IN wa_var-var.
    IF sy-subrc = 0.
      SPLIT wa_var-var AT '-' INTO var1 wa_var-var.
    ENDIF.
    READ TABLE it_var_chk1 INTO wa_var_chk WITH KEY field = wa_var-var
    BINARY SEARCH.
    IF sy-subrc = 0.
      wa_var-flag = 'X'.
      MODIFY it_var1 FROM wa_var.
    ENDIF.
    CLEAR wa_var_chk.
    READ TABLE it_var_chk2 INTO wa_var_chk WITH KEY field = wa_var-var
    BINARY SEARCH.
    IF sy-subrc = 0.
      wa_var-flag = 'X'.
      MODIFY it_var1 FROM wa_var.
    ENDIF.
    CLEAR wa_var_chk.
    READ TABLE it_field_chk INTO wa_field_chk WITH KEY fieldname =
    wa_var-var BINARY SEARCH.
    IF sy-subrc = 0.
      wa_var-flag = 'X'.
      MODIFY it_var1 FROM wa_var.
    ENDIF.
    CLEAR: wa_field_chk,
          wa_var.
  ENDLOOP.
  REFRESH: it_var_chk1,
           it_var_chk2,
           it_field_chk.
************************************************************
*******Remove sapscript system/standard symbols from it_var1
  DELETE it_var1 WHERE flag = 'X'.

ENDFORM.                    " form_var_edit
*&---------------------------------------------------------------------*
*&      Form  check_com_line
*&---------------------------------------------------------------------*
*       Check pure comment line
*----------------------------------------------------------------------*
*       No Parameters
*----------------------------------------------------------------------*
FORM check_com_line .

  DATA: count              TYPE i,
        index1             TYPE i,
        l_length           TYPE i,
        l_form_lines_temp  TYPE STANDARD TABLE OF tline,
        wa_form_lines1     TYPE tline.

  l_form_lines_temp[] = it_form_lines[].

  DELETE l_form_lines_temp WHERE tdformat <> '/*'.


  LOOP AT l_form_lines_temp INTO wa_form_lines1.
    FIND '&' IN wa_form_lines1-tdline.
    IF sy-subrc = 0.
      v_com_line = v_com_line + 1.
      LOOP AT it_form_lines INTO wa_form_lines.
        IF wa_form_lines-tdformat = '/W'.
          count = 0.
          wa_dtls_error_table-error_field = wa_form_lines-tdline+0(8).
        ELSE.
          count = count + 1.
          IF wa_form_lines-tdline = wa_form_lines1-tdline.
            wa_dtls_error_table-scrn_field  = 'RSSCF-TDWINOB'.
            wa_dtls_error_table-error_desc  =
            'Variable present in Comment Line'.
            wa_dtls_error_table-line_no     = count.
            CONDENSE wa_dtls_error_table-line_no.
            wa_dtls_error_table-error_index = v_err_index.
            CONCATENATE wa_dtls_error_table-error_field
                        wa_dtls_error_table-line_no
                        INTO wa_dtls_error_table-error_field
                        SEPARATED BY '/'.
            APPEND wa_dtls_error_table TO it_dtls_error_table.
            EXIT.
          ENDIF.
        ENDIF.
      ENDLOOP.

    ENDIF.
  ENDLOOP.


  CLEAR wa_error_table.
  wa_error_table-error_index = v_err_index.
  wa_error_table-error_desc  = 'Variable present in Comment Line'.
  wa_error_table-total_error = v_com_line.
  APPEND wa_error_table TO it_error_table.


  v_err_index = v_err_index + 1.


ENDFORM.                    " check_com_line
*&---------------------------------------------------------------------*
*&      Form  modify_screen
*&---------------------------------------------------------------------*
*       Modify screen options
*----------------------------------------------------------------------*
*       No Parameters
*----------------------------------------------------------------------*
FORM modify_screen .

  IF w_ucomm = 'FC01'.
    sy_sel = 'X'.
    sy_read = 'X'.
    sort_bny = 'X'.
    read_bny = 'X'.
    hard_wre = 'X'.
    half_com = 'X'.
    no_type = 'X'.
    no_len  = 'X'.
    sel_loop = 'X'.
    no_delm  = 'X'.
    del_ajt = 'X'.
    move_cor = 'X'.
    into_cor = 'X'.
    sel_star = 'X'.
    dev_tran = 'X'.
    font_fam = 'X'.
    logo_txt = 'X'.
    nex_page = 'X'.
    pure_com = 'X'.
    red_des = 'X'.
    red_par = 'X'.
    red_var = 'X'.
    sub_pool ='X'.
    txt_ele = 'X'.
    var_dri = 'X'.
    win_def = 'X'.
    st_txt = 'X'.
    over_win = 'X'.

  ELSEIF w_ucomm = 'FC02'.
    CLEAR:
      sy_sel,
      sy_read,
      sort_bny,
      read_bny,
      hard_wre,
      half_com,
      no_type,
      no_len,
      sel_loop,
      no_delm,
      del_ajt,
      move_cor,
      into_cor,
      sel_star,
      dev_tran,
      font_fam,
      logo_txt,
      nex_page,
      pure_com,
      red_des,
      red_par,
      red_var,
      sub_pool,
      txt_ele,
      var_dri,
      win_def,
      over_win,
      st_txt.
  ENDIF.

*Set dynamic screen options depending on whether a driver program exists
  IF p_chkdri = 'X'.

    LOOP AT SCREEN.
      IF screen-group1 = 'GRC'.
        screen-input = 0.
        MODIFY SCREEN.
      ENDIF.
      IF screen-group1 = 'GRP'.
*screen-active = 0.
*screen-invisible = 1.
        screen-input = 1.
        var_dri = 'X'.
        red_var = 'X'.
        txt_ele = 'X'.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.

  ELSE.
    CLEAR g_pname.
    LOOP AT SCREEN.
      IF screen-group1 = 'GRP'.
*screen-active = 0.
*screen-invisible = 1.
        screen-input = 0.
        red_var = space.
        txt_ele = space.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.

  ENDIF.

ENDFORM.                    " modify_screen

*Text symbol text
*003:SY-SUBRC Check After SELECT
*004:SY-SUBRC Check After READ
*005:Sort Before Binary Search
*006:Binary Search in READ
*007:Hard Coding in WHERE Clause
*008:Half Line Comment Check
*009:No Data Type Specified
*010:No Length Specified
*011:SELECT Inside a LOOP
*012:Data Element is Not Specified
*013:SORT Before DELETE ADJACENT
*014:Check SELECT *
*015:Check MOVE-CORRESPONDING
*016:INTO CORRESPONDING in SELECT
*017:Script Check Options
*018:Check for Package
*019:Variables defined but unused in form
*020:Char & Para format not used
*021:Variables not declared in driver
*022:Unused txt elements in form/program
*023:Window Overlap
*024:Repeated Description
*025:Next page left blank
*027:Existence of subroutine
*028:Pure Comment Line
*029:Font fam & size blank for para & char format
*030:Unused Windows in Form
*031:Check for Logo & Std text
*033:Std text assigned to CTS
*034:Select from Cluster Tables
*035:Hard Break Points in Code
*036:User Name Check in the Code
*037:Available Views for Joined Tables
*038:Sort Inside Loop
*039:Negative SQLstatements in Where Condition
*040:Usage of ON CHANGE OF Statement
*041:DB Table Hit Count
*042:Warning to Check the Size Limit of Ranges
*043:Check for initial before for all entries
*044:Check for One Statement per Line

*045:Check For Sort on the Hashed Internal Table
*Selection text
*G_PNAME:        Program Name
*HALF_COM:        Half Line Comment Check
*HARD_WRE:        Hard Coding in WHERE Clause
*HTML_DWN:        Download to HTML
*INTO_COR:        INTO CORRESPONDING in Select
*LOGO_TXT:        Check for Logo & Std text
*MOVE_COR:        Check MOVE-CORRESPONDING
*NEX_PAGE:        Next page left Blank
*NO_DELM:        Data Element Not Specified
*NO_LEN:        No Length Specified
*NO_TYPE:        No Data Type Specified
*PURE_COM:        Pure Comment Line
*P_CHKB:        Checkbox Starts With
*P_CHKDRI:        Driver Program Exists
*P_CLIENT:        Client
*P_CONST:        Constant Name Starts With
*P_GLOB:        Global Variable Starts With
*P_LANG:        Language
*P_LOC:        Local Variable Starts With
*P_OPT:        Select-Option Starts With
*P_PARA:        Parameter Starts With
*P_RADB:        Radiobutton Starts With
*P_RANGE:        Range Starts With
*P_SCRIPT:        SAPScript Name
*P_STATUS:        Active Version
*P_STRUC:        Structure Name Starts With
*P_TABL:        Internal Table Name Start With
*P_TYPE:        TYPES Starts With
*P_WA:        Work Area Starts With
*READ_BNY:        Binary Search in Read
*RED_DES:        Repeated Description
*SORT_BNY:        Sort Before Binary Search
*ST_TXT:        Sort Before Binary Search
*SY_READ:        SY-SUBRC Check After Read
*SY_SEL:        SY-SUBRC Check After Select
*TXT_ELE:        Unused txt elements in form/pr
*VAR_DRI:        "Variable defined,unused in frm"
*WIN_DEF:        Unused Windows in Form
*WIN_OVER:        Window Overlap
