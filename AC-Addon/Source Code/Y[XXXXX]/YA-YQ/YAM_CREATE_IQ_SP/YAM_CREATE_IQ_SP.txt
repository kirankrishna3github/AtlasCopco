*----------------------------------------------------------------------
* PROGRAM ID           : YAM_CREATE_IQ_SP                              *
* PROGRAM TITLE        : AM: Create Intelli Quoter Service Product     *
* AUTHOR               : LUC MERTENS                                   *
* DATE                 : 07/02/2007                                    *
* DEVELOPMENT ID       :                                               *
* CHANGE REQUEST NUMBER: CD1K910294                                    *
* PROGRAM DESCRIPTION  : This is a program to create the service prod  *
*                        based on the Intelli Quoter from AIF/AII+AIP. *
*----------------------------------------------------------------------*
* CHANGE HISTORY LOG
*----------------------------------------------------------------------*
* MOD. NO.|  DATE      | NAME               | CORRECT.NR.| CHANGE REF. *
*----------------------------------------------------------------------*
* MOD-001 | 2008.04.02 | L. Mertens         | CD1K927646 |             *
*           - change start date 'ZPN0' to first day of current year    *
*----------------------------------------------------------------------*
* MOD-002 | 2008.07.24 | L. Mertens         | CD1K942302 | CR0003      *
*           - PR00 for FP SP's                                         *
*----------------------------------------------------------------------*
* MOD-003 | 2010.06.03 | J. Smets           | CD1K942302 | CR1198      *
*           - Process mode for batch input modifiable                  *
*----------------------------------------------------------------------*
* MOD-004 | 2010.10.01 | L. Mertens         | CD1K959716 | CR1676      *
*           - Estimated running hours not mandatory anymore            *
*----------------------------------------------------------------------*
* MOD-005 | 2011.09.02 | L. Mertens         | CD1K967573 | CR1470      *
*----------------------------------------------------------------------*
REPORT yam_create_iq_sp
       NO STANDARD PAGE HEADING
       LINE-SIZE 120
       MESSAGE-ID yam_dc.

*---------------------------------------------------------------------*
* TABLES DECLARATION
*---------------------------------------------------------------------*
TABLES: t001w,                              " Plants
        t179,                               " Product hierarchy
        cepc_bukrs.                         " Profit centers

*---------------------------------------------------------------------*
* INTERNAL TABLE DECLARATIONS                                         *
*---------------------------------------------------------------------*
DATA : i_bdcdata LIKE bdcdata OCCURS 0 WITH HEADER LINE,
       struct_bdcdata TYPE bdcdata,
       gt_err    LIKE bdcmsgcoll OCCURS 0 WITH HEADER LINE.

DATA g_api_values LIKE api_value OCCURS 0 WITH HEADER LINE.

DATA: BEGIN OF tmerk OCCURS 0.
        INCLUDE STRUCTURE clx2f.
DATA: END   OF tmerk.

DATA: BEGIN OF tvalues OCCURS 0.
        INCLUDE STRUCTURE clx2v.
DATA: END   OF tvalues.

DATA: BEGIN OF gt_char OCCURS 20,
        name  TYPE atnam,
        value TYPE atwrt,
      END OF gt_char.

*---------------------------------------------------------------------*
* VARIABLE DECLARATIONS                                               *
*---------------------------------------------------------------------*
DATA : gv_matnr          TYPE matnr,
       gv_newmatnr       TYPE matnr,
       gv_bukrs          TYPE bukrs,
       gv_matkl          TYPE matkl,
       gv_curr           TYPE waers,
       l_date            TYPE d ,             " Date in User Format
* begin of change MOD-001
       gv_datum          LIKE sy-datum,
* end of change MOD-001
       gv_msgnr          LIKE t100-msgnr,
       gv_mestx          LIKE t100-text,
       gv_costpr(11)     TYPE c,
       gv_kbetr(11)      TYPE c,
       gv_idx(2)         TYPE n,
       gv_scr_field(15)  TYPE c,
       gv_type(5)        TYPE c,
       g_sctms           LIKE sctms,
       gv_char(1)        TYPE c,
*       gv_mtpos          type mtpos,
* begin of insert MOD-002
       gv_kschl          TYPE kschl,
* end of insert MOD-002
       gv_off(2)         TYPE n,
       gv_len(2)         TYPE n,
       gv_textline(132)  TYPE c.

DATA: gv_mode            TYPE bdcmode   VALUE 'N'.          "MOD-003

*---------------------------------------------------------------------*
* CONSTANT DECLARATIONS                                               *
*---------------------------------------------------------------------*
CONSTANTS: c_11(2)               TYPE c     VALUE '11',
           c_01(2)               TYPE c     VALUE '01',
           c_001            TYPE klassenart VALUE '001',
           c_datbi            TYPE sy-datum VALUE '99991231',
           c_x(1)                TYPE c     VALUE 'X',
           c_mbrsh               TYPE mbrsh VALUE 'M',
           c_mtart               TYPE mtart VALUE 'ZDIE',
* begin of delete MOD-002
*          c_kschl               type kschl value 'ZPN0',
* end of delete MOD-002
           c_meins               TYPE meins VALUE 'AU',
           c_kondm               TYPE kondm VALUE '01',
           c_ktgrm               TYPE ktgrm VALUE 'S2',
           gc_bklas              TYPE bklas VALUE '3200',
*           c_zs04                type mtpos value 'ZS04',
*           c_zs02                type mtpos value 'ZS02',
           c_taxkm               TYPE taxkm VALUE '1',
           c_basic(5)            TYPE c     VALUE 'BASIC',
           c_views(5)            TYPE c     VALUE 'VIEWS',
           c_class            TYPE klasse_d VALUE 'ZAM_CLASS_04',
           c_zam_duration        TYPE atnam VALUE 'ZAM_DURATION',
           c_zam_elec_parts      TYPE atnam VALUE 'ZAM_ELEC_PARTS',
           c_zam_elt_overhaul    TYPE atnam VALUE 'ZAM_ELT_OVERHAUL',
           c_zam_mot_overhaul    TYPE atnam VALUE 'ZAM_MOT_OVERHAUL',
           c_zam_motpow_service  TYPE atnam VALUE 'ZAM_MOTPOW_SERVICE',
           c_zam_oil             TYPE atnam VALUE 'ZAM_OIL',
           c_zam_running_hours   TYPE atnam VALUE 'ZAM_RUNNING_HOURS',
           c_zam_service_product TYPE atnam VALUE 'ZAM_SERVICE_PRODUCT',
           c_zam_service_range   TYPE atnam VALUE 'ZAM_SERVICE_RANGE',
           c_zam_oiltype         TYPE atnam VALUE 'ZAM_OILTYPE',
           c_zam_company         TYPE atnam VALUE 'ZAM_COMPANY',
           c_zam_visit_freq_char TYPE atnam VALUE 'ZAM_VISIT_FREQ_CHAR',
           c_zam_service_hours   TYPE atnam VALUE 'ZAM_SERVICE_HOURS',
           c_zam_engineoil       TYPE atnam VALUE 'ZAM_ENGINEOIL',
           c_group        LIKE apqi-groupid VALUE 'Y_IQSP',
           c_transmat     LIKE tstc-tcode   VALUE 'MM01',
           c_transcon     LIKE tstc-tcode   VALUE 'VK11'.

*---------------------------------------------------------------------*
* PARAMETER DECLARATION
*---------------------------------------------------------------------*
SELECTION-SCREEN : BEGIN OF BLOCK b1 WITH FRAME TITLE text-001.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31)   text-sc1 FOR FIELD p_vkorg.
PARAMETERS: p_vkorg  LIKE mvke-vkorg OBLIGATORY MEMORY ID vko.
SELECTION-SCREEN COMMENT (2) g_blank1.
SELECTION-SCREEN COMMENT (30) g_ktext1.
SELECTION-SCREEN END OF LINE.

PARAMETERS: p_maktx  LIKE makt-maktx OBLIGATORY,
            p_bismt  LIKE mara-bismt OBLIGATORY,
            p_prdha  LIKE mara-prdha OBLIGATORY,
            p_prctr  LIKE marc-prctr OBLIGATORY,
            p_stprs  LIKE mbew-stprs OBLIGATORY,
            p_kbetr  LIKE konp-kbetr OBLIGATORY.
SELECTION-SCREEN: END OF BLOCK b1.

SELECTION-SCREEN : BEGIN OF BLOCK b2 WITH FRAME TITLE text-002.
PARAMETERS: p_comp(3)    TYPE c OBLIGATORY,
            p_srang(15)  TYPE c,
            p_sprod(3)   TYPE c OBLIGATORY,
* begin of change MOD-004
*            p_rhour(4)   TYPE c OBLIGATORY,
            p_rhour(4)   TYPE c,
* end of change MOD-004
            p_visit(10)  TYPE c OBLIGATORY,
            p_durat(3)   TYPE c OBLIGATORY,
* begin of change MOD-005
*            p_oil(1)     TYPE c OBLIGATORY,
            p_oil(1)     TYPE c,
* end of change MOD-005
            p_oiltp(10)  TYPE c,
            p_engoil(10) TYPE c,
            p_eover(1)   TYPE c,
            p_epart(1)   TYPE c,
            p_mserv(8)   TYPE c,
            p_mover(1)   TYPE c,
            p_servh(8)   TYPE c.
SELECTION-SCREEN: END OF BLOCK b2.

*---------------------------------------------------------------------*
* Initialization                                                      *
*---------------------------------------------------------------------*
INITIALIZATION.

* preselect characteristics of class 'ZAM_CLASS_04'
  CALL FUNCTION 'CLEX_GET_CLASS_FEATURES_VALUES'
    EXPORTING
      activity                      = ' '
      classname                     = c_class
      classtype                     = c_001
      display_scope_in              = g_sctms
      without_values                = ' '
    TABLES
      features                      = tmerk
      values                        = tvalues
    EXCEPTIONS
      not_authorized_classification = 1
      not_authorized_maintenance    = 2
      not_authorized_selection      = 3
      no_features_defined           = 4
      OTHERS                        = 5.

* check whether features exist
  IF tmerk[] IS INITIAL.
    MESSAGE e001(00) WITH text-e10 ' ' c_class.
  ENDIF.

  SORT tmerk BY atnam.
  SORT tvalues BY atinn atwrt.

*---------------------------------------------------------------------*
*--- AT selection-screen on sales organization
*---------------------------------------------------------------------*
AT SELECTION-SCREEN ON p_vkorg.

  DATA: lt_tvkot LIKE tvkot,
        lt_tvko  LIKE tvko,
        lt_tvtwt LIKE tvtwt,
        lt_tspat LIKE tspat,
        lt_tvkbt LIKE tvkbt,
        lt_tvgrt LIKE tvgrt.

  CLEAR: lt_tvkot, lt_tvtwt, lt_tspat, lt_tvkbt, lt_tvgrt.

*.. Check sales organization
  CALL FUNCTION 'ITOB_CHECK_SALES_ORGANIZATION'
    EXPORTING
      vkorg                   = p_vkorg
*     LANGU                   = SY-LANGU
*     USE_BUF                 = 'X'
*     DIALOG_MODE             = 'X'
      dialog_cursor           = 'P_VKORG'
*     DIALOG_STEPL            = 0
*     INIT_MESSAGE_DATA       = 'X'
*     X_MESS_TYPE             = 'E'
*     READ_TEXT_TABLES        = 'X'
    IMPORTING
      tvko_exp                = lt_tvko
      tvkot_exp               = lt_tvkot
    EXCEPTIONS
      empty_key               = 1
      application_error       = 2
      OTHERS                  = 3.

  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
          WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE lt_tvkot-vtext TO g_ktext1.
  MOVE lt_tvko-bukrs  TO gv_bukrs.


* authority check
  AUTHORITY-CHECK OBJECT 'V_VBAK_VKO'
         ID 'VKORG' FIELD p_vkorg
         ID 'VTWEG' FIELD c_11
         ID 'SPART' FIELD c_01
         ID 'ACTVT' FIELD '01'.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e01 p_vkorg.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_bismt.

  gv_len = STRLEN( p_bismt ).
  IF gv_len < 12 OR
     gv_len > 16.
    MESSAGE e001(00) WITH text-e15.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_prdha.

  SELECT SINGLE * FROM t179 WHERE prodh = p_prdha.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e09.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_prctr.

  DATA: lv_kokrs       TYPE kokrs.

  CALL FUNCTION 'COPA_ERKRS_FIND'
      EXPORTING
        bukrs              = gv_bukrs
        gsber              = ' '
        kokrs              = ' '
    IMPORTING
*       ERKRS              =
        kokrs              = lv_kokrs
    EXCEPTIONS
        error_kokrs_find   = 1
        kokrs_wrong        = 2
        no_erkrs_defined   = 3
        no_erkrs_for_kokrs = 4
        OTHERS             = 5.

  SELECT SINGLE * FROM cepc_bukrs WHERE prctr = p_prctr
                                    AND bukrs = gv_bukrs
                                    AND kokrs = lv_kokrs.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e13.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_durat.

  CHECK NOT p_durat IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_duration
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_durat.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_epart.

  CHECK NOT p_epart IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_elec_parts
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_epart.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_eover.

  CHECK NOT p_eover IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_elt_overhaul
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_eover.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_mover.

  CHECK NOT p_mover IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_mot_overhaul
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_mover.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_mserv.

  CHECK NOT p_mserv IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_motpow_service
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_mserv.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_oil.

  CHECK NOT p_oil IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_oil
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_oil.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_rhour.

  CHECK NOT p_rhour IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_running_hours
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_rhour.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_sprod.

  CHECK NOT p_sprod IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_service_product
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_sprod.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_srang.

  CHECK NOT p_srang IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_service_range
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_srang.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_oiltp.

  CHECK NOT p_oiltp IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_oiltype
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_oiltp.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_comp.

  CHECK NOT p_comp IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_company
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_comp.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_visit.

  CHECK NOT p_visit IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_visit_freq_char
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_visit.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_servh.

  CHECK NOT p_servh IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_service_hours
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_servh.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_engoil.

  CHECK NOT p_engoil IS INITIAL.

  READ TABLE tmerk WITH KEY atnam = c_zam_engineoil
                        BINARY SEARCH.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e11 ' ' c_class.
  ENDIF.

  READ TABLE tvalues WITH KEY atinn = tmerk-atinn
                              atwrt = p_engoil.
  IF NOT sy-subrc = 0.
    MESSAGE e001(00) WITH text-e12.
  ENDIF.

*---------------------------------------------------------------------*
*--- F4 Inputhelp
*---------------------------------------------------------------------*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_durat.

  PERFORM help_f4 USING c_zam_duration
               CHANGING p_durat.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_epart.

  PERFORM help_f4 USING c_zam_elec_parts
               CHANGING p_epart.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_eover.

  PERFORM help_f4 USING c_zam_elt_overhaul
               CHANGING p_eover.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_mover.

  PERFORM help_f4 USING c_zam_mot_overhaul
               CHANGING p_mover.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_mserv.

  PERFORM help_f4 USING c_zam_motpow_service
               CHANGING p_mserv.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_oil.

  PERFORM help_f4 USING c_zam_oil
               CHANGING p_oil.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_rhour.

  PERFORM help_f4 USING c_zam_running_hours
               CHANGING p_rhour.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_sprod.

  PERFORM help_f4 USING c_zam_service_product
               CHANGING p_sprod.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_srang.

  PERFORM help_f4 USING c_zam_service_range
               CHANGING p_srang.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_oiltp.

  PERFORM help_f4 USING c_zam_oiltype
               CHANGING p_oiltp.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_comp.

  PERFORM help_f4 USING c_zam_company
               CHANGING p_comp.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_visit.

  PERFORM help_f4 USING c_zam_visit_freq_char
               CHANGING p_visit.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_servh.

  PERFORM help_f4 USING c_zam_service_hours
               CHANGING p_servh.

*
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_engoil.

  PERFORM help_f4 USING c_zam_engineoil
               CHANGING p_engoil.

*--------- S T A R T   O F   M A I N   P R O C E S S I N G -----------*

*---------------------------------------------------------------------*
* START-OF-SELECTION                                                  *
*---------------------------------------------------------------------*
START-OF-SELECTION.

  CALL METHOD ycl_statistics=>record_transaction.

* Get the currency with which the prices are to be stored
  SELECT SINGLE waers INTO gv_curr
         FROM tvko
         WHERE vkorg = p_vkorg.

* Fill int. table with char. + values
  REFRESH gt_char.

  IF NOT p_durat IS INITIAL.
    MOVE c_zam_duration       TO gt_char-name.
    MOVE p_durat              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_epart IS INITIAL.
    MOVE c_zam_elec_parts     TO gt_char-name.
    MOVE p_epart              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_eover IS INITIAL.
    MOVE c_zam_elt_overhaul   TO gt_char-name.
    MOVE p_eover              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_mover IS INITIAL.
    MOVE c_zam_mot_overhaul   TO gt_char-name.
    MOVE p_mover              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_mserv IS INITIAL.
    MOVE c_zam_motpow_service TO gt_char-name.
    MOVE p_mserv              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_oil IS INITIAL.
    MOVE c_zam_oil            TO gt_char-name.
    MOVE p_oil                TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_rhour IS INITIAL.
    MOVE c_zam_running_hours  TO gt_char-name.
    MOVE p_rhour              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_sprod IS INITIAL.
    MOVE c_zam_service_product TO gt_char-name.
    MOVE p_sprod               TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_srang IS INITIAL.
    MOVE c_zam_service_range  TO gt_char-name.
    MOVE p_srang              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_oiltp IS INITIAL.
    MOVE c_zam_oiltype        TO gt_char-name.
    MOVE p_oiltp              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_comp IS INITIAL.
    MOVE c_zam_company        TO gt_char-name.
    MOVE p_comp               TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_visit IS INITIAL.
    MOVE c_zam_visit_freq_char TO gt_char-name.
    MOVE p_visit               TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_servh IS INITIAL.
    MOVE c_zam_service_hours  TO gt_char-name.
    MOVE p_servh              TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.
  IF NOT p_engoil IS INITIAL.
    MOVE c_zam_engineoil      TO gt_char-name.
    MOVE p_engoil             TO gt_char-value.
    APPEND gt_char.
    CLEAR gt_char.
  ENDIF.

* Check existance of service product
  SELECT matnr INTO gv_matnr
         FROM mara
         WHERE bismt = p_bismt.
  ENDSELECT.

  CLEAR gv_textline.
  IF sy-subrc = 0.
*.. check existance of sales organization data
    SELECT SINGLE matnr INTO gv_matnr
           FROM mvke
           WHERE matnr = gv_matnr
             AND vkorg = p_vkorg
             AND vtweg = c_11.

    IF sy-subrc = 0.
      SKIP 15.
      WRITE: 30 text-020.
      WRITE: /33 text-i01,
             /30 text-020.
    ELSE.
*.... create only S.O.data and condition record
      gv_type = c_views.
      PERFORM create_sp_and_cond USING gv_type.
    ENDIF.
  ELSE.
*.. create service product, S.O.data and condition record
    gv_type = c_basic.
    PERFORM create_sp_and_cond USING gv_type.
  ENDIF.

*----------------------------------------------------------------------*
* END-OF-SELECTION                                                     *
*----------------------------------------------------------------------*
END-OF-SELECTION.

*-S U B R O U T I N E S------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  HELP_F4
*&---------------------------------------------------------------------*
*       Inputhelp                                                      *
*----------------------------------------------------------------------*
FORM help_f4 USING r_char_tab-atnam
          CHANGING r_char_atwrt.

  READ TABLE tmerk WITH KEY atnam = r_char_tab-atnam
                   BINARY SEARCH.
  CHECK sy-subrc = 0.
  REFRESH g_api_values.

  CALL FUNCTION 'CTMS_CHAR_VALUE_F4'
       EXPORTING
            imp_characteristic = tmerk-atinn
*           IMP_MODE           = ' '
*           IMP_DISPLAY        = ' '
*           IMP_LANGUAGE       = SY-LANGU
*           IMP_DATE           = SY-DATUM
       TABLES
            exp_values         = g_api_values.

  READ TABLE g_api_values INDEX 1.
  IF sy-subrc = 0.
    r_char_atwrt = g_api_values-atwrt.
  ENDIF.

ENDFORM.                                                    "help_f4

*&---------------------------------------------------------------------*
*&      Form  create_sp_and_cond
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM create_sp_and_cond USING p_type.

* derive FP or SP service product --> item category group
* gv_len = strlen( p_bismt ).
  IF p_prdha+4(4) = '8140' OR
     p_prdha+4(4) = '8141' OR
     p_prdha+4(4) = '8142' OR
     p_prdha+4(4) = '8431'.
    gv_off = gv_len - 10.
  ELSE.
    gv_off = gv_len - 9.
  ENDIF.
  gv_char = p_bismt+gv_off(1).
*  if gv_char = '4'.
*    gv_mtpos = c_zs02.       "FP
*  else.
*    gv_mtpos = c_zs04.       "SP
*  endif.

* begin of insert MOD-002
  IF gv_char = '4'.           "FP
    gv_kschl = 'PR00'.
  ELSE.
    gv_kschl = 'ZPN0'.
  ENDIF.
* end of insert MOD-002

  IF p_type = c_basic.
*.. get next external material number
    CALL FUNCTION 'YAM_GET_NEXT_MATNR'
      EXPORTING
        p_ls_mtart         = c_mtart
      IMPORTING
        p_matnr            = gv_newmatnr
      EXCEPTIONS
        end_of_range       = 1
        wrong_materialtype = 2
        locked             = 3
        OTHERS             = 4.
    IF sy-subrc <> 0.
      SKIP 15.
      WRITE: 30 text-020.
      WRITE: /33 text-e14,
             /30 text-020.
      RETURN.
    ENDIF.

*.. create product, S.O.data and condition record
*.. determine materialclass on base of old material number
*    perform prepare_matkl using gv_char
*                                p_prdha
*                       changing gv_matkl.
    CLEAR gv_matkl.
    CALL FUNCTION 'YAM_CONVERT_MATKL'
      EXPORTING
        p_bismt       = p_bismt
        p_prdha       = p_prdha
      CHANGING
        p_matkl       = gv_matkl
      EXCEPTIONS
        no_parameters = 1
        OTHERS        = 2.

    IF sy-subrc <> 0.
      SKIP 15.
      WRITE: 30 text-020.
      WRITE: /33 text-e18,
             /30 text-020.
      RETURN.
    ENDIF.

    PERFORM bdc_filldata_mat.
  ELSE.
*.. create only S.O.data and condition record
    PERFORM bdc_filldata_so.
  ENDIF.
  CALL TRANSACTION c_transmat USING i_bdcdata
*                              MODE 'N'                     "MOD-003
                              MODE gv_mode                  "MOD-003
                              UPDATE 'S'
                              MESSAGES INTO gt_err.

  IF sy-subrc IS INITIAL.
    GET PARAMETER ID 'MAT' FIELD gv_matnr.

    REFRESH: i_bdcdata,
             gt_err.
    PERFORM bdc_filldata_cond USING gv_matnr.
    CALL TRANSACTION c_transcon USING i_bdcdata
*                                MODE 'N'                   "MOD-003
                                MODE gv_mode                "MOD-003
                                UPDATE 'S'
                                MESSAGES INTO gt_err.

    IF NOT sy-subrc IS INITIAL.
      SKIP 15.
      WRITE: 30 text-020.
      WRITE: /33 text-i02, gv_matnr.
      gv_textline = text-i03.
      REPLACE '&1' WITH p_vkorg INTO gv_textline.
      WRITE: /33 gv_textline,
             /33 text-e03.
      LOOP AT gt_err.
        gv_msgnr = gt_err-msgnr.
        CALL FUNCTION 'RH_MESSAGE_GET'
          EXPORTING
*           SPRSL                   = SY-LANGU
            arbgb                   = sy-msgid
            msgnr                   = gv_msgnr
            msgv1                   = sy-msgv1
            msgv2                   = sy-msgv2
            msgv3                   = sy-msgv3
            msgv4                   = sy-msgv4
          IMPORTING
            msgtext                 = gv_mestx
          EXCEPTIONS
            message_not_found       = 1
            OTHERS                  = 2.

        IF sy-subrc = 0.
          FORMAT COLOR COL_NEGATIVE.
          WRITE: /33 gv_mestx.
        ENDIF.
      ENDLOOP.
      FORMAT RESET.
      WRITE: /30 text-020.
      RETURN.
    ENDIF.
  ELSE.
    SKIP 15.
    WRITE: 30 text-020.
    WRITE: /33 text-e02.
    LOOP AT gt_err.
      gv_msgnr = gt_err-msgnr.
      CALL FUNCTION 'RH_MESSAGE_GET'
        EXPORTING
*         SPRSL                   = SY-LANGU
          arbgb                   = sy-msgid
          msgnr                   = gv_msgnr
          msgv1                   = sy-msgv1
          msgv2                   = sy-msgv2
          msgv3                   = sy-msgv3
          msgv4                   = sy-msgv4
        IMPORTING
          msgtext                 = gv_mestx
        EXCEPTIONS
          message_not_found       = 1
          OTHERS                  = 2.

      IF sy-subrc = 0.
        FORMAT COLOR COL_NEGATIVE.
        WRITE: /33 gv_mestx.
      ENDIF.
    ENDLOOP.
    FORMAT RESET.
    gv_textline = text-e04.
    REPLACE '&1' WITH p_vkorg INTO gv_textline.
    WRITE: /33 gv_textline,
           /33 text-e05,
           /30 text-020.
    RETURN.
  ENDIF.

  SKIP 15.
  WRITE: 30 text-020.
  WRITE: /33 text-i02, gv_matnr.
  gv_textline = text-i03.
  REPLACE '&1' WITH p_vkorg INTO gv_textline.
  WRITE: /33 gv_textline,
         /33 text-i04,
         /30 text-020.

ENDFORM.                    "create_sp_and_cond

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_so
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_so.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0060'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MATNR' gv_matnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MBRSH'  c_mbrsh
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MTART'  c_mtart
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1_REF-MATNR'  '!'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SELA'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0080'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-WERKS'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VKORG'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VTWEG'  c_11
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP04'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-DWERK'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MG03STEUER-TAXKM(01)'  c_taxkm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4200'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KONDM'  c_kondm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KTGRM'  c_ktgrm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*  perform fill_bdcdata in program yam_common_routines
*           using    ''  ''  ''  'MVKE-MTPOS'  gv_mtpos
*           changing struct_bdcdata.
*  append struct_bdcdata  to i_bdcdata.
*  clear  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP06'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-PRCTR'  p_prctr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP24'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* save
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-BKLAS'  gc_bklas
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-STPRS'  gv_costpr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_so

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_mat
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_mat.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0060'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MATNR'  gv_newmatnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MBRSH'  c_mbrsh
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MTART'  c_mtart
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1_REF-MATNR'  '!'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SELA'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0080'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-WERKS'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VKORG'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VTWEG'  c_11
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4004'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MAKT-MAKTX'  p_maktx
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-BISMT'  p_bismt
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-MEINS'  c_meins
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-MATKL'  gv_matkl
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-SPART'  c_01
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-PRDHA'  p_prdha
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP03'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Classification
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCLCA'  '0602'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMCLF-KLART'  c_001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTE'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCLFM'  '0500'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMCLF-CLASS(01)'  c_class
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCTMS'  '0109'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  CLEAR gv_idx.

  LOOP AT gt_char.
    ADD 1 TO gv_idx.

    IF gv_idx > 10.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      gv_idx = 1.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    'SAPLCLFM'  '0500'  'X'  ''  ''
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    ''  ''  ''  'BDC_OKCODE'  '/00'
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    'SAPLCTMS'  '0109'  'X'  ''  ''
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

    ENDIF.

    CONCATENATE 'RCTMS-MNAME(' gv_idx ')' INTO gv_scr_field.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  gv_scr_field  gt_char-name
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    CONCATENATE 'RCTMS-MWERT(' gv_idx ')' INTO gv_scr_field.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  gv_scr_field  gt_char-value
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
  ENDLOOP.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCLFM'  '0500'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=WEI1'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-DWERK'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MG03STEUER-TAXKM(01)'  c_taxkm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4200'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KONDM'  c_kondm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KTGRM'  c_ktgrm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*  perform fill_bdcdata in program yam_common_routines
*           using    ''  ''  ''  'MVKE-MTPOS'  gv_mtpos
*           changing struct_bdcdata.
*  append struct_bdcdata  to i_bdcdata.
*  clear  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP06'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-PRCTR'  p_prctr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP24'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* save
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-BKLAS'  gc_bklas
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-STPRS'  gv_costpr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_mat

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_cond
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_cond USING r_matnr.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPMV13A'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
* begin of change MOD-002
*          using    ''  ''  ''  'RV13A-KSCHL'  c_kschl
           USING    ''  ''  ''  'RV13A-KSCHL' gv_kschl
* end of change MOD-002
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLV14A'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* begin of insert MOD-002
  IF gv_kschl = 'ZPN0'.
* end of insert MOD-002
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'RV130-SELKZ(02)'  c_x
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
* begin of insert MOD-002
  ELSE.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'RV130-SELKZ(05)'  c_x
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
  ENDIF.
* end of insert MOD-002

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=WEIT'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
* begin of insert MOD-002
  IF gv_kschl = 'ZPN0'.
* end of insert MOD-002
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPMV13A'  '1004'  'X'  ''  ''
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VKORG'  p_vkorg
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VTWEG'  c_11
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-MATNR(01)'  r_matnr
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    WRITE p_kbetr TO gv_kbetr CURRENCY gv_curr.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KONP-KBETR(01)'  gv_kbetr
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

* begin of change MOD-001
* write sy-datum to l_date.
    MOVE sy-datum TO gv_datum.
    MOVE '0101' TO gv_datum+4(4).
    WRITE gv_datum TO l_date.
* end of change MOD-001
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'RV13A-DATAB(01)'  l_date
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'BDC_OKCODE'  '=SICH'
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
* begin of insert MOD-002
  ELSE.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPMV13A'  '1304'  'X'  ''  ''
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VKORG'  p_vkorg
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VTWEG'  c_11
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-MATNR(01)'  r_matnr
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    WRITE p_kbetr TO gv_kbetr CURRENCY gv_curr.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KONP-KBETR(01)'  gv_kbetr
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    MOVE sy-datum TO gv_datum.
    MOVE '0101' TO gv_datum+4(4).
    WRITE gv_datum TO l_date.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'RV13A-DATAB(01)'  l_date
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'BDC_OKCODE'  '=SICH'
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
  ENDIF.
* end of insert MOD-002

ENDFORM.        "bdc_filldata_cond

*&---------------------------------------------------------------------*
*&      Form  prepare_matkl
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM prepare_matkl USING r_char
                         r_p_prdha
                CHANGING r_matkl.

  CASE r_char.
    WHEN '1'.
      r_matkl = '044ZIP'.
    WHEN '2'.
      r_matkl = '044ZPM'.
    WHEN '3'.
      r_matkl = '044ZTR'.
    WHEN '4'.
      r_matkl = '042Z10000'.
    WHEN '5'.
      r_matkl = '044ZPP'.
    WHEN '6'.
      IF r_p_prdha(3) = '84M' OR
         r_p_prdha(3) = '81M'.
        r_matkl = '044ZCC'.
      ELSE.
        r_matkl = '044ZXT'.
      ENDIF.
    WHEN '7'.
      r_matkl = '044ZXT'.
    WHEN OTHERS.
      r_matkl = '044Z'.
  ENDCASE.

ENDFORM.                    " prepare_matkl

*Text symbol text
*001:Basic data
*002:Classification
*020:*------------------------------*
*E01:You have no authorisation for sales organisation :
*E02:Transaction MM01 failed
*E03:Transaction VK11 failed
*E04:View for &1 not created
*E05:Condition ZPN0 not created
*E06:You have no authorisation for plant :
*E07:You have no authorisation for delivering plant :
*E08:Invalid plant
*E09:Invalid product hierarchy
*E10:No characteristics exist for
*E11:Characteristic not in class
*E12:Value is not valid
*E13:Invalid profit center
*E14:No new material number could be reserved !
*E15:Length should be >11 and <17
*E16:Fill in Old Service Product number
*E17:Fill in both MRP Type and Item category group
*E18:Material group could not be derived !
*I01:SP and View already exist
*I02:SP number :
*I03:View for &1 created
*I04:Condition ZPN0 created
*SC1:Sales Organization
*SC2:Distribution Channel
*SC3:Division
*SC4:Plant

*SC5:Delivering Plant
*Selection text
*P_BISMT:        Old Service Product number
*P_COMP:        Company code
*P_DURAT:        Contract duration
*P_ENGOIL:        Engine Oil
*P_EOVER:        Element Overhaul
*P_EPART:        Electrical Parts
*P_KBETR:        Sales price
*P_MAKTX:        Service Product description
*P_MOVER:        Motor Overhaul
*P_MSERV:        Motor power
*P_OIL:        Oil included
*P_OILTP:        Oil type
*P_PRCTR:D       Profit Center
*P_PRDHA:D       Product hierarchy
*P_RHOUR:        Estimated Running Hours
*P_SERVH:        Service hours
*P_SPROD:        Service product
*P_SRANG:        Service ranges
*P_STPRS:D       Standard Price
*P_VISIT:        Visit frequency
*P_VKORG:D       Sales Organization
