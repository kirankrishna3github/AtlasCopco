*----------------------------------------------------------------------*
* PROGRAM ID           : YAM_MASS_UPD_WORKCENTER                       *
* PROGRAM TITLE        : AM: Workcenter update                         *
* AUTHOR               : MARC JACOBS                                   *
* DATE                 : 27/02/2007                                    *
* DEVELOPMENT ID       :                                               *
* CHANGE REQUEST NUMBER: CD1K911183                                    *
* PROGRAM DESCRIPTION  : This is a program to do mass-updates of       *
*                         - main workcenter                            *
*                         - workcenter for fixed FSE - Visitour        *
*                         - sales office                               *
*                         - sales group                                *
*                         - planner group                              *
*                         - costcenter                                 *
*                         - sort field (maintenance plans)             *
*                         - user status (equipments)                   *
*                        in : - open orders                            *
*                             - open notifications                     *
*                             - maintenance plans                      *
*                             - equipments                             *
*                             - functional locations                   *
*                             - contracts                              *
*----------------------------------------------------------------------*
* CHANGE HISTORY LOG
*----------------------------------------------------------------------*
* MOD. NO.|  DATE    | NAME       |CORR. NUMBER| CHANGE REFERENCE      *
*----------------------------------------------------------------------*
* MOD-001 |04/03/2008| M.Jacobs   | CD1K926919 | Change sort field too *
*----------------------------------------------------------------------*
* MOD-002 |08/10/2009| Uzzawal V  | CD1K947743 | CR0699                *
*         | User status update                                         *
*----------------------------------------------------------------------*
* MOD-003 |02/02/2011| Nanda      | CD1K962704 | CR1922                *
*                      Sreenivasan               User status update    *
*----------------------------------------------------------------------*
* MOD-004 |28/06/2011| J. Smets   | CD1K926919 | CR1975 (+ CR2119)     *
*         | Improvements                                               *
*----------------------------------------------------------------------*
* MOD-005 |15/03/2012| G.Rutten   | prevent overflow if 1st level Floc *
*         | would be taken into consideration --> exclude them from    *
*         | selection                                                  *
*----------------------------------------------------------------------*
* MOD-006 |23/04/2014| Raghavendra Rao| CD1K981040 | CR3114            *
*         | System status update                                       *
************************************************************************
REPORT yam_mass_upd_workcenter  NO STANDARD PAGE HEADING
                                LINE-SIZE 120
                                MESSAGE-ID yam_dc.

*---------------------------------------------------------------------*
* TABLES DECLARATION
*---------------------------------------------------------------------*
TABLES: equi,                               " Equipments
        crhd,                               " Workcenters
        tvbvk,                              " sales office - group
        t024i,                              " plant - planner group
        csks,                               " Costcenters
        tj30t.                                              " MOD-002

*---------------------------------------------------------------------*
* INTERNAL TABLE DECLARATIONS                                         *
*---------------------------------------------------------------------*
DATA: l_struct_bdcdata  TYPE bdcdata ,             "BDCDATA table
      l_i_bdcdata TYPE STANDARD TABLE OF bdcdata.  "Table for BDC data

DATA g_api_values LIKE api_value OCCURS 0 WITH HEADER LINE.

DATA: BEGIN OF gt_ord OCCURS 0,
        aufnr LIKE aufk-aufnr,
        kostv LIKE aufk-kostv,
        kostl LIKE aufk-kostl,
        gewrk LIKE afih-gewrk,
        ingpr LIKE afih-ingpr,
        qmnum LIKE afih-qmnum,
      END OF gt_ord.

DATA: BEGIN OF gt_not OCCURS 0,
        qmnum LIKE viqmel-qmnum,
        vkbur LIKE viqmel-vkbur,
        vkgrp LIKE viqmel-vkgrp,
        arbpl LIKE viqmel-arbpl,
        ingrp LIKE viqmel-ingrp,
        kostl LIKE viqmel-kostl,
      END OF gt_not.

DATA: BEGIN OF gt_mpl OCCURS 0,
        wapos LIKE vimpos-wapos,
        warpl LIKE vimpos-warpl,
        gewrk LIKE vimpos-gewrk,
        wpgrp LIKE vimpos-wpgrp,
*        eqfnr TYPE plan_sort,                      "MOD-001/MOD-004
        plan_sort TYPE plan_sort,                           "MOD-004
      END OF gt_mpl.

DATA: BEGIN OF gt_equ OCCURS 0,
        equnr LIKE v_equi-equnr,
        kostl LIKE v_equi-kostl,
        vkbur LIKE v_equi-vkbur,
        vkgrp LIKE v_equi-vkgrp,
        gewrk LIKE v_equi-gewrk,
        ingrp LIKE v_equi-ingrp,
        objnr LIKE v_equi-objnr,                            "MOD-002
        ppsid LIKE v_equi-ppsid,                            "MOD-004
      END OF gt_equ.

DATA: BEGIN OF gt_flo OCCURS 0,
        tplnr LIKE iflo-tplnr,
        kostl LIKE iflo-kostl,
        ingrp LIKE iflo-ingrp,
        lgwid LIKE iflo-lgwid,
        vkbur LIKE iflo-vkbur,
        vkgrp LIKE iflo-vkgrp,
      END OF gt_flo.

DATA: BEGIN OF gt_con OCCURS 0,
        vbeln LIKE vbak-vbeln,
        vkbur LIKE vbak-vkbur,
        vkgrp LIKE vbak-vkgrp,
      END OF gt_con.

*>>>>> Start of MoD-002 EXTUVE
DATA: BEGIN OF it_tj30t OCCURS 0,
       txt30 LIKE tj30t-txt30,
       txt04 LIKE tj30t-txt04,
      END OF it_tj30t.

DATA: lv_index TYPE sy-tabix.

*** MOD-004 * begin ***
*DATA: BEGIN OF it_jest OCCURS 0,
*        objnr LIKE jest-objnr,
*        stat  LIKE jest-stat,
*        inact LIKE jest-inact,
*        txt04 LIKE tj30t-txt04,                             "MOD-002
*      END OF it_jest.

TYPES: BEGIN OF ty_jest,
         objnr LIKE jest-objnr,
         stat  LIKE jest-stat,
         inact LIKE jest-inact,
         txt04 LIKE tj30t-txt04,
       END OF ty_jest.

DATA: it_jesti  TYPE TABLE OF ty_jest,
      it_jest   TYPE HASHED TABLE OF ty_jest
                     WITH UNIQUE KEY objnr stat
                     WITH HEADER LINE.
*** MOD-004 * end ***

* begin of insert MOD-003
*DATA: BEGIN OF it_tj30t_temp OCCURS 0,
*        estat LIKE tj30t-estat,
*        txt30 LIKE tj30t-txt30,
*        txt04 LIKE tj30t-txt04,
*      END OF it_tj30t_temp.

TYPES: BEGIN OF ty_tj30t_temp,
         estat LIKE tj30t-estat,
         txt04 LIKE tj30t-txt04,
       END OF ty_tj30t_temp.

DATA: it_tj30t_temp TYPE STANDARD TABLE OF ty_tj30t_temp
                         WITH HEADER LINE,
      it_jest_ins   TYPE STANDARD TABLE OF jest_upd  WITH HEADER LINE,
      it_jest_upd   TYPE STANDARD TABLE OF jest_upd  WITH HEADER LINE,
      it_jsto_ins   TYPE STANDARD TABLE OF jsto      WITH HEADER LINE,
      it_jsto_upd   TYPE STANDARD TABLE OF jsto_upd  WITH HEADER LINE,
      it_obj_del    TYPE STANDARD TABLE OF onr00     WITH HEADER LINE.
* end of insert MOD-003

DATA: it_return1  LIKE ddshretval  OCCURS 0  WITH HEADER LINE,
      it_return2  LIKE ddshretval  OCCURS 0  WITH HEADER LINE.

DATA: wa_tj30        LIKE it_tj30t,
      wa_tj30t_temp  LIKE it_tj30t_temp,
      wa_jest        LIKE it_jest.

* begin of insert MOD-003
*FIELD-SYMBOLS :<fs-jest> LIKE it_jest.
* end of insert MOD-003

*>>>>> End of MoD-002 EXTUVE

*---------------------------------------------------------------------*
* VARIABLE DECLARATIONS                                               *
*---------------------------------------------------------------------*
DATA: g_gewrko          TYPE gewrk,           "old main workcenter
      gv_ppsido         TYPE ppsid,                         "MOD-004
      gv_mode           TYPE c   VALUE 'N',                 "MOD-004
      gv_objnr          LIKE jest-objnr,      "object number
      gv_bukrs          TYPE bukrs,
      gv_kokrs          TYPE kokrs,
      gv_textline(132)  TYPE c.
DATA: gv_warpl          TYPE warpl.                         "MOD-001
DATA: var1   TYPE string,                                   "MOD-002
      var2   TYPE string.                                   "MOD-002

*---------------------------------------------------------------------*
* CONSTANT DECLARATIONS                                               *
*---------------------------------------------------------------------*
CONSTANTS: c_blank(1)   TYPE c            VALUE ' ',
           c_i0068      LIKE jest-stat    VALUE 'I0068',   "status OSNO
           c_i0070      LIKE jest-stat    VALUE 'I0070',   "status NOPR
           c_datbi      TYPE sy-datum     VALUE '99991231',
           c_zsm5       TYPE auart        VALUE 'ZSM5',
           c_x(1)       TYPE c            VALUE 'X'.

CONSTANTS: c_zam00004   TYPE tj30t-stsma  VALUE 'ZAM00004'.  "MOD-003

*---------------------------------------------------------------------*
* PARAMETER DECLARATION
*---------------------------------------------------------------------*
* Sales Organisation
SELECTION-SCREEN: BEGIN OF BLOCK b1  WITH FRAME  TITLE text-001.
SELECTION-SCREEN: BEGIN OF BLOCK b1a.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31) text-sc1 FOR FIELD p_vkorg.
PARAMETERS: p_vkorg  LIKE mvke-vkorg  OBLIGATORY  MEMORY ID vko.
SELECTION-SCREEN COMMENT (2) g_blank1.
SELECTION-SCREEN COMMENT (30) g_ktext1.
SELECTION-SCREEN END OF LINE.

* Distribution Channel
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31) text-sc2 FOR FIELD p_vtweg.
PARAMETERS: p_vtweg  LIKE mvke-vtweg  OBLIGATORY  MEMORY ID vtw.
SELECTION-SCREEN COMMENT (4) g_blank2.
SELECTION-SCREEN COMMENT (30) g_ktext2.
SELECTION-SCREEN END OF LINE.

* Division
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31) text-sc3 FOR FIELD p_spart.
PARAMETERS: p_spart  LIKE mara-spart  OBLIGATORY  MEMORY ID spa.
SELECTION-SCREEN COMMENT (4) g_blank3.
SELECTION-SCREEN COMMENT (30) g_ktext3.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN END OF BLOCK b1a.

* Plant
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31) text-sc4 FOR FIELD p_werks.
PARAMETERS: p_werks  LIKE marc-werks  OBLIGATORY  MEMORY ID wrk.
SELECTION-SCREEN COMMENT (2) g_blank4.
SELECTION-SCREEN COMMENT (30) g_ktext4.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b1.

* Equipment
SELECTION-SCREEN: BEGIN OF BLOCK b2  WITH FRAME  TITLE text-002.
SELECT-OPTIONS: s_equnr  FOR equi-equnr  MATCHCODE OBJECT equi
                                         OBLIGATORY.        "MOD-004
SELECTION-SCREEN: END OF BLOCK b2.

* Main WorkCenter
SELECTION-SCREEN: BEGIN OF BLOCK b3  WITH FRAME  TITLE text-003.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_mwc  AS CHECKBOX  DEFAULT ' ' .
SELECTION-SCREEN COMMENT (23) text-sc5 FOR FIELD p_arbplf.
SELECTION-SCREEN COMMENT (5) text-scf.
PARAMETERS: p_arbplf  LIKE afvgd-arbpl.
SELECTION-SCREEN COMMENT (9) g_blank5.
SELECTION-SCREEN COMMENT (5) text-sc6.
PARAMETERS: p_arbplt  LIKE afvgd-arbpl.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b3.

*** MOD-004 * begin ***
* Workcenter for Fixed FSE - Visitour
SELECTION-SCREEN: BEGIN OF BLOCK b3a  WITH FRAME  TITLE text-010.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_vwc  AS CHECKBOX  DEFAULT ' ' .
SELECTION-SCREEN COMMENT (23) text-scn FOR FIELD p_arbpvf.
SELECTION-SCREEN COMMENT (5) text-sco.
PARAMETERS: p_arbpvf  LIKE afvgd-arbpl.
SELECTION-SCREEN COMMENT (9) g_blankc.
SELECTION-SCREEN COMMENT (5) text-scp.
PARAMETERS: p_arbpvt  LIKE afvgd-arbpl.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b3a.
*** MOD-004 * end ***

* Sales Office and Sales Group
SELECTION-SCREEN: BEGIN OF BLOCK b4  WITH FRAME  TITLE text-004.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_sosg  AS CHECKBOX  DEFAULT ' ' .
SELECTION-SCREEN COMMENT (23) text-sc7 FOR FIELD p_vkburf.
SELECTION-SCREEN COMMENT (5) text-scg.
PARAMETERS: p_vkburf  LIKE tvbur-vkbur.
SELECTION-SCREEN COMMENT (13) g_blank6.
SELECTION-SCREEN COMMENT (5) text-sc8.
PARAMETERS: p_vkburt  LIKE tvbur-vkbur.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (25) text-sc9 FOR FIELD p_vkgrpf.
SELECTION-SCREEN COMMENT (5) text-sch.
PARAMETERS: p_vkgrpf  LIKE tvkgr-vkgrp.
SELECTION-SCREEN COMMENT (14) g_blank7.
SELECTION-SCREEN COMMENT (5) text-sca.
PARAMETERS: p_vkgrpt  LIKE tvkgr-vkgrp.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b4.

* Planner Group
SELECTION-SCREEN: BEGIN OF BLOCK b5  WITH FRAME  TITLE text-005.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_pg  AS CHECKBOX  DEFAULT ' ' .
SELECTION-SCREEN COMMENT (23) text-scb FOR FIELD p_ingrpf.
SELECTION-SCREEN COMMENT (5) text-sci.
PARAMETERS: p_ingrpf  LIKE t024i-ingrp.
SELECTION-SCREEN COMMENT (14) g_blank8.
SELECTION-SCREEN COMMENT (5) text-scc.
PARAMETERS: p_ingrpt  LIKE t024i-ingrp.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b5.

* Costcenter
SELECTION-SCREEN: BEGIN OF BLOCK b6  WITH FRAME  TITLE text-006.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_cc  AS CHECKBOX  DEFAULT ' ' .
SELECTION-SCREEN COMMENT (23) text-scd FOR FIELD p_kostlf.
SELECTION-SCREEN COMMENT (5) text-scj.
PARAMETERS: p_kostlf  LIKE itob-kostl.
SELECTION-SCREEN COMMENT (7) g_blank9.
SELECTION-SCREEN COMMENT (5) text-sce.
PARAMETERS: p_kostlt  LIKE itob-kostl.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b6.

* begin of insertion MOD-001
* Sort Field
SELECTION-SCREEN: BEGIN OF BLOCK b7  WITH FRAME  TITLE text-007.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_sf  AS CHECKBOX  DEFAULT ' ' .
SELECTION-SCREEN COMMENT (23) text-sck FOR FIELD p_eqfnrf.
SELECTION-SCREEN COMMENT (5) text-scl.
PARAMETERS: p_eqfnrf  LIKE rmipm-plan_sort.
SELECTION-SCREEN COMMENT (7) g_blanka.
SELECTION-SCREEN COMMENT (5) text-scm.
PARAMETERS: p_eqfnrt  LIKE rmipm-plan_sort.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b7.
* end of insertion MOD-001

* begin of insertion MOD-002
* User Status
SELECTION-SCREEN: BEGIN OF BLOCK b8  WITH FRAME  TITLE text-009.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_us  AS CHECKBOX  DEFAULT ' ' .
*** MOD-004 * begin ***
*SELECTION-SCREEN COMMENT (23) text-sus FOR FIELD p_estato.
*SELECTION-SCREEN COMMENT (5) text-scl.
*PARAMETERS: p_estato LIKE it_tj30t-txt04.
*SELECTION-SCREEN COMMENT (7) g_blankb.
*SELECTION-SCREEN COMMENT (5) text-scm.
*PARAMETERS: p_estatn  LIKE it_tj30t-txt04.
*** MOD-004 * end ***
SELECTION-SCREEN COMMENT (23) text-sus.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (30) text-s03.
SELECTION-SCREEN POSITION POS_LOW.
PARAMETERS: rb_sel1 RADIOBUTTON GROUP sel  DEFAULT 'X'.
*** MOD-004 * begin ***
SELECTION-SCREEN COMMENT (7) g_blankb.
SELECTION-SCREEN COMMENT (5) text-scm.
PARAMETERS: p_estatn  LIKE it_tj30t-txt04.
*** MOD-004 * end ***
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (30) text-s04.
SELECTION-SCREEN POSITION POS_LOW.
PARAMETERS: rb_sel2 RADIOBUTTON GROUP sel.
*** MOD-004 * begin ***
SELECTION-SCREEN COMMENT (7) g_blankd.
SELECTION-SCREEN COMMENT (5) text-scl.
PARAMETERS: p_estato LIKE it_tj30t-txt04.
*** MOD-004 * end ***
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN: END OF BLOCK b8.
* end of insertion MOD-002

SELECTION-SCREEN : BEGIN OF BLOCK b9 WITH FRAME TITLE text-008.
PARAMETERS: p_updoo  AS CHECKBOX  DEFAULT ' ',
            p_updno  AS CHECKBOX  DEFAULT ' ',
            p_updmp  AS CHECKBOX  DEFAULT ' ',
            p_updeq  AS CHECKBOX  DEFAULT ' ',
            p_updfl  AS CHECKBOX  DEFAULT ' ',
            p_updco  AS CHECKBOX  DEFAULT ' '.
SELECTION-SCREEN: END OF BLOCK b9.

* Begin of MOD-006
SELECTION-SCREEN : BEGIN OF BLOCK b10 WITH FRAME TITLE text-011.
PARAMETERS: p_dlfl  AS CHECKBOX  DEFAULT ' ',
            p_inac  AS CHECKBOX  DEFAULT ' '.
SELECTION-SCREEN: END OF BLOCK b10.
* End of MOD-006
*---------------------------------------------------------------------*
*--- AT selection-screen on block b1a: Sales Area
*---------------------------------------------------------------------*
AT SELECTION-SCREEN ON BLOCK b1a.

  DATA: lt_tvkot  LIKE tvkot,
        lt_tvko   LIKE tvko,
        lt_tvtwt  LIKE tvtwt,
        lt_tspat  LIKE tspat,
        lt_tvkbt  LIKE tvkbt,
        lt_tvgrt  LIKE tvgrt.

  CLEAR: lt_tvkot, lt_tvtwt, lt_tspat, lt_tvkbt, lt_tvgrt.

* Check sales organization
  CALL FUNCTION 'ITOB_CHECK_SALES_ORGANIZATION'
    EXPORTING
      vkorg                   = p_vkorg
*      LANGU                   = SY-LANGU
*      USE_BUF                 = 'X'
*      DIALOG_MODE             = 'X'
      dialog_cursor           = 'P_VKORG'
*      DIALOG_STEPL            = 0
*      INIT_MESSAGE_DATA       = 'X'
*      X_MESS_TYPE             = 'E'
*      READ_TEXT_TABLES        = 'X'
    IMPORTING
      tvko_exp                = lt_tvko
      tvkot_exp               = lt_tvkot
    EXCEPTIONS
      empty_key               = 1
      application_error       = 2
      OTHERS                  = 3.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE lt_tvkot-vtext TO g_ktext1.
  MOVE lt_tvko-bukrs  TO gv_bukrs.

* Check distribution channel
  CALL FUNCTION 'ITOB_CHECK_SALES_CHANNEL'
    EXPORTING
      vtweg                   = p_vtweg
*     LANGU                   = SY-LANGU
*     USE_BUF                 = 'X'
*     DIALOG_MODE             = 'X'
      dialog_cursor           = 'P_VTWEG'
*      DIALOG_STEPL            = 0
*      INIT_MESSAGE_DATA       = 'X'
*      X_MESS_TYPE             = 'E'
*      READ_TEXT_TABLES        = 'X'
    IMPORTING
*      TVTW_EXP                =
      tvtwt_exp               = lt_tvtwt
    EXCEPTIONS
      empty_key               = 1
      application_error       = 2
      OTHERS                  = 3.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE lt_tvtwt-vtext TO g_ktext2.

* Check division
  CALL FUNCTION 'ITOB_CHECK_SALES_DIVISION'
    EXPORTING
      spart                   = p_spart
*      LANGU                   = SY-LANGU
*      USE_BUF                 = 'X'
*      DIALOG_MODE             = 'X'
      dialog_cursor           = 'P_SPART'
*      DIALOG_STEPL            = 0
*      INIT_MESSAGE_DATA       = 'X'
*      X_MESS_TYPE             = 'E'
*      READ_TEXT_TABLES        = 'X'
    IMPORTING
*      TSPA_EXP                =
      tspat_exp               = lt_tspat
    EXCEPTIONS
      empty_key               = 1
      application_error       = 2
      OTHERS                  = 3.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE lt_tspat-vtext TO g_ktext3.

* Authority check
  AUTHORITY-CHECK OBJECT 'V_VBAK_VKO'
                  ID 'VKORG' FIELD p_vkorg
                  ID 'VTWEG' FIELD p_vtweg
                  ID 'SPART' FIELD p_spart
                  ID 'ACTVT' FIELD '01'.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e01 p_vkorg.
  ENDIF.

* Check Sales area
  CALL FUNCTION 'ITOB_CHECK_SALES_AREA'
    EXPORTING
      vkorg             = p_vkorg
      vtweg             = p_vtweg
      spart             = p_spart
    EXCEPTIONS
      empty_key         = 1
      application_error = 2
      OTHERS            = 3.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
          WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

*-----------------------------------------------------------------*
* Plant
AT SELECTION-SCREEN ON p_werks.

  SELECT SINGLE name1 INTO g_ktext4
         FROM t001w
         WHERE werks = p_werks.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e08.
  ENDIF.

* Authority check
  AUTHORITY-CHECK OBJECT 'I_IWERK'
                  ID 'TCD'   FIELD sy-tcode
                  ID 'IWERK' FIELD p_werks.

  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e06 p_werks.
  ENDIF.

*-----------------------------------------------------------------*
* Main Workcenter
AT SELECTION-SCREEN ON BLOCK b3.

  IF p_mwc = 'X'.
    CLEAR: g_gewrko.
*   Workcenter from
* begin of change MOD-001
*    IF NOT p_arbplt IS INITIAL.
    IF NOT p_arbplf IS INITIAL.
* end of change MOD-001
      SELECT SINGLE * FROM crhd
             WHERE werks = p_werks
               AND arbpl = p_arbplf.
      IF sy-subrc <> 0.
        MESSAGE e001(00) WITH text-e10 p_werks.
      ELSE.
        MOVE crhd-objid TO g_gewrko.
      ENDIF.
    ENDIF.
*   Workcenter to
    IF p_arbplt IS INITIAL.
      MESSAGE e001(00) WITH text-e09.
    ELSE.
      SELECT SINGLE * FROM crhd
             WHERE werks = p_werks
               AND arbpl = p_arbplt.
      IF sy-subrc <> 0.
        MESSAGE e001(00) WITH text-e11 p_werks.
      ENDIF.
    ENDIF.
*   Workcenter from and to cannot be the same
    IF p_arbplf = p_arbplt.
      MESSAGE e001(00) WITH text-e12.
    ENDIF.
  ENDIF.

*** MOD-004 * begin ***
*-----------------------------------------------------------------*
* Workcenter for Fixed FSE - Visitour
AT SELECTION-SCREEN ON BLOCK b3a.

  IF p_vwc = 'X'.
    CLEAR: gv_ppsido.
*   Workcenter from
    IF NOT p_arbpvf IS INITIAL.
      SELECT SINGLE * FROM crhd
             WHERE werks = p_werks
               AND arbpl = p_arbpvf.
      IF sy-subrc <> 0.
        MESSAGE e001(00) WITH text-e10 p_werks.
      ELSE.
        MOVE crhd-objid TO gv_ppsido.
      ENDIF.
    ENDIF.
*   Workcenter to
    IF p_arbpvt IS INITIAL.
      MESSAGE e001(00) WITH text-e09.
    ELSE.
      SELECT SINGLE * FROM crhd
             WHERE werks = p_werks
               AND arbpl = p_arbpvt.
      IF sy-subrc <> 0.
        MESSAGE e001(00) WITH text-e11 p_werks.
      ENDIF.
    ENDIF.
*   Workcenter from and to cannot be the same
    IF p_arbpvf = p_arbpvt.
      MESSAGE e001(00) WITH text-e12.
    ENDIF.
  ENDIF.
*** MOD-004 * end ***

*-----------------------------------------------------------------*
* Sales office - Sales group
AT SELECTION-SCREEN ON BLOCK b4.

  IF p_sosg = 'X'.
    SELECT SINGLE * FROM tvbvk
           WHERE vkbur = p_vkburt
             AND vkgrp = p_vkgrpt.
    IF sy-subrc <> 0.
      MESSAGE e001(00) WITH text-e13.
    ENDIF.
  ENDIF.

*-----------------------------------------------------------------*
* Plant - Planner group
AT SELECTION-SCREEN ON BLOCK b5.

  IF p_pg = 'X'.
    SELECT SINGLE * FROM t024i
           WHERE iwerk = p_werks
             AND ingrp = p_ingrpt.
    IF sy-subrc <> 0.
      MESSAGE e001(00) WITH text-e14 p_werks.
    ENDIF.
  ENDIF.

*-----------------------------------------------------------------*
* CostCenter
AT SELECTION-SCREEN ON BLOCK b6.

  IF p_cc = 'X'.
*   First get the controlling area from the company code
    CALL FUNCTION 'COPA_ERKRS_FIND'
      EXPORTING
        bukrs              = gv_bukrs
        gsber              = ' '
        kokrs              = ' '
      IMPORTING
*        ERKRS              =
        kokrs              = gv_kokrs
      EXCEPTIONS
        error_kokrs_find   = 1
        kokrs_wrong        = 2
        no_erkrs_defined   = 3
        no_erkrs_for_kokrs = 4
        OTHERS             = 5.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.

*   Then check costcenter for controlling area
    SELECT SINGLE * FROM csks
           WHERE kokrs = gv_kokrs
             AND kostl = p_kostlt
             AND datbi = c_datbi.
    IF sy-subrc <> 0.
      MESSAGE e001(00) WITH text-e15 gv_kokrs.
    ENDIF.
  ENDIF.

*>>>> Start of insert EXTUVE MOD-003
*-----------------------------------------------------------------*
* Select values for User Status (Old)
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_estato.

  REFRESH : it_return1 .

  SELECT txt30 txt04 INTO TABLE it_tj30t
         FROM tj30t
         WHERE stsma = 'ZAM00004'
           AND spras = sy-langu.

  IF sy-subrc = 0.
    SORT it_tj30t BY txt04.
    CALL FUNCTION 'F4IF_INT_TABLE_VALUE_REQUEST'
      EXPORTING
        retfield        = 'P_ESTATO'
        value_org       = 'S'
      TABLES
        value_tab       = it_tj30t
        return_tab      = it_return1
      EXCEPTIONS
        parameter_error = 1
        no_values_found = 2
        OTHERS          = 3.
    IF sy-subrc = 0.
      p_estato =  it_return1-fieldval.
    ELSE.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ENDIF.
*
*-----------------------------------------------------------------*
* Select values for User Status (New)
AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_estatn.

  REFRESH : it_return2 .

  SELECT txt30 txt04 INTO TABLE it_tj30t
         FROM tj30t
         WHERE stsma = 'ZAM00004'
           AND spras = sy-langu.

  IF sy-subrc = 0.
    SORT it_tj30t BY txt04.
    CALL FUNCTION 'F4IF_INT_TABLE_VALUE_REQUEST'
      EXPORTING
        retfield        = 'P_ESTATN'
        value_org       = 'S'
      TABLES
        value_tab       = it_tj30t
        return_tab      = it_return2
      EXCEPTIONS
        parameter_error = 1
        no_values_found = 2
        OTHERS          = 3.
    IF sy-subrc = 0.
      p_estatn =  it_return2-fieldval.
    ELSE.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ENDIF.

*-----------------------------------------------------------------*
* User Status
AT SELECTION-SCREEN ON BLOCK b8.

  IF p_us = 'X' AND rb_sel1 = c_x.
*** MOD-004 * begin ***
**   Check the user status
*    SELECT SINGLE * FROM tj30t
*           WHERE txt04 = p_estato.
*    IF sy-subrc <> 0.
*      MESSAGE e001(00) WITH text-e19 p_estato.
*    ENDIF.
*** MOD-004 * end ***
*   Check the user status to be added
    SELECT SINGLE * FROM tj30t
           WHERE txt04 = p_estatn.
    IF sy-subrc <> 0.
      MESSAGE e001(00) WITH text-e19 p_estatn.
    ENDIF.
*
  ELSEIF p_us = 'X' AND rb_sel2 = c_x.
*** MOD-004 * begin ***
*   Check the user status to be removed
    SELECT SINGLE * FROM tj30t
           WHERE txt04 = p_estato.
    IF sy-subrc <> 0.
      MESSAGE e001(00) WITH text-e19 p_estato.
    ENDIF.
*    IF p_estatn IS NOT INITIAL.
*      MESSAGE e001(00) WITH text-e21 p_estatn.
*    ENDIF.
*** MOD-004 * end ***
  ENDIF.

*>>>> End of insert EXTUVE MOD-003


*--------- S T A R T   O F   M A I N   P R O C E S S I N G -----------*

*---------------------------------------------------------------------*
* Initialization                                                      *
*---------------------------------------------------------------------*
INITIALIZATION.


*---------------------------------------------------------------------*
* START-OF-SELECTION                                                  *
*---------------------------------------------------------------------*
START-OF-SELECTION.

* Test equipment must be filled
  IF  s_equnr IS INITIAL .
    MESSAGE s001(00) WITH text-e00  .
    EXIT.
  ENDIF.

* At least 1 field change must be filled in
  IF p_mwc  IS INITIAL  AND
     p_vwc  IS INITIAL  AND                                 "MOD-004
     p_sosg IS INITIAL  AND
     p_pg   IS INITIAL  AND
     p_cc   IS INITIAL  AND
     p_sf   IS INITIAL  AND                                 "MOD-001
     p_us   IS INITIAL.                                     "MOD-002
    MESSAGE s001(00) WITH text-e02  .
    EXIT.
  ENDIF.

* At least 1 item must be filled in in the table changes
  IF p_updoo IS INITIAL  AND
     p_updno IS INITIAL  AND
     p_updmp IS INITIAL  AND
     p_updeq IS INITIAL  AND
     p_updfl IS INITIAL  AND
     p_updco IS INITIAL.
    MESSAGE s001(00) WITH text-e03  .
    EXIT.
  ENDIF.

* Update Service Orders
* Only for workcenters, planner group and costcenter
  IF ( p_mwc = 'X' OR p_pg = 'X' OR p_cc = 'X' ).
    IF p_updoo = c_x.
*     Get the open orders
      REFRESH gt_ord.
      PERFORM select_orders.
*     Update the open orders
      IF NOT gt_ord[] IS INITIAL.
        PERFORM update_orders.
      ENDIF.
    ENDIF.
  ENDIF.

* Update Notifications
  IF p_updno = c_x.
*   Get the notifications
    REFRESH gt_not.
    PERFORM select_notifs.
*   Update the open notifications
    IF NOT gt_not[] IS INITIAL.
      PERFORM update_notifs.
    ENDIF.
  ENDIF.

* Maintenance Plans
* Only for workcenter, planner group and sortfield
* begin of change MOD-001
*  IF ( p_mwc = 'X' OR p_pg = 'X' ).
  IF ( p_mwc = 'X' OR p_pg = 'X' OR p_sf = 'X' ).
* end of change MOD-001
    IF p_updmp = c_x.
*     Get the maintenance plans
      REFRESH gt_mpl.
      PERFORM select_maintpl.
*     Update the open maintenance plans
      IF NOT gt_mpl[] IS INITIAL.
* begin of insertion MOD-001
        IF ( p_mwc = 'X' OR p_pg = 'X' ).
          PERFORM update_maintpl.
* begin of insertion MOD-001
        ENDIF.
        IF p_sf = c_x.
          PERFORM update_sortfield.
        ENDIF.
* end of insertion MOD-001
      ENDIF.
    ENDIF.
  ENDIF.

* Equipments
  IF p_updeq = c_x.
*   Get the equipments
    REFRESH gt_equ.
    PERFORM select_equipm.
*   Update the equipments
    IF NOT gt_equ[] IS INITIAL.
      PERFORM update_equipm.
    ENDIF.
  ENDIF.

* Functional Locations
  IF p_updfl = c_x.
*   Get the functional locations
    REFRESH gt_flo.
    PERFORM select_funcloc.
*   Update functional locations
    IF NOT gt_flo[] IS INITIAL.
      PERFORM update_funcloc.
    ENDIF.
  ENDIF.

* Contracts
* Only for sales office/sales group
  IF p_sosg = 'X'.
    IF p_updco = c_x.
*     Get the contracts
      REFRESH gt_con.
      PERFORM select_contracts.
*     Update the contracts
      IF NOT gt_con[] IS INITIAL.
        PERFORM update_contracts.
      ENDIF.
    ENDIF.
  ENDIF.


*----------------------------------------------------------------------*
* END-OF-SELECTION                                                     *
*----------------------------------------------------------------------*
END-OF-SELECTION.


*---------- S U B R O U T I N E S -------------------------------------*

*&---------------------------------------------------------------------*
*&      Form  select_orders
*&---------------------------------------------------------------------*
FORM select_orders.

* Select all open orders for this plant/old workcenter + equipments
* not orders of type ZSM5
  SELECT a~aufnr a~kostv a~kostl b~gewrk b~ingpr b~qmnum
         INTO CORRESPONDING FIELDS OF TABLE gt_ord
         FROM aufk AS a
         INNER JOIN afih AS b
                    ON a~aufnr = b~aufnr
         WHERE a~phas3 =  c_blank
           AND a~werks =  p_werks
           AND b~equnr IN s_equnr
           AND a~auart NE c_zsm5.

* Old workcenter filled in --> check internal table
  IF NOT p_arbplf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_ord.
*      IF gt_ord-gewrk <> g_gewrko.
*        DELETE gt_ord.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_ord WHERE gewrk <> g_gewrko.
*** MOD-004 * end ***
  ENDIF.

* If the old planner group is filled in --> check internal table
  IF NOT p_ingrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_ord.
*      IF gt_ord-ingpr <> p_ingrpf.
*        DELETE gt_ord.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_ord WHERE ingpr <> p_ingrpf.
*** MOD-004 * end ***
  ENDIF.

* If the old costcenter is filled in --> check internal table
  IF NOT p_kostlf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_ord.
*      IF gt_ord-kostv <> p_kostlf OR
*         gt_ord-kostl <> p_kostlf.
*        DELETE gt_ord.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_ord WHERE kostv <> p_kostlf
                     OR kostl <> p_kostlf.
*** MOD-004 * end ***
  ENDIF.

* Sort
  SORT gt_ord.
* Delete duplicate records
  DELETE ADJACENT DUPLICATES FROM gt_ord.

ENDFORM.                    "select_orders

*&---------------------------------------------------------------------*
*&      Form  update_orders
*&---------------------------------------------------------------------*
FORM update_orders.

  LOOP AT gt_ord.

    REFRESH l_i_bdcdata.

*   Screen get order
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLCOIH'  '0101'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '/00'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*            USING    ''  ''  ''  'BDC_CURSOR'  'CAUFVD-AUFNR'
*            CHANGING l_struct_bdcdata.
*    APPEND l_struct_bdcdata  TO l_i_bdcdata.
*    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'CAUFVD-AUFNR'  gt_ord-aufnr
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Headerdata
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLCOIH'  '3000'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=IHKD'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Planner group
    IF p_pg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'CAUFVD-INGPR'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'CAUFVD-INGPR'  p_ingrpt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Workcenter (2 times)
    IF p_mwc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'CAUFVD-VAPLZ'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'CAUFVD-VAPLZ'  p_arbplt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'AFVGD-ARBPL'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'AFVGD-ARBPL'  p_arbplt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Additional data
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLCOIH'  '3000'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=ILOA'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Costcenter
    IF p_cc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'CAUFVD-KOSTV'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'CAUFVD-KOSTV'  p_kostlt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Location
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLCOIH'  '3000'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Costcenter
    IF p_cc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ILOA-KOSTL'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'ILOA-KOSTL'  p_kostlt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Call transaction IW32
    IF NOT l_i_bdcdata[] IS INITIAL.
      CALL TRANSACTION 'IW32' USING l_i_bdcdata
                              MODE gv_mode  UPDATE 'S'.
      IF sy-subrc NE 0 .
*       Populate Status table with Call Transaction failed
        WRITE: /'Order ', gt_ord-aufnr, ' not updated.'.
      ELSE.
*       Logging of changes
        WRITE: / 'Order ', gt_ord-aufnr, ' updated.'.
        IF p_mwc = 'X'.
          WRITE: / 'Workcenter from ', p_arbplf, ' to ', p_arbplt.
        ENDIF.
        IF p_pg = 'X'.
          WRITE: / 'Planner group from ', p_ingrpf, ' to ', p_ingrpt.
        ENDIF.
        IF p_cc = 'X'.
          WRITE: / 'Costcenter from ', p_kostlf, ' to ', p_kostlt.
        ENDIF.
        WRITE: /.
        IF NOT gt_ord-qmnum IS INITIAL.
*         Update corresponding notification
          REFRESH gt_not.
          MOVE gt_ord-qmnum TO gt_not-qmnum.
          APPEND gt_not.
          PERFORM update_notifs.
        ENDIF.
      ENDIF.
    ENDIF.

  ENDLOOP.

ENDFORM.                    "update_orders

*&---------------------------------------------------------------------*
*&      Form  select_notifications
*&---------------------------------------------------------------------*
FORM select_notifs.

  SELECT qmnum vkbur vkgrp arbpl ingrp kostl
         INTO CORRESPONDING FIELDS OF TABLE gt_not FROM viqmel
         WHERE vkorg =  p_vkorg
           AND vtweg =  p_vtweg
           AND spart =  p_spart
           AND iwerk =  p_werks
           AND equnr IN s_equnr.

* Old workcenter filled in --> check internal table
  IF NOT p_arbplf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_not.
*      IF gt_not-arbpl <> g_gewrko.
*        DELETE gt_not.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_not WHERE arbpl <> g_gewrko.
*** MOD-004 * end ***
  ENDIF.

* Old sales office filled in --> check internal table
  IF NOT p_vkburf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_not.
*      IF gt_not-vkbur <> p_vkburf.
*        DELETE gt_not.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_not WHERE vkbur <> p_vkburf.
*** MOD-004 * end ***
  ENDIF.

* Old sales group filled in --> check internal table
  IF NOT p_vkgrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_not.
*      IF gt_not-vkgrp <> p_vkgrpf.
*        DELETE gt_not.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_not WHERE vkgrp <> p_vkgrpf.
*** MOD-004 * end ***
  ENDIF.

* Old planner group filled in --> check internal table
  IF NOT p_ingrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_not.
*      IF gt_not-ingrp <> p_ingrpf.
*        DELETE gt_not.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_not WHERE ingrp <> p_ingrpf.
*** MOD-004 * end ***
  ENDIF.

* Old costcenter filled in --> check internal table
  IF NOT p_kostlf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_not.
*      IF gt_not-kostl <> p_kostlf.
*        DELETE gt_not.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_not WHERE kostl <> p_kostlf.
*** MOD-004 * end ***
  ENDIF.

* Status notification must be outstanding (OSNO) or (NOPR)
  LOOP AT gt_not.

    CONCATENATE 'QM' gt_not-qmnum INTO gv_objnr.

    CALL FUNCTION 'STATUS_CHECK'
      EXPORTING
        objnr             = gv_objnr
        status            = c_i0068
      EXCEPTIONS
        object_not_found  = 1
        status_not_active = 2
        OTHERS            = 3.

    IF sy-subrc NE 0.
      CONCATENATE 'QM' gt_not-qmnum INTO gv_objnr.

      CALL FUNCTION 'STATUS_CHECK'
        EXPORTING
          objnr             = gv_objnr
          status            = c_i0070
        EXCEPTIONS
          object_not_found  = 1
          status_not_active = 2
          OTHERS            = 3.
      IF sy-subrc NE 0.
        DELETE gt_not.
      ENDIF.
    ENDIF.

  ENDLOOP.

* Sort
  SORT gt_not.
* Delete duplicate records
  DELETE ADJACENT DUPLICATES FROM gt_not.

ENDFORM.                    "select_notifs

*&---------------------------------------------------------------------*
*&      Form  update_notifications
*&---------------------------------------------------------------------*
FORM update_notifs.

  LOOP AT gt_not.

    REFRESH l_i_bdcdata.

*   Screen get notification
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLIQS0'  '0100'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '/00'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*            USING    ''  ''  ''  'BDC_CURSOR'  'RIWO00-QMNUM'
*            CHANGING l_struct_bdcdata.
*    APPEND l_struct_bdcdata  TO l_i_bdcdata.
*    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'RIWO00-QMNUM'  gt_not-qmnum
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   General data
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLIQS0'  '7200'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=10\TAB06'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Workcenter
    IF p_mwc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'RIWO00-GEWRK'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'RIWO00-GEWRK'  p_arbplt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Planner group
    IF p_pg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'VIQMEL-INGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'VIQMEL-INGRP'  p_ingrpt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Sales office / Sales group
    IF p_sosg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'VIQMEL-VKBUR'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'VIQMEL-VKBUR'  p_vkburt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'VIQMEL-VKGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'VIQMEL-VKGRP'  p_vkgrpt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Location data
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLIQS0'  '7200'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=BUCH'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Costcenter
    IF p_cc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ILOA-KOSTL'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'ILOA-KOSTL'  p_kostlt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Call transaction IW52
    IF NOT l_i_bdcdata[] IS INITIAL.
      CALL TRANSACTION 'IW52' USING l_i_bdcdata
                              MODE gv_mode  UPDATE 'S' .
      IF sy-subrc NE 0 .
*       Populate Status table with Call Transaction failed
        WRITE: / 'Notification ', gt_not-qmnum, ' not updated.'.
      ELSE.
*       Logging of changes
        WRITE: / 'Notification ', gt_not-qmnum, ' updated.'.
        IF NOT gt_not-arbpl IS INITIAL.
          IF p_mwc = 'X'.
            WRITE: / ' Workcenter from ', p_arbplf, ' to ', p_arbplt.
          ENDIF.
          IF p_sosg = 'X'.
            WRITE: / ' Sales office from ', gt_not-vkbur,
                                    ' to ', p_vkburt.
            WRITE: / ' Sales group from ', gt_not-vkgrp,
                                   ' to ', p_vkgrpt.
          ENDIF.
          IF p_pg = 'X'.
            WRITE: / ' Planner group from ', gt_not-ingrp,
                                     ' to ', p_ingrpt.
          ENDIF.
          IF p_cc = 'X'.
            WRITE: / ' Costcenter from ', gt_not-kostl ,
                                  ' to ', p_kostlt.
          ENDIF.
        ENDIF.
        WRITE: /.
      ENDIF.
    ENDIF.

  ENDLOOP.

ENDFORM.                    "update_notifs

*&---------------------------------------------------------------------*
*&      Form  select_maintenance plans
*&---------------------------------------------------------------------*
FORM select_maintpl.

* Select all maintenance plans
  SELECT wapos mpi~warpl gewrk wpgrp
         mph~plan_sort                                      "MOD-004
         INTO CORRESPONDING FIELDS OF TABLE gt_mpl
         FROM vimpos AS mpi
         INNER JOIN mpla AS mph                             "MOD-004
                    ON mpi~warpl = mph~warpl                "MOD-004
         WHERE mpi~vkorg =  p_vkorg
           AND mpi~vtweg =  p_vtweg
           AND mpi~spart =  p_spart
           AND mpi~iwerk =  p_werks
           AND mpi~equnr IN s_equnr.

*** MOD-004 * begin ***
* Performance (see also SELECT above)
** begin of insert MOD-001 (add the sortfield)
*  LOOP AT gt_mpl.
*    CLEAR gv_plan_sort.
*    SELECT SINGLE plan_sort INTO gv_plan_sort
*           FROM mpla
*           WHERE warpl = gt_mpl-warpl.
*    IF sy-subrc = 0.
*      gt_mpl-eqfnr = gv_plan_sort.
*      MODIFY gt_mpl.
*    ENDIF.
*  ENDLOOP.
** end of insert MOD-001
*** MOD-004 * end ***

* Old workcenter filled in --> check internal table
  IF NOT p_arbplf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_mpl.
*      IF gt_mpl-gewrk <> g_gewrko.
*        DELETE gt_mpl.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_mpl WHERE gewrk <> g_gewrko.
*** MOD-004 * end ***
  ENDIF.

* Old planner group filled in --> check internal table
  IF NOT p_ingrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_mpl.
*      IF gt_mpl-wpgrp <> p_ingrpf.
*        DELETE gt_mpl.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_mpl WHERE wpgrp <> p_ingrpf.
*** MOD-004 * end ***
  ENDIF.

* begin of insertion MOD-001
* Old sort field filled in --> check internal table
  IF NOT p_eqfnrf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_mpl.
**      IF gt_mpl-eqfnr <> p_eqfnrf.                        "MOD-004
*      IF gt_mpl-plan_sort <> p_eqfnrf.                     "MOD-004
*        DELETE gt_mpl.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_mpl WHERE plan_sort <> p_eqfnrf.
*** MOD-004 * end ***
  ENDIF.
* end of insertion MOD-001

* Sort
  SORT gt_mpl.
* Delete  duplicate records
  DELETE ADJACENT DUPLICATES FROM gt_mpl.

ENDFORM.                    "select_maintpl

*&---------------------------------------------------------------------*
*&      Form  update_maintenance plans
*&---------------------------------------------------------------------*
FORM update_maintpl.

  LOOP AT gt_mpl.

    REFRESH l_i_bdcdata.

*   Screen select maintenance plan
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLIWP3'  '0203'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '/00'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*            USING    ''  ''  ''  'BDC_CURSOR'  'RMIPM-WAPOS'
*            CHANGING l_struct_bdcdata.
*    APPEND l_struct_bdcdata  TO l_i_bdcdata.
*    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'RMIPM-WAPOS'  gt_mpl-wapos
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Screen maintenance plan item
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPLIWP3'  '0201'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Planner group
    IF p_pg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'RMIPM-WPGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'RMIPM-WPGRP'  p_ingrpt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Workcenter
    IF p_mwc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'RMIPM-GEWERK'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'RMIPM-GEWERK'  p_arbplt
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Call transaction IP05
    IF NOT l_i_bdcdata[] IS INITIAL.
      CALL TRANSACTION 'IP05' USING l_i_bdcdata
                              MODE gv_mode  UPDATE 'S' .
      IF sy-subrc NE 0 .
**      Populate Status table with Call Transaction failed
        WRITE: / 'Maintenance plan item ', gt_mpl-wapos,
                ' not updated.'.
      ELSE.
**      Logging of changes
        WRITE: / 'Maintenance plan item ', gt_mpl-wapos,
                ' updated.'.
        IF p_mwc = 'X'.
          WRITE: / ' Workcenter from ', p_arbplf, ' to ', p_arbplt.
        ENDIF.
        IF p_pg = 'X'.
          WRITE: / ' Planner group from ', gt_mpl-wpgrp ,
                                   ' to ', p_ingrpt.
        ENDIF.
        WRITE: /.
      ENDIF.
    ENDIF.

  ENDLOOP.

ENDFORM.                    "update_maintpl

*&---------------------------------------------------------------------*
*&      Form  select_equipments
*&---------------------------------------------------------------------*
FORM select_equipm.

  SELECT equnr kostl vkbur vkgrp gewrk ingrp objnr
         ppsid                                              "MOD-004
         INTO CORRESPONDING FIELDS OF TABLE gt_equ
         FROM v_equi
         WHERE datbi =  c_datbi
           AND iwerk =  p_werks
           AND vkorg =  p_vkorg
           AND vtweg =  p_vtweg
           AND spart =  p_spart
           AND equnr IN s_equnr.

* begin of insert MOD-003

**>>>> Start of insert MOD-002  EXTUVE
*  IF p_us = c_x.
*    IF NOT gt_equ[] IS INITIAL .
*      SELECT objnr stat inact
*               INTO CORRESPONDING FIELDS OF TABLE it_jest
*                 FROM jest
*                   FOR ALL ENTRIES IN gt_equ
*                    WHERE objnr = gt_equ-objnr
*                      AND inact = space.
*      IF sy-subrc = 0.
*        SORT it_jest BY objnr.
*        DELETE ADJACENT DUPLICATES FROM it_jest COMPARING ALL FIELDS.
*      ENDIF.
*    ENDIF.
**
*    IF NOT it_jest[] IS INITIAL .
*      SELECT estat txt04 txt30
*               INTO CORRESPONDING FIELDS OF TABLE it_tj30t_temp
*                 FROM tj30t
*                   FOR ALL ENTRIES IN it_jest
*                    WHERE stsma = 'ZAM00004'
*                      AND estat = it_jest-stat
*                      AND spras = sy-langu.
*      IF sy-subrc = 0.
*        SORT it_tj30t_temp BY txt04.
*      ENDIF.
*    ENDIF.
**
*    LOOP AT it_jest ASSIGNING <fs-jest>.
*      CLEAR wa_tj30t_temp.
*      READ TABLE it_tj30t_temp INTO wa_tj30t_temp WITH KEY estat =
*                                                     <fs-jest>-stat.
*      IF sy-subrc = 0.
*        <fs-jest>-txt04 = wa_tj30t_temp-txt04.
*      ENDIF.
*    ENDLOOP.
*
** old user status filled in --> check internal table
*    IF NOT p_estato IS INITIAL.
*      LOOP AT it_jest.
*        IF it_jest-txt04 <> p_estato.
*          DELETE it_jest.
*        ENDIF.
*      ENDLOOP.
*    ENDIF.
**
*    LOOP AT gt_equ.
*      READ TABLE it_jest INTO wa_jest WITH KEY objnr = gt_equ-objnr.
*      IF sy-subrc <> 0.
*        DELETE gt_equ.
*      ENDIF.
*    ENDLOOP.
*    CLEAR : wa_jest.
*  ENDIF.
**
*  SELECT txt30 txt04  FROM tj30t INTO
*         TABLE it_tj30t WHERE stsma = 'ZAM00004'
*                         AND spras = sy-langu.
*  IF sy-subrc = 0.
*    SORT it_tj30t BY txt04.
*  ENDIF.
** New User Status Creation
*  CLEAR wa_tj30.
*  READ TABLE it_tj30t INTO wa_tj30 WITH KEY txt04 = p_estatn.
*  IF sy-subrc = 0.
*    CASE wa_tj30-txt04.
*      WHEN 'ZCC1'.
*        var1 = 'J_STMAINT-ANWSO(01)'.
*      WHEN 'ZCC2'.
*        var1 = 'J_STMAINT-ANWSO(02)'.
*      WHEN 'ZCC3'.
*        var1 = 'J_STMAINT-ANWSO(03)'.
*      WHEN 'ZCLO'.
*        var1 = 'J_STMAINT-ANWSO(04)'.
*      WHEN 'ZDMA'.
*        var1 = 'J_STMAINT-ANWSO(05)'.
*      WHEN 'ZEXP'.
*        var1 = 'J_STMAINT-ANWSO(06)'.
*      WHEN 'ZIMP'.
*        var1 = 'J_STMAINT-ANWSO(07)'.
*      WHEN 'ZIND'.
*        var1 = 'J_STMAINT-ANWSO(08)'.
*      WHEN 'ZNOC'.
*        var1 = 'J_STMAINT-ANWSO(09)'.
*      WHEN 'ZNOS'.
*        var1 = 'J_STMAINT-ANWSO(10)'.
*      WHEN 'ZNOW'.
*        var1 = 'J_STMAINT-ANWSO(11)'.
*      WHEN 'ZOEM'.
*        var1 = 'J_STMAINT-ANWSO(12)'.
*      WHEN 'ZOOO'.
*        var1 = 'J_STMAINT-ANWSO(13)'.
*      WHEN 'ZRCP'.
*        var1 = 'J_STMAINT-ANWSO(14)'.
*      WHEN 'ZREN'.
*        var1 = 'J_STMAINT-ANWSO(15)'.
*      WHEN 'ZSCR'.
*        var1 = 'J_STMAINT-ANWSO(16)'.
*      WHEN 'ZSHA'.
*        var1 = 'J_STMAINT-ANWSO(17)'.
*      WHEN 'ZSTO'.
*        var1 = 'J_STMAINT-ANWSO(18)'.
*      WHEN 'ZSTP'.
*        var1 = 'J_STMAINT-ANWSO(19)'.
*      WHEN 'ZTEM'.
*        var1 = 'J_STMAINT-ANWSO(19)'.
*      WHEN 'ZUNK'.
*        var1 = 'J_STMAINT-ANWSO(20)'.
*      WHEN 'ZWWC'.
*        var1 = 'J_STMAINT-ANWSO(21)'.
*    ENDCASE.
*  ENDIF.
** OLD User Status Removal
*  CLEAR wa_tj30.
*  READ TABLE it_tj30t INTO wa_tj30 WITH KEY txt04 = p_estato.
*  IF sy-subrc = 0.
*    CASE wa_tj30-txt04.
*      WHEN 'ZCC1'.
*        var2 = 'J_STMAINT-ANWSO(01)'.
*      WHEN 'ZCC2'.
*        var2 = 'J_STMAINT-ANWSO(02)'.
*      WHEN 'ZCC3'.
*        var2 = 'J_STMAINT-ANWSO(03)'.
*      WHEN 'ZCLO'.
*        var2 = 'J_STMAINT-ANWSO(04)'.
*      WHEN 'ZDMA'.
*        var2 = 'J_STMAINT-ANWSO(05)'.
*      WHEN 'ZEXP'.
*        var2 = 'J_STMAINT-ANWSO(06)'.
*      WHEN 'ZIMP'.
*        var2 = 'J_STMAINT-ANWSO(07)'.
*      WHEN 'ZIND'.
*        var2 = 'J_STMAINT-ANWSO(08)'.
*      WHEN 'ZNOC'.
*        var2 = 'J_STMAINT-ANWSO(09)'.
*      WHEN 'ZNOS'.
*        var2 = 'J_STMAINT-ANWSO(10)'.
*      WHEN 'ZNOW'.
*        var2 = 'J_STMAINT-ANWSO(11)'.
*      WHEN 'ZOEM'.
*        var2 = 'J_STMAINT-ANWSO(12)'.
*      WHEN 'ZOOO'.
*        var2 = 'J_STMAINT-ANWSO(13)'.
*      WHEN 'ZRCP'.
*        var2 = 'J_STMAINT-ANWSO(14)'.
*      WHEN 'ZREN'.
*        var2 = 'J_STMAINT-ANWSO(15)'.
*      WHEN 'ZSCR'.
*        var2 = 'J_STMAINT-ANWSO(16)'.
*      WHEN 'ZSHA'.
*        var2 = 'J_STMAINT-ANWSO(17)'.
*      WHEN 'ZSTO'.
*        var2 = 'J_STMAINT-ANWSO(18)'.
*      WHEN 'ZSTP'.
*        var2 = 'J_STMAINT-ANWSO(19)'.
*      WHEN 'ZTEM'.
*        var2 = 'J_STMAINT-ANWSO(19)'.
*      WHEN 'ZUNK'.
*        var2 = 'J_STMAINT-ANWSO(20)'.
*      WHEN 'ZWWC'.
*        var2 = 'J_STMAINT-ANWSO(21)'.
*    ENDCASE.
*  ENDIF.
*
**>>>> End   of insert MOD-002  EXTUVE
if p_dlfl = c_x OR p_inac  = c_x.                         " MOD-006

ELSE.                                                     " MOD-006
  IF p_us = c_x.
    IF NOT gt_equ[] IS INITIAL .
      SELECT objnr stat inact
             INTO CORRESPONDING FIELDS OF TABLE it_jesti
             FROM jest
             FOR ALL ENTRIES IN gt_equ
             WHERE objnr = gt_equ-objnr.
*               AND inact = space.
*      IF sy-subrc = 0.                                     "MOD-004
      SORT it_jesti
           BY objnr stat.                                   "MOD-004
      DELETE ADJACENT DUPLICATES FROM it_jesti
             COMPARING objnr stat.                          "MOD-004
      it_jest[] = it_jesti[].                               "MOD-004
      FREE it_jesti.                                        "MOD-004
*      ENDIF.                                               "MOD-004
    ENDIF.

*    IF NOT it_jest[] IS INITIAL .
    SELECT estat txt04
           INTO TABLE it_tj30t_temp
           FROM tj30t
*           FOR ALL ENTRIES IN it_jest
           WHERE stsma = c_zam00004
*             AND estat = it_jest-stat
             AND spras = sy-langu.
    IF sy-subrc = 0.
      SORT it_tj30t_temp BY txt04.
    ENDIF.
*    ENDIF.

  ENDIF.

* End of insert MOD-003

* Old main workcenter filled in --> check internal table
  IF NOT p_arbplf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_equ.
*      IF gt_equ-gewrk <> g_gewrko.
*        DELETE gt_equ.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_equ WHERE gewrk <> g_gewrko.
*** MOD-004 * end ***
  ENDIF.

*** MOD-004 * begin ***
* Old Visitour workcenter filled in --> check internal table
  IF NOT p_arbpvf IS INITIAL.
    DELETE gt_equ WHERE ppsid <> gv_ppsido.
  ENDIF.
*** MOD-004 * end ***

* Old costcenter filled in --> check internal table
  IF NOT p_kostlf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_equ.
*      IF gt_equ-kostl <> p_kostlf.
*        DELETE gt_equ.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_equ WHERE kostl <> p_kostlf.
*** MOD-004 * end ***
  ENDIF.

* Old planner group filled in --> check internal table
  IF NOT p_ingrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_equ.
*      IF gt_equ-ingrp <> p_ingrpf.
*        DELETE gt_equ.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_equ WHERE ingrp <> p_ingrpf.
*** MOD-004 * end ***
  ENDIF.

* Old sales office filled in --> check internal table
  IF NOT p_vkburf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_equ.
*      IF gt_equ-vkbur <> p_vkburf.
*        DELETE gt_equ.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_equ WHERE vkbur <> p_vkburf.
*** MOD-004 * end ***
  ENDIF.

* Old sales group filled in --> check internal table
  IF NOT p_vkgrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_equ.
*      IF gt_equ-vkgrp <> p_vkgrpf.
*        DELETE gt_equ.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_equ WHERE vkgrp <> p_vkgrpf.
*** MOD-004 * end ***
  ENDIF.

* Sort
  SORT gt_equ.
* Delete  duplicate records
  DELETE ADJACENT DUPLICATES FROM gt_equ.
 ENDIF.                                         " MOD-006
ENDFORM.                    "select_equipm
*&---------------------------------------------------------------------*
*&      Form  update_equipments
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM update_equipm.

  LOOP AT gt_equ.

*** MOD-004 * begin ***
    IF NOT p_mwc  IS INITIAL  OR
       NOT p_vwc  IS INITIAL  OR
       NOT p_sosg IS INITIAL  OR
       NOT p_pg   IS INITIAL  OR
       NOT p_cc   IS INITIAL.
*** MOD-004 * end ***

      REFRESH l_i_bdcdata.

*     Screen select equipment
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    'SAPMIEQ0'  '0100'  'X'  ''  ''
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '/00'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*            USING    ''  ''  ''  'BDC_CURSOR'  'RM63E-EQUNR'
*            CHANGING l_struct_bdcdata.
*    APPEND l_struct_bdcdata  TO l_i_bdcdata.
*    CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'RM63E-EQUNR'  gt_equ-equnr
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    'SAPMIEQ0'  '0101'  'X'  ''  ''
               CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*** MOD-004 * begin ***
*     Workcenter for Fixed FSE - Visitour
      IF p_vwc = 'X'.
*       Location
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'BDC_OKCODE'  '=T\02'
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    'SAPMIEQ0'  '0101'  'X'  ''  ''
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'ITOBATTR-ARBPL'  p_arbpvt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.
      ENDIF.
*** MOD-004 * end ***

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '=T\03'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*     Organization
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    'SAPMIEQ0'  '0101'  'X'  ''  ''
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '=T\06'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*     Costcenter
      IF p_cc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-KOSTL'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'ITOB-KOSTL'  p_kostlt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.
      ENDIF.

*     Planner group
      IF p_pg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-INGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'ITOB-INGRP'  p_ingrpt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.
      ENDIF.

*     Main workcenter
      IF p_mwc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOBATTR-GEWRK'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'ITOBATTR-GEWRK'  p_arbplt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.
      ENDIF.

* Begin of insert MOD-003
**>>>>>>>> Start of Insert MOD-002 EXTUVE
*    IF p_us = c_x .
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*               USING    'SAPMIEQ0'  '0101'  'X'  ''  ''
*               CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.
*
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_OKCODE'  '=SU'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.
*
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*               USING    'SAPLBSVA'  '0300'  'X'  ''  ''
*               CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.
*
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.
*      IF rb_sel1 = c_x.
*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                  USING    ''  ''  ''  'BDC_CURSOR'  var1
*                  CHANGING l_struct_bdcdata.
*        APPEND l_struct_bdcdata  TO l_i_bdcdata.
*        CLEAR  l_struct_bdcdata.
*
*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                USING    ''  ''  ''  var1  c_x
*                CHANGING l_struct_bdcdata.
*      ELSEIF rb_sel2 = c_x.
*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                  USING    ''  ''  ''  'BDC_CURSOR'  var2
*                  CHANGING l_struct_bdcdata.
*        APPEND l_struct_bdcdata  TO l_i_bdcdata.
*        CLEAR  l_struct_bdcdata.
*
*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                USING    ''  ''  ''  var2  ' '
*                CHANGING l_struct_bdcdata.
*      ENDIF.
*
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.
*    ENDIF.
**>>>>>>>> End   of Insert MOD-002 EXTUVE
* End of insert MOD-003

*     Sales and distribution
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    'SAPMIEQ0'  '0101'  'X'  ''  ''
               CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*     Sales office / Sales group
      IF p_sosg = 'X'.
*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-VKBUR'
*                CHANGING l_struct_bdcdata.
*        APPEND l_struct_bdcdata  TO l_i_bdcdata.
*        CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'ITOB-VKBUR'  p_vkburt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.

*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-VKGRP'
*                CHANGING l_struct_bdcdata.
*        APPEND l_struct_bdcdata  TO l_i_bdcdata.
*        CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'ITOB-VKGRP'  p_vkgrpt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.
      ENDIF.

*     Call transaction IE02
      IF NOT l_i_bdcdata[] IS INITIAL.
        CALL TRANSACTION 'IE02' USING l_i_bdcdata
                                MODE gv_mode  UPDATE 'S' .
        IF sy-subrc NE 0 .
*         Populate Status table with Call Transaction failed
          WRITE: / 'Equipment ', gt_equ-equnr, ' not updated.'.
        ELSE.
*         Logging of changes
          WRITE: / 'Equipment ', gt_equ-equnr, ' updated.'.
          IF p_cc = 'X'.
            WRITE: / ' Costcenter from ', gt_equ-kostl,
                                  ' to ', p_kostlt.
          ENDIF.
          IF p_pg = 'X'.
            WRITE: / ' Planner group from ', gt_equ-ingrp,
                                     ' to ', p_ingrpt.
          ENDIF.
          IF p_mwc = 'X'.
            WRITE: / ' Main workcenter from ', p_arbplf ,
                                       ' to ', p_arbplt.
          ENDIF.
*** MOD-004 * begin ***
          IF p_vwc = 'X'.
            WRITE: / ' Workcenter for Fixed FSE (Visitour) from ',
                       p_arbpvf, ' to ', p_arbpvt.
          ENDIF.
*** MOD-004 * end ***
          IF p_sosg = 'X'.
            WRITE: / ' Sales Office from ', gt_equ-vkbur,
                                    ' to ', p_vkburt.
            WRITE: / ' Sales Group from ', gt_equ-vkgrp,
                                   ' to ', p_vkgrpt.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.                                                  "MOD-004

* Begin of insert MOD-003

*>>>>> Start of insert EXTUVE MOD-002
*       IF p_us = 'X'.
*         WRITE : / ' User Status from ' , p_estato , ' to ', p_estatn.
*       ENDIF.
*>>>>> End  of insert EXTUVE MOD-002

*   User status
    IF p_us = 'X'.

*** MOD-004 * begin ***
*     Logging of changes
      IF p_mwc  IS INITIAL  AND
         p_vwc  IS INITIAL  AND
         p_sosg IS INITIAL  AND
         p_pg   IS INITIAL  AND
         p_cc   IS INITIAL.
        WRITE : / 'Equipment ', gt_equ-equnr, ' updated.'.
      ENDIF.
*** MOD-004 * end ***

*     New User Status Creation
      IF rb_sel1 = c_x.

        REFRESH: it_jest_ins,
                 it_jest_upd.

* Check if the record is already present in the JEST table to update in STATUS_READ FM
        CLEAR it_tj30t_temp.
        READ TABLE it_tj30t_temp WITH KEY txt04 = p_estatn
                                 BINARY SEARCH.               "MOD-004
        IF sy-subrc = 0.
*** MOD-004 * begin ***
*          CLEAR it_jest.
*          READ TABLE it_jest WITH TABLE KEY objnr = gt_equ-objnr
*                                            stat  = it_tj30t_temp-estat.
*          IF sy-subrc ne 0.
*
**           If present then use JEST_UPD parameter.
*            it_jest_upd-mandt = sy-mandt.
*            it_jest_upd-objnr = gt_equ-objnr.
*            it_jest_upd-stat  = it_tj30t_temp-estat.
**            IT_JEST_UPD-INACT = C_X.
*            it_jest_upd-chgkz = c_x.
*            APPEND it_jest_upd.
*
*            CALL FUNCTION 'STATUS_UPDATE'
*              TABLES
*                jest_ins = it_jest_ins
*                jest_upd = it_jest_upd
*                jsto_ins = it_jsto_ins
*                jsto_upd = it_jsto_upd
*                obj_del  = it_obj_del.
*          ELSE.
**           If not present then use JEST_INS parameter.
*            it_jest_ins-mandt = sy-mandt.
*            it_jest_ins-objnr = gt_equ-objnr.
*            it_jest_ins-stat  = it_tj30t_temp-estat.
**            IT_JEST_INS-INACT = C_X.
*            it_jest_ins-chgkz = c_x.
*            APPEND it_jest_ins.
*
*            CALL FUNCTION 'STATUS_UPDATE'
*              TABLES
*                jest_ins = it_jest_ins
*                jest_upd = it_jest_upd
*                jsto_ins = it_jsto_ins
*                jsto_upd = it_jsto_upd
*                obj_del  = it_obj_del.

*           Use other function module for updating status
*           --> for logging of database changes (CR2119)
          CALL FUNCTION 'STATUS_CHANGE_EXTERN'
            EXPORTING
              objnr                     = gt_equ-objnr
              user_status               = it_tj30t_temp-estat
*                SET_INACT                 = ' '
*                SET_CHGKZ                 =
*              IMPORTING
*                STONR                     =
            EXCEPTIONS
              object_not_found          = 1
              status_inconsistent       = 2
              status_not_allowed        = 3
              OTHERS                    = 4.
          IF sy-subrc <> 0.
*              MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*                      WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
            WRITE : / ' User Status could not be added '.
          ELSE.
            COMMIT WORK.
            WRITE : / ' User Status ', p_estatn, ' added'.
          ENDIF.
*          ENDIF.
*** MOD-004 * end ***
        ENDIF.

*     OLD User Status Removal
      ELSEIF rb_sel2 = c_x.

        REFRESH: it_jest_ins,
                 it_jest_upd.

        CLEAR it_tj30t_temp.
        READ TABLE it_tj30t_temp WITH KEY txt04 = p_estato
                                 BINARY SEARCH.               "MOD-004
        IF sy-subrc = 0.
*** MOD-004 * begin ***
*          CLEAR it_jest.
*          READ TABLE it_jest WITH TABLE KEY objnr = gt_equ-objnr
*                                            stat  = it_tj30t_temp-estat.
*          IF sy-subrc = 0.
*
**           If present then use JEST_UPD parameter.
*            it_jest_upd-mandt = sy-mandt.
*            it_jest_upd-objnr = gt_equ-objnr.
*            it_jest_upd-stat  = it_tj30t_temp-estat.
*            it_jest_upd-inact = c_x.
**          IT_JEST_UPD-CHGKZ = C_X.
*            APPEND it_jest_upd.
*
*            CALL FUNCTION 'STATUS_UPDATE'
*              TABLES
*                jest_ins = it_jest_ins
*                jest_upd = it_jest_upd
*                jsto_ins = it_jsto_ins
*                jsto_upd = it_jsto_upd
*                obj_del  = it_obj_del.

*           Use other function module for updating status
*           --> for logging of database changes (CR2119)
          CALL FUNCTION 'STATUS_CHANGE_EXTERN'
            EXPORTING
              objnr                     = gt_equ-objnr
              user_status               = it_tj30t_temp-estat
              set_inact                 = 'X'
*                SET_CHGKZ                 =
*              IMPORTING
*                STONR                     =
            EXCEPTIONS
              object_not_found          = 1
              status_inconsistent       = 2
              status_not_allowed        = 3
              OTHERS                    = 4.
          IF sy-subrc <> 0.
*              MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*                      WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
            WRITE : / ' User Status could not be removed '.
          ELSE.
            COMMIT WORK.
            WRITE : / ' User Status ', p_estato, ' removed'.
          ENDIF.
*         ENDIF.
*** MOD-004 * end ***
        ENDIF.
      ENDIF.

*** MOD-004 * begin ***
*      IF rb_sel1 = c_x.
*        READ TABLE it_tj30t_temp WITH KEY txt04 = p_estatn.
*        IF sy-subrc = 0.
*          SELECT SINGLE stat INTO it_tj30t_temp
*                 FROM jest
*                 WHERE objnr = gt_equ-objnr
*                   AND stat  = it_tj30t_temp-estat
*                   AND inact = space.
*          IF sy-subrc = 0.
*            WRITE : / ' User Status changed to ', p_estatn.
*          ELSE.
*            WRITE : / ' User Status could not be changed '.
*          ENDIF.
*        ENDIF.
*      ELSEIF rb_sel2 = c_x.
*        READ TABLE it_tj30t_temp WITH KEY txt04 = p_estato.
*        IF sy-subrc = 0.
*          SELECT SINGLE stat INTO it_tj30t_temp
*                 FROM jest
*                 WHERE objnr = gt_equ-objnr
*                   AND stat  = it_tj30t_temp-estat
*                   AND inact = c_x.
*          IF sy-subrc = 0.
*            WRITE : / ' User Status ' , p_estato , ' removed'.
*          ELSE.
*            WRITE : / ' User Status could not be removed'.
*          ENDIF.
*        ENDIF.
*      ENDIF.
*** MOD-004 * end ***
    ENDIF.
* End of insert MOD-003

    WRITE: /.

  ENDLOOP.

ENDFORM.                    "update_equipm

*&---------------------------------------------------------------------*
*&      Form  select_functional locations
*&---------------------------------------------------------------------*
FORM select_funcloc.

  SELECT a~tplnr a~kostl a~ingrp a~lgwid a~vkbur a~vkgrp
         INTO CORRESPONDING FIELDS OF TABLE gt_flo
         FROM iflo AS a
         INNER JOIN v_equi AS b
                    ON a~tplnr = b~tplnr
         WHERE a~iwerk =  p_werks
           AND a~vkorg =  p_vkorg
           AND a~vtweg =  p_vtweg
           AND a~spart =  p_spart
           AND b~datbi =  c_datbi
           AND b~equnr IN s_equnr.

* Old workcenter filled in --> check internal table
  IF NOT p_arbplf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_flo.
*      IF gt_flo-lgwid <> g_gewrko.
*        DELETE gt_flo.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_flo WHERE lgwid <> g_gewrko.
*** MOD-004 * end ***
  ENDIF.

* Old costcenter filled in --> check internal table
  IF NOT p_kostlf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_flo.
*      IF gt_flo-kostl <> p_kostlf.
*        DELETE gt_flo.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_flo WHERE kostl <> p_kostlf.
*** MOD-004 * end ***
  ENDIF.

* Old planner group filled in --> check internal table
  IF NOT p_ingrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_flo.
*      IF gt_flo-ingrp <> p_ingrpf.
*        DELETE gt_flo.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_flo WHERE ingrp <> p_ingrpf.
*** MOD-004 * end ***
  ENDIF.

* Old sales office filled in --> check internal table
  IF NOT p_vkburf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_flo.
*      IF gt_flo-vkbur <> p_vkburf.
*        DELETE gt_flo.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_flo WHERE vkbur <> p_vkburf.
*** MOD-004 * end ***
  ENDIF.

* Old sales group filled in --> check internal table
  IF NOT p_vkgrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_flo.
*      IF gt_flo-vkgrp <> p_vkgrpf.
*        DELETE gt_flo.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_flo WHERE vkgrp <> p_vkgrpf.
*** MOD-004 * end ***
  ENDIF.

* Sort
  SORT gt_flo.
* Delete  duplicate records
  DELETE ADJACENT DUPLICATES FROM gt_flo.

*** MOD-005 * begin ***
* Remove the top level Func locations from being updated
* otherwise table lock overflow will happen
  DELETE gt_flo WHERE tplnr = 'BE' OR
        tplnr = 'LU' OR
        tplnr = 'NL' OR
        tplnr = 'IT' OR
        tplnr = 'SE' OR
        tplnr = 'ES' OR
        tplnr = 'NO' OR
        tplnr = 'FR' OR
        tplnr = 'FR_0000000033_0001' OR
        tplnr = 'CH' OR
        tplnr = 'GB' OR
        tplnr = 'DE'.

*** mod-005 * end ***

ENDFORM.                    "select_funcloc

*&---------------------------------------------------------------------*
*&      Form  update_functional locations
*&---------------------------------------------------------------------*
FORM update_funcloc.

  LOOP AT gt_flo.

    REFRESH l_i_bdcdata.

*   Screen select equipment
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPMILO0'  '1110'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '/00'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*            USING    ''  ''  ''  'BDC_CURSOR'  'IFLO-TPLNR'
*            CHANGING l_struct_bdcdata.
*    APPEND l_struct_bdcdata  TO l_i_bdcdata.
*    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                  USING    ''  ''  ''  'IFLO-TPLNR'  gt_flo-tplnr
      CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Organization
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPMILO0'  '2100'  'X'  ''  ''
             CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=T\03'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Organization
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPMILO0'  '2100'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=T\06'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Costcenter
    IF p_cc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-KOSTL'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'ITOB-KOSTL'  p_kostlt
      CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Planner group
    IF p_pg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-INGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'ITOB-INGRP'  p_ingrpt
      CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Workcenter
    IF p_mwc = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOBATTR-GEWRK'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'ITOBATTR-GEWRK'  p_arbplt
         CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Sales and distribution
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPMILO0'  '2100'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Sales offfice / Sales group
    IF p_sosg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-VKBUR'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'ITOB-VKBUR'  p_vkburt
      CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'ITOB-VKGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'ITOB-VKGRP'  p_vkgrpt
      CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Call transaction IL02
    IF NOT l_i_bdcdata[] IS INITIAL.
      CALL TRANSACTION 'IL02' USING l_i_bdcdata
                              MODE gv_mode  UPDATE 'S' .
      IF sy-subrc NE 0 .
*       Populate Status table with Call Transaction failed
        WRITE: / 'Func.Loc. ', gt_flo-tplnr, ' not updated.'.
      ELSE.
*       Logging of changes
        WRITE: / 'Func.Loc. ', gt_flo-tplnr, ' updated.'.
        IF p_cc = 'X'.
          WRITE: / ' Costcenter from ', gt_flo-kostl,
                                ' to ', p_kostlt.
        ENDIF.
        IF p_pg = 'X'.
          WRITE : / ' Planner group from ', gt_flo-ingrp ,
                                    ' to ', p_ingrpt.
        ENDIF.
        IF p_mwc = 'X'.
          WRITE: / ' Workcenter from ', p_arbplf, ' to ', p_arbplt.
        ENDIF.
        IF p_sosg = 'X'.
          WRITE: / ' Sales Office from ', gt_flo-vkbur,
                                  ' to ', p_vkburt.
          WRITE: / ' Sales Group from ', gt_flo-vkgrp,
                                 ' to ', p_vkgrpt.
        ENDIF.
        WRITE: /.
      ENDIF.
    ENDIF.

  ENDLOOP.

ENDFORM.                    "update_funcloc

*&---------------------------------------------------------------------*
*&      Form  select_contracts
*&---------------------------------------------------------------------*
FORM select_contracts.

  SELECT a~vbeln a~vkbur a~vkgrp
         INTO CORRESPONDING FIELDS OF TABLE gt_con
         FROM vbak AS a
         INNER JOIN viser02 AS b
                    ON a~vbeln = b~sdaufnr
         INNER JOIN vbap AS c
                    ON a~vbeln = c~vbeln
         WHERE b~equnr IN s_equnr
           AND a~vkorg =  p_vkorg
           AND a~vtweg =  p_vtweg
           AND a~spart =  p_spart
           AND c~werks =  p_werks.

* Old sales office filled in --> check internal table
  IF NOT p_vkburf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_con.
*      IF gt_con-vkbur <> p_vkburf.
*        DELETE gt_con.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_con WHERE vkbur <> p_vkburf.
*** MOD-004 * end ***
  ENDIF.

* Old sales group filled in --> check internal table
  IF NOT p_vkgrpf IS INITIAL.
*** MOD-004 * begin ***
* Performance
*    LOOP AT gt_con.
*      IF gt_con-vkgrp <> p_vkgrpf.
*        DELETE gt_con.
*      ENDIF.
*    ENDLOOP.
    DELETE gt_con WHERE vkgrp <> p_vkgrpf.
*** MOD-004 * end ***
  ENDIF.

* Sort
  SORT gt_con.
* Delete  duplicate records
  DELETE ADJACENT DUPLICATES FROM gt_con.

ENDFORM.                    "select_contracts

*&---------------------------------------------------------------------*
*&      Form  update_contracts
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM update_contracts.

  LOOP AT gt_con.

    REFRESH l_i_bdcdata.

*   Screen select contract
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPMV45A'  '0102'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '/00'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*            USING    ''  ''  ''  'BDC_CURSOR'  'VBAK-VBELN'
*            CHANGING l_struct_bdcdata.
*    APPEND l_struct_bdcdata  TO l_i_bdcdata.
*    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                  USING    ''  ''  ''  'VBAK-VBELN'  gt_con-vbeln
      CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Sales document header
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPMV45A'  '4001'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=HEAD'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    'SAPMV45A'  '4002'  'X'  ''  ''
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'BDC_OKCODE'  '=SICH'
            CHANGING l_struct_bdcdata.
    APPEND l_struct_bdcdata  TO l_i_bdcdata.
    CLEAR  l_struct_bdcdata.

*   Sales offices / sales group
    IF p_sosg = 'X'.
*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'VBAK-VKBUR'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'VBAK-VKBUR'  p_vkburt
        CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'VBAK-VKGRP'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                    USING    ''  ''  ''  'VBAK-VKGRP'  p_vkgrpt
        CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.
    ENDIF.

*   Call transaction VA42
    IF NOT l_i_bdcdata[] IS INITIAL.
      CALL TRANSACTION 'VA42' USING l_i_bdcdata
                              MODE gv_mode  UPDATE 'S' .
      IF sy-subrc NE 0 .
*       Populate Status table with Call Transaction failed
        WRITE: / 'Contract ', gt_con-vbeln, ' not updated.'.
      ELSE.
*       Logging of changes
        WRITE: / 'Contract ', gt_con-vbeln, ' updated.'.
        IF p_sosg = 'X'.
          WRITE: / ' Sales Office from ', gt_con-vkbur,
                                  ' to ', p_vkburt.
          WRITE: / ' Sales Group from ', gt_con-vkgrp,
                                 ' to ', p_vkgrpt.
        ENDIF.
        WRITE: /.
      ENDIF.
    ENDIF.

  ENDLOOP.

ENDFORM.                    "update_contracts

*&---------------------------------------------------------------------*
*&      Form  update_sortfield                              "MOD-001
*&---------------------------------------------------------------------*
FORM update_sortfield.

  SORT gt_mpl BY warpl.
  CLEAR : gv_warpl.
  LOOP AT gt_mpl.

    IF gt_mpl-warpl <> gv_warpl.
      MOVE gt_mpl-warpl TO gv_warpl.

      REFRESH l_i_bdcdata.

*     Screen select maintenance plan
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    'SAPLIWP3'  '0140'  'X'  ''  ''
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '/00'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*              USING    ''  ''  ''  'BDC_CURSOR'  'RMIPM-WARPL'
*              CHANGING l_struct_bdcdata.
*      APPEND l_struct_bdcdata  TO l_i_bdcdata.
*      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'RMIPM-WARPL'  gt_mpl-warpl
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*     Screen maintenance plan additional data
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    'SAPLIWP3'  '0201'  'X'  ''  ''
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '=T\03'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

*     Sort field
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    'SAPLIWP3'  '0201'  'X'  ''  ''
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
              USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
              CHANGING l_struct_bdcdata.
      APPEND l_struct_bdcdata  TO l_i_bdcdata.
      CLEAR  l_struct_bdcdata.

      IF p_sf = 'X'.
*        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
*                USING    ''  ''  ''  'BDC_CURSOR'  'RMIPM-PLAN_SORT'
*                CHANGING l_struct_bdcdata.
*        APPEND l_struct_bdcdata  TO l_i_bdcdata.
*        CLEAR  l_struct_bdcdata.

        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
                USING    ''  ''  ''  'RMIPM-PLAN_SORT'  p_eqfnrt
                CHANGING l_struct_bdcdata.
        APPEND l_struct_bdcdata  TO l_i_bdcdata.
        CLEAR  l_struct_bdcdata.
      ENDIF.

*     Call transaction IP02
      IF NOT l_i_bdcdata[] IS INITIAL.
        CALL TRANSACTION 'IP02' USING l_i_bdcdata
                                MODE gv_mode  UPDATE 'S' .
        IF sy-subrc NE 0 .
*         Populate Status table with Call Transaction failed
          WRITE: / 'Maintenance plan ', gt_mpl-warpl,
                   ' not updated.'.
        ELSE.
*         Logging of changes
          WRITE: / 'Maintenance plan ', gt_mpl-warpl, ' updated.'.
          IF p_sf = 'X'.
            WRITE: / ' Sortfield from ', p_eqfnrf, ' to ', p_eqfnrt.
          ENDIF.
          WRITE: /.
        ENDIF.
      ENDIF.
    ENDIF.

  ENDLOOP.

ENDFORM.                    "update_sortfield

*Text symbol text
*001:Basic parameters
*002:Equipment
*003:Main Workcenter
*004:Sales Office - Sales Group
*005:Planner Group
*006:Cost Center
*007:Sort Field
*008:Changes
*009:user status
*010:Workcenter for Fixed FSE - Visitour
*011:System Status
*E00:Fill in at least 1 equipment number
*E01:You have no authorisation for sales organisation :
*E02:Select at least 1 field to change
*E03:Select at least 1 item in the tab Changes
*E06:You have no authorisation for plant :
*E07:You have no authorisation for delivering plant :
*E08:Invalid plant
*E09:Invalid workcenter
*E10:Old workcenter does not exist in plant :
*E11:New workcenter does not exist in plant :
*E12:Old and new workcenter cannot be the same
*E13:Combination new sales office-sales group invalid.
*E14:New planner group not valid for plant :
*E15:New cost center not valid for contr.area:
*E19:User Status not Valid
*E21:Do Not input value for New user status when remove user status is selected
*S03:Add User Status
*S04:Remove User Status
*SC1:Sales Organization
*SC2:Distribution Channel
*SC3:Division
*SC4:Plant
*SC5:Change Main Workcenter
*SC6:New
*SC7:Change Sales Office
*SC8:New
*SC9:          And Sales Group
*SCA:New
*SCB:Change Planner Group
*SCC:New
*SCD:Change Costcenter
*SCE:New
*SCF:Old
*SCG:Old
*SCH:Old
*SCI:Old
*SCJ:Old
*SCK:Change Sort Field
*SCL:Old
*SCM:New
*SCN:Change Workcenter - VT
*SCO:Old
*SCP:New

*SUS:Change User Status
*Selection text
*P_ARBPLF:        Old workcenter
*P_DLFL:        Delete
*P_INAC:        Inactive
*P_SPART:D       .
*P_UPDCO:        Change Contracts
*P_UPDEQ:        Change Equipments
*P_UPDFL:        Change Functional Locations
*P_UPDMP:        Change Maintenance Plans
*P_UPDNO:        Change Notifications
*P_UPDOO:        Change Open Orders
*P_VKORG:D       .
*P_VTWEG:D       .
*P_WERKS:D       .
*S_EQUNR:        Equipment
