*----------------------------------------------------------------------*
*   INCLUDE CMDC0003                                                   *
*----------------------------------------------------------------------*
*---------------------------------------------------------------------*
*       FORM PRESENT_RESULTS1                                         *
*---------------------------------------------------------------------*
FORM present_results1.

  IF gv_acc_flag IS INITIAL.
    SET PF-STATUS 'LIST'.
    IF konhex NE space OR konpex NE space.
      PERFORM write_block1.
    ENDIF.
    IF schvak NE space.
      PERFORM write_block2.
    ENDIF.
    IF stfbzg NE space.
      PERFORM write_block3.
    ENDIF.
    IF konadb NE space.
      PERFORM write_block4.
    ENDIF.
    IF interv NE space.
      PERFORM write_block5.
    ENDIF.
    IF nummch NE space.
      PERFORM write_numfoot.
    ENDIF.

  ELSE.

    CLEAR: gv_counter,
           gv_1_is_first,
           gv_2_is_first,
           gv_3_is_first,
           gv_4_is_first,
           gv_5_is_first,
           gv_6_is_first.

* check which append list is the first list
    IF konhex NE space OR konpex NE space.
      gv_1_is_first = 'X'.
    ELSE.
      IF schvak NE space.
        gv_2_is_first = 'X'.
      ELSE.
        IF stfbzg NE space.
          gv_3_is_first = 'X'.
        ELSE.
          IF konadb NE space.
            gv_4_is_first = 'X'.
          ELSE.
            IF interv NE space.
              gv_5_is_first = 'X'.
            ELSE.
              IF nummch NE space.
                gv_6_is_first = 'X'.
              ENDIF.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
    ENDIF.

* display the append list via ALV...
    PERFORM display_block1_alv.

  ENDIF.

ENDFORM.                    "PRESENT_RESULTS1

*---------------------------------------------------------------------*
*      Form  VAKEY_POPUP                                              *
*---------------------------------------------------------------------*
FORM vakey_popup_alv.
  IF xresult IS NOT INITIAL.
    IF NOT xresult-hvakey IS INITIAL.
      CALL FUNCTION 'VAKEY_TO_WINDOW_TABLE'
        EXPORTING
          table_number      = xresult-kotabnr
          usage             = act_kvewe
          variable_key      = xresult-hvakey
        TABLES
          description_table = description_table
          window_table      = window_table
        EXCEPTIONS
          OTHERS            = 2.
    ELSE.
      CALL FUNCTION 'VAKEY_TO_WINDOW_TABLE'
        EXPORTING
          table_number      = xresult-kotabnr
          usage             = act_kvewe
          variable_key      = xresult-vakey
        TABLES
          description_table = description_table
          window_table      = window_table
        EXCEPTIONS
          OTHERS            = 2.
    ENDIF.

    IF sy-subrc EQ 0.
      PERFORM display_window_table_alv.
    ELSE.
      MESSAGE i796.
    ENDIF.
  ELSE.
    MESSAGE i799.
  ENDIF.
ENDFORM.                               " VAKEY_POPUP_ALV

*&---------------------------------------------------------------------*
*&      Form  display_block1_alv
*&---------------------------------------------------------------------*
*       text: display content of table xresult as zebra. xresult was
*             filled in form CONDITIONS_ANAL
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_block1_alv .

  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_layo TYPE slis_layout_alv,
        lt_events TYPE slis_t_event.


  gv_counter = 1.

  IF konhex NE space OR konpex NE space.

    PERFORM select_data_for_block1.

    PERFORM set_fieldcatalog  CHANGING lt_fcat.

    PERFORM set_events        CHANGING lt_events.

    PERFORM set_layout        CHANGING ls_layo.

    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
      EXPORTING
        i_callback_program       = gv_repid
        i_callback_pf_status_set = 'HANDLE_EVENT_PF_STATUS'
        i_callback_user_command  = 'HANDLE_EVENT_USER_COMMAND'
        is_layout                = ls_layo
        it_fieldcat              = lt_fcat
        it_events                = lt_events
      TABLES
        t_outtab                 = gt_outtab_block1
      EXCEPTIONS
        program_error            = 1
        OTHERS                   = 2.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ELSE.
    PERFORM display_block2_alv.
  ENDIF.


ENDFORM.                    " display_block1_alv

*&---------------------------------------------------------------------*
*&      Form  display_block2_alv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_block2_alv .
  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_layo TYPE slis_layout_alv,
        lt_events TYPE slis_t_event.

  gv_counter = 2.

  IF schvak NE space.

    PERFORM select_data_for_block2.

    PERFORM set_fieldcatalog CHANGING lt_fcat.

    PERFORM set_layout       CHANGING ls_layo.

    PERFORM set_events       CHANGING lt_events.

    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
      EXPORTING
        i_callback_program       = gv_repid
        i_callback_pf_status_set = 'HANDLE_EVENT_PF_STATUS'
        i_callback_user_command  = 'HANDLE_EVENT_USER_COMMAND'
        is_layout                = ls_layo
        it_fieldcat              = lt_fcat
        it_events                = lt_events
      TABLES
        t_outtab                 = gt_outtab_block2
      EXCEPTIONS
        program_error            = 1
        OTHERS                   = 2.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ELSE.
    PERFORM display_block3_alv.
  ENDIF.

ENDFORM.                    " display_block2_alv

*&---------------------------------------------------------------------*
*&      Form  display_block3_alv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_block3_alv .
  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_layo TYPE slis_layout_alv,
        lt_events TYPE slis_t_event,
        ls_prnt TYPE slis_print_alv.
  gv_counter = 3.

  IF stfbzg NE space.

    PERFORM select_data_for_block3.

    PERFORM set_fieldcatalog CHANGING lt_fcat.

    PERFORM set_layout       CHANGING ls_layo.

    PERFORM set_events       CHANGING lt_events.

    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
      EXPORTING
        i_callback_program       = gv_repid
        i_callback_pf_status_set = 'HANDLE_EVENT_PF_STATUS'
        i_callback_user_command  = 'HANDLE_EVENT_USER_COMMAND'
        is_layout                = ls_layo
        it_fieldcat              = lt_fcat
        it_events                = lt_events
      TABLES
        t_outtab                 = gt_outtab_block3
      EXCEPTIONS
        program_error            = 1
        OTHERS                   = 2.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ELSE.
    PERFORM display_block4_alv.
  ENDIF.

ENDFORM.                    " display_block3_alv

*&---------------------------------------------------------------------*
*&      Form  display_block4_alv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_block4_alv .
  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_layo TYPE slis_layout_alv,
        lt_events TYPE slis_t_event,
        ls_prnt TYPE slis_print_alv.



  gv_counter = 4.

  IF konadb NE space.

    PERFORM select_data_for_block4.

    PERFORM set_fieldcatalog CHANGING lt_fcat.

    PERFORM set_layout       CHANGING ls_layo.

    PERFORM set_events       CHANGING lt_events.

    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
      EXPORTING
        i_callback_program       = gv_repid
        i_callback_pf_status_set = 'HANDLE_EVENT_PF_STATUS'
        i_callback_user_command  = 'HANDLE_EVENT_USER_COMMAND'
        is_layout                = ls_layo
        it_fieldcat              = lt_fcat
        it_events                = lt_events
      TABLES
        t_outtab                 = gt_outtab_block4
      EXCEPTIONS
        program_error            = 1
        OTHERS                   = 2.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ELSE.
    PERFORM display_block5_alv.
  ENDIF.

ENDFORM.                    " display_block4_alv

*&---------------------------------------------------------------------*
*&      Form  display_block5_alv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_block5_alv .
  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_layo TYPE slis_layout_alv,
        lt_events TYPE slis_t_event,
        ls_prnt TYPE slis_print_alv.


  gv_counter = 5.

  IF interv NE space.

    PERFORM select_data_for_block5.

    PERFORM set_fieldcatalog CHANGING lt_fcat.

    PERFORM set_layout       CHANGING ls_layo.

    PERFORM set_events       CHANGING lt_events.

    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
      EXPORTING
        i_callback_program       = gv_repid
        i_callback_pf_status_set = 'HANDLE_EVENT_PF_STATUS'
        i_callback_user_command  = 'HANDLE_EVENT_USER_COMMAND'
        is_layout                = ls_layo
        it_fieldcat              = lt_fcat
        it_events                = lt_events
      TABLES
        t_outtab                 = gt_outtab_block5
      EXCEPTIONS
        program_error            = 1
        OTHERS                   = 2.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ELSE.
    PERFORM display_block6_alv.
  ENDIF.


ENDFORM.                    " display_block5_alv

*&---------------------------------------------------------------------*
*&      Form  display_block6_alv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_block6_alv .
  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_layo TYPE slis_layout_alv,
        lt_events TYPE slis_t_event,
        ls_prnt TYPE slis_print_alv,
        lt_exc TYPE TABLE OF alv_s_qinf.

  gv_counter = 6.

  IF nummch NE space.

    PERFORM select_data_for_block6.

    PERFORM set_fieldcatalog CHANGING lt_fcat.

    PERFORM set_layout       CHANGING ls_layo.

    PERFORM set_events       CHANGING lt_events.

    PERFORM set_tooltip      CHANGING lt_exc.

    CALL FUNCTION 'REUSE_ALV_LIST_DISPLAY'
      EXPORTING
        i_callback_program       = gv_repid
        i_callback_pf_status_set = 'HANDLE_EVENT_PF_STATUS'
        i_callback_user_command  = 'HANDLE_EVENT_USER_COMMAND'
        is_layout                = ls_layo
        it_fieldcat              = lt_fcat
        it_events                = lt_events
        it_except_qinfo          = lt_exc
      TABLES
        t_outtab                 = gt_outtab_block6
      EXCEPTIONS
        program_error            = 1
        OTHERS                   = 2.
    IF sy-subrc <> 0.
      MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
    ENDIF.
  ENDIF.


ENDFORM.                    " display_block6_alv

*&---------------------------------------------------------------------*
*&      Form  set_fieldcatalog
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_LT_FCAT  text
*----------------------------------------------------------------------*
FORM set_fieldcatalog  CHANGING ct_fcat TYPE slis_t_fieldcat_alv.

*    IMPORTANT NOTE: when registering to the Event Double
*    Click it is necessary to set the field TABNAME of
*    each list to a specific name which identifies the list
*    it belongs to. This way when you double click on a list
*    you can easily determine to which list it belongs to.

  DATA: lt_fcat TYPE slis_t_fieldcat_alv,
        ls_fcat TYPE slis_fieldcat_alv,
        lv_tabix TYPE sy-tabix.

  CASE gv_counter.
    WHEN 1.
*... the first list is being displayed: gt_outtab_block1
* with structure CMDC0_1_alv
      CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
        EXPORTING
          i_structure_name       = 'CMDC0_1_alv'
        CHANGING
          ct_fieldcat            = ct_fcat
        EXCEPTIONS
          inconsistent_interface = 1
          program_error          = 2
          OTHERS                 = 3.
      IF sy-subrc <> 0.
        MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
*... IMPORTANT NOTE: Event Double Click
*    In order to have this work we will set the tabname to
*    the list number
      ls_fcat-tabname = 'GT_OUTTAB_BLOCK1'.
      MODIFY ct_fcat FROM ls_fcat TRANSPORTING tabname
        WHERE tabname NE ls_fcat-tabname.

      LOOP AT ct_fcat INTO ls_fcat.
        lv_tabix = sy-tabix.
        CASE ls_fcat-fieldname.
          WHEN 'KNUMH'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-025.
            ls_fcat-seltext_l = text-025.
            ls_fcat-seltext_s = text-025.
            ls_fcat-reptext_ddic = text-025.
            ls_fcat-ddictxt   = 'S'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KOTABNR'.
            ls_fcat-outputlen = 3.
            ls_fcat-seltext_m = text-007.
            ls_fcat-seltext_l = text-007.
            ls_fcat-seltext_s = text-007.
            ls_fcat-reptext_ddic = text-007.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-005.
            ls_fcat-seltext_l = text-005.
            ls_fcat-seltext_s = text-005.
            ls_fcat-reptext_ddic = text-005.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'VAKEY'.
            ls_fcat-outputlen = 50.
            ls_fcat-seltext_m = text-006.
            ls_fcat-seltext_l = text-006.
            ls_fcat-seltext_s = text-006.
            ls_fcat-reptext_ddic = text-006.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KONH_TEXT'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-026.
            ls_fcat-seltext_l = text-026.
            ls_fcat-seltext_s = text-026.
            ls_fcat-reptext_ddic = text-026.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KONP_TEXT'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-027.
            ls_fcat-seltext_l = text-027.
            ls_fcat-seltext_s = text-027.
            ls_fcat-reptext_ddic = text-027.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'REMARK'.
            ls_fcat-outputlen = 70.
            ls_fcat-seltext_m = text-602.
            ls_fcat-seltext_l = text-602.
            ls_fcat-seltext_s = text-602.
            ls_fcat-reptext_ddic = text-602.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'HVAKEY'.
            ls_fcat-tech = 'X'.
*            ls_fcat-no_out = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
        ENDCASE.
      ENDLOOP.

    WHEN 2.
* 2. list for gt_outtab_block2
* with structure CMDC0_2_alv
      CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
        EXPORTING
          i_structure_name       = 'CMDC0_2_alv'
        CHANGING
          ct_fieldcat            = ct_fcat
        EXCEPTIONS
          inconsistent_interface = 1
          program_error          = 2
          OTHERS                 = 3.
      IF sy-subrc <> 0.
        MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
*... IMPORTANT NOTE: Event Double Click
*    In order to have this work we will set the tabname to
*    the list number
      ls_fcat-tabname = 'GT_OUTTAB_BLOCK2'.
      MODIFY ct_fcat FROM ls_fcat TRANSPORTING tabname
        WHERE tabname NE ls_fcat-tabname.

      LOOP AT ct_fcat INTO ls_fcat.
        lv_tabix = sy-tabix.
        CASE ls_fcat-fieldname.
          WHEN 'KNUMH'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-025.
            ls_fcat-seltext_l = text-025.
            ls_fcat-seltext_s = text-025.
            ls_fcat-reptext_ddic = text-025.
            ls_fcat-ddictxt   = 'S'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KOTABNR'.
            ls_fcat-outputlen = 3.
            ls_fcat-seltext_m = text-007.
            ls_fcat-seltext_l = text-007.
            ls_fcat-seltext_s = text-007.
            ls_fcat-reptext_ddic = text-007.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-609.
            ls_fcat-seltext_l = text-609.
            ls_fcat-seltext_s = text-609.
            ls_fcat-reptext_ddic = text-609.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'VAKEY'.
            ls_fcat-outputlen = 50.
            ls_fcat-seltext_m = text-610.
            ls_fcat-seltext_l = text-610.
            ls_fcat-seltext_s = text-610.
            ls_fcat-reptext_ddic = text-610.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'HKSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-611.
            ls_fcat-seltext_l = text-611.
            ls_fcat-seltext_s = text-611.
            ls_fcat-reptext_ddic = text-611.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'HVAKEY'.
            ls_fcat-outputlen = 50.
            ls_fcat-seltext_m = text-612.
            ls_fcat-seltext_l = text-612.
            ls_fcat-seltext_s = text-612.
            ls_fcat-reptext_ddic = text-612.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'PKSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-613.
            ls_fcat-seltext_l = text-613.
            ls_fcat-seltext_s = text-613.
            ls_fcat-reptext_ddic = text-613.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'REMARK'.
            ls_fcat-outputlen = 70.
            ls_fcat-seltext_m = text-602.
            ls_fcat-seltext_l = text-602.
            ls_fcat-seltext_s = text-602.
            ls_fcat-reptext_ddic = text-602.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
        ENDCASE.
      ENDLOOP.
    WHEN 3.
*... the third list is being displayed
*3. list for gt_outtab_block3 with structure CMDC0_3_alv
      CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
        EXPORTING
          i_structure_name       = 'CMDC0_3_alv'
        CHANGING
          ct_fieldcat            = ct_fcat
        EXCEPTIONS
          inconsistent_interface = 1
          program_error          = 2
          OTHERS                 = 3.
      IF sy-subrc <> 0.
        MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
*... IMPORTANT NOTE: Event Double Click
*    In order to have this work we will set the tabname to
*    the list number
      ls_fcat-tabname = 'GT_OUTTAB_BLOCK3'.
      MODIFY ct_fcat FROM ls_fcat TRANSPORTING tabname
        WHERE tabname NE ls_fcat-tabname.

      LOOP AT ct_fcat INTO ls_fcat.
        lv_tabix = sy-tabix.
        CASE ls_fcat-fieldname.
          WHEN 'KNUMH'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-025.
            ls_fcat-seltext_l = text-025.
            ls_fcat-seltext_s = text-025.
            ls_fcat-reptext_ddic = text-025.
            ls_fcat-ddictxt   = 'S'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KOTABNR'.
            ls_fcat-outputlen = 3.
            ls_fcat-seltext_m = text-007.
            ls_fcat-seltext_l = text-007.
            ls_fcat-seltext_s = text-007.
            ls_fcat-reptext_ddic = text-007.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-005.
            ls_fcat-seltext_l = text-005.
            ls_fcat-seltext_s = text-005.
            ls_fcat-reptext_ddic = text-005.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KZBZGA'.
            ls_fcat-outputlen = 5.
            ls_fcat-seltext_m = text-033.
            ls_fcat-seltext_l = text-033.
            ls_fcat-seltext_s = text-033.
            ls_fcat-reptext_ddic = text-033.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'PKZBZG_TEXT'.
            ls_fcat-outputlen = 66.
            ls_fcat-seltext_m = text-012.
            ls_fcat-seltext_l = text-012.
            ls_fcat-seltext_s = text-012.
            ls_fcat-reptext_ddic = text-012.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'REMARK'.
            ls_fcat-outputlen = 70.
            ls_fcat-seltext_m = text-602.
            ls_fcat-seltext_l = text-602.
            ls_fcat-seltext_s = text-602.
            ls_fcat-reptext_ddic = text-602.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'HVAKEY'.
            ls_fcat-tech = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'VAKEY'.
            ls_fcat-tech = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
        ENDCASE.
      ENDLOOP.

    WHEN 4.
*... the fourth list is being displayed
* 4. list for gt_outtab_block4 with structure CMDC0_4_alv
      CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
        EXPORTING
          i_structure_name       = 'CMDC0_4_alv'
        CHANGING
          ct_fieldcat            = ct_fcat
        EXCEPTIONS
          inconsistent_interface = 1
          program_error          = 2
          OTHERS                 = 3.
      IF sy-subrc <> 0.
        MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
*... IMPORTANT NOTE: Event Double Click
*    In order to have this work we will set the tabname to
*    the list number
      ls_fcat-tabname = 'GT_OUTTAB_BLOCK4'.
      MODIFY ct_fcat FROM ls_fcat TRANSPORTING tabname
        WHERE tabname NE ls_fcat-tabname.

      LOOP AT ct_fcat INTO ls_fcat.
        lv_tabix = sy-tabix.
        CASE ls_fcat-fieldname.
          WHEN 'KOTABNR'.
            ls_fcat-outputlen = 3.
            ls_fcat-seltext_m = text-007.
            ls_fcat-seltext_l = text-007.
            ls_fcat-seltext_s = text-007.
            ls_fcat-reptext_ddic = text-007.
            ls_fcat-ddictxt   = 'S'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-005.
            ls_fcat-seltext_l = text-005.
            ls_fcat-seltext_s = text-005.
            ls_fcat-reptext_ddic = text-005.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'VAKEY'.
            ls_fcat-outputlen = 51.
            ls_fcat-seltext_m = text-006.
            ls_fcat-seltext_l = text-006.
            ls_fcat-seltext_s = text-006.
            ls_fcat-reptext_ddic = text-006.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'DKNUMA'.
            ls_fcat-outputlen = 31.
            ls_fcat-seltext_m = text-031.
            ls_fcat-seltext_l = text-031.
            ls_fcat-seltext_s = text-031.
            ls_fcat-reptext_ddic = text-031.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'REMARK'.
            ls_fcat-outputlen = 70.
            ls_fcat-seltext_m = text-602.
            ls_fcat-seltext_l = text-602.
            ls_fcat-seltext_s = text-602.
            ls_fcat-reptext_ddic = text-602.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'HVAKEY'.
            ls_fcat-tech = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KNUMH'.
            ls_fcat-tech = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
        ENDCASE.
      ENDLOOP.

    WHEN 5.
*... the fifth list is being displayed
* 5. list for gt_outtab_block5 with structure CMDC0_5_alv
      CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
        EXPORTING
          i_structure_name       = 'CMDC0_5_alv'
        CHANGING
          ct_fieldcat            = ct_fcat
        EXCEPTIONS
          inconsistent_interface = 1
          program_error          = 2
          OTHERS                 = 3.
      IF sy-subrc <> 0.
        MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
*... IMPORTANT NOTE: Event Double Click
*    In order to have this work we will set the tabname to
*    the list number
      ls_fcat-tabname = 'GT_OUTTAB_BLOCK5'.
      MODIFY ct_fcat FROM ls_fcat TRANSPORTING tabname
        WHERE tabname NE ls_fcat-tabname.

      LOOP AT ct_fcat INTO ls_fcat.
        lv_tabix = sy-tabix.
        CASE ls_fcat-fieldname.
          WHEN 'KTOABNR'.
            ls_fcat-outputlen = 3.
            ls_fcat-seltext_m = text-007.
            ls_fcat-seltext_l = text-007.
            ls_fcat-seltext_s = text-007.
            ls_fcat-reptext_ddic = text-007.
            ls_fcat-ddictxt   = 'S'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KSCHL'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-005.
            ls_fcat-seltext_l = text-005.
            ls_fcat-seltext_s = text-005.
            ls_fcat-reptext_ddic = text-005.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KNUMH'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-025.
            ls_fcat-seltext_l = text-025.
            ls_fcat-seltext_s = text-025.
            ls_fcat-reptext_ddic = text-025.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'DATAB'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-013.
            ls_fcat-seltext_l = text-013.
            ls_fcat-seltext_s = text-013.
            ls_fcat-reptext_ddic = text-013.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'DATBI'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-032.
            ls_fcat-seltext_l = text-032.
            ls_fcat-seltext_s = text-032.
            ls_fcat-reptext_ddic = text-032.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'IKNUMH'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-025.
            ls_fcat-seltext_l = text-025.
            ls_fcat-seltext_s = text-025.
            ls_fcat-reptext_ddic = text-025.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'IDATAB'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-013.
            ls_fcat-seltext_l = text-013.
            ls_fcat-seltext_s = text-013.
            ls_fcat-reptext_ddic = text-013.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'IDATBI'.
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-032.
            ls_fcat-seltext_l = text-032.
            ls_fcat-seltext_s = text-032.
            ls_fcat-reptext_ddic = text-032.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'REMARK'.
            ls_fcat-outputlen = 70.
            ls_fcat-seltext_m = text-602.
            ls_fcat-seltext_l = text-602.
            ls_fcat-seltext_s = text-602.
            ls_fcat-reptext_ddic = text-602.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'HVAKEY'.
            ls_fcat-tech = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'VAKEY'.
            ls_fcat-tech = 'X'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
        ENDCASE.
      ENDLOOP.

    WHEN 6.
*... the sixth list is being displayed
* 6. list for gt_outtab_block6 with structure CMDC0_6_alv
      CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
        EXPORTING
          i_structure_name       = 'CMDC0_6_alv'
        CHANGING
          ct_fieldcat            = ct_fcat
        EXCEPTIONS
          inconsistent_interface = 1
          program_error          = 2
          OTHERS                 = 3.
      IF sy-subrc <> 0.
        MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
                WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
      ENDIF.
*... IMPORTANT NOTE: Event Double Click
*    In order to have this work we will set the tabname to
*    the list number
      ls_fcat-tabname = 'GT_OUTTAB_BLOCK6'.
      MODIFY ct_fcat FROM ls_fcat TRANSPORTING tabname
        WHERE tabname NE ls_fcat-tabname.

      LOOP AT ct_fcat INTO ls_fcat.
        lv_tabix = sy-tabix.
        CASE ls_fcat-fieldname.
          WHEN 'KOTABNR'. "Tabelle
            ls_fcat-outputlen = 3.
            ls_fcat-seltext_m = text-040.
            ls_fcat-seltext_l = text-040.
            ls_fcat-seltext_s = text-040.
            ls_fcat-reptext_ddic = text-040.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KONHMAX'. "Nr. kreis KONH (max.)
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-603.
            ls_fcat-seltext_l = text-603.
            ls_fcat-seltext_s = text-603.
            ls_fcat-reptext_ddic = text-603.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'KONPMAX'. "Nr. kreis KONP (max.)
            ls_fcat-outputlen = 10.
            ls_fcat-seltext_m = text-604.
            ls_fcat-seltext_l = text-604.
            ls_fcat-seltext_s = text-604.
            ls_fcat-reptext_ddic = text-604.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'STATUS'.  "Status (Ikone)
            ls_fcat-datatype = 'CHAR'.
            ls_fcat-outputlen = 4.
            ls_fcat-seltext_m = text-605.
            ls_fcat-seltext_l = text-605.
            ls_fcat-seltext_s = text-605.
            ls_fcat-reptext_ddic = text-605.
            ls_fcat-icon = 'X'.
            ls_fcat-ddictxt   = 'S'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
          WHEN 'REMARK'.
            ls_fcat-outputlen = 70.
            ls_fcat-seltext_m = text-602.
            ls_fcat-seltext_l = text-602.
            ls_fcat-seltext_s = text-602.
            ls_fcat-reptext_ddic = text-602.
            ls_fcat-ddictxt   = 'M'.
            MODIFY ct_fcat FROM ls_fcat INDEX lv_tabix.
        ENDCASE.
      ENDLOOP.
  ENDCASE.

ENDFORM.                    " set_fieldcatalog

*&---------------------------------------------------------------------*
*&      Form  select_data_for_block1
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data_for_block1 .

  CLEAR gt_outtab_block1.
  REFRESH gt_outtab_block1.


  LOOP AT xresult WHERE nkonhx NE space OR nkonpx NE space.
    gt_outtab_block1-knumh   = xresult-knumh.
    gt_outtab_block1-kotabnr = xresult-kotabnr.
    gt_outtab_block1-kschl   = xresult-kschl.
    gt_outtab_block1-vakey   = xresult-vakey.
    IF konhex NE space.
      IF xresult-nkonhx EQ 'X'.
        gt_outtab_block1-konh_text = text-500.
      ELSE.
        gt_outtab_block1-konh_text = text-501.
      ENDIF.
    ELSE.
      gt_outtab_block1-konh_text = text-502.
    ENDIF.
    IF konpex NE space.
      IF xresult-nkonpx EQ 'X'.
        gt_outtab_block1-konp_text = text-500.
      ELSEIF xresult-nkonpx EQ 'O'.
        gt_outtab_block1-konp_text = text-503.
      ELSE.
        gt_outtab_block1-konp_text = text-501.
      ENDIF.
    ELSE.
      gt_outtab_block1-konp_text = text-502.
    ENDIF.
    gt_outtab_block1-hvakey = xresult-hvakey.
    APPEND gt_outtab_block1.
  ENDLOOP.
  IF sy-subrc NE 0.
    gt_outtab_block1-remark = text-004.
    APPEND gt_outtab_block1.
  ENDIF.

ENDFORM.                    " select_data_for_block1

*&---------------------------------------------------------------------*
*&      Form  select_data_for_block2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data_for_block2 .

  CLEAR gt_outtab_block2.
  REFRESH gt_outtab_block2.


  LOOP AT xresult WHERE hkschl NE space OR pkschl NE space OR
                        hvakey NE space.
    gt_outtab_block2-knumh   = xresult-knumh.
    gt_outtab_block2-kotabnr = xresult-kotabnr.
    gt_outtab_block2-kschl   = xresult-kschl.
    gt_outtab_block2-vakey   = xresult-vakey(50).
    gt_outtab_block2-hkschl  = xresult-hkschl.
    gt_outtab_block2-hvakey  = xresult-hvakey.
    gt_outtab_block2-pkschl  = xresult-pkschl.
    APPEND gt_outtab_block2.
  ENDLOOP.
  IF sy-subrc NE 0.
    gt_outtab_block2-remark = text-008.
    APPEND gt_outtab_block2.
  ENDIF.



ENDFORM.                    " select_data_for_block2

*&---------------------------------------------------------------------*
*&      Form  set_events
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_LT_EVTS1  text
*----------------------------------------------------------------------*
FORM set_events  CHANGING ct_events TYPE slis_t_event.

  DATA: ls_events TYPE slis_alv_event.

  ls_events-name = 'END_OF_LIST'.
  ls_events-form = 'HANDLE_EVENT_END_OF_LIST'.
  APPEND ls_events TO ct_events.



  ls_events-name = 'TOP_OF_PAGE'.
  ls_events-form = 'HANDLE_EVENT_TOP_OF_PAGE'.
  APPEND ls_events TO ct_events.

ENDFORM.                    " set_events


*&---------------------------------------------------------------------*
*&      Form  handle_event_top_of_page
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM handle_event_top_of_page .

  DATA: lr_content TYPE REF TO cl_salv_form_element.

  PERFORM alv_form_top_of_page CHANGING lr_content.

  cl_salv_form_content=>set( lr_content ).

ENDFORM.                    " handle_event_top_of_page

*&---------------------------------------------------------------------*
*&      Form  alv_form_top_of_page
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM alv_form_top_of_page
                   CHANGING cr_content TYPE REF TO cl_salv_form_element.

  DATA: lr_grid  TYPE REF TO cl_salv_form_layout_grid,
        lr_flow  TYPE REF TO cl_salv_form_layout_flow,
        lr_label TYPE REF TO cl_salv_form_label,
        lr_text  TYPE REF TO cl_salv_form_text,
        lr_icon  TYPE REF TO cl_salv_form_icon,
        lv_row   TYPE i.


*... a grid is created
  CREATE OBJECT lr_grid.

  CASE gv_counter.
    WHEN 1.
* Zeile 1 Liste 1: Konsistenzpr¨¹fung KONH / KONP
      lr_grid->create_header_information(
        row    = 1
        column = 1
        text    = text-020
        tooltip = text-020 ).
    WHEN 2.
* Zeile 1 Liste 2: Pr¨¹fung Konditionsschl¨¹ssel und VAKEY
      lr_grid->create_header_information(
        row    = 1
        column = 1
        text    = text-021
        tooltip = text-021 ).
    WHEN 3.
* Zeile 1 Liste 3: Pr¨¹fung Staffelbezugsgr##e
      lr_grid->create_header_information(
        row    = 1
        column = 1
        text    = text-022
        tooltip = text-022 ).
    WHEN 4.
* Zeile 1 Liste 4: Pr¨¹fung auf doppelte Absprachen
      lr_grid->create_header_information(
        row    = 1
        column = 1
        text    = text-023
        tooltip = text-023 ).
    WHEN 5.
* Zeile 1 Liste 5: #berlappende Zeitr#ume
      lr_grid->create_header_information(
        row    = 1
        column = 1
        text    = text-024
        tooltip = text-024 ).
    WHEN 6.
* Zeile 1 Liste 6: Nummernvergabe f¨¹r das Feld KNUMH
      lr_grid->create_header_information(
        row    = 1
        column = 1
        text    = text-112
        tooltip = text-112 ).

      IF NOT act_interval IS INITIAL.
*... Zelle [2,1] Aktueller Nummernkreisstand KONH
        lr_flow = lr_grid->create_flow(
           row    = 2
           column = 1 ).
        lr_label = lr_flow->create_label(
                     text = text-106
                     tooltip = text-106 ).
        lr_text  = lr_flow->create_text(
                     text = act_interval-nrlevel+10(10)
                     tooltip = text-106 ).
        lr_label->set_label_for( lr_text ).

        lv_row = 3.
        IF gv_text_051 = 'X'.
*... Zelle [3,1] Eintr#ge mit tempor#rer KNUMH in KONH
          lr_flow = lr_grid->create_flow(
             row    = 3
             column = 1 ).
          lr_label = lr_flow->create_label(
                       text = text-051
                       tooltip = text-051 ).
          lr_text  = lr_flow->create_text(
                       text = text-103
                       tooltip = text-103 ).
          lr_label->set_label_for( lr_text ).

          CREATE OBJECT lr_icon
            EXPORTING
              icon = icon_yellow_light.
          lr_icon->set_tooltip( text-103 ).
          lr_grid->set_element(
           row       = 3
           column    = 2
           r_element = lr_icon ).
        ENDIF.
        lv_row = 4.
      ENDIF.
      IF gv_text_052 = 'X'.
*... Zelle [4,1] Eintr#ge mit tempor#rer KNUMH in KONP
        lr_flow = lr_grid->create_flow(
           row    = lv_row
           column = 1 ).
        lr_label = lr_flow->create_label(
                     text = text-052
                     tooltip = text-052 ).
        lr_text  = lr_flow->create_text(
                     text = text-103
                     tooltip = text-103 ).
        lr_label->set_label_for( lr_text ).

        CREATE OBJECT lr_icon
          EXPORTING
            icon = icon_yellow_light.
        lr_icon->set_tooltip( text-103 ).
        lr_grid->set_element(
         row       = lv_row
         column    = 2
         r_element = lr_icon ).


      ENDIF.
  ENDCASE.
  cr_content = lr_grid.

ENDFORM.                    "alv_form_top_of_page

*&---------------------------------------------------------------------*
*&      Form  set_layout
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_LS_LAYO  text
*----------------------------------------------------------------------*
FORM set_layout   CHANGING cs_layo TYPE slis_layout_alv.

  cs_layo-zebra = 'X'.
  cs_layo-colwidth_optimize = 'X'.
  cs_layo-min_linesize  = '255'.
*  cs_layo-max_linesize  = '200'.

  CASE gv_counter.
    WHEN 1.
      IF gv_1_is_first = 'X'.
        cs_layo-list_append      = 'Y'. "sonst keine Append-Liste
      ENDIF.
    WHEN 2.
      IF gv_2_is_first = 'X'.
        cs_layo-list_append      = 'Y'. "sonst keine Append-Liste
      ELSE.
        cs_layo-list_append      = 'X'. "sonst keine Append-Liste
      ENDIF.
    WHEN 3.
      IF gv_3_is_first = 'X'.
        cs_layo-list_append      = 'Y'. "sonst keine Append-Liste
      ELSE.
        cs_layo-list_append      = 'X'. "sonst keine Append-Liste
      ENDIF.
    WHEN 4.
      IF gv_4_is_first = 'X'.
        cs_layo-list_append      = 'Y'. "sonst keine Append-Liste
      ELSE.
        cs_layo-list_append      = 'X'. "sonst keine Append-Liste
      ENDIF.
    WHEN 5.
      IF gv_5_is_first = 'X'.
        cs_layo-list_append      = 'Y'. "sonst keine Append-Liste
      ELSE.
        cs_layo-list_append      = 'X'. "sonst keine Append-Liste
      ENDIF.
    WHEN 6.
      IF gv_6_is_first = 'X'.
        cs_layo-list_append      = 'Y'. "sonst keine Append-Liste
      ELSE.
        cs_layo-list_append      = 'X'. "sonst keine Append-Liste
      ENDIF.
  ENDCASE.

ENDFORM.                    "set_layout

*&---------------------------------------------------------------------*
*&      Form  handle_event_pf_status
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM handle_event_pf_status USING rt_extab TYPE slis_t_extab. "#EC *

  SET PF-STATUS 'LIST_ALV'.

ENDFORM.                    " handle_event_pf_status

*&---------------------------------------------------------------------*
*&      Form  handle_event_user_command
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM handle_event_user_command USING r_ucomm     TYPE syucomm
                               rs_selfield TYPE slis_selfield. "#EC *
  CLEAR xresult.

* simulate the HIDE-command...
  CASE rs_selfield-tabname.
    WHEN 'GT_OUTTAB_BLOCK1'.
      READ TABLE gt_outtab_block1 INDEX rs_selfield-tabindex.
      IF sy-subrc = 0.
        xresult-kotabnr = gt_outtab_block1-kotabnr.
        xresult-vakey   = gt_outtab_block1-vakey.
      ENDIF.
    WHEN 'GT_OUTTAB_BLOCK2'.
      READ TABLE gt_outtab_block2 INDEX rs_selfield-tabindex.
      IF sy-subrc = 0.
        CASE rs_selfield-sel_tab_field.
          WHEN 'GT_OUTTAB_BLOCK2-KNUMH' OR 'GT_OUTTAB_BLOCK2-KOTABNR'
            OR 'GT_OUTTAB_BLOCK2-KSCHL' OR 'GT_OUTTAB_BLOCK2-VAKEY'.
            xresult-kotabnr = gt_outtab_block2-kotabnr.
            xresult-vakey   = gt_outtab_block2-vakey.
            xresult-knumh   = gt_outtab_block2-knumh.
*          when GT_OUTTAB_BLOCK2-HKSCHL or GT_OUTTAB_BLOCK2-HVAKEY.
          WHEN OTHERS.
            xresult-kotabnr = gt_outtab_block2-kotabnr.
            xresult-hvakey  = gt_outtab_block2-hvakey.
        ENDCASE.
      ENDIF.
    WHEN 'GT_OUTTAB_BLOCK3'.
      READ TABLE gt_outtab_block3 INDEX rs_selfield-tabindex.
      IF sy-subrc = 0.
        xresult-kotabnr = gt_outtab_block3-kotabnr.
        xresult-vakey   = gt_outtab_block3-vakey.
        xresult-knumh   = gt_outtab_block3-knumh.
      ENDIF.
    WHEN 'GT_OUTTAB_BLOCK4'.
      READ TABLE gt_outtab_block4 INDEX rs_selfield-tabindex.
      IF sy-subrc = 0.
        xresult-kotabnr = gt_outtab_block4-kotabnr.
        xresult-vakey   = gt_outtab_block4-vakey.
      ENDIF.
    WHEN 'GT_OUTTAB_BLOCK5'.
      READ TABLE gt_outtab_block5 INDEX rs_selfield-tabindex.
      IF sy-subrc = 0.
        xresult-kotabnr = gt_outtab_block5-kotabnr.
        xresult-vakey   = gt_outtab_block5-vakey.
        xresult-knumh   = gt_outtab_block5-knumh.
      ENDIF.
    WHEN 'GT_OUTTAB_BLOCK6'.
      READ TABLE gt_outtab_block6 INDEX rs_selfield-tabindex.
  ENDCASE.

  CASE r_ucomm.
    WHEN '&IC1'.
      PERFORM vakey_popup_alv.
      CLEAR xresult.
    WHEN 'ENT1'.
      SUBTRACT 2 FROM syst-lsind.
    WHEN 'CANC'.
      SUBTRACT 2 FROM syst-lsind.
    WHEN 'RECO'.
      IF NOT xresult-knumh IS INITIAL.
        CALL FUNCTION 'RV_CONDITION_RESET'.
        CALL FUNCTION 'RV_CONDITION_RECORD'
          EXPORTING
            condition_number = xresult-knumh
            item_number      = '01'
            condition_use    = act_kvewe.
      ELSE.
        MESSAGE i798.
      ENDIF.
      CLEAR xresult.
  ENDCASE.

ENDFORM.                    " handle_event_user_command

*&---------------------------------------------------------------------*
*&      Form  handle_event_end_of_list
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM handle_event_end_of_list .                             "#EC *
  CASE gv_counter.
    WHEN 1.
* call the 2. list ...
      PERFORM display_block2_alv.
    WHEN 2.
* call the 3. list ...
      PERFORM display_block3_alv.
    WHEN 3.
* call the 4. list ...
      PERFORM display_block4_alv.
    WHEN 4.
* call the 5. list ...
      PERFORM display_block5_alv.
    WHEN 5.
* call the 6. list ...
      PERFORM display_block6_alv.
  ENDCASE.
ENDFORM.                    " handle_event_end_of_list

*&---------------------------------------------------------------------*
*&      Form  select_data_for_block3
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data_for_block3 .
  CLEAR gt_outtab_block3.
  REFRESH gt_outtab_block3.

  LOOP AT xresult WHERE pkzbzg NE space.
    gt_outtab_block3-knumh   = xresult-knumh.
    gt_outtab_block3-kotabnr = xresult-kotabnr.
    gt_outtab_block3-kschl   = xresult-kschl.
    gt_outtab_block3-kzbzga  = xresult-kzbzga.
    IF xresult-pkzbzg EQ 'M'.
      gt_outtab_block3-pkzbzg_text = text-036.
    ELSE.
      gt_outtab_block3-pkzbzg_text = text-037.
    ENDIF.
    gt_outtab_block3-hvakey = xresult-hvakey.
    gt_outtab_block3-vakey  = xresult-vakey.
    APPEND gt_outtab_block3.
  ENDLOOP.
  IF sy-subrc NE 0.
    gt_outtab_block3-remark = text-010.
    APPEND gt_outtab_block3.
  ENDIF.


ENDFORM.                    " select_data_for_block3

*&---------------------------------------------------------------------*
*&      Form  select_data_for_block4
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data_for_block4 .
  CLEAR gt_outtab_block4.
  REFRESH gt_outtab_block4.
  LOOP AT xresult WHERE dknuma NE space.
    gt_outtab_block4-kotabnr = xresult-kotabnr.
    gt_outtab_block4-kschl   = xresult-kschl.
    gt_outtab_block4-vakey   = xresult-vakey.
    gt_outtab_block4-dknuma  = xresult-dknuma.
    gt_outtab_block4-hvakey  = xresult-hvakey.
    gt_outtab_block4-knumh   = xresult-knumh.
    APPEND gt_outtab_block4.
  ENDLOOP.
  IF sy-subrc NE 0.
    gt_outtab_block4-remark = text-011.
    APPEND gt_outtab_block4.
  ENDIF.

ENDFORM.                    " select_data_for_block4

*&---------------------------------------------------------------------*
*&      Form  select_data_for_block5
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data_for_block5 .
  CLEAR gt_outtab_block5.
  REFRESH gt_outtab_block5.

  LOOP AT xresult WHERE iknumh NE space.
    gt_outtab_block5-kotabnr  = xresult-kotabnr.
    gt_outtab_block5-kschl    = xresult-kschl.
    gt_outtab_block5-knumh    = xresult-knumh.
    gt_outtab_block5-datab    = xresult-datab.
    gt_outtab_block5-datbi    = xresult-datbi.
    gt_outtab_block5-iknumh   = xresult-iknumh.
    gt_outtab_block5-idatab   = xresult-idatab.
    gt_outtab_block5-idatbi   = xresult-idatbi.
    gt_outtab_block5-hvakey   = xresult-hvakey.
    gt_outtab_block5-vakey    = xresult-vakey.
    APPEND gt_outtab_block5.
  ENDLOOP.
  IF sy-subrc NE 0.
    gt_outtab_block5-remark = text-014.
    APPEND gt_outtab_block5.
  ENDIF.


ENDFORM.                    " select_data_for_block5

*&---------------------------------------------------------------------*
*&      Form  select_data_for_block6
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM select_data_for_block6 .
  CLEAR:  gv_text_051,
          gv_text_052,
          gt_outtab_block6.
  REFRESH gt_outtab_block6.

  IF NOT act_interval IS INITIAL.
    LOOP AT numkr.
      gt_outtab_block6-kotabnr = numkr-kotabnr.
      IF numkr-konhmax NE con_knumh_0 OR numkr-konpmax NE con_knumh_0.
        gt_outtab_block6-konhmax = numkr-konhmax.
        gt_outtab_block6-konpmax = numkr-konpmax.
*        WRITE: 47 NUMKR-KONHMAX, '/', NUMKR-KONPMAX.
        IF numkr-konhmax GT act_interval-nrlevel OR
           numkr-konpmax GT act_interval-nrlevel.         "#EC PORTABLE
          gt_outtab_block6-status = icon_red_light.
        ELSE.
          gt_outtab_block6-status = icon_green_light.
        ENDIF.
      ELSE.
        gt_outtab_block6-remark = text-017.
      ENDIF.
      APPEND gt_outtab_block6.
    ENDLOOP.
  ENDIF.

  SELECT knumh FROM konh INTO konh-knumh
    WHERE knumh BETWEEN '$000000000' AND '$999999999'.    "#EC PORTABLE
  ENDSELECT.
  IF sy-subrc EQ 0.
    gv_text_051 = 'X'.
  ENDIF.
  SELECT knumh FROM konp INTO konp-knumh
    WHERE knumh BETWEEN '$000000000' AND '$999999999'.    "#EC PORTABLE
  ENDSELECT.
  IF sy-subrc EQ 0.
    gv_text_052 = 'X'.
  ENDIF.
ENDFORM.                    " select_data_for_block6
*&---------------------------------------------------------------------*
*&      Form  set_tooltip
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      <--P_LT_EXC  text
*----------------------------------------------------------------------*
FORM set_tooltip  CHANGING ct_exc TYPE alv_t_qinf.

* Setzen Tooltips f¨¹r die Icons
  DATA: tooltips TYPE REF TO cl_salv_tooltips,
        ls_exc TYPE alv_s_qinf.
  ls_exc-type        = cl_salv_tooltip=>c_type_icon.
  ls_exc-fieldname   = 'STATUS'.
  ls_exc-tabname     = 'GT_OUTTAB_BLOCK6'.
  ls_exc-value       = icon_green_light.
  ls_exc-text        = text-606.
  APPEND ls_exc TO ct_exc.

  ls_exc-type        = cl_salv_tooltip=>c_type_icon.
  ls_exc-fieldname   = 'STATUS'.
  ls_exc-tabname     = 'GT_OUTTAB_BLOCK6'.
  ls_exc-value       = icon_red_light.
  ls_exc-text        = text-607.
  APPEND ls_exc TO ct_exc.

ENDFORM.                    " set_tooltip
*&---------------------------------------------------------------------*
*&      Form  display_window_table_alv
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM display_window_table_alv .

  CALL FUNCTION 'REUSE_ALV_POPUP_TO_SELECT'
    EXPORTING
      i_title               = text-608
      i_selection           = ' '
      i_allow_no_selection  = 'X'
      i_screen_start_column = 10
      i_screen_start_line   = 10
      i_screen_end_column   = 60
      i_screen_end_line     = 15
      i_tabname             = 'WINDOW_TABLE'
      i_structure_name      = 'CMDC0_7_ALV'
      i_callback_program    = gv_repid
    TABLES
      t_outtab              = window_table
    EXCEPTIONS
      program_error         = 1
      OTHERS                = 2.

  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

ENDFORM.                    " display_window_table_alv

*---------------------------------------------------------------------*
*      Form  WRITE_BLOCK1                                             *
*---------------------------------------------------------------------*
FORM write_block1.
* explanation
  WRITE text-020 COLOR OFF INTENSIFIED OFF.
* header
  ULINE AT (list_width).
  FORMAT COLOR COL_HEADING INTENSIFIED.
  WRITE: / sy-vline NO-GAP, text-025 NO-GAP, 12 sy-vline NO-GAP,
                              text-007 NO-GAP, 16 sy-vline NO-GAP,
                              text-005 NO-GAP, 21 sy-vline NO-GAP,
                              text-006 NO-GAP, 72 sy-vline NO-GAP,
                              text-026 NO-GAP, 83 sy-vline NO-GAP,
                              text-027 NO-GAP.
  WRITE AT list_width sy-vline.
  ULINE AT (list_width).
* body
  lcol = 0.
  LOOP AT xresult WHERE nkonhx NE space OR nkonpx NE space.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP,
             xresult-knumh COLOR COL_KEY INTENSIFIED NO-GAP,
             12 sy-vline NO-GAP,
             xresult-kotabnr NO-GAP, 16 sy-vline NO-GAP,
             xresult-kschl NO-GAP, 21 sy-vline NO-GAP,
             xresult-vakey(50) NO-GAP, 72 sy-vline NO-GAP.
    HIDE: xresult-kotabnr, xresult-vakey.
    IF konhex NE space.
      IF xresult-nkonhx EQ 'X'.
        WRITE: 73 text-500 NO-GAP, 83 sy-vline NO-GAP.
      ELSE.
        WRITE: 73 text-501 NO-GAP, 83 sy-vline NO-GAP.
      ENDIF.
    ELSE.
      WRITE: 73 text-502 NO-GAP, 83 sy-vline NO-GAP.
    ENDIF.
    IF konpex NE space.
      IF xresult-nkonpx EQ 'X'.
        WRITE: 84 text-500 NO-GAP.
      ELSEIF xresult-nkonpx EQ 'O'.
        WRITE: 84 text-503 NO-GAP.
      ELSE.
        WRITE: 84 text-501 NO-GAP.
      ENDIF.
    ELSE.
      WRITE: 84 text-502 NO-GAP.
    ENDIF.
    WRITE AT list_width sy-vline.
  ENDLOOP.
  IF sy-subrc NE 0.
    FORMAT COLOR COL_NORMAL INTENSIFIED.
    WRITE: sy-vline NO-GAP, text-004.
    WRITE AT list_width sy-vline.
  ENDIF.
  ULINE AT (list_width).
ENDFORM.                               " WRITE_BLOCK1

*---------------------------------------------------------------------*
*      Form  WRITE_BLOCK2                                             *
*---------------------------------------------------------------------*
FORM write_block2.
  NEW-PAGE.
* explanation
  WRITE text-021 COLOR OFF INTENSIFIED OFF.
* header
  ULINE AT (list_width).
  FORMAT COLOR COL_HEADING INTENSIFIED.
  WRITE: / sy-vline NO-GAP,
         text-025 NO-GAP, 12 sy-vline NO-GAP,
         text-007 NO-GAP, 16 sy-vline NO-GAP,
         text-005 NO-GAP, 21 sy-vline NO-GAP,
         text-006.
  WRITE 63 text-050.
  WRITE AT list_width sy-vline.
  WRITE: / sy-vline, 12 sy-vline NO-GAP, 16 sy-vline NO-GAP,
             text-005 NO-GAP, 21 sy-vline NO-GAP, text-006.
  WRITE 63 text-051.
  WRITE AT list_width sy-vline.
  WRITE: / sy-vline, 12 sy-vline NO-GAP, 16 sy-vline NO-GAP,
             text-005 NO-GAP, 21 sy-vline.
  WRITE 63 text-052.
  WRITE AT list_width sy-vline.
  ULINE AT (list_width).
* body
  lcol = 0.
  LOOP AT xresult WHERE hkschl NE space OR pkschl NE space OR
                        hvakey NE space.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP,
             xresult-knumh COLOR COL_KEY INTENSIFIED NO-GAP,
             12 sy-vline NO-GAP,
             xresult-kotabnr NO-GAP, 16 sy-vline NO-GAP,
             xresult-kschl NO-GAP, 21 sy-vline NO-GAP,
             xresult-vakey(50).
    WRITE AT list_width sy-vline.
    HIDE: xresult-kotabnr, xresult-vakey, xresult-knumh.
    WRITE: / sy-vline, 12 sy-vline, 16 sy-vline NO-GAP,
             xresult-hkschl NO-GAP, 21 sy-vline NO-GAP, xresult-hvakey.
    WRITE AT list_width sy-vline.
    HIDE: xresult-kotabnr, xresult-hvakey.
    WRITE: / sy-vline, 12 sy-vline, 16 sy-vline NO-GAP,
             xresult-pkschl NO-GAP, 21 sy-vline.
    WRITE AT list_width sy-vline.
  ENDLOOP.
  IF sy-subrc NE 0.
    FORMAT COLOR COL_NORMAL INTENSIFIED.
    WRITE: sy-vline NO-GAP, text-008.
    WRITE AT list_width sy-vline.
  ENDIF.
  ULINE AT (list_width).
ENDFORM.                               " WRITE_BLOCK2

*---------------------------------------------------------------------*
*      Form  WRITE_BLOCK3                                             *
*---------------------------------------------------------------------*
FORM write_block3.
  NEW-PAGE.
* explanation
  WRITE text-022 COLOR OFF INTENSIFIED OFF.
* header
  ULINE AT (list_width).
  FORMAT COLOR COL_HEADING INTENSIFIED.
  WRITE: / sy-vline NO-GAP,
         text-025 NO-GAP, 12 sy-vline NO-GAP,
         text-007 NO-GAP, 16 sy-vline NO-GAP,
         text-005 NO-GAP, 21 sy-vline NO-GAP,
         text-033 NO-GAP, 27 sy-vline NO-GAP,
         text-012.
  WRITE AT list_width sy-vline.
  ULINE AT (list_width).
* body
  lcol = 0.
  LOOP AT xresult WHERE pkzbzg NE space.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP,
             xresult-knumh COLOR COL_KEY INTENSIFIED NO-GAP,
             12 sy-vline NO-GAP,
             xresult-kotabnr NO-GAP, 16 sy-vline NO-GAP,
             xresult-kschl NO-GAP, 21 sy-vline NO-GAP,
             xresult-kzbzga.
    HIDE: xresult-kotabnr, xresult-vakey, xresult-knumh.
    IF xresult-pkzbzg EQ 'M'.
      WRITE: 27 sy-vline NO-GAP, text-036.
    ELSE.
      WRITE: 27 sy-vline NO-GAP, text-037.
    ENDIF.
    WRITE AT list_width sy-vline.
  ENDLOOP.
  IF sy-subrc NE 0.
    FORMAT COLOR COL_NORMAL INTENSIFIED.
    WRITE: sy-vline NO-GAP, text-010.
    WRITE AT list_width sy-vline.
  ENDIF.
  ULINE AT (list_width).
ENDFORM.                               " WRITE_BLOCK3

*---------------------------------------------------------------------*
*      Form  WRITE_BLOCK4                                             *
*---------------------------------------------------------------------*
FORM write_block4.
  NEW-PAGE.
* explanation
  WRITE text-023 COLOR OFF INTENSIFIED OFF.
* header
  ULINE AT (list_width).
  FORMAT COLOR COL_HEADING INTENSIFIED.
  WRITE: / sy-vline NO-GAP,
         text-007 NO-GAP, 5 sy-vline NO-GAP,
         text-005 NO-GAP, 10 sy-vline NO-GAP,
         text-006 NO-GAP, 62 sy-vline NO-GAP,
         text-031 NO-GAP.
  WRITE AT list_width sy-vline.
  ULINE AT (list_width).
* body
  lcol = 0.
  LOOP AT xresult WHERE dknuma NE space.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP,
               xresult-kotabnr NO-GAP, 5 sy-vline NO-GAP,
               xresult-kschl NO-GAP, 10 sy-vline NO-GAP,
               11 xresult-vakey(50) NO-GAP, 62 sy-vline NO-GAP,
               xresult-dknuma.
    WRITE AT list_width sy-vline.
    HIDE: xresult-kotabnr, xresult-vakey.
  ENDLOOP.
  IF sy-subrc NE 0.
    FORMAT COLOR COL_NORMAL INTENSIFIED.
    WRITE: sy-vline NO-GAP, text-011.
    WRITE AT list_width sy-vline.
  ENDIF.
  ULINE AT (list_width).
ENDFORM.                               " WRITE_BLOCK4

*---------------------------------------------------------------------*
*      Form  WRITE_BLOCK5                                             *
*---------------------------------------------------------------------*
FORM write_block5.
  NEW-PAGE.
* explanation
  WRITE text-024 COLOR OFF INTENSIFIED OFF.
* header
  ULINE AT (list_width).
  FORMAT COLOR COL_HEADING INTENSIFIED.
  WRITE: / sy-vline NO-GAP,
         text-007 NO-GAP, 5 sy-vline NO-GAP,
         text-005 NO-GAP, 10 sy-vline NO-GAP,
         text-025 NO-GAP, 21 sy-vline NO-GAP,
         text-013 NO-GAP, 32 sy-vline NO-GAP.
  WRITE: text-032 NO-GAP, 43 sy-vline NO-GAP.
  WRITE: text-025 NO-GAP, 54 sy-vline NO-GAP,
         text-013 NO-GAP, 65 sy-vline NO-GAP.
  WRITE: text-032 NO-GAP.
  WRITE AT list_width sy-vline.
  ULINE AT (list_width).
* body
  lcol = 0.
  LOOP AT xresult WHERE iknumh NE space.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP,
             xresult-kotabnr NO-GAP, 5 sy-vline NO-GAP,
             xresult-kschl NO-GAP, 10 sy-vline NO-GAP,
             xresult-knumh NO-GAP, 21 sy-vline NO-GAP,
             xresult-datab NO-GAP, 32 sy-vline NO-GAP.
    WRITE:   xresult-datbi NO-GAP, 43 sy-vline NO-GAP.
    WRITE:   xresult-iknumh NO-GAP, 54 sy-vline NO-GAP,
             xresult-idatab NO-GAP, 65 sy-vline NO-GAP.
    WRITE:   xresult-idatbi NO-GAP.
    WRITE AT list_width sy-vline.
    HIDE: xresult-kotabnr, xresult-vakey, xresult-knumh.
  ENDLOOP.
  IF sy-subrc NE 0.
    FORMAT COLOR COL_NORMAL INTENSIFIED.
    WRITE: sy-vline NO-GAP, text-014 NO-GAP.
    WRITE AT list_width sy-vline.
  ENDIF.
  ULINE AT (list_width).
ENDFORM.                               " WRITE_BLOCK5

*---------------------------------------------------------------------*
*      Form  WRITE_NUMFOOT                                            *
*---------------------------------------------------------------------*
FORM write_numfoot.
  NEW-PAGE.
* explanation
  WRITE text-112 COLOR OFF INTENSIFIED OFF.
* header
  ULINE AT (list_width).
  FORMAT COLOR COL_HEADING.
  WRITE: / sy-vline NO-GAP,
         text-040 NO-GAP,
         45 sy-vline NO-GAP, text-025 NO-GAP.
  WRITE AT list_width sy-vline.
  ULINE AT (list_width).
* body
  IF NOT act_interval IS INITIAL.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP,
             text-106 NO-GAP,
             45 sy-vline, act_interval-nrlevel+10(10).
    WRITE AT list_width sy-vline.
    LOOP AT numkr.
      PERFORM listformat.
      WRITE: / sy-vline NO-GAP, 2 numkr-kotabnr,
              45 sy-vline.
      IF numkr-konhmax NE con_knumh_0 OR numkr-konpmax NE con_knumh_0.
        WRITE: 47 numkr-konhmax, '/', numkr-konpmax.
        IF numkr-konhmax GT act_interval-nrlevel OR
           numkr-konpmax GT act_interval-nrlevel.         "#EC PORTABLE
          WRITE 90 icon_red_light AS ICON.
        ELSE.
          WRITE 90 icon_green_light AS ICON.
        ENDIF.
      ELSE.
        WRITE: 45 sy-vline NO-GAP, text-017.
      ENDIF.
      WRITE AT list_width sy-vline.
    ENDLOOP.
  ENDIF.
  SELECT knumh FROM konh INTO konh-knumh
    WHERE knumh BETWEEN '$000000000' AND '$999999999'.    "#EC PORTABLE
  ENDSELECT.
  IF sy-subrc EQ 0.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP, text-051 NO-GAP,
          45 sy-vline, text-103, 90 icon_yellow_light AS ICON.
    WRITE AT list_width sy-vline.
  ENDIF.
  SELECT knumh FROM konp INTO konp-knumh
    WHERE knumh BETWEEN '$000000000' AND '$999999999'.    "#EC PORTABLE
  ENDSELECT.
  IF sy-subrc EQ 0.
    PERFORM listformat.
    WRITE: / sy-vline NO-GAP, text-052 NO-GAP,
            45 sy-vline, text-103, 90 icon_yellow_light AS ICON.
    WRITE AT list_width sy-vline.
  ENDIF.
  ULINE AT (list_width).
ENDFORM.                               " WRITE_NUMFOOT

*---------------------------------------------------------------------*
*       FORM LISTFORMAT                                               *
*---------------------------------------------------------------------*
FORM listformat.
  IF lcol EQ 1.
    lcol = 0.
    FORMAT COLOR COL_NORMAL INTENSIFIED OFF.
  ELSE.
    lcol = 1.
    FORMAT COLOR COL_NORMAL INTENSIFIED ON.
  ENDIF.
ENDFORM.                    "LISTFORMAT

*---------------------------------------------------------------------*
*      Form  VAKEY_POPUP                                              *
*---------------------------------------------------------------------*
FORM vakey_popup.
  CHECK NOT xresult IS INITIAL.
  IF NOT xresult-hvakey IS INITIAL.
    CALL FUNCTION 'VAKEY_TO_WINDOW_TABLE'
      EXPORTING
        table_number      = xresult-kotabnr
        usage             = act_kvewe
        variable_key      = xresult-hvakey
      TABLES
        description_table = description_table
        window_table      = window_table
      EXCEPTIONS
        OTHERS            = 2.
  ELSE.
    CALL FUNCTION 'VAKEY_TO_WINDOW_TABLE'
      EXPORTING
        table_number      = xresult-kotabnr
        usage             = act_kvewe
        variable_key      = xresult-vakey
      TABLES
        description_table = description_table
        window_table      = window_table
      EXCEPTIONS
        OTHERS            = 2.
  ENDIF.
  IF sy-subrc EQ 0.
    NEW-PAGE LINE-SIZE 100.
    WINDOW STARTING AT 10 10 ENDING AT 60 15.
    SET TITLEBAR 'CM01'.
    SET PF-STATUS 'ABBR'.
    LOOP AT window_table.
      WRITE / window_table(100).
    ENDLOOP.
  ELSE.
    MESSAGE i796.
  ENDIF.
ENDFORM.                               " VAKEY_POPUP

*&--------------------------------------------------------------------*
*&      Form  f4_kotabnr
*&--------------------------------------------------------------------*
*       text
*---------------------------------------------------------------------*
*      -->P_KOTABNR  text
*---------------------------------------------------------------------*
FORM f4_kotabnr CHANGING p_kotabnr.
  DATA: ls_t681 TYPE t681.

  PERFORM set_kvewe.

  CALL FUNCTION 'RV_GET_CONDITION_TABLES'
    EXPORTING
      condition_use          = act_kvewe
      display_always         = 'X'
      like_pf4               = 'X'
*     don't show deactivated tables (SFW)
      table_status           = ' 123456789'
      table_generate         = ' '
    IMPORTING
      table_t681             = ls_t681
    EXCEPTIONS
      invalid_condition_type = 1
      missing_parameter      = 2
      no_selection_done      = 3
      no_table_found         = 4
      table_not_valid        = 5
      OTHERS                 = 6.
  IF sy-subrc <> 0.
    CLEAR ls_t681.
  ENDIF.

  IF ls_t681 IS NOT INITIAL.
    p_kotabnr = ls_t681-kotabnr.
  ENDIF.

ENDFORM.                                                    "f4_kotabnr

*&--------------------------------------------------------------------*
*&      Form  set_kvewe
*&--------------------------------------------------------------------*
*       text
*---------------------------------------------------------------------*
FORM set_kvewe.
  IF kvewe_a NE space.
    act_kvewe = 'A'.
  ELSEIF kvewe_e NE space.
    act_kvewe = 'E'.
  ELSE.
    MESSAGE e791.
  ENDIF.
ENDFORM.                    "set_kvewe
