************************************************************************
* Report  : YSE_CS_OPS_WORKSHOP_RPT                                    *
*----------------------------------------------------------------------*
* Author  : Eric Felly                                                 *
* Company : CSC                                                        *
* Created : 09.03.2007                                                 *
* Dev.nbr : D172-D175 CS-REP-Operational workshop report               *
*----------------------------------------------------------------------*
* This program will cover a lot of different  reports                  *
* (repair stats, service variance, performance, failure reporting)     *
************************************************************************
REPORT YSE_CS_OPS_WORKSHOP_RPT NO STANDARD PAGE HEADING.

*----------------------------------------------------------------------*
* Data declarations                                                    *
*----------------------------------------------------------------------*
INCLUDE YSE_CS_OPS_WORKSHOP_RPT_TOP.
*
*
*----------------------------------------------------------------------*
* Selection screen                                                     *
*----------------------------------------------------------------------*
INCLUDE YSE_CS_OPS_WORKSHOP_RPT_S01.
*
*----------------------------------------------------------------------*
* Initialization of the selection screen                               *
*----------------------------------------------------------------------*
INITIALIZATION.

*at selection-screen on value-request for p_var.
*  perform variant_inputhelp using p_var.

*at selection-screen output.
*
*  perform variant_init.
*  if p_var is initial and g_variant_flag is initial.
*    perform get_default_variant using p_var.
*    g_variant_flag = 'X'.
*  endif.

*at selection-screen.
*  perform existence_variant using p_var.

*PERFORM init_alv_field. " Field names initialization
*
*g_repid           = sy-repid.
*gs_variant-report = g_repid.
*g_save            = 'A'.

************************************************************************
* START MAIN PROGRAM                                                   *
************************************************************************
START-OF-SELECTION.

  PERFORM INITIALIZE_DATA.

  PERFORM SELECT_DATA.
* during the  process form we continue
* to perform selections based on previous data extraction
* in a way to reduce at each step the number of extracted data.
  PERFORM PROCESS_DATA.

  PERFORM DISPLAY_DATA.



************************************************************************
* SUBROUTINES  LEVEL 01                                                *
************************************************************************

*----------------------------------------------------------------------*
*       Form  VARIANT_INPUTHELP                                        *
*----------------------------------------------------------------------*
*       F4 - help for variants                                         *
*----------------------------------------------------------------------*
FORM VARIANT_INPUTHELP USING VAR.

  CLEAR H_EXIT.
  CLEAR GX_VARIANT.

  CALL FUNCTION 'REUSE_ALV_VARIANT_F4'
    EXPORTING
      IS_VARIANT    = G_VARIANT
      I_SAVE        = G_VARIANT_SAVE
    IMPORTING
      E_EXIT        = H_EXIT
      ES_VARIANT    = GX_VARIANT
    EXCEPTIONS
      NOT_FOUND     = 1
      PROGRAM_ERROR = 2
      OTHERS        = 3.

  IF SY-SUBRC IS INITIAL AND H_EXIT IS INITIAL.
    G_VARIANT-VARIANT = GX_VARIANT-VARIANT.
    VAR               = GX_VARIANT-VARIANT.
  ENDIF.

ENDFORM.                    " VARIANT_INPUTHELP


*----------------------------------------------------------------------*
*       Form  VARIANT_INIT                                             *
*----------------------------------------------------------------------*
*       Initialize variant                                             *
*----------------------------------------------------------------------*
FORM VARIANT_INIT.

  CLEAR G_VARIANT.

  X_REPID = SY-REPID.
  G_VARIANT-REPORT    = X_REPID.

ENDFORM.                    " VARIANT_INIT


*----------------------------------------------------------------------*
*       Form  EXISTENCE_VARIANT                                        *
*----------------------------------------------------------------------*
*       Does the variant exist ?                                       *
*----------------------------------------------------------------------*
FORM EXISTENCE_VARIANT USING VAR LIKE G_VARIANT-VARIANT.

  IF NOT VAR IS INITIAL.
    G_VARIANT-VARIANT = VAR.
    CALL FUNCTION 'REUSE_ALV_VARIANT_EXISTENCE'
      EXPORTING
        I_SAVE     = G_VARIANT_SAVE
      CHANGING
        CS_VARIANT = G_VARIANT.
  ELSE.
    PERFORM VARIANT_INIT.
  ENDIF.

ENDFORM.                    " EXISTENCE_VARIANT


*----------------------------------------------------------------------*
*       Form  GET_DEFAULT_VARIANT                                      *
*----------------------------------------------------------------------*
*       If there is an existing default variant - get it               *
*----------------------------------------------------------------------*
FORM GET_DEFAULT_VARIANT USING VAR.

  GX_VARIANT = G_VARIANT.
  CALL FUNCTION 'REUSE_ALV_VARIANT_DEFAULT_GET'
    EXPORTING
      I_SAVE     = G_VARIANT_SAVE
    CHANGING
      CS_VARIANT = GX_VARIANT
    EXCEPTIONS
      NOT_FOUND  = 2.

  IF SY-SUBRC IS INITIAL.
    VAR = GX_VARIANT-VARIANT.
  ENDIF.

ENDFORM.                    " GET_DEFAULT_VARIANT


*----------------------------------------------------------------------*
*   Form  INITIALIZE_DATA                                              *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM INITIALIZE_DATA.

  IF RB_SEL2  IS NOT INITIAL
  OR RB_SEL4  IS NOT INITIAL.
    MOVE  'Y'  TO GV_GAC-PGC-TEST.
  ENDIF.

* Build the reference table for orders with a teco
* to be used to count the orders with teco per equipment
*
*  IF RB_SEL4  IS NOT INITIAL.
*    SELECT OBJNR   FROM JCDS
*                     INTO TABLE IT_JCDS_TECO
*                    WHERE
*                       STAT = 'I0045'
*                   AND UDATE IN S_DATE.
*    SORT IT_JCDS_TECO ASCENDING.
*    DELETE ADJACENT DUPLICATES FROM IT_JCDS_TECO COMPARING OBJNR.
**
*    SELECT AUFNR OBJNR EQUNR FROM VIAUFKS
*                  INTO CORRESPONDING FIELDS OF TABLE
*                                            IT_AUFK_TECO_REF
*                       FOR ALL ENTRIES IN IT_JCDS_TECO
*                  WHERE
*                       OBJNR = IT_JCDS_TECO-OBJNR.
**
*    FREE  IT_JCDS_TECO.
*  ENDIF.
*
*  clear: r_parvw.
*  refresh: r_parvw.
*  r_parvw-sign   = 'I'.
*  r_parvw-option = 'EQ'.
*  r_parvw-low    = c_parvw_ve.  append r_parvw.
*  r_parvw-low    = c_parvw_zx.  append r_parvw.
*  r_parvw-low    = c_parvw_zy.  append r_parvw.
*
*  clear: r_date1, r_date2.
*  refresh: r_date1, r_date2.
*  if not rb_sel1 is initial.
*    r_date1-sign   = 'I'.
*    r_date1-option = 'BT'.
*    r_date1-low    = p_fdate.
*    r_date1-high   = p_tdate.
*    append r_date1.
*  else.
*    r_date2-sign   = 'I'.
*    r_date2-option = 'BT'.
*    r_date2-low    = p_fdate.
*    r_date2-high   = p_tdate.
*    append r_date2.
*  endif.

ENDFORM.                    " INITIALIZE_DATA


*----------------------------------------------------------------------*
*   Form  SELECT_DATA                                                  *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM SELECT_DATA.
* Select Repair statistics report
  IF RB_SEL1  IS NOT INITIAL.
    PERFORM SELECT_REPAIR_STATS_REP.
  ENDIF.
  IF RB_SEL2  IS NOT INITIAL.
    PERFORM SELECT_REPAIR_STATS_REP.
  ENDIF.
  IF RB_SEL4  IS NOT INITIAL.
    PERFORM SELECT_REPAIR_STATS_REP.
  ENDIF.

*
ENDFORM.                    " SELECT_DATA

*----------------------------------------------------------------------*
*   Form  select_repair_stats_rep                                      *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM    SELECT_REPAIR_STATS_REP.
*
  IF RB_SEL1  IS NOT INITIAL.
    SELECT AUFNR OBJNR WERKS FROM AUFK
                    INTO CORRESPONDING FIELDS OF TABLE
                                              IT_AUFK_UNFILTERED
                    WHERE
                          AUFNR IN S_AUFNR
                    AND   WERKS IN S_WERKS
*                    AND   IDAT1 IN S_DATE " release date but
*                                            select only on teco
                    AND   IDAT2 IN S_DATE. " teco date
  ELSE.
    SELECT AUFNR OBJNR WERKS FROM AUFK
                    INTO CORRESPONDING FIELDS OF TABLE
                                              IT_AUFK_UNFILTERED
                    WHERE
                          AUFNR IN S_AUFNR
*                    AND   IDAT1 IN S_DATE
                    AND   IDAT2 IN S_DATE.

  ENDIF.
**  if not it_aufk[] is initial.
* Get status TECO for the service orders (= I0045) for change doc date
*  SELECT OBJNR CHGNR UDATE INACT FROM JCDS
*                     INTO TABLE IT_JCDS_TECO
*                      FOR ALL ENTRIES IN IT_AUFK_UNFILTERED
*                    WHERE OBJNR = IT_AUFK_UNFILTERED-OBJNR
*                     AND INACT ne 'X'
*                      AND STAT = 'I0045'
*                      AND UDATE IN S_DATE.
* To have the last version (= highest change number (CHGNR)), we
* delete the adjacent duplicates.
  SORT IT_JCDS_TECO DESCENDING.
*  DELETE ADJACENT DUPLICATES FROM IT_JCDS_TECO COMPARING OBJNR CHGNR.

*  LOOP AT IT_JCDS_TECO.
*    LOOP AT IT_AUFK_UNFILTERED  WHERE OBJNR =  IT_JCDS_TECO-OBJNR.
*      IF IT_JCDS_TECO-INACT = SPACE.
        APPEND  IT_AUFK_UNFILTERED  TO IT_AUFK.
*      ENDIF.
*    ENDLOOP.
*  ENDLOOP.
  FREE  IT_AUFK_UNFILTERED.

  SORT IT_JCDS_TECO BY OBJNR.


  CHECK IT_AUFK[] IS NOT INITIAL.
* IT_AUFK should now contain those service orders which are TECO.
* Now get status Released for these orders, as the report will
* show the date of status released (JCDS-UDATE).
  SELECT OBJNR CHGNR UDATE INACT FROM JCDS
                     INTO TABLE IT_JCDS_REL
                      FOR ALL ENTRIES IN IT_AUFK
                    WHERE OBJNR = IT_AUFK-OBJNR
*                      AND INACT = ' '
                      AND STAT = 'I0002'.
*                            AND CHGNR  =
*                            ( SELECT MAX( CHGNR ) FROM   JCDS
*                                     WHERE  OBJNR = IT_AUFK-OBJNR
*                                            AND INACT = ' '
*                                            AND STAT = 'I0002' ).
* To have the last version (= highest change number (CHGNR)), we
* delete the adjacent duplicates.
  SORT IT_JCDS_REL DESCENDING.
  DELETE ADJACENT DUPLICATES FROM IT_JCDS_REL COMPARING OBJNR CHGNR.
  DELETE IT_JCDS_REL  WHERE  INACT = 'X'.

  SORT IT_JCDS_REL  BY OBJNR.
* CHGNR = change number
* I0045 = TECO (Technically completed)
* I0002 = REL  (Released)

ENDFORM.   " select_repair_stats_rep.
*
*----------------------------------------------------------------------*
*   Form  PROCESS_DATA                                                 *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM PROCESS_DATA.

  DATA:  LV_ZE(2)             TYPE C.

  DATA: LV_ORDER_HEADER       LIKE BAPI2088_HEADER.
  DATA: LV_ORDER_OPS          LIKE BAPI2088_OPERATION   OCCURS 0
                             WITH HEADER LINE.
  DATA: LV_PARTNER            LIKE BAPI2088_PARTNER   OCCURS 0
                             WITH HEADER LINE.
  DATA: LV_COMPONENT            LIKE BAPI2088_COMPONENT   OCCURS 0
                             WITH HEADER LINE.

  DATA: LV_CONFIRMATION   LIKE BAPI2088_CONFIRMATION_DOC   OCCURS 0
                             WITH HEADER LINE.

  DATA: LV_EQUI_PARTNER     LIKE ALM_ME_PARTNER_KEY_STRUCT OCCURS 0
                             WITH HEADER LINE.

  DATA: LV_EQUI_NOTIF       LIKE ALM_ME_TOB_NOTIF_HISTORY  OCCURS 0
                             WITH HEADER LINE.

  DATA: LV_EQUI_ORDER_HISTORY
                            LIKE ALM_ME_TOB_ORDER_HISTORY  OCCURS 0
                            WITH HEADER LINE.


  DATA:  LV_END_CUST        LIKE LV_EQUI_PARTNER-PARTNER_KEY.

  DATA:  LV_ORDER_OPS_VAL    TYPE T_ORDER_OPS_VAL OCCURS 0
                             WITH HEADER LINE.




  CLEAR STR_DATA.
  CLEAR LV_ORDER_HEADER.
  REFRESH LV_ORDER_OPS.
  REFRESH LV_CONFIRMATION.
  REFRESH LV_COMPONENT.


  LOOP  AT  IT_AUFK.
    MOVE IT_AUFK-AUFNR    TO STR_DATA-AUFNR.
    MOVE IT_AUFK-WERKS    TO STR_DATA-WERKS.
* Get the release date
    READ TABLE IT_JCDS_REL     WITH KEY  OBJNR = IT_AUFK-OBJNR
                                         BINARY SEARCH.
    MOVE IT_JCDS_REL-UDATE    TO  STR_DATA-IDAT1.    " release date
* Get the TECO-date (technically complete)
    READ TABLE IT_JCDS_TECO    WITH KEY  OBJNR = IT_AUFK-OBJNR
                                         BINARY SEARCH.
    MOVE IT_JCDS_TECO-UDATE   TO  STR_DATA-IDAT2.    " teco date
* Go get all details from the service order.
    CALL FUNCTION 'IWWO_SERVORDER_GET_DETAIL'
      EXPORTING
        ORDERID                      = IT_AUFK-AUFNR
*     ACTIVITY                     =
*     SUB_ACTIVITY                 =
     IMPORTING
       ORDER_HEADER                 = LV_ORDER_HEADER
*     ORDER_CONTRACT               =
*     RETURN                       =
     TABLES
*     ORDER_OBJECTLIST             =
       ORDER_PARTNER                = LV_PARTNER
       ORDER_OPERATION              = LV_ORDER_OPS
     ORDER_CONFIRMATION_DOC       = LV_CONFIRMATION
     ORDER_COMPONENT              = LV_COMPONENT.
*     ORDER_GOODSMVT_DOC           =
*     ORDER_LONGTEXT               =
*     CALC_MOTIVE                  =
*     ACTIVITY_TYPE                =
* Service order number    .
    MOVE LV_ORDER_HEADER-ORDERID        TO STR_DATA-AUFNR.
* Equipment of the service order
    MOVE LV_ORDER_HEADER-EQUIPMENT      TO STR_DATA-EQUNR.
* Customer (sold-to?) of the service order
    MOVE LV_ORDER_HEADER-CUSTOMER       TO STR_DATA-KUNNR.
* Notification number
    MOVE LV_ORDER_HEADER-NOTIF_NO       TO STR_DATA-QMNUM.
    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
      EXPORTING
        INPUT  = STR_DATA-QMNUM
      IMPORTING
        OUTPUT = STR_DATA-QMNUM.


* The Sold-to partner of the service order
    LOOP AT  LV_PARTNER WHERE PARTN_ROLE = 'AG'. "Sold To
      MOVE LV_PARTNER-PARTNER   TO STR_DATA-KUNNR.
    ENDLOOP.
* The Subcontractor of the partner
    LOOP AT  LV_PARTNER WHERE PARTN_ROLE = 'ZS'. "SubContractor
      MOVE LV_PARTNER-NAME_LIST   TO STR_DATA-CONTRACTOR.
    ENDLOOP.
*break air22210.
    IF  LV_ORDER_OPS[]  IS INITIAL.
      PERFORM SAVE_ALL_DATA.
    ELSE.
* Get the descriptions of the workcenters
      SELECT CRHD~ARBPL CRTX~OBJID CRTX~KTEXT
                               INTO TABLE IT_CRTX
                               FROM CRHD INNER JOIN CRTX
                                 ON CRHD~OBJTY = CRTX~OBJTY
                                AND CRHD~OBJID = CRTX~OBJID
                                FOR ALL ENTRIES IN LV_ORDER_OPS
                              WHERE CRHD~WERKS  EQ
                                                LV_ORDER_OPS-PLANT
                                AND CRHD~ARBPL EQ
                                            LV_ORDER_OPS-WORKCENTER
                                AND CRTX~SPRAS EQ SY-LANGU.
* Loop on all operations
      LOOP AT LV_ORDER_OPS.
* Get the workcenter of the operation.
        MOVE LV_ORDER_OPS-WORKCENTER      TO STR_DATA-ARBPL.
* Get the description of the workcenter.
        READ TABLE IT_CRTX WITH KEY ARBPL = STR_DATA-ARBPL.
        IF SY-SUBRC EQ 0.
          MOVE IT_CRTX-KTEXT TO STR_DATA-KTEXT.
        ENDIF.
* The planned time/distance/costs of the operation and its UoM
        MOVE LV_ORDER_OPS-WORK_ACTIVITY   TO
                                          STR_DATA-WORK_ACTIVITY.
        MOVE LV_ORDER_OPS-UN_WORK         TO STR_DATA-UN_WORK.
        MOVE STR_DATA TO IT_DATA.
* Each operation can have a confirmation. That contains the real
* time/distance/costs.
        LOOP AT  LV_CONFIRMATION
                 WHERE ACTIVITY  = LV_ORDER_OPS-ACTIVITY.
          MOVE LV_CONFIRMATION-ACT_WORK     TO STR_DATA-ACT_WORK.
          CALL FUNCTION 'CONVERSION_EXIT_CUNIT_OUTPUT'
            EXPORTING
              INPUT    = LV_CONFIRMATION-UN_ACT_WORK
              LANGUAGE = SY-LANGU
            IMPORTING
              OUTPUT   = STR_DATA-UN_ACT_WORK.
        ENDLOOP.
* perform collect service_order_material.
* Store the materials of the components in IT_MATNR_REF
* and add them also to IT_DATA.
        IF  RB_SEL1   IS  NOT  INITIAL.
          LOOP AT LV_COMPONENT WHERE ACTIVITY = LV_ORDER_OPS-ACTIVITY.
            MOVE IT_AUFK-AUFNR          TO IT_MATNR_REF-AUFNR.
            MOVE LV_COMPONENT-MATERIAL  TO IT_MATNR_REF-MATNR.
            COLLECT IT_MATNR_REF.
            MOVE LV_COMPONENT-MATERIAL  TO STR_DATA-MATNR.
            PERFORM SAVE_ALL_DATA.
            MOVE-CORRESPONDING IT_DATA_HEADER TO STR_DATA.
            MOVE-CORRESPONDING IT_DATA_VALUES TO STR_DATA.
            CLEAR STR_DATA-MATNR.
*         MOVE IT_AUFK-AUFNR    TO STR_DATA-AUFNR.
          ENDLOOP.
* end perform.
          IF SY-SUBRC NE 0. " No components for this operation.
            PERFORM SAVE_ALL_DATA.
            MOVE-CORRESPONDING IT_DATA_HEADER TO STR_DATA.
          ENDIF.
        ELSE.
          PERFORM SAVE_ALL_DATA.
          MOVE-CORRESPONDING IT_DATA_HEADER TO STR_DATA.
        ENDIF.
      ENDLOOP.
    ENDIF.
*break air22210.
    CLEAR STR_DATA.
    CLEAR LV_ORDER_HEADER.
    REFRESH LV_ORDER_OPS.
    REFRESH LV_CONFIRMATION.
    REFRESH LV_COMPONENT.
    REFRESH IT_DATA_HEADER.                                 " air22210

  ENDLOOP.

*  perform determine_prdha_selection.
* Go get the product hierarchy from the materials
  SELECT MATNR PRDHA FROM MARA
          INTO TABLE IT_MARA
                         FOR ALL ENTRIES IN IT_MATNR_REF
                         WHERE
                              MATNR = IT_MATNR_REF-MATNR.
* Get the description of the materials
  SELECT MATNR MAKTX FROM MAKT
          INTO TABLE IT_MAKT
                         FOR ALL ENTRIES IN IT_MARA
                         WHERE
                              MATNR = IT_MARA-MATNR
                          AND SPRAS = SY-LANGU.

  CLEAR WA_MARA.
  LOOP AT IT_MARA INTO WA_MARA.
    READ TABLE IT_MAKT WITH TABLE KEY  MATNR = WA_MARA-MATNR
                            INTO       WA_MAKT.
    MOVE WA_MAKT-MAKTX      TO     WA_MARA-MAKTX.
* Derive the GAC and PGC out of the product hierarchy.
    WA_MARA-GAC = WA_MARA-PRDHA(4).
    WA_MARA-PGC = WA_MARA-PRDHA+4(14).
    MODIFY  IT_MARA FROM WA_MARA.

    CLEAR WA_MARA.
  ENDLOOP.

* end perform.

*break air22210.
* Check if the equipment is in the selection of the
* selection screen.
* IF NOT ( S_EQUNR[] IS INITIAL ).
  MOVE IT_DATA[] TO IT_DATA_OLD[].
  REFRESH IT_DATA[].
* fetch serial number and  material id
  SELECT EQUNR SERNR MATNR FROM EQUI
                           INTO TABLE IT_EQUI
                           FOR ALL ENTRIES IN IT_DATA
                    WHERE EQUNR = IT_DATA-EQUNR.
  SELECT MATNR PRDHA FROM MARA
          INTO TABLE IT_MARA_EQUI
                         FOR ALL ENTRIES IN IT_EQUI
                         WHERE
                              MATNR = IT_EQUI-MATNR.

  CLEAR STR_DATA.
  LOOP AT IT_DATA_OLD INTO STR_DATA_OLD.
    MOVE STR_DATA_OLD-EQUNR  TO WA_EQUI-EQUNR.
    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
      EXPORTING
        INPUT  = STR_DATA_OLD-EQUNR
      IMPORTING
        OUTPUT = STR_DATA_OLD-EQUNR.
*break air22210.
    IF  STR_DATA_OLD-EQUNR IN S_EQUNR.
* add and  check  the GAC PGC of the equipment material
      READ TABLE IT_EQUI WITH TABLE KEY
                                    EQUNR = STR_DATA_OLD-EQUNR
                       INTO       WA_EQUI.
      READ TABLE IT_MARA_EQUI WITH TABLE KEY
                                    MATNR = WA_EQUI-MATNR
                       INTO       WA_MARA.
* Derive the GAC and PGC out of the product hierarchy.
      WA_MARA-GAC = WA_MARA-PRDHA(4).
      WA_MARA-PGC = WA_MARA-PRDHA+4(14).
      MOVE    WA_MARA-PGC    TO  STR_DATA_OLD-PGC.
      MOVE    WA_MARA-GAC    TO  STR_DATA_OLD-GAC.

      IF GV_GAC-PGC-TEST = 'Y'.
        IF  ( WA_MARA-PGC IN SO_PGC ) AND
            ( WA_MARA-GAC IN SO_GAC ).
          MOVE    STR_DATA_OLD   TO  STR_DATA.
          APPEND  STR_DATA       TO  IT_DATA.
        ENDIF.
      ELSE.
        MOVE    STR_DATA_OLD   TO  STR_DATA.
        APPEND  STR_DATA       TO  IT_DATA.
      ENDIF.

    ENDIF.
    CLEAR STR_DATA.
  ENDLOOP.
* ENDIF.
  FREE IT_EQUI.


*    delete  it_data where equnr not IN s_equnr.

  DELETE  IT_DATA WHERE KUNNR NOT IN S_KUNNR.

  DELETE  IT_DATA WHERE ARBPL NOT IN S_ARBPL.

*
*  perform select_PGC_GAC.
*  * Check if PGC/GAC codes are as selecte
  SORT IT_MARA BY MATNR.
  CLEAR IT_DATA.
*  break air22210.
  LOOP AT IT_DATA.
    CLEAR WA_MARA.
    READ TABLE IT_MARA WITH  KEY  MATNR = IT_DATA-MATNR  BINARY SEARCH
                          INTO       WA_MARA.
    MOVE WA_MARA-MAKTX    TO     IT_DATA-MAKTX.
    MODIFY IT_DATA.

*    MOVE WA_MARA-PGC      TO     IT_DATA-PGC.
*    MOVE WA_MARA-GAC      TO     IT_DATA-GAC.
*    IF RB_SEL2  IS NOT INITIAL.
*      IF  ( WA_MARA-PGC IN SO_PGC ) OR
*          ( WA_MARA-GAC IN SO_GAC ).
*        MODIFY IT_DATA.
*      ELSE.
*        DELETE IT_DATA.
*      ENDIF.
*    ELSE.
*      MODIFY IT_DATA.
*    ENDIF.
    CLEAR IT_DATA.

  ENDLOOP.
*
  CHECK IT_DATA[] IS NOT INITIAL.
*
  SORT IT_DATA BY AUFNR KUNNR ARBPL.
* fetch serial number and  material id
  SELECT EQUNR SERNR MATNR FROM EQUI
                           INTO TABLE IT_EQUI
                           FOR ALL ENTRIES IN IT_DATA
                    WHERE EQUNR = IT_DATA-EQUNR.
* fetch customer reference
  SELECT EQUNR TIDNR FROM EQUZ
                     INTO TABLE IT_EQUZ
                      FOR ALL ENTRIES IN IT_DATA
                    WHERE EQUNR = IT_DATA-EQUNR
                      AND DATBI = '99991231'.
* fetch customer name
  SELECT KUNNR NAME1 FROM KNA1
                     INTO TABLE IT_KNA1
                      FOR ALL ENTRIES IN IT_DATA
                    WHERE KUNNR = IT_DATA-KUNNR
                       OR KUNNR = IT_DATA-END_CUST.
*
  IF RB_SEL4  IS NOT INITIAL.
* fetch notification
*    break air22210.
    SELECT QMNUM QMART ERDAT FROM QMEL
                       INTO TABLE IT_QMEL
                        FOR ALL ENTRIES IN IT_DATA
                      WHERE
                            QMNUM = IT_DATA-QMNUM.
    SELECT QMNUM FENUM URNUM URGRP URCOD URTXT
                       FROM QMUR
                       INTO TABLE IT_QMUR_SEL
                        FOR ALL ENTRIES IN IT_DATA
                      WHERE
                            QMNUM = IT_DATA-QMNUM.

    DELETE  IT_QMUR_SEL WHERE URGRP NOT IN S_FAITYP.

*    DELETE  IT_DATA WHERE URGRP NOT IN S_FAITYP.
*    DELETE  IT_DATA WHERE URCOD NOT IN S_?????
    REFRESH IT_DATA_OLD[].
    MOVE IT_DATA[] TO IT_DATA_OLD[].
    REFRESH IT_DATA[].
    CLEAR STR_DATA.
    CLEAR STR_DATA_OLD.
    IF S_FAITYP  IS INITIAL.
      LOOP AT IT_QMEL INTO WA_QMEL.
        LOOP AT IT_DATA_OLD  WHERE QMNUM = WA_QMEL-QMNUM.
          APPEND  IT_DATA_OLD  TO IT_DATA.
        ENDLOOP.
      ENDLOOP.
    ELSE.
      SORT IT_QMUR_SEL ASCENDING.
      DELETE ADJACENT DUPLICATES FROM IT_QMUR_SEL
                               COMPARING QMNUM.
*    BREAK AIR22210.
      LOOP AT IT_QMUR_SEL.
        LOOP AT IT_DATA_OLD  WHERE QMNUM = IT_QMUR_SEL-QMNUM.
          APPEND  IT_DATA_OLD  TO IT_DATA.
        ENDLOOP.
      ENDLOOP.
    ENDIF.
    SELECT QMNUM FENUM URNUM URGRP URCOD URTXT
                       FROM QMUR
                       INTO TABLE IT_QMUR
                        FOR ALL ENTRIES IN IT_DATA
                      WHERE
                            QMNUM = IT_DATA-QMNUM.

  ENDIF.

  IF RB_SEL4  IS NOT INITIAL.
* to determine the number of teco service order
* per equipment within a period of time
* retrieve all related orders for a equipment(part of the report)
* from view VIAUFKS
    SELECT AUFNR OBJNR EQUNR FROM VIAUFKS
                 INTO CORRESPONDING FIELDS OF TABLE
                                           IT_AUFK_TECO_REF
                      FOR ALL ENTRIES IN IT_DATA
                 WHERE
                      EQUNR = IT_DATA-EQUNR.

    SORT  IT_AUFK_TECO_REF   ASCENDING.
    DELETE ADJACENT DUPLICATES FROM IT_AUFK_TECO_REF
                               COMPARING EQUNR AUFNR.


    REFRESH IT_JCDS_TECO.
* determine the objnrs for  the teco orders
    SELECT OBJNR   FROM JCDS
                     INTO TABLE IT_JCDS_TECO
                  FOR ALL ENTRIES IN IT_AUFK_TECO_REF
                    WHERE
                       OBJNR = IT_AUFK_TECO_REF-OBJNR
                   AND STAT = 'I0045'
                   AND UDATE IN S_DATE.
*
    SORT IT_JCDS_TECO  ASCENDING.
*    DELETE ADJACENT DUPLICATES FROM IT_JCDS_TECO
*                               COMPARING  OBJNR.

*
*break air22210.
* count the number of teco  orders per equipent .
    LOOP AT  IT_AUFK_TECO_REF.
      LOOP AT IT_JCDS_TECO WHERE
                           OBJNR = IT_AUFK_TECO_REF-OBJNR.
        CLEAR IT_AUFK_TECO_REF-AUFNR.
        CLEAR IT_AUFK_TECO_REF-OBJNR.
        IT_AUFK_TECO_REF-COUNTER = 1.
        COLLECT IT_AUFK_TECO_REF INTO IT_EQUI_AUFNR_COUNT.
      ENDLOOP.
    ENDLOOP.
    SORT IT_EQUI_AUFNR_COUNT  BY  EQUNR.
  ENDIF.
*
  CLEAR IT_DATA.

  LOOP  AT  IT_DATA.
    IF  IT_DATA-EQUNR  IS NOT INITIAL.
* serial number
      READ TABLE IT_EQUI WITH TABLE KEY  EQUNR = IT_DATA-EQUNR
                            INTO       WA_EQUI.
      MOVE WA_EQUI-SERNR    TO     IT_DATA-SERNR.
* customer reference number
      READ TABLE IT_EQUZ WITH TABLE KEY  EQUNR = IT_DATA-EQUNR
                            INTO       WA_EQUZ.
      MOVE WA_EQUZ-TIDNR    TO     IT_DATA-TIDNR.
    ENDIF.
    IF IT_DATA-KUNNR  IS  NOT INITIAL.
* Customer names
      READ TABLE IT_KNA1 WITH TABLE KEY  KUNNR = IT_DATA-KUNNR
                            INTO       WA_KNA1.
      MOVE WA_KNA1-NAME1    TO     IT_DATA-NAME1.
    ENDIF.
*
    IF NOT ( IT_DATA-EQUNR IS INITIAL ).
      CLEAR LV_EQUI_PARTNER.
      .      REFRESH LV_EQUI_PARTNER[].
      CALL FUNCTION 'ALM_ME_EQUIPMENT_GETDETAIL'
        EXPORTING
          I_EQUIPMENT                     = IT_DATA-EQUNR
*     I_PARTNER_TPA_KEY               =
*     I_MEASPT_WITH_CODES             = ' '
*   IMPORTING
*     E_EQUI_HEADER                   =
     TABLES
*     T_EQUI_NOTIF_HISTORY            =  LV_EQUI_NOTIF
*         T_EQUI_ORDER_HISTORY       =  LV_EQUI_ORDER_HISTORY
*     T_EQUI_MEASUREMENT_POINTS       =
*     T_EQUI_CONTRACTS                =
*     T_EQUI_SUBEQUIS                 =
         T_EQUI_PARTNERS                  = LV_EQUI_PARTNER.
*     T_EQUI_WARRANTIES               =
*     T_EQUI_USERSTATUS               =
*     T_FUNCLOC_CLASSVALUES           =
*     EQUIPMENT_ADDDETAILS            =
*     RETURN                          =
*   EXCEPTIONS
*     NOT_SUCCESSFUL                  = 1
*     OTHERS                          = 2
      .
      IF SY-SUBRC <> 0.
* MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*         WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
      ENDIF.

* 'ZE' forEnd customer
      LOOP AT  LV_EQUI_PARTNER WHERE PARTNER_ROLE = 'ZE'.
        SPLIT LV_EQUI_PARTNER-PARTNER_KEY AT 'ZE'
                              INTO LV_ZE LV_END_CUST.
        CALL FUNCTION 'CONVERSION_EXIT_ALPHA_OUTPUT'
          EXPORTING
            INPUT  = LV_END_CUST
          IMPORTING
            OUTPUT = IT_DATA-END_CUST.

      ENDLOOP.
* End Customer names
      IF IT_DATA-END_CUST  IS  NOT INITIAL.
        READ TABLE IT_KNA1 WITH TABLE KEY  KUNNR = IT_DATA-END_CUST
                         INTO       WA_KNA1.
        MOVE WA_KNA1-NAME1    TO     IT_DATA-EC_NAME1.
      ENDIF.

    ENDIF.
* calculate rario and delta.
    IF RB_SEL2  IS  NOT  INITIAL .
      IF  IT_DATA-WORK_ACTIVITY <>  0.
        IT_DATA-RATIO   =  IT_DATA-ACT_WORK / IT_DATA-WORK_ACTIVITY.
      ELSE.
        IT_DATA-RATIO   = 1.
      ENDIF.
      IT_DATA-DELTA   =  IT_DATA-ACT_WORK - IT_DATA-WORK_ACTIVITY.
    ENDIF.

    IF  RB_SEL4 IS NOT INITIAL.
      CLEAR WA_QMEL.
      READ TABLE IT_QMEL WITH TABLE KEY QMNUM = IT_DATA-QMNUM
                            INTO       WA_QMEL.
      MOVE WA_QMEL-QMART    TO     IT_DATA-QMART.
      MOVE WA_QMEL-ERDAT    TO     IT_DATA-ERDAT_NOT.
      CLEAR WA_QMUR.
      LOOP AT IT_QMUR  INTO WA_QMUR  WHERE  QMNUM = IT_DATA-QMNUM.
        MOVE WA_QMUR-URGRP    TO     IT_DATA-URGRP.
        MOVE WA_QMUR-URCOD    TO     IT_DATA-URCOD.
        MOVE WA_QMUR-URTXT    TO     IT_DATA-URTXT.
      ENDLOOP.
* determine the Qty of repairs.
*      LOOP AT IT_EQUI_AUFNR_COUNT WHERE EQUNR = IT_DATA-EQUNR.
*        IT_DATA-COUNT_REPAIRS  = IT_EQUI_AUFNR_COUNT-COUNTER.
*      ENDLOOP.
      READ TABLE IT_EQUI_AUFNR_COUNT  WITH KEY EQUNR = IT_DATA-EQUNR
                                      BINARY SEARCH.
      IF sy-subrc  = 0.
        IT_DATA-COUNT_REPAIRS  = IT_EQUI_AUFNR_COUNT-COUNTER.
      endif.
    ENDIF.
    MODIFY IT_DATA.
    CLEAR IT_DATA.
  ENDLOOP.

  SORT IT_DATA BY AUFNR ASCENDING KUNNR DESCENDING.

ENDFORM.                    " PROCESS_DATA


*----------------------------------------------------------------------*
*   Form  DISPLAY_DATA                                                 *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM DISPLAY_DATA.

  PERFORM FILL_FIELD_CATALOG.
  PERFORM PREPARE_SORT.
  PERFORM CHANGE_CATALOG.
  PERFORM ALV_OUTPUT.

ENDFORM.                    " DISPLAY_DATA



************************************************************************
* SUBROUTINES  LEVEL 02                                                *
************************************************************************

*----------------------------------------------------------------------*
*   Form  SAVE_ALL_DATA                                                *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM SAVE_ALL_DATA.

  MOVE STR_DATA TO IT_DATA.
  APPEND IT_DATA.

ENDFORM.                    " SAVE_ALL_DATA


*----------------------------------------------------------------------*
*   Form  RESET_DATA                                                   *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM RESET_DATA.

  CLEAR STR_DATA.

ENDFORM.                    " RESET_DATA


*----------------------------------------------------------------------*
*       Form  FILL_FIELD_CATALOG                                       *
*----------------------------------------------------------------------*
*       text                                                           *
*----------------------------------------------------------------------*
FORM FILL_FIELD_CATALOG.

  X_REPID = SY-REPID.
  CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
       EXPORTING
            I_PROGRAM_NAME         = X_REPID
            I_INTERNAL_TABNAME     = 'IT_DATA'
*           i_structure_name       =
*           i_client_never_display = 'X'
            I_INCLNAME             = X_REPID
*           i_bypassing_buffer     =
*           i_buffer_active        =
       CHANGING
            CT_FIELDCAT            = IT_FIELDCAT
       EXCEPTIONS
            INCONSISTENT_INTERFACE = 1
            PROGRAM_ERROR          = 2
            OTHERS                 = 3.
  IF SY-SUBRC <> 0.
*   message id sy-msgid type sy-msgty number sy-msgno
*           with sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

ENDFORM.                    " FILL_FIELD_CATALOG


*----------------------------------------------------------------------*
*       Form  PREPARE_SORT                                             *
*----------------------------------------------------------------------*
*       text                                                           *
*----------------------------------------------------------------------*
FORM PREPARE_SORT.

  CLEAR STR_SORT.
  STR_SORT-SPOS      = '1'.
  STR_SORT-FIELDNAME = 'AUFNR'.
  STR_SORT-UP        = 'X'.
  APPEND STR_SORT TO IT_SORT.

ENDFORM.                    " PREPARE_SORT


*----------------------------------------------------------------------*
*       Form  CHANGE_CATALOG                                           *
*----------------------------------------------------------------------*
*       text                                                           *
*----------------------------------------------------------------------*
FORM CHANGE_CATALOG.

  CLEAR: LS_FIELDCAT.
  CLEAR: LT_FIELDCAT.
  REFRESH: LT_FIELDCAT.

  LOOP AT IT_FIELDCAT INTO LS_FIELDCAT.
    CASE LS_FIELDCAT-FIELDNAME.
      WHEN 'IDAT1'.
        IF RB_SEL2 IS NOT INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'IDAT2'.
        IF RB_SEL2 IS NOT INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'MATNR'.
        IF RB_SEL2 IS NOT INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'NAME1'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F04.
        LS_FIELDCAT-COL_POS      = 04.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'END_CUST'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F05.
        LS_FIELDCAT-COL_POS      = 06.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'EC_NAME1'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F07.
        LS_FIELDCAT-COL_POS      = 07.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'MAKTX'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F53.
        LS_FIELDCAT-COL_POS      = 13.
        IF RB_SEL2 IS NOT INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
        ENDIF.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'GAC'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F54.
        LS_FIELDCAT-COL_POS      = 14.
        IF RB_SEL4 IS  INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
        ENDIF.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'PGC'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F55.
        LS_FIELDCAT-COL_POS      = 15.
        IF RB_SEL4 IS INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
        ENDIF.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.


      WHEN 'WORK_ACTIVITY'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F10.
        LS_FIELDCAT-COL_POS      = 16.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'ACT_WORK'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F12.
        LS_FIELDCAT-COL_POS      = 18.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'UN_ACT_WORK'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F13.
        LS_FIELDCAT-COL_POS      = 19.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'CONTRACTOR'.
        PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F14.
        LS_FIELDCAT-COL_POS      = 20.
        IF RB_SEL2 IS NOT INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
        ENDIF.
        MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
      WHEN 'RATIO'.
        IF RB_SEL2 IS NOT INITIAL.
          PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F56.
          LS_FIELDCAT-COL_POS      = 21.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ELSE.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'DELTA'.
        IF RB_SEL2 IS NOT INITIAL.
          PERFORM CHANGE_FIELDCATALOGUE USING TEXT-F57.
          LS_FIELDCAT-COL_POS      = 22.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ELSE.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'URGRP'.
        IF RB_SEL4 IS  INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'URCOD'.
        IF RB_SEL4 IS  INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'URTXT'.
        IF RB_SEL4 IS  INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.
      WHEN 'WERKS'.
        IF RB_SEL1 IS  INITIAL.
          LS_FIELDCAT-NO_OUT      = 'X'.
          MODIFY IT_FIELDCAT FROM LS_FIELDCAT.
        ENDIF.



    ENDCASE.
  ENDLOOP.
*
*  gs_layout-colwidth_optimize   = 'X'.
*  gs_layout-confirmation_prompt = 'X'.
*  gs_layout-key_hotspot         = 'X'.
*  gs_layout-detail_titlebar     = 'SALES REPORTING'.

ENDFORM.                    " CHANGE_CATALOG


*----------------------------------------------------------------------*
*       Form  ALV_OUTPUT                                               *
*----------------------------------------------------------------------*
*       text                                                           *
*----------------------------------------------------------------------*
FORM ALV_OUTPUT.

  VARIANT-REPORT    = 'YSE_SD_COMMISSION_SALESREP'.
  VARIANT-VARIANT   = VARIANT.
  GS_SD_ALV-VARIANT = GX_VARIANT.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
       EXPORTING
*           i_interface_check           = ' '
*           i_bypassing_buffer          =
*           i_buffer_active             = ' '
            I_CALLBACK_PROGRAM          = 'YSE_CS_OPS_WORKSHOP_RPT'
*           i_callback_pf_status_set    = g_status_set
            I_CALLBACK_USER_COMMAND     = G_USER_COMMAND
*           i_callback_top_of_page      = ' '
*           i_callback_html_top_of_page = ' '
*           i_callback_html_end_of_list = ' '
*           i_structure_name            =
*           i_background_id             = ' '
            I_GRID_TITLE                = 'OPs Workshop Rpt...'
*           i_grid_settings             =
            IS_LAYOUT                   = GS_LAYOUT
            IT_FIELDCAT                 = IT_FIELDCAT
*           it_excluding                =
*           it_special_groups           =
            IT_SORT                     = IT_SORT
*           it_filter                   =
*           is_sel_hide                 =
            I_DEFAULT                   = 'X'
            I_SAVE                      = 'A'
            IS_VARIANT                  = GS_SD_ALV-VARIANT
*           it_events                   =
*           it_event_exit               =
*           is_print                    =
*           is_reprep_id                =
            I_SCREEN_START_COLUMN       = 0
            I_SCREEN_START_LINE         = 0
            I_SCREEN_END_COLUMN         = 0
            I_SCREEN_END_LINE           = 0
*           it_alv_graphics             =
*           it_add_fieldcat             =
*           it_hyperlink                =
*      importing
*           e_exit_caused_by_caller     =
*           es_exit_caused_by_user      =
       TABLES
            T_OUTTAB                    = IT_DATA
       EXCEPTIONS
            PROGRAM_ERROR               = 1
            OTHERS                      = 2.
*  if sy-subrc ne 0.
*   message id sy-msgid type sy-msgty number sy-msgno
*           with sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
*  endif.

ENDFORM.                    " ALV_OUTPUT


************************************************************************
* SUBROUTINES  LEVEL 03                                                *
************************************************************************

*----------------------------------------------------------------------*
*   Form  GET_STATUS                                                   *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM GET_STATUS USING TABLE FIELD STATUS
                CHANGING TEXT.

  CLEAR STR_STATUS.
  STR_STATUS-SPRAS = SY-LANGU.
  STR_STATUS-TBNAM = TABLE.
  STR_STATUS-FDNAM = FIELD.
  STR_STATUS-STATU = STATUS.

  CALL FUNCTION 'RV_DOCUMENT_STATUS_TEXTS'
    EXPORTING
      TVBST_WA      = STR_STATUS
    IMPORTING
*     returncode    =
      TEXT          = TEXT.

ENDFORM.                    " GET_STATUS


*----------------------------------------------------------------------*


*----------------------------------------------------------------------*
*   Form  CHANGE_FIELDCATALOGUE                                        *
*----------------------------------------------------------------------*
*   .....                                                              *
*----------------------------------------------------------------------*
FORM CHANGE_FIELDCATALOGUE USING TITLE.

  LS_FIELDCAT-SELTEXT_S    = TITLE.
  LS_FIELDCAT-SELTEXT_M    = TITLE.
  LS_FIELDCAT-SELTEXT_L    = TITLE.
  LS_FIELDCAT-REPTEXT_DDIC = TITLE.

ENDFORM.                    " CHANGE_FIELDCATALOGUE
*
*
* ----------------------------------------------------------------------
*   FORM
*   USER COMMAND
*
*   User commands management
*
* ----------------------------------------------------------------------
FORM USER_COMMAND USING PI_UCOMM       LIKE SY-UCOMM
                        PI_RS_SELFIELD TYPE SLIS_SELFIELD.  "#EC CALLED

  CASE PI_UCOMM.

    WHEN '&IC1'.
      CASE  PI_RS_SELFIELD-FIELDNAME.
        WHEN 'AUFNR'.
          SET PARAMETER ID 'ANR' FIELD PI_RS_SELFIELD-VALUE.
          CALL TRANSACTION 'IW32' AND SKIP FIRST SCREEN.
        WHEN 'EQUNR'.
          SET PARAMETER ID 'EQN' FIELD PI_RS_SELFIELD-VALUE.
          CALL TRANSACTION 'IE02' AND SKIP FIRST SCREEN.
        WHEN 'KUNNR'.
          SET PARAMETER ID 'KUN' FIELD PI_RS_SELFIELD-VALUE.
          CALL TRANSACTION 'XD02'.

      ENDCASE.

  ENDCASE.

ENDFORM.                                                   "user_command

*
*&---------------------------------------------------------------------*
*&      Form  orders_ops_preparation
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*FORM  orders_ops_preparation   tables lv_order_ops
*                                      structure  BAPI2088_OPERATION
*                                      lv_order_ops_val
*                                      structure  str_order_ops_val.
*
*  SORT lv_order_ops  by workcenter.
*  refresh  lv_order_ops_val.
**
*  LOOP AT lv_order_ops.
*    move lv_order_ops-workcenter   to lv_order_ops_val-workcenter.
*    append lv_order_ops_val.
*  ENDLOOP.
**

*ENDFORM.                    "orders_ops_preparation
*Text symbol text£º
*F04:Customer Name
*F05:End Customer
*F07:End customer Name
*F10:Planned Work
*F12:Actual  Work
*F13:Un.
*F14:Subcontractor Name
*F20:End Customer
*F22:Ship-To name
*F23:NAICS/SIC Code
*F24:Delivery status
*F25:Ord.rel.billing status
*F26:Overall status
*F33:Sales employee VE
*F36:Sales employee ZX
*F39:Sales employee ZY
*F40:Ord. item net value
*F42:Cost
*F43:Profit
*F44:Profit %
*F48:Vendor name
*F51:Del. goods mov. status
*F53:Material Description
*F54:GAC
*F55:PGC
*F56:Act  / Plan
*F57:Act  - Plan
*F61:Inv.item net value
*F63:Open inv.qty
*S03:Repair statistics report
*S04:Service variance report
*S05:FSE/Technician performance report
*S06:????????????????????????????????????????????????????????????
*S07:Variant to use ALV-output

*S08:Failure report
*Selection text£º
*SO_GAC:        GAC
*SO_PGC:        PGC
*S_ACTTYP:D       Activity Type
*S_ARBPL:D       Work Center
*S_AUFNR:        Service order No.
*S_DATE:        From date
*S_EQUNR:        Equipment No.
*S_FAITYP:        Failure Type
*S_KUNNR:        Customer No.
*S_TIDNR:        Customer Reference  No.
*S_WERKS:D       Plant
