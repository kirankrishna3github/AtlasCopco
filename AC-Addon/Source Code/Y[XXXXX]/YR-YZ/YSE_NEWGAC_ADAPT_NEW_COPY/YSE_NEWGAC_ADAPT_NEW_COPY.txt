*&---------------------------------------------------------------------*
* PROGRAM ID           : YSE_NEWGAC_ADAPT_NE                           *
* PROGRAM TITLE        :                                               *
* AUTHOR               : Anda Wu                                       *
* DATE                 : 03/11/2016                                    *
* DEVELOPMENT ID       : CD1K990054                                    *
* CHANGE REQUEST NUMBER: CR4052                                        *
* PROGRAM DESCRIPTION  : Upate the Material master data  to adapt      *
*                        new GAC (New version)                         *
*----------------------------------------------------------------------*
* CHANGE HISTORY LOG                                                   *
*----------------------------------------------------------------------*
* MOD. NO.|  DATE    | NAME     |CORRECTION NUMBER| CHANGE REFERENCE # *
*----------------------------------------------------------------------*
*****Janstudy:[report] is a keywords in SAP to declare the program type
*****Janstudy: Program type can be found in table REPOSRC
REPORT  yse_newgac_adapt_new_copy.
*****Janstudy:[Include] can be used in any program whick refer to an
*****Janstudy: include program. It's a modular and reuse design in SAP
INCLUDE yse_include_test.
************************************************************************
* TYPE SPOOLS                                                          *
************************************************************************
*****Janstudy: [TYPE-POOLS] Something like include, also for modular
*****Janstudy: and reuse design in SAP. The difference is that
*****Janstudy: [TYPE-POOLS] only refer to TYPE defines, but [Include]
*****Janstudy: contain TYPE define and programming statement as well
TYPE-POOLS: slis,truxs.

************************************************************************
* TABLES DECLARATIONS
************************************************************************
*****Janstudy: Can be user to delcare a global workarea
TABLES: marc,mvke.

************************************************************************
* TYPES
************************************************************************
*****Janstudy: [TYPES] is a SAP keyword which used to define some local
*****Janstudy: types which can be used below in the program
TYPES: BEGIN OF ty_marc,
        matnr     TYPE marc-matnr,
        werks     TYPE marc-werks,
        prctr     TYPE marc-prctr,
       END OF ty_marc,

       BEGIN OF ty_mvke,
         matnr    TYPE mvke-matnr,
         vkorg    TYPE mvke-vkorg,
         vtweg    TYPE mvke-vtweg,
         prodh    TYPE mvke-prodh,
       END OF ty_mvke,

       BEGIN OF ty_file_in,
         matnr    TYPE marc-matnr,
         gac_new  TYPE prctr,
         pgc_new  TYPE char10,
       END OF ty_file_in,

       BEGIN OF ty_object,
         matnr    TYPE  marc-matnr,
       END OF ty_object,

       BEGIN OF ty_errlog,
        matnr   TYPE marc-matnr,
        werks   TYPE marc-werks,
        vkorg   TYPE mvke-vkorg,
        vtweg   TYPE mvke-vtweg,
        errmsg  TYPE char128,
       END OF ty_errlog,

       BEGIN OF ty_study_plan,
         seq    TYPE n LENGTH 5,
         comm   TYPE string,
         des    TYPE string,
         status TYPE char10,
         ORDER  TYPE I,
       END OF ty_study_plan,

       ty_t_errlog TYPE STANDARD TABLE OF ty_errlog.

************************************************************************
* VARIABLES DECLARATIONS
************************************************************************
*****Janstudy: [DATA] is a SAP keyword whick used to declare a data
*****Janstudy: here we use GV_ to identify it as a global varibable
*****Janstudy: which is good manner to give a meaningful name to data
DATA:   gv_ucomm          TYPE sy-ucomm,
        gv_noalvlog       TYPE char1,
        gv_suc_pc         TYPE char10,
        gv_suc_ph         TYPE char10,
        gv_prologue1      TYPE string,        "prologue1
        gv_prologue2      TYPE string,        "prologue2
        gv_prologue3      TYPE string,        "prologue3
        gv_prologue4      TYPE string,        "prologue4
        gv_appe           TYPE char20,        "appellation
        gv_vkorg          TYPE itob-vkorg.

************************************************************************
* WORKAERA
************************************************************************
*****Janstudy: here we use GS_ to identify it as a global structure,
*****Janstudy: someone may use GWA_ as global workarea.
*****Here structure is a general name, while workarea is the formal name.
*****Janstudy: A workarea may contain serval fields while varibale is
*****Janstudy: contain only 1 field itself. We use WANAME-FDNAME to
*****Janstudy: access a field in workarea but VARNAME itself.
DATA: gs_layout       TYPE slis_layout_alv.

************************************************************************
* CONSTANTS DECLARATIONS
************************************************************************
*****Janstudy: here we use GC_ to identify it as a global constant.
*****Janstudy:Constant is some fixed value which would never be changed
CONSTANTS: gc_x    TYPE char1 VALUE 'X',
           gc_pkgs TYPE i     VALUE 2,
           gc_appe_w  TYPE char20 VALUE 'Woman',
           gc_appe_m  TYPE char20 VALUE 'Man',
           gc_appe_b  TYPE char20 VALUE 'Boy',
           gc_appe_g  TYPE char20 VALUE 'Girl',
           gc_callback_routine TYPE slis_formname VALUE 'USER_COMMAND'.

************************************************************************
* INTERNAL TABLE DECLARATIONS
************************************************************************
*****Janstudy: here we use GT_ to identify it as a global internalTable
*****Janstudy: When declare a internal table you can user KEYWORD
*****Janstudy: [TABLE] after table or the type refer to is a table type
DATA: gt_errlog_ph    TYPE STANDARD TABLE OF ty_errlog,
      gt_errlog_pc    TYPE ty_t_errlog,
      gt_fieldcat     TYPE slis_t_fieldcat_alv,
      gt_plan         TYPE STANDARD TABLE OF ty_study_plan,
      gt_ngac_log_pc  TYPE STANDARD TABLE OF yse_mat_ngac_log,
      gt_ngac_log_ph  TYPE STANDARD TABLE OF yse_mat_ngac_log.

*****Janstudy: Below section is used to define the elements in
*****Janstudy: selection screen. The element have different type such
*****Janstudy: as parameter, select-option....
************************************************************************
* SELECTION SCREEN
************************************************************************
SELECTION-SCREEN BEGIN OF BLOCK b0 WITH FRAME TITLE text-003.
PARAMETER: rb_upl RADIOBUTTON GROUP gp1
                  USER-COMMAND fun MODIF ID m0,
           rb_upd RADIOBUTTON GROUP gp1 MODIF ID m0,
*           rb_TST RADIOBUTTON GROUP gp1 MODIF ID m0,
           rb_jan RADIOBUTTON GROUP gp1 DEFAULT 'X' MODIF ID m0.
SELECTION-SCREEN END OF BLOCK b0.

SELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE text-002.
PARAMETER: cb_ph AS CHECKBOX USER-COMMAND ph MODIF ID m1,
           cb_pc AS CHECKBOX USER-COMMAND pc MODIF ID m1,
           cb_st AS CHECKBOX USER-COMMAND pc MODIF ID m1.
SELECTION-SCREEN END OF BLOCK b1.

SELECTION-SCREEN BEGIN OF BLOCK b2 WITH FRAME TITLE text-001.
SELECT-OPTIONS: s_matnr FOR mvke-matnr MODIF ID m2,
                s_vkorg FOR gv_vkorg MODIF ID m3,
                s_vtweg FOR mvke-vtweg MODIF ID m3,
                s_werks FOR marc-werks MODIF ID m4.

PARAMETER:  p_file TYPE char128 MODIF ID m5.
SELECTION-SCREEN END OF BLOCK b2.

SELECTION-SCREEN BEGIN OF BLOCK b4 WITH FRAME TITLE text-004.
PARAMETER: p_name  TYPE char20 MODIF ID mj
                   DEFAULT 'Jan Praskac' LOWER CASE,
           p_sex   TYPE char1 DEFAULT 'M' MODIF ID mj,
           p_birth TYPE sy-datum DEFAULT '19900108' MODIF ID mj,
           p_age   TYPE n LENGTH 3 MODIF ID mj,  " int type
           p_land  TYPE land1_gp MODIF ID mj. "Country
PARAMETER: cb_sp AS CHECKBOX MODIF ID mj. "Show plan
SELECTION-SCREEN END OF BLOCK b4.

*****Janstudy: This event will be triggered before selectionscreen
*****Janstudy: show or you make some user action to trigger it.
*****Janstudy: Here you can change the attribute of the
*****Janstudy: selectionscreen elements such as required, input,output
AT SELECTION-SCREEN OUTPUT.
  PERFORM frm_screen_set.

*****Janstudy: This event will be triggered once you make any user
*****Janstudy: action. You can check the validation of user input
AT SELECTION-SCREEN.
  gv_ucomm = sy-ucomm.
  IF sy-ucomm  IS INITIAL OR sy-ucomm = 'ONLI'.
    PERFORM frm_screen_check.
  ENDIF.

*****Janstudy: This event will be triggered once you press F4 on a
*****Janstudy: screen orr click trying to get proposalvalue of a element
AT SELECTION-SCREEN ON VALUE-REQUEST FOR  p_file.
  PERFORM file_f4_help.

************************************************************************
* INITIALIZATION.
************************************************************************
*****Janstudy: This event will be triggered after the event
*****Janstudy: LOAD-OF-PROGRAM(Which is the first event ABAP can catch)
INITIALIZATION.
* Do initialization
  PERFORM do_init.

************************************************************************
* START-OF-SELECTION
************************************************************************
*****Janstudy: This event will be triggered after you press F8 to run
*****Janstudy: the program.
START-OF-SELECTION.

*****Janstudy:  Case is a flowcontrol keyword
  CASE 'X'.
    WHEN rb_upl.
*     Upload the file to SAP customerizing table
      PERFORM do_upload.
    WHEN rb_upd.
*     Update the materail master date
      PERFORM do_update.
    WHEN rb_jan.
      PERFORM frm_jan_study.
*    WHEN RB_TST.
*      WRITE: 'tEST  [CASE]'.
    WHEN OTHERS.
  ENDCASE.

END-OF-SELECTION.
* Show the procee error log
  PERFORM show_log.

*&---------------------------------------------------------------------*
*&      Form  DO_INIT
*&---------------------------------------------------------------------*
*       Do initialization
*----------------------------------------------------------------------*
FORM do_init .

  REFRESH:  gt_errlog_ph,
            gt_errlog_pc,
            gt_ngac_log_pc,
            gt_ngac_log_ph,
            gt_fieldcat.

  gv_noalvlog = gc_x.
  CLEAR: gs_layout.
  gv_suc_ph = 0.
  gv_suc_pc = 0.
ENDFORM.                    " DO_INIT
*&---------------------------------------------------------------------*
*&      Form  GET_MATERIALS_DATA
*&---------------------------------------------------------------------*
*       Get the material data per selection screen
*----------------------------------------------------------------------*
FORM get_materials_data .
*****Janstudy:  IF is a flowcontrol keyword
  IF cb_pc IS NOT INITIAL.
    SELECT *
      FROM yse_mat_ngac_log
      INTO TABLE gt_ngac_log_pc
      WHERE matnr IN s_matnr
        AND werks IN s_werks
        AND upd_ind = 'Y'
        AND ( flag_pc = 'E' OR flag_pc = space ).
*    IF sy-subrc <> 0.
*      IF  cb_ph IS INITIAL .
*        MESSAGE s001(00) WITH text-m02 DISPLAY LIKE 'E'.
*        LEAVE LIST-PROCESSING.
*      ENDIF.
*    ENDIF.

  ENDIF.

  IF cb_ph IS NOT INITIAL.
    SELECT *
      FROM yse_mat_ngac_log
      INTO TABLE gt_ngac_log_ph
      WHERE matnr IN s_matnr
        AND vkorg IN s_vkorg
        AND vtweg IN s_vtweg
        AND upd_ind = 'Y'
        AND ( flag_ph = 'E' OR flag_ph = space ).
*    IF sy-subrc <> 0.
*      IF cb_pc IS INITIAL.
*        MESSAGE s001(00) WITH text-m92 DISPLAY LIKE 'E'.
*        LEAVE LIST-PROCESSING.
*      ENDIF.
*    ENDIF.
  ENDIF.

  IF cb_ph IS NOT INITIAL OR cb_pc IS NOT INITIAL.
    IF    gt_ngac_log_pc IS INITIAL
      AND gt_ngac_log_ph IS INITIAL.
      MESSAGE s001(00) WITH text-m82 DISPLAY LIKE 'E'.
      LEAVE LIST-PROCESSING.
    ENDIF.
  ENDIF.


ENDFORM.                    " GET_MATERIALS_DATA
*&---------------------------------------------------------------------*
*&      Form  UPDATE_MATERIALS
*&---------------------------------------------------------------------*
*       Update the materials per the mapping
*----------------------------------------------------------------------*
FORM update_materials .

  DATA:
        lflg_update   TYPE char1,
        ls_errlog     TYPE ty_errlog,
        lv_tabix      TYPE sy-tabix,
        lt_log_delt   TYPE STANDARD TABLE OF yse_mat_ngac_log,
        ls_ngc_log    TYPE yse_mat_ngac_log.

  DATA : ls_headdata      TYPE bapimathead,
         ls_plantdata     TYPE bapi_marc,
         ls_plantdatax    TYPE bapi_marcx,
         ls_salesdata     TYPE bapi_mvke,
         ls_salesdatax    TYPE bapi_mvkex,
         ls_return        TYPE bapiret2.

  IF cb_ph IS NOT INITIAL.
*****Janstudy:  Loop is a flowcontrol keyword
    LOOP AT gt_ngac_log_ph INTO ls_ngc_log.
      CLEAR:    ls_headdata,
                ls_salesdata,
                ls_salesdatax,
                lflg_update   ,
                ls_errlog     .
      lv_tabix  = sy-tabix.
*     Material head data
      ls_headdata-material = ls_ngc_log-matnr.
      ls_headdata-sales_view   =  gc_x.
*      ls_headdata-cost_view    = gc_x.

      IF ls_ngc_log-nprodh <> ls_ngc_log-oprodh.
        ls_salesdata-sales_org = ls_ngc_log-vkorg.
        ls_salesdata-distr_chan = ls_ngc_log-vtweg.
        ls_salesdata-prod_hier  = ls_ngc_log-nprodh.
        ls_salesdatax-sales_org = ls_ngc_log-vkorg.
        ls_salesdatax-distr_chan = ls_ngc_log-vtweg.
        ls_salesdatax-prod_hier = gc_x.
      ELSE.
*****Janstudy:  CONTINUE is a flowcontrol keyword
        CONTINUE.
      ENDIF.
*****Janstudy:  Function is a module desige in SAP
      CALL FUNCTION 'BAPI_MATERIAL_SAVEDATA'
        EXPORTING
          headdata   = ls_headdata
          salesdata  = ls_salesdata
          salesdatax = ls_salesdatax
        IMPORTING
          return     = ls_return.
*     Check if the update was successful.
      IF ls_return-type = 'S'.
*       save the record into the database.
        CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
          EXPORTING
            wait = gc_x.
        gv_suc_ph = gv_suc_ph + 1.
        ls_ngc_log-flag_ph = 'U'.
        CLEAR: ls_ngc_log-txt_ph.
*        ls_ngc_log-upd_ind = 'N'.
*        ls_ngc_log-txt_ph  = ls_return-message.
      ELSE.
        CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
        CLEAR ls_errlog.
        ls_errlog-matnr  = ls_ngc_log-matnr.
        ls_errlog-vkorg  = ls_ngc_log-vkorg.
        ls_errlog-vtweg  = ls_ngc_log-vtweg.
        ls_errlog-errmsg = ls_return-message.
        APPEND ls_errlog TO gt_errlog_ph.
        ls_ngc_log-flag_ph = 'E'.
        ls_ngc_log-txt_ph  = ls_return-message.
      ENDIF.
      ls_ngc_log-aenam  = sy-uname.
      ls_ngc_log-aedat  = sy-datum.
      ls_ngc_log-aezet  = sy-uzeit.
      APPEND ls_ngc_log TO lt_log_delt.
      DELETE gt_ngac_log_ph INDEX lv_tabix.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_ngac_log_ph.

  IF cb_pc IS NOT INITIAL.
    LOOP AT gt_ngac_log_pc INTO ls_ngc_log .
      lv_tabix = sy-tabix.
      CLEAR:    ls_headdata   ,
                ls_plantdata  ,
                ls_plantdatax ,
                lflg_update   ,
                ls_errlog     .
*     Material head data
      ls_headdata-material = ls_ngc_log-matnr.
*      ls_headdata-basic_view  = gc_x.
      ls_headdata-sales_view   =  gc_x.
*      ls_headdata-cost_view    = gc_x.

      IF ls_ngc_log-nprctr <> ls_ngc_log-oprctr.
        ls_plantdata-plant = ls_ngc_log-werks.
        ls_plantdata-profit_ctr = ls_ngc_log-nprctr.
        ls_plantdatax-plant = ls_ngc_log-werks.
        ls_plantdatax-profit_ctr = gc_x.
      ELSE.
        CONTINUE.
      ENDIF.

      CALL FUNCTION 'BAPI_MATERIAL_SAVEDATA'
        EXPORTING
          headdata   = ls_headdata
          plantdata  = ls_plantdata
          plantdatax = ls_plantdatax
        IMPORTING
          return     = ls_return.
*     Check if the update was successful.
      IF ls_return-type = 'S'.
*       save the record into the database.
        CALL FUNCTION 'BAPI_TRANSACTION_COMMIT'
          EXPORTING
            wait = gc_x.
        gv_suc_pc = gv_suc_pc + 1.
        ls_ngc_log-flag_pc = 'U'.
*        ls_ngc_log-upd_ind = 'N'.
        CLEAR: ls_ngc_log-txt_pc.
      ELSE.
        CALL FUNCTION 'BAPI_TRANSACTION_ROLLBACK'.
        CLEAR ls_errlog.
        ls_errlog-matnr  = ls_ngc_log-matnr.
        ls_errlog-werks  = ls_ngc_log-werks.
        ls_errlog-errmsg = ls_return-message.
        APPEND ls_errlog TO gt_errlog_pc.
        ls_ngc_log-flag_pc = 'E'.
        ls_ngc_log-txt_pc  = ls_return-message.
      ENDIF.
      ls_ngc_log-aenam  = sy-uname.
      ls_ngc_log-aedat  = sy-datum.
      ls_ngc_log-aezet  = sy-uzeit.
      APPEND ls_ngc_log TO lt_log_delt.
      DELETE gt_ngac_log_pc INDEX lv_tabix.
    ENDLOOP.
  ENDIF.
  MODIFY yse_mat_ngac_log FROM TABLE lt_log_delt.
  COMMIT WORK AND WAIT.

ENDFORM.                    " UPDATE_MATERIALS
*&---------------------------------------------------------------------*
*&      Form  SHOW_LOG
*&---------------------------------------------------------------------*
*       Show the procee error log
*----------------------------------------------------------------------*
FORM show_log .

  DATA: lv_err_no_gac TYPE char10,
        lv_err_no_ph  TYPE char10,
        lv_message1 TYPE string,
        lv_message2 TYPE string,
        lv_message3 TYPE string,
        lv_message4 TYPE string.

  IF rb_upd IS NOT INITIAL.
    DESCRIBE TABLE gt_errlog_pc LINES lv_err_no_gac.
    DESCRIBE TABLE gt_errlog_ph LINES lv_err_no_ph.

    CONDENSE: gv_suc_pc,gv_suc_ph,lv_err_no_ph,lv_err_no_gac,
              lv_message1,lv_message2,lv_message3,lv_message4.

    IF cb_pc IS NOT INITIAL.
      lv_message1 = text-i10.
      lv_message2 = text-i11.
      REPLACE '&1' IN lv_message1 WITH gv_suc_pc.
      REPLACE '&1' IN lv_message2 WITH lv_err_no_gac.
    ENDIF.

    IF cb_ph IS NOT INITIAL.
      CLEAR: lv_message3, lv_message4.
      lv_message3 = text-i10.
      lv_message4 = text-i21.
      REPLACE '&1' IN lv_message3 WITH gv_suc_ph.
      REPLACE '&1' IN lv_message4 WITH lv_err_no_ph.
      IF lv_message1 IS NOT INITIAL.
        CONCATENATE cl_abap_char_utilities=>vertical_tab
          lv_message3 INTO lv_message3.
      ENDIF.
    ENDIF.

    IF cb_st IS NOT INITIAL.
      IF lv_message4 IS INITIAL.
        lv_message4 = text-t31.
      ELSE.
        CONCATENATE lv_message4 '|' text-t31 INTO lv_message4.
      ENDIF.
    ENDIF.


    MESSAGE i001(00) WITH lv_message1 lv_message2
                          lv_message3 lv_message4.
    IF gv_noalvlog IS INITIAL.
*     FIELDCAT set
      PERFORM alv_fieldcat_set.
*     LAYOUT set
      PERFORM alv_layout_set.
*     ALV display
      PERFORM alv_display.
    ENDIF.
  ENDIF.


ENDFORM.                    " SHOW_LOG

*&---------------------------------------------------------------------*
*&      Form  ALV_FIELDCAT_SET
*&---------------------------------------------------------------------*
*       FIELDCAT set
*----------------------------------------------------------------------*
FORM alv_fieldcat_set .

  DATA:
     lv_linecnt  TYPE i,
     ls_fieldcat TYPE slis_fieldcat_alv.

  CLEAR lv_linecnt.
* Material Number
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'MATNR'.
  ls_fieldcat-seltext_s = 'Mat.No'(030).
  ls_fieldcat-seltext_m = 'Material Number'(031).
  ls_fieldcat-hotspot = gc_x.
  ls_fieldcat-ref_fieldname =  'MATNR'.
  ls_fieldcat-ref_tabname   = 'MARA'.
  ls_fieldcat-fix_column = gc_x.
  APPEND ls_fieldcat TO gt_fieldcat.

* Sales org
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'VKORG'.
  ls_fieldcat-seltext_s = 'Sales Org'(052).
  ls_fieldcat-seltext_m = 'Sales Organization'(053).
  ls_fieldcat-fix_column = gc_x.
  APPEND ls_fieldcat TO gt_fieldcat.

* Distribute channel
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'VTWEG'.
  ls_fieldcat-seltext_s = 'Distr. Chl'(054).
  ls_fieldcat-seltext_m = 'Distribution Channel'(055).
  ls_fieldcat-fix_column = gc_x.
  APPEND ls_fieldcat TO gt_fieldcat.

* Plant
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'WERKS'.
  ls_fieldcat-seltext_s = 'Plant'(032).
  ls_fieldcat-seltext_m = 'Plant'(032).
  ls_fieldcat-fix_column = gc_x.
  APPEND ls_fieldcat TO gt_fieldcat.

* Error message
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'ERRMSG'.
  ls_fieldcat-seltext_s = 'Err.Msg'(033).
  ls_fieldcat-seltext_m = 'Error Message'(034).
  APPEND ls_fieldcat TO gt_fieldcat.

ENDFORM.                    " ALV_FIELDCAT_SET
*&---------------------------------------------------------------------*
*&      Form  ALV_LAYOUT_SET
*&---------------------------------------------------------------------*
*       LAYOUT set
*----------------------------------------------------------------------*
FORM alv_layout_set .

  CLEAR: gs_layout.
  gs_layout-zebra = gc_x.               "ALV lines cross-color display
  gs_layout-colwidth_optimize = gc_x.   " Auto optimize column width
  gs_layout-detail_popup = gc_x.        " Show detail screen

ENDFORM.                    " ALV_LAYOUT_SET

*&---------------------------------------------------------------------*
*&      Form  ALV_DISPLAY
*&---------------------------------------------------------------------*
*       ALV display
*----------------------------------------------------------------------*
FORM alv_display .
  DATA: lv_callback TYPE slis_formname,
        lt_errlog   TYPE STANDARD TABLE OF ty_errlog.
  APPEND LINES OF gt_errlog_pc TO lt_errlog.
  APPEND LINES OF gt_errlog_ph TO lt_errlog.
  CHECK lt_errlog IS NOT INITIAL.
  lv_callback = gc_callback_routine.
  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      i_callback_program      = sy-repid
      is_layout               = gs_layout
      i_callback_user_command = lv_callback
      it_fieldcat             = gt_fieldcat
    TABLES
      t_outtab                = lt_errlog
    EXCEPTIONS
      program_error           = 1
      OTHERS                  = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

ENDFORM.                    " ALV_DISPLAY

*&---------------------------------------------------------------------*
*&      Form  ALV_OTHERS_SET
*&---------------------------------------------------------------------*
*       USER_COMMAND
*----------------------------------------------------------------------*
FORM user_command USING u_ucomm     LIKE sy-ucomm           "#EC CALLED
                        p_selfield  TYPE slis_selfield.

  CASE u_ucomm.
    WHEN '&IC1'.        " SAP standard code for double-clicking
      IF p_selfield-fieldname = 'MATNR'.
        IF p_selfield-value IS NOT INITIAL.
          SET PARAMETER ID 'MAT' FIELD p_selfield-value.
          CALL TRANSACTION 'MM03' AND SKIP FIRST SCREEN.
        ENDIF.
      ENDIF.
    WHEN OTHERS.
  ENDCASE.

ENDFORM.                    " USER_COMMAND
*&---------------------------------------------------------------------*
*&      Form  FRM_SCREEN_SET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM frm_screen_set .
  DATA: lv_age TYPE tfmatage.
  IF rb_upl  IS NOT INITIAL.
    LOOP AT SCREEN.
      IF    screen-group1 = 'M1'
        OR  screen-group1 = 'M2'
        OR  screen-group1 = 'MJ'.
        screen-input = '0'.
        screen-invisible = '1'.
        MODIFY SCREEN .
      ENDIF.
    ENDLOOP.
  ELSEIF rb_upd IS NOT INITIAL.
    LOOP AT SCREEN.
      IF screen-group1 = 'M5' OR  screen-group1 = 'MJ'.
        screen-input = '0'.
        screen-invisible = '1'.
        MODIFY SCREEN .
      ENDIF.
      IF cb_pc IS INITIAL AND cb_st IS INITIAL.
        IF screen-group1 = 'M4'.
          screen-input = '0'.
          screen-invisible = '1'.
          MODIFY SCREEN .
        ENDIF.
      ENDIF.
      IF cb_ph IS INITIAL.
        IF screen-group1 = 'M3'.
          screen-input = '0'.
          screen-invisible = '1'.
          MODIFY SCREEN .
        ENDIF.
      ENDIF.
      IF cb_pc IS INITIAL AND cb_ph IS INITIAL AND cb_st IS INITIAL.
        IF screen-group1 = 'M2'.
          screen-input = '0'.
          screen-invisible = '1'.
          MODIFY SCREEN .
        ENDIF.
      ENDIF.
    ENDLOOP.
  ELSEIF rb_jan IS NOT INITIAL.
    LOOP AT SCREEN.
      IF screen-group1 = 'M1' OR screen-group1 = 'M2' OR
         screen-group1 = 'M3' OR screen-group1 = 'M4' OR
         screen-group1 = 'M5'.
        screen-input = '0'.
        screen-invisible = '1'.
        MODIFY SCREEN .
      ELSE.
        IF screen-name CS 'P_AGE'.
          screen-input = '0'.
          MODIFY SCREEN .
        ENDIF.
      ENDIF.
    ENDLOOP.
  ENDIF.

  CALL FUNCTION 'FIMA_DAYS_AND_MONTHS_AND_YEARS'
    EXPORTING
      i_date_from          =  p_birth
*     I_KEY_DAY_FROM       =
      i_date_to            =  sy-datum
*     I_KEY_DAY_TO         =
*     I_FLG_SEPARATE       = ' '
    IMPORTING
      e_years              = lv_age .
  p_age = lv_age.

ENDFORM.                    " FRM_SCREEN_SET
*&---------------------------------------------------------------------*
*&      Form  FRM_SCREEN_CHECK
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM frm_screen_check .

  IF cb_pc IS NOT INITIAL.
    IF s_werks[] IS INITIAL OR s_werks IS INITIAL.
      SET CURSOR FIELD 'S_WERKS'.
      MESSAGE e001(00) WITH text-m60.
    ENDIF.
  ENDIF.
  IF cb_ph IS NOT INITIAL.
    IF s_vkorg[] IS INITIAL OR s_vkorg IS INITIAL.
      SET CURSOR FIELD 'S_VKORG'.
      MESSAGE e001(00) WITH text-m61.
    ENDIF.
    IF s_vtweg[] IS INITIAL OR s_vtweg IS INITIAL.
      SET CURSOR FIELD 'S_VTWEG'.
      MESSAGE e001(00) WITH text-m62.
    ENDIF.
  ENDIF.

ENDFORM.                    " FRM_SCREEN_CHECK
*&---------------------------------------------------------------------*
*&      Form  FILE_F4_HELP
*&---------------------------------------------------------------------*
*       File choose help
*----------------------------------------------------------------------*
FORM file_f4_help .

  DATA: lt_filetable  TYPE filetable,
         ls_filetable  TYPE file_table,
         lv_rc         TYPE i.

  CALL METHOD cl_gui_frontend_services=>file_open_dialog
*    EXPORTING
*      window_title            =
*      default_extension       =
*      default_filename        =
*      file_filter             =
*      with_encoding           =
*      initial_directory       =
*      multiselection          =
    CHANGING
      file_table              = lt_filetable
      rc                      = lv_rc
*      user_action             =
*      file_encoding           =
    EXCEPTIONS
      file_open_dialog_failed = 1
      cntl_error              = 2
      error_no_gui            = 3
      not_supported_by_gui    = 4
      OTHERS                  = 5
          .
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
              WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ELSE.
    READ TABLE lt_filetable INTO ls_filetable INDEX 1.
    IF sy-subrc = 0.
      p_file = ls_filetable-filename.
    ENDIF.
  ENDIF.
ENDFORM.                    " FILE_F4_HELP
*&---------------------------------------------------------------------*
*&      Form  DO_UPDATE
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM do_update .
* Extact material data from MARA MARC and MVKE
  PERFORM get_materials_data.
*****Janstudy:  subroutine is a module desige in SAP ,keyword PERFORM
* Update the materials per the mapping
  PERFORM update_materials.

  IF cb_st IS NOT INITIAL.
*   Update the YSE_MAT_NGAC_LOG of the stock remove flag
    PERFORM update_stock_remove.
  ENDIF.
ENDFORM.                    " DO_UPDATE
*&---------------------------------------------------------------------*
*&      Form  DO_UPLOAD
*&---------------------------------------------------------------------*
*       Upload the file to SAP customerizing table
*----------------------------------------------------------------------*
FORM do_upload .
  TYPES: BEGIN OF ty_pgc_ph,
          pgc     TYPE char10,
          prodh   TYPE prodh_d,
         END OF ty_pgc_ph.

  DATA: lt_raw_data   TYPE truxs_t_text_data,
        ls_marc       TYPE ty_marc,
        ls_mvke       TYPE ty_mvke,
        ls_object     TYPE ty_object,
        ls_ngac_log   TYPE yse_mat_ngac_log,
        lt_pgc2ph     TYPE STANDARD TABLE OF yse_map_pgc2ph,
        ls_pgc2ph     TYPE yse_map_pgc2ph,
        lt_t179       TYPE STANDARD TABLE OF t179,
        ls_t179       TYPE t179,
        lt_ngac_log   TYPE STANDARD TABLE OF yse_mat_ngac_log,
        lt_object     TYPE STANDARD TABLE OF ty_object,
        lt_mvke       TYPE STANDARD TABLE OF ty_mvke,
        lt_marc       TYPE STANDARD TABLE OF ty_marc,
        lt_file_in    TYPE STANDARD TABLE OF ty_file_in,
*        lt_pgc_ph     TYPE STANDARD TABLE OF ty_pgc_ph,
*        ls_pgc_ph     TYPE ty_pgc_ph,
        ls_file_in    TYPE ty_file_in.

  FIELD-SYMBOLS: <lfs_file_in>  TYPE ty_file_in,
                 <lfs_t179>     TYPE t179.

* Upload the Material data from the excel file
  CALL FUNCTION 'TEXT_CONVERT_XLS_TO_SAP'
    EXPORTING
      i_tab_raw_data       = lt_raw_data
      i_filename           = p_file
    TABLES
      i_tab_converted_data = lt_file_in
    EXCEPTIONS
      conversion_failed    = 1
      OTHERS               = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
           WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.
  DELETE lt_file_in INDEX 1.
  IF lt_file_in IS INITIAL.
*****Janstudy:  KEYWORD [MESSAGE] used to raised a message to user
    MESSAGE s001(00) WITH text-m80 DISPLAY LIKE 'E'.
    LEAVE LIST-PROCESSING.
  ENDIF.

  LOOP AT lt_file_in ASSIGNING <lfs_file_in>.
    CALL FUNCTION 'CONVERSION_EXIT_MATN1_INPUT'
      EXPORTING
        input        = <lfs_file_in>-matnr
      IMPORTING
        output       = <lfs_file_in>-matnr
      EXCEPTIONS
        length_error = 1
        OTHERS       = 2.
    IF sy-subrc = 0.
      ls_object = <lfs_file_in>-matnr.
      APPEND ls_object TO lt_object.
    ENDIF.
    CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
      EXPORTING
        input  = <lfs_file_in>-gac_new
      IMPORTING
        output = <lfs_file_in>-gac_new.
    CONDENSE <lfs_file_in>-pgc_new.
  ENDLOOP.

*  Replace to use the uploading data in YSE_MAP_PGC2PH
*  SELECT * FROM t179
*    INTO TABLE lt_t179.
*
*  LOOP AT lt_t179 INTO ls_t179.
*    ls_pgc_ph-pgc = ls_t179-prodh+4(4).
*    CONDENSE ls_pgc_ph-pgc.
*    ls_pgc_ph-prodh = ls_t179-prodh.
*    READ TABLE lt_file_in TRANSPORTING NO FIELDS
*      WITH KEY pgc_new = ls_pgc_ph-pgc.
*    IF sy-subrc = 0.
*      APPEND ls_pgc_ph TO lt_pgc_ph.
*    ENDIF.
*  ENDLOOP.

  SELECT *
    FROM yse_map_pgc2ph
    INTO TABLE lt_pgc2ph
    WHERE pgc <> space.
  IF sy-subrc <> 0.
    MESSAGE s001(00) WITH text-m42 DISPLAY LIKE 'E'.
    LEAVE LIST-PROCESSING.
  ENDIF.

  SORT lt_object.
  DELETE ADJACENT DUPLICATES FROM lt_object.

  IF lt_object IS NOT INITIAL.
    IF s_werks IS NOT INITIAL.
      SELECT matnr
             werks
             prctr
        FROM marc
        INTO TABLE lt_marc
        FOR ALL ENTRIES IN lt_object
        WHERE matnr = lt_object-matnr
          AND werks IN s_werks.
    ENDIF.

    IF NOT ( s_vkorg IS INITIAL AND s_vkorg IS INITIAL ).
      SELECT matnr
             vkorg
             vtweg
             prodh
        FROM mvke
        INTO TABLE lt_mvke
        FOR ALL ENTRIES IN lt_object
        WHERE matnr = lt_object-matnr
          AND vkorg IN s_vkorg
          AND vtweg IN s_vtweg.
    ENDIF.

  ENDIF.

  IF lt_mvke IS INITIAL AND lt_marc IS INITIAL.
    MESSAGE s001(00) WITH text-m82 DISPLAY LIKE 'E'.
    LEAVE LIST-PROCESSING.
  ENDIF.

  SORT: lt_marc,
        lt_mvke,
        lt_file_in.

  LOOP AT lt_marc INTO ls_marc.
    CLEAR: ls_ngac_log.
    READ TABLE lt_file_in INTO ls_file_in
      BINARY SEARCH WITH KEY matnr = ls_marc-matnr.
    IF sy-subrc = 0.
      ls_ngac_log-matnr   = ls_marc-matnr.
      ls_ngac_log-werks   = ls_marc-werks.
      ls_ngac_log-ernam   = sy-uname.
      ls_ngac_log-erdat   = sy-datum.
      ls_ngac_log-erzet   = sy-uzeit.
      ls_ngac_log-oprctr  = ls_marc-prctr.
      ls_ngac_log-nprctr  = ls_file_in-gac_new.
      IF ls_ngac_log-oprctr = ls_ngac_log-nprctr.
        ls_ngac_log-upd_ind   = 'N'. "No need to do replace
        ls_ngac_log-flag_stk = 'N'.  "No need to remove stock
      ELSE.
        ls_ngac_log-upd_ind   = 'Y'. "Need to do replace
      ENDIF.
      IF ls_ngac_log-upd_ind = 'Y'.
        SELECT COUNT(*)
          FROM cepc
          WHERE prctr = ls_file_in-gac_new.
        IF sy-subrc <> 0.
          ls_ngac_log-upd_ind   = 'N'. "No need to do replace
          ls_ngac_log-flag_pc   = 'E'. "error when upload
          ls_ngac_log-txt_pc    = 'Profit center not exist!'(t61).
        ENDIF.
      ENDIF.
      APPEND ls_ngac_log TO lt_ngac_log.
    ENDIF.
  ENDLOOP.

  LOOP AT lt_mvke INTO ls_mvke.
    CLEAR: ls_ngac_log, ls_file_in, ls_pgc2ph ."ls_pgc_ph.
    READ TABLE lt_file_in INTO ls_file_in
      BINARY SEARCH WITH KEY matnr = ls_mvke-matnr.
    IF sy-subrc = 0.
      ls_ngac_log-matnr   = ls_mvke-matnr.
      ls_ngac_log-vkorg   = ls_mvke-vkorg.
      ls_ngac_log-vtweg   = ls_mvke-vtweg.
      ls_ngac_log-ernam   = sy-uname.
      ls_ngac_log-erdat   = sy-datum.
      ls_ngac_log-erzet   = sy-uzeit.
      ls_ngac_log-oprodh  = ls_mvke-prodh.
      READ TABLE lt_pgc2ph INTO ls_pgc2ph
        WITH KEY pgc = ls_file_in-pgc_new.
      IF sy-subrc = 0.
        ls_ngac_log-nprodh = ls_pgc2ph-prodh.
        IF ls_ngac_log-oprodh = ls_ngac_log-nprodh.
          ls_ngac_log-upd_ind   = 'N'. "No need to do replace
        ELSE.
          ls_ngac_log-upd_ind   = 'Y'. "Need to do replace
        ENDIF.
      ELSE.
        ls_ngac_log-nprodh = ls_file_in-pgc_new.
        ls_ngac_log-upd_ind   = 'N'. "No need to do replace
        ls_ngac_log-flag_ph   = 'E'."error when upload
        ls_ngac_log-txt_ph   = 'New PH can not found per new GAC'(t62).
      ENDIF.
      APPEND ls_ngac_log TO lt_ngac_log.
    ENDIF.
  ENDLOOP.

  MODIFY yse_mat_ngac_log FROM TABLE lt_ngac_log.
  IF sy-subrc <> 0.
    MESSAGE s001(00) WITH text-m06 DISPLAY LIKE 'E'.
    LEAVE LIST-PROCESSING.
  ENDIF.

  MESSAGE s001(00) WITH text-m07.

ENDFORM.                    " DO_UPLOAD
*&---------------------------------------------------------------------*
*&      Form  UPDATE_STOCK_REMOVE
*&---------------------------------------------------------------------*
*       Update the YSE_MAT_NGAC_LOG of the stock remove flag
*----------------------------------------------------------------------*
FORM update_stock_remove .
  TYPES: BEGIN OF lty_mbew,
            matnr TYPE mbew-matnr,
            bwkey TYPE mbew-bwkey,
            bwtar TYPE mbew-bwtar,
            lbkum TYPE mbew-lbkum,
         END OF lty_mbew,

         BEGIN OF lty_msku,
            matnr  TYPE msku-matnr,
            werks  TYPE msku-werks,
            charg  TYPE msku-charg,
            sobkz  TYPE msku-sobkz,
            kunnr  TYPE msku-kunnr,
            kulab  TYPE msku-kulab,
         END OF lty_msku.

  DATA: ls_ngac_log   TYPE yse_mat_ngac_log,
        lt_mbew       TYPE STANDARD TABLE OF lty_mbew,
        ls_mbew       TYPE lty_mbew,
        lt_msku       TYPE STANDARD TABLE OF lty_msku,
        ls_msku       TYPE lty_msku,
        lt_ngac_deta  TYPE STANDARD TABLE OF yse_mat_ngac_log,
        lt_ngac_log   TYPE STANDARD TABLE OF yse_mat_ngac_log.

  FIELD-SYMBOLS: <lfs_ngac_log> TYPE yse_mat_ngac_log.

  SELECT *
    FROM yse_mat_ngac_log
    INTO TABLE lt_ngac_log
    PACKAGE SIZE gc_pkgs
    WHERE matnr IN s_matnr
      AND werks IN s_werks
      AND werks <> space.
    REFRESH: lt_mbew, lt_msku,lt_ngac_deta.
    DELETE lt_ngac_log WHERE upd_ind = 'N'
                        AND  flag_stk = 'N'.
    SELECT matnr
          bwkey
          bwtar
          lbkum
      FROM mbew
      INTO TABLE lt_mbew
      FOR ALL ENTRIES IN lt_ngac_log
      WHERE matnr = lt_ngac_log-matnr
        AND bwkey = lt_ngac_log-werks
        AND lbkum > 0.

    SELECT  matnr
            werks
            charg
            sobkz
            kunnr
            kulab
      FROM msku
      INTO TABLE lt_msku
      FOR ALL ENTRIES IN lt_ngac_log
      WHERE matnr = lt_ngac_log-matnr
        AND werks = lt_ngac_log-werks
        AND kulab > 0.
    SORT lt_mbew BY matnr ASCENDING
                     bwkey ASCENDING
                     bwtar ASCENDING
                     lbkum DESCENDING.
    SORT lt_msku BY matnr ASCENDING
                    werks ASCENDING
                    charg ASCENDING
                    sobkz ASCENDING
                    kunnr ASCENDING
                    kulab DESCENDING.
    LOOP AT lt_ngac_log ASSIGNING <lfs_ngac_log>.
      ls_ngac_log = <lfs_ngac_log>.
      CLEAR: ls_msku, ls_mbew.
      <lfs_ngac_log>-flag_stk = 'N'.
      READ TABLE lt_mbew INTO ls_mbew
        WITH KEY matnr = <lfs_ngac_log>-matnr
                 bwkey = <lfs_ngac_log>-werks.
      IF sy-subrc = 0.
        <lfs_ngac_log>-txt_stk = 'Valuation stock not removed.'(t54).
        <lfs_ngac_log>-flag_stk = 'Y'.
      ELSE.
        READ TABLE lt_msku INTO ls_msku
          WITH KEY matnr = <lfs_ngac_log>-matnr
                   werks = <lfs_ngac_log>-werks.
        IF sy-subrc = 0.
          <lfs_ngac_log>-txt_stk = 'Consignment stock not removed.'(t55).
          <lfs_ngac_log>-flag_stk = 'Y'.
        ELSE.
          CLEAR: <lfs_ngac_log>-txt_stk.
        ENDIF.
      ENDIF.
      IF NOT ( ls_ngac_log-flag_stk = <lfs_ngac_log>-flag_stk AND
         ls_ngac_log-txt_stk = <lfs_ngac_log>-txt_stk ).
        APPEND <lfs_ngac_log> TO lt_ngac_deta.
      ENDIF.
      MODIFY yse_mat_ngac_log FROM TABLE lt_ngac_deta.
      IF sy-subrc = 0.
        COMMIT WORK AND WAIT.
      ENDIF.
    ENDLOOP.
  ENDSELECT.
*  MODIFY yse_mat_ngac_log FROM TABLE lt_ngac_deta.
  IF sy-subrc = 0.
    COMMIT WORK AND WAIT.
  ENDIF.

ENDFORM.                    " UPDATE_STOCK_REMOVE
*&---------------------------------------------------------------------*
*&      Form  FRM_JAN_STUDY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM frm_jan_study .
  DATA: ls_extid TYPE yextid.
******* Training Plan to JAN********************************************
*****Janstudy: assign value to data:  [MOVE],[=],Define data,clear,READ
  DATA: myid    TYPE char10 VALUE '123',
        ls_plan TYPE ty_study_plan,
        lv_order TYPE i.

*****Janstudy:5  - Program type
  "DONE
  " 1 - exectuable program : YSE_NEWGAC_ADAPT_NEW_COPY - SE38
  " I - Include program:  yse_include_test   - SE38
  " F - Function module:  ZCS_DYNAMIC_CHANGE
  " k - Class/Interface:  Object-Oriented programingm method
  " BADI-Bussine add-in; BAPI: Bussiness abpplication prgoramming interface
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '5'.
*ls_plan-comm    =
  ls_plan-des     = 'Program type'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '5'.
  ls_plan-comm    = '1 - exectuable program : YSE_NEWGAC_ADAPT_NEW_COPY - SE38'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '5'.
  ls_plan-comm    = 'I - Include program:  yse_include_test   - SE38'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '5'.
  ls_plan-comm    = 'F - Function module:  ZCS_DYNAMIC_CHANGE'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '5'.
  ls_plan-comm    = 'k - Class/Interface:  Object-Oriented programingm method'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '5'.
  ls_plan-comm    = 'BADI-Bussine add-in; BAPI: Bussiness abpplication prgoramming interface'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

*****Janstudy:10 - Event concepte comprehension
  "DONE
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '10'.
  ls_plan-des     = 'Event concepte comprehension'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

*****Janstudy:20 - DATA TYPE
  "DONE
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '20 '.
  ls_plan-des     = 'DATA TYPE'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

*****Janstudy:25 - WRITE data in SAP LIST
  "Done
*   1. ABAP WORKBENCH - SE80: The portal of SAP ABAP OBJECTS
*   2. SAP LIST - Some  SAP standard screen for exectuable program
*         Once you write something in you program, it will be displayed
*   3. keyword help - put cursor on the keyword, press 'F1'
*   4. SAP LIST content will be save in the spool when program running in background mode
*   WRITE 5(20) 'Hello world!'. " [5(10)] - position(Length);[/] - jump to next line
*   WRITE  / 'SECOND  STATEMENT'. " [5(10)] - position(Length);[/] - jump to next line
*   ULINE.    "" draw a underline in the sap list

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '25'.
  ls_plan-des     = 'WRITE data in SAP LIST'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '25'.
  ls_plan-comm    = '1. ABAP WORKBENCH - SE80: The portal of SAP ABAP OBJECTS'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '25'.
  ls_plan-comm    = '        Once you write something in you program, it will be displayed'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '25'.
  ls_plan-comm    = '3. keyword help - put cursor on the keyword, press ''F1'''.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '25'.
  ls_plan-comm    = '4. SAP LIST content will be save in the spool when program running in background mode'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

*****Janstudy:35 - Comparison Operators for All Data Types
*** 1. In SAP, when you try to make some math coparsion, all the data will be convet to numbric data**
  " DONE
*  DATA: LV_AGE TYPE Char1.
*  IF p_age GT 18. "
*    WRITE 'Audlt'.
*  ELSE.
*    WRITE 'Child'.
*  ENDIF.
*=, EQ Equal
*<>, NE Not Equal
*<, LT Lower Than
*>, GT Greater Than
*<=, LE Lower Equal
*>=, GE Greater Equal

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '35'.
  ls_plan-des     = 'Comparison Operators for All Data Types'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '35'.
  ls_plan-comm    = '1. In SAP, when you try to make some math coparsion,'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '35'.
  ls_plan-comm    = 'all the data will be convet to numbric data'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

*****Janstudy:40 - Logic expression:  AND/OR/NOT  INITIAL
  "Done
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '40'.
  ls_plan-des     = 'Logic expression'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '40'.
  ls_plan-comm    = 'KEYWORD: AND/OR/NOT  INITIAL'.
  ls_plan-status  = 'Done'.
  APPEND ls_plan TO gt_plan.


  IF NOT ( p_age < 18 OR  p_sex <> 'F'). "  =  [p_age >= 18 and p_sex = 'F']
    WRITE: gc_appe_w.
    gv_appe = 'lady'.
  ELSEIF p_age >= 18 AND p_sex = 'M'.
    WRITE: gc_appe_m.
    gv_appe = gc_appe_m.
  ELSEIF p_age < 18 AND p_sex = 'M'.
    WRITE: gc_appe_b.
    gv_appe = gc_appe_b.
  ELSEIF p_age < 18 AND p_sex = 'F'.
    WRITE: gc_appe_g.
    gv_appe = gc_appe_g.
  ENDIF.

*  IF SY-SUBRC = 0.
*    WRITE: 'Yes'.
*  ENDIF.


*****Janstudy: 45 - Flow control
*****Janstudy: KEYWORD-IF..ELSE/SWITCH/DO/WHILE/LOOP/CONTINUE/CONTINUE/
*****Janstudy: CHEK/EXIT
  "TO DO
* Example: In VA02 we can change something in the order; while we can't
*    changee anything in the SO via VA03. But in fact, it's the same program
  DATA:  lv_age TYPE char5,
         LV_45_show TYPE char1.
  IF LV_45_show IS NOT INITIAL.


    lv_age = p_age.

    CLEAR: ls_plan.
    lv_order = lv_order + 1.
    ls_plan-ORDER = lv_order.
    ls_plan-seq     = '45'.
    ls_plan-des     = 'Flow control'.
    ls_plan-status  = 'TO DO'.
    APPEND ls_plan TO gt_plan.

    CLEAR: ls_plan.
    lv_order = lv_order + 1.
    ls_plan-ORDER = lv_order.
    ls_plan-seq     = '45'.
    ls_plan-comm    = 'KEYWORD-IF..ELSE/CASE/DO/WHILE/LOOP/CONTINUE/EXIT/'.
    ls_plan-status  = 'TO DO'.
    APPEND ls_plan TO gt_plan.

*   Do some thing  N time (KEYWORD-DO)
    WRITE:/  '45 -[do]'.
    do lv_age times.
      WRITE:/ 'I am ', lv_age, 'years old !'.
      lv_age = lv_age - 1.
    enddo.
*    DAY_IN_WEEK

*   Keyword -while: you want do samething many times with a condition
*   While will end once the condition is NOT satisfied. Be very careful to use it
    WRITE:/  '45 -[While]'.
    lv_age = p_age.
    WHILE lv_age > 10.
      WRITE:/ 'Age:',lv_age.
      lv_age = lv_age - 1.
    ENDWHILE.
*   keyword - LOOP  used to loop the internal table

*   KEYWORD - CONTINUE: USED TO SKIP current step

*   KEYWORD - EXIT: USED TO jump out of the block(WHILE,DO,LOOP)
 ENDIF.
*****Janstudy: 50 - Computer operation
*  [{+|-|*|/|DIV|MOD|**}
  "TO DO  ‚Â: zh®¨  English:jealous
* Example:
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '50'.
  ls_plan-des     = 'Computer operation'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '50'.
  ls_plan-comm    = 'KEYWORD-{+|-|*|/|DIV|MOD|**}'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.
  DATA: LV_50_show TYPE char1.
*  Number can't be write to SAP LIST directly
  IF LV_50_show IS NOT INITIAL.

  ENDIF.


*****Janstudy: 55 - MESSAGE
*****Janstudy: Message type: I/S/W/E/A/X
  "TO DO
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '55'.
  ls_plan-des     = 'MESSAGE'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '55'.
  ls_plan-comm    = 'Message type: I/S/W/E/A/X'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  DATA: LV_55_show TYPE char1.
  IF LV_55_show IS NOT INITIAL.
    CONCATENATE 'Hi'
                gv_appe
                ',I know you long ago. You are'
                p_name
                '.'
        INTO gv_prologue1
        SEPARATED BY space.

    CONCATENATE 'Born on' p_birth
                ',' p_age 'years old now.'
          INTO gv_prologue2
          SEPARATED BY space.
    IF p_age < 18.
      CONCATENATE 'Heard you want to learn ABAP?'
             'Sorry but you are to'
          INTO gv_prologue3
          SEPARATED BY space.
      CONCATENATE 'o young!' 'Come to me when you are 18+'
          INTO gv_prologue4
          SEPARATED BY space.
      MESSAGE  s001(00) WITH gv_prologue1
                             gv_prologue3
                             gv_prologue4
                DISPLAY LIKE 'E'.
      LEAVE LIST-PROCESSING.
    ELSE.
      CONCATENATE 'Heard you want to learn ABAP?'
             'Let'' start!'
          INTO gv_prologue3.
      MESSAGE  i001(00) WITH gv_prologue1 gv_prologue2 gv_prologue3.
    ENDIF.
  ENDIF.

*****Janstudy: 60 - DATA RETRIEVE
*****Janstudy: KEYWORD: SELELCT, SE11-TABLE KEY,JOIN
* TO DO
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '60'.
  ls_plan-des     = 'DATA RETRIEVE'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '60'.
  ls_plan-comm    = 'KEYWORD: SELELCT, SE11-TABLE KEY,JOIN'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  DATA: LV_60_show TYPE char1.
  IF LV_60_show IS NOT INITIAL.
  ENDIF.

*****Janstudy: 65 - Internal TABLE manipulate
*****Janstudy: KEYWORD: APPEND, INSERT, DELETE, MODIFY,<FIELD-SYMBOL>
*****Janstudy: KEYWORD: LOOP, DO, CONITUE,EXIT.
** TO DO
* [APPEND] MEANS ADD A ENTRY AT THE END OF INTERNAL TABLE
* [INSERT] MEAMS ADD A ENTRY AT A GIVEN POSTION OF THE INTERHNAL TABLE
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '65'.
  ls_plan-des     = 'Internal TABLE manipulate'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '65'.
  ls_plan-comm    = 'KEYWORD: APPEND, INSERT, DELETE, MODIFY,<FIELD-SYMBOL>'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

* [MODIFY] MEANS MODIFY THE VALUE OF AN ENTRY IN INTERNAL TABLE
*  ls_plan-comm = 'This is a test'.
*  MODIFY gt_plan INDEX lv_order from ls_plan.

*  <FIELD-SYMBOL> IS ANOTHER WAY TO MODIFY THE INTERNAL TABLE
  FIELD-SYMBOLS: <FS_COMM> TYPE ty_study_plan.
  LOOP AT GT_PLAN ASSIGNING <FS_COMM> WHERE ORDER = LV_ORDER .
    <FS_COMM>-COMM = 'USE FIELD SYMBOL'.
  ENDLOOP.

    CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '65'.
  ls_plan-comm    = 'APPEND MEANS ADD A ENTRY AT THE END OF INTERNAL TABLE'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '65'.
  ls_plan-comm    = 'KEYWORD: LOOP, DO, CONITUE,EXIT.'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.
*  INSERT LS_PLAN INTO GT_PLAN INDEX 1.

*****Janstudy: 70 - TABLE manipulate
*****Janstudy: KEYWORD: INSERT, UPDATE, MODIFY,DELETE
** TO DO
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '70'.
  ls_plan-des     = 'TABLE manipulate'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '70'.
  ls_plan-comm    = 'KEYWORD: INSERT, UPDATE, MODIFY,DELETE'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

*****Janstudy:80 - modular design
*****Janstudy:(inculde,function,class,subroutine,marco)
  "TO DO
  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '80'.
  ls_plan-des     = 'modular design'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

  CLEAR: ls_plan.
  lv_order = lv_order + 1.
  ls_plan-ORDER = lv_order.
  ls_plan-seq     = '80'.
  ls_plan-comm    = '(inculde,function,class,subroutine,marco)'.
  ls_plan-status  = 'TO DO'.
  APPEND ls_plan TO gt_plan.

*****Janstudy: 99  - DEBUG - BREAK-POINT/WATCHPOINT/[/H]
*****Janstudy: F5 - SINGLE STPE(to next statement)
*****Janstudy: F6 - EXECUTE (To next program block)
*****Janstudy: F7 - RETURN (To the end of current block)
*****Janstudy: F8 - Continue (To next break-point)
  "TO DO


  IF cb_sp IS NOT INITIAL.
    SKIP to LINE 3.
    WRITE: 1(116) sy-uline.
    WRITE: / sy-vline, (8) 'Sequence', sy-vline,
    13(90) 'Description/Commnet',sy-vline,
           105(10) 'Status' ,sy-vline.
    WRITE: (116) sy-uline.
    SORT: gt_plan by order.
    LOOP AT gt_plan INTO ls_plan.
      IF ls_plan-des IS NOT INITIAL and sy-tabix <> 1.
        SKIP 1.
        WRITE: (116) sy-uline.
      ENDIF.
      IF ls_plan-comm IS NOT INITIAL.
        WRITE: / sy-vline, 12 sy-vline.
        WRITE: 13(1)'*' , 15(90) ls_plan-comm, 116 sy-vline.
      ELSEIF ls_plan-des IS NOT INITIAL.
        WRITE: / sy-vline, (8) ls_plan-seq , sy-vline.
        WRITE: 13(90) ls_plan-des, sy-vline.
        IF ls_plan-status = 'Done'.
          FORMAT COLOR 5.
        ELSEIF ls_plan-status = 'Partial'.
          FORMAT COLOR 3.
        ELSEIF ls_plan-status = 'TO DO'.
          FORMAT COLOR 6.
        ENDIF.
        WRITE: 105(10) ls_plan-status,sy-vline.
        WRITE: (116) sy-uline.
        FORMAT COLOR OFF.
      ENDIF.
      at END OF seq.
        WRITE: (116) sy-uline.
      ENDAT.
    ENDLOOP.
  ENDIF.
ENDFORM.                    " FRM_JAN_STUDY

*Text symbol text£∫
*001:Selection screen
*002:Update fields
*003:Select Functionality
*004:ABAP Training
*030:Mat.No
*031:Material Number
*032:Plant
*033:Err.Msg
*034:Error Message
*052:Sales Org
*053:Sales Organization
*054:Distr. Chl
*055:Distribution Channel
*I10:Totally &1 materials are updated successfully,
*I11:while &1 failed(GAC).
*I21:while &1 failed(GACPGC).
*M02:No data found per the selection screen - GAC
*M06:Failed to upload data to tale YSE_MAT_NGAC_LOG
*M07:Successfully upload the data from source file
*M42:Please maintain the mapping tableYSE_MAP_PGC2PH in advance
*M60:Please enter the [Plant]
*M61:Please enter the [Sales Org]
*M62:Please enter the [Distr. Chl]
*M70:Please maintain the mapping table of GAC - YSE_MAP_PRCTR
*M71:Please maintain the mapping table of GACPGC -YSE_MAP_GACPGC
*M80:No data extracfted from the file
*M82:No data found per the selection screen
*M92:No data found per the selection screen - PH
*T31:Stock flag in log table are updated
*T54:Valuation stock not removed.
*T55:Consignment stock not removed.
*T61:Profit center not exist!

*T62:New PH can not found per new GAC
*Selection text£∫
*CB_PC:        Profit Center
*CB_PH:        Product Hierarchy
*CB_SP:        Overviwe - Study progress
*CB_ST:        Stock remove Flag
*P_AGE:        Age
*P_BIRTH:        Birthday
*P_FILE:        Uploading File
*P_LAND:        Country
*P_NAME:        Name
*P_SEX:        Sex
*RB_JAN:        ABAP training
*RB_UPD:        Update
*RB_UPL:        Upload
*S_MATNR:D       .
*S_VKORG:D       .
*S_VTWEG:D       .
*S_WERKS:D       .
