*----------------------------------------------------------------------
* PROGRAM ID           : YSE_CREATE_IQ_SP                              *
* PROGRAM TITLE        : SEED: Create Intelli Quoter Service Product   *
* AUTHOR               : LUC MERTENS                                   *
* DATE                 : 12/03/2007                                    *
* DEVELOPMENT ID       :                                               *
* CHANGE REQUEST NUMBER: CD1K912098                                    *
* PROGRAM DESCRIPTION  : This is a program to create the service prod  *
*                        based on the Intelli Quoter from AIF/AII+AIP. *
*----------------------------------------------------------------------*
* CHANGE HISTORY LOG
*----------------------------------------------------------------------*
* MOD. NO.|  DATE    | NAME     |CORRECTION NUMBER| CHANGE REFERENCE   *
*----------------------------------------------------------------------*
* MOD-001 |2007.09.28|L. Mertens       |CD1K921426|SEED:issue 3185     *
* MOD-002 |2007.10.10|L. Mertens       |CD1K921773|enlarge field and   *
*        - skip classification screen in case of extension             *
* MOD-003 |2008.11.27|M. Jacobs        |CD1K944839|interactive mode    *
* MOD-004 |2009.11.16|M. Jacobs        |CD1K951825|CR1088 EUR for Russia*
* MOD-005 |2009.12.01|L. Mertens       |CD1K952395|CR1119              *
* MOD-006 |2013.05.07|L. Mertens       |CD1K975922|CR2890              *
************************************************************************
REPORT yse_create_iq_sp
       NO STANDARD PAGE HEADING
       LINE-SIZE 120
       MESSAGE-ID yam_dc.

*---------------------------------------------------------------------*
* TABLES DECLARATION
*---------------------------------------------------------------------*
TABLES: t001w,                              " Plants
        marc,                               " Material plant data
        t179,                               " Product hierarchy
        t024,                               " Purchasing group
        tptm,                               " Item category group
        t438a,                              " MRP Type
        t023,                               " Material group
        plko,                               " Task list - header
        cepc_bukrs.                         " Profit centers

*---------------------------------------------------------------------*
* INTERNAL TABLE DECLARATIONS                                         *
*---------------------------------------------------------------------*
DATA : i_bdcdata      LIKE bdcdata OCCURS 0 WITH HEADER LINE,
       struct_bdcdata TYPE bdcdata,
       gt_err         LIKE bdcmsgcoll OCCURS 0 WITH HEADER LINE.

DATA: g_api_values LIKE api_value OCCURS 0 WITH HEADER LINE.

DATA: BEGIN OF tmerk OCCURS 0.
        INCLUDE STRUCTURE clx2f.
DATA: END   OF tmerk.

DATA: BEGIN OF tvalues OCCURS 0.
        INCLUDE STRUCTURE clx2v.
DATA: END   OF tvalues.

DATA: BEGIN OF gt_char OCCURS 20,
        name  TYPE atnam,
        value TYPE atwrt,
      END OF gt_char.

*---------------------------------------------------------------------*
* VARIABLE DECLARATIONS                                               *
*---------------------------------------------------------------------*
DATA : gv_matnr          TYPE matnr,
       gv_werks          TYPE werks,
       gv_vkorg          TYPE vkorg,
       gv_ekgrp          TYPE ekgrp,
       gv_newmatnr       TYPE matnr,
       gv_bukrs          TYPE bukrs,
       gv_matkl          TYPE matkl,
       gv_curr           TYPE waers,
       l_date            TYPE d ,             " Date in User Format
       gv_msgnr          LIKE t100-msgnr,
       gv_mestx          LIKE t100-text,
       gv_costpr(11)     TYPE c,
       gv_kbetr(11)      TYPE c,
       gv_idx(2)         TYPE n,
       gv_scr_field(15)  TYPE c,
* begin of change MOD-002
*      gv_type(5)        type c,
       gv_type(10)       TYPE c,
* end of change MOD-002
       g_sctms           LIKE sctms,
       gv_dummy          TYPE werks,
       gv_so(1)          TYPE c,
       gv_char(1)        TYPE c,
       gv_mtpos          TYPE mtpos,
       gv_dismm          TYPE dismm,
       gv_kschl          TYPE kschl,
       gv_bismt          TYPE bismt,
       gv_off(2)         TYPE n,
       gv_len(2)         TYPE n,
       gv_plant_exist(1) TYPE c,
       gv_textline(132)  TYPE c.
* begin of insertion MOD-003
DATA:  gv_mode(1)        TYPE c VALUE 'N'.

*---------------------------------------------------------------------*
* CONSTANT DECLARATIONS                                               *
*---------------------------------------------------------------------*
CONSTANTS: c_11(2)               TYPE c     VALUE '11',
           c_01(2)               TYPE c     VALUE '01',
           c_001            TYPE klassenart VALUE '001',
           c_datbi            TYPE sy-datum VALUE '99991231',
           c_x(1)                TYPE c     VALUE 'X',
           c_y_ekgrp(7)          TYPE c     VALUE 'Y_EKGRP',
           c_mbrsh               TYPE mbrsh VALUE 'M',
           c_mtart               TYPE mtart VALUE 'ZDIE',
           c_meins               TYPE meins VALUE 'AU',
           c_kondm               TYPE kondm VALUE '01',
           c_ktgrm               TYPE ktgrm VALUE '11',
           gc_bklas              TYPE bklas VALUE '3200',
           c_z001(4)             TYPE c     VALUE 'Z001',
           c_zs04                TYPE mtpos VALUE 'ZS04',
           c_zs02                TYPE mtpos VALUE 'ZS02',
           c_z3                  TYPE dismm VALUE 'Z3',
           c_z4                  TYPE dismm VALUE 'Z4',
           c_zpn0                TYPE kschl VALUE 'ZPN0',
           c_zpro                TYPE kschl VALUE 'ZPRO',
           c_taxkm               TYPE taxkm VALUE '1',
           c_basic(5)            TYPE c     VALUE 'BASIC',
           c_sales(5)            TYPE c     VALUE 'SALES',
           c_plant(5)            TYPE c     VALUE 'PLANT',
           c_salesplant(10)      TYPE c     VALUE 'SALESPLANT',
           c_class            TYPE klasse_d VALUE 'ZAM_CLASS_04',
           c_zam_duration        TYPE atnam VALUE 'ZAM_DURATION',
           c_zam_elec_parts      TYPE atnam VALUE 'ZAM_ELEC_PARTS',
           c_zam_elt_overhaul    TYPE atnam VALUE 'ZAM_ELT_OVERHAUL',
           c_zam_mot_overhaul    TYPE atnam VALUE 'ZAM_MOT_OVERHAUL',
           c_zam_motpow_service  TYPE atnam VALUE 'ZAM_MOTPOW_SERVICE',
           c_zam_oil             TYPE atnam VALUE 'ZAM_OIL',
           c_zam_running_hours   TYPE atnam VALUE 'ZAM_RUNNING_HOURS',
           c_zam_service_product TYPE atnam VALUE 'ZAM_SERVICE_PRODUCT',
           c_zam_service_range   TYPE atnam VALUE 'ZAM_SERVICE_RANGE',
           c_zam_oiltype         TYPE atnam VALUE 'ZAM_OILTYPE',
           c_zam_company         TYPE atnam VALUE 'ZAM_COMPANY',
           c_zam_visit_freq_char TYPE atnam VALUE 'ZAM_VISIT_FREQ_CHAR',
           c_zam_service_hours   TYPE atnam VALUE 'ZAM_SERVICE_HOURS',
           c_zam_engineoil       TYPE atnam VALUE 'ZAM_ENGINEOIL',
           c_generic(7)          TYPE c     VALUE 'GENERIC',
           c_group        LIKE apqi-groupid VALUE 'Y_IQSP',
           c_transoisd    LIKE tstc-tcode   VALUE 'OISD',
           c_transmat     LIKE tstc-tcode   VALUE 'MM01',
           c_transcon     LIKE tstc-tcode   VALUE 'VK11'.
* begin of insertion MOD-004
CONSTANTS : c_ru(2)              TYPE c VALUE 'RU'.
DATA : gv_calledfrom(8) TYPE c.
* end of insertion MOD-004

*---------------------------------------------------------------------*
* PARAMETER DECLARATION
*---------------------------------------------------------------------*
SELECTION-SCREEN : BEGIN OF BLOCK b1 WITH FRAME TITLE text-001.
*SELECTION-SCREEN : BEGIN OF BLOCK B1A.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31)   text-sc1 FOR FIELD p_vkorg.
PARAMETERS: p_vkorg  LIKE mvke-vkorg OBLIGATORY MEMORY ID vko.
SELECTION-SCREEN COMMENT (2) g_blank1.
SELECTION-SCREEN COMMENT (30) g_ktext1.
SELECTION-SCREEN END OF LINE.
* begin of insert MOD-005
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31)   text-sc3 FOR FIELD p_spart.
PARAMETERS: p_spart  LIKE tvta-spart OBLIGATORY MEMORY ID spa.
SELECTION-SCREEN COMMENT (2) g_blank3.
SELECTION-SCREEN COMMENT (30) g_ktext3.
SELECTION-SCREEN END OF LINE.
* end of insert MOD-005

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31)   text-sc4 FOR FIELD p_werks.
PARAMETERS: p_werks  LIKE marc-werks OBLIGATORY MEMORY ID wrk.
SELECTION-SCREEN COMMENT (2) g_blank4.
SELECTION-SCREEN COMMENT (30) g_ktext4.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31)   text-sc5 FOR FIELD p_dwerk.
PARAMETERS: p_dwerk  LIKE mvke-dwerk OBLIGATORY MEMORY ID wrk.
SELECTION-SCREEN COMMENT (2) g_blank5.
SELECTION-SCREEN COMMENT (30) g_ktext5.
SELECTION-SCREEN END OF LINE.

PARAMETERS: p_maktx  LIKE makt-maktx OBLIGATORY.

SELECTION-SCREEN : BEGIN OF BLOCK b1b.
SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (12)   text-sc6 FOR FIELD p_iqnum.
PARAMETERS: p_iqnum  TYPE c RADIOBUTTON GROUP radi.
SELECTION-SCREEN COMMENT (2) g_blank6.
SELECTION-SCREEN COMMENT (26)   text-sc8 FOR FIELD p_bismt.
PARAMETERS: p_bismt  LIKE mara-bismt.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (12)   text-sc7 FOR FIELD p_gener.
PARAMETERS: p_gener  TYPE c RADIOBUTTON GROUP radi DEFAULT 'X'.
SELECTION-SCREEN COMMENT (2) g_blank7.
SELECTION-SCREEN COMMENT (18)   text-scc FOR FIELD p_genmat.
PARAMETERS: p_genmat LIKE mara-matnr.
* begin of delete MOD-005
**SELECTION-SCREEN COMMENT (2) g_blankc.
*SELECTION-SCREEN COMMENT (15)   text-sc9 FOR FIELD p_mtpos.
*PARAMETERS: p_mtpos  LIKE mvke-mtpos DEFAULT 'ZS02'.
**SELECTION-SCREEN COMMENT (2) g_blank9.
*SELECTION-SCREEN COMMENT (08)   text-sca FOR FIELD p_dismm.
*PARAMETERS: p_dismm  LIKE marc-dismm DEFAULT 'Z3'.
**SELECTION-SCREEN COMMENT (2) g_blankb.
* end of delete MOD-005
SELECTION-SCREEN COMMENT (14)   text-scb FOR FIELD p_matkl.
PARAMETERS: p_matkl  LIKE mara-matkl.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (31)   text-scd FOR FIELD p_tasklg.
PARAMETERS: p_tasklg LIKE plko-plnnr.
PARAMETERS: p_tasklc LIKE plko-plnal.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN END OF BLOCK b1b.

PARAMETERS: p_prdha  LIKE mara-prdha OBLIGATORY,
            p_prctr  LIKE marc-prctr OBLIGATORY,
            p_stprs  LIKE mbew-stprs,
            p_kbetr  LIKE konp-kbetr OBLIGATORY.
SELECTION-SCREEN: END OF BLOCK b1.

*SELECTION-SCREEN : BEGIN OF BLOCK B2 WITH FRAME TITLE TEXT-002.
*PARAMETERS: p_durat(3)   type c obligatory,
*            p_epart(1)   type c,
*            p_eover(1)   type c,
*            p_mover(1)   type c,
*            p_mserv(8)   type c,
*            p_oil(1)     type c obligatory,
*            p_rhour(4)   type c obligatory,
*            p_sprod(3)   type c obligatory,
*            p_srang(15)  type c obligatory,
*            p_oiltp(10)  type c,
*            p_comp(3)    type c obligatory,
*            p_visit(10)  type c obligatory,
*            p_servh(8)   type c,
*            p_engoil(10) type c.
*SELECTION-SCREEN: END OF BLOCK B2.

*---------------------------------------------------------------------*
* Initialization                                                      *
*---------------------------------------------------------------------*
INITIALIZATION.

** preselect characteristics of class 'ZAM_CLASS_04'
*  CALL FUNCTION 'CLEX_GET_CLASS_FEATURES_VALUES'
*    EXPORTING
*      ACTIVITY                      = ' '
*      CLASSNAME                     = c_class
*      CLASSTYPE                     = c_001
*      DISPLAY_SCOPE_IN              = g_sctms
*      WITHOUT_VALUES                = ' '
*    TABLES
*      FEATURES                      = tmerk
*      VALUES                        = tvalues
*    EXCEPTIONS
*      NOT_AUTHORIZED_CLASSIFICATION = 1
*      NOT_AUTHORIZED_MAINTENANCE    = 2
*      NOT_AUTHORIZED_SELECTION      = 3
*      NO_FEATURES_DEFINED           = 4
*      OTHERS                        = 5.
*
** check whether features exist
*  if tmerk[] is initial.
*    message e001(00) WITH text-e10 ' ' c_class.
*  endif.
*
*  sort tmerk by atnam.
*  sort tvalues by atinn atwrt.

* begin of insert MOD-005
  GET PARAMETER ID 'VKO' FIELD p_vkorg.
  select single spart into p_spart
    from tvta where vkorg = p_vkorg
                and vtweg = c_11.
* end of insert MOD-005

*---------------------------------------------------------------------*
*--- AT selection-screen on sales organization
*---------------------------------------------------------------------*
AT SELECTION-SCREEN ON p_vkorg.

  DATA: lt_tvkot LIKE tvkot,
        lt_tvko  LIKE tvko,
        lt_tvtwt LIKE tvtwt,
        lt_tspat LIKE tspat,
        lt_tvkbt LIKE tvkbt,
        lt_tvgrt LIKE tvgrt.

  CLEAR: lt_tvkot, lt_tvtwt, lt_tspat, lt_tvkbt, lt_tvgrt.

*.. Check sales organization
  CALL FUNCTION 'ITOB_CHECK_SALES_ORGANIZATION'
    EXPORTING
      vkorg                   = p_vkorg
*     LANGU                   = SY-LANGU
*     USE_BUF                 = 'X'
*     DIALOG_MODE             = 'X'
      dialog_cursor           = 'P_VKORG'
*     DIALOG_STEPL            = 0
*     INIT_MESSAGE_DATA       = 'X'
*     X_MESS_TYPE             = 'E'
*     READ_TEXT_TABLES        = 'X'
    IMPORTING
      tvko_exp                = lt_tvko
      tvkot_exp               = lt_tvkot
    EXCEPTIONS
      empty_key               = 1
      application_error       = 2
      OTHERS                  = 3.

  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
          WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE lt_tvkot-vtext TO g_ktext1.
  MOVE lt_tvko-bukrs  TO gv_bukrs.

* begin of delete MOD-005
** authority check
*  AUTHORITY-CHECK OBJECT 'V_VBAK_VKO'
*         ID 'VKORG' FIELD p_vkorg
*         ID 'VTWEG' FIELD c_11
*         ID 'SPART' FIELD c_01
*         ID 'ACTVT' FIELD '01'.
*  IF sy-subrc <> 0.
*    MESSAGE e001(00) WITH text-e01 p_vkorg.
*  ENDIF.
* end of delete MOD-005

* begin of insert MOD-005
  select single spart into p_spart
    from tvta where vkorg = p_vkorg
                and vtweg = c_11.
* end of insert MOD-005

* begin of insert MOD-005
*---------------------------------------------------------------------*
*--- AT selection-screen on division
*---------------------------------------------------------------------*
AT SELECTION-SCREEN ON p_spart.

  DATA: lt_tspat LIKE tspat.

* Check division
  CALL FUNCTION 'ITOB_CHECK_SALES_DIVISION'
    EXPORTING
      spart                   = p_spart
      dialog_cursor           = 'P_SPART'
    IMPORTING
      tspat_exp               = lt_tspat
  EXCEPTIONS
    empty_key               = 1
    application_error       = 2
    OTHERS                  = 3.

  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
          WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  MOVE lt_tspat-vtext TO g_ktext3.

* Check Sales area
  CALL FUNCTION 'ITOB_CHECK_SALES_AREA'
    EXPORTING
      vkorg                   = p_vkorg
      vtweg                   = '11'
      spart                   = p_spart
    EXCEPTIONS
      empty_key               = 1
      application_error       = 2
      OTHERS                  = 3.

  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
          WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

* authority check
  AUTHORITY-CHECK OBJECT 'V_VBAK_VKO'
         ID 'VKORG' FIELD p_vkorg
         ID 'VTWEG' FIELD c_11
         ID 'SPART' FIELD p_spart
         ID 'ACTVT' FIELD '01'.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e01 p_vkorg '11' p_spart.
  ENDIF.
* end of insert MOD-005

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_werks.

  SELECT SINGLE name1 INTO g_ktext4
     FROM t001w WHERE werks = p_werks.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e08.
  ENDIF.

  SELECT SINGLE werks INTO gv_dummy
     FROM tvkwz WHERE vkorg = p_vkorg
                  AND vtweg = c_11
                  AND werks = p_werks.
  IF sy-subrc <> 0.
    gv_textline = text-e22.
    REPLACE '&1' WITH p_werks INTO gv_textline.
    REPLACE '&2' WITH p_vkorg INTO gv_textline.
    MESSAGE e001(00) WITH gv_textline.
  ENDIF.

* authority check
  AUTHORITY-CHECK OBJECT 'I_IWERK'
             ID 'TCD'   FIELD sy-tcode
             ID 'IWERK' FIELD p_werks.

  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e06 p_werks.
  ENDIF.

* begin of insert MOD-001
  SELECT SINGLE ekgrp INTO gv_ekgrp
     FROM yse_plant_ekgrp WHERE werks = p_werks.

  IF sy-subrc <> 0.
    CLEAR gv_textline.
    gv_textline = text-e29.
    REPLACE '&1' WITH p_werks INTO gv_textline.
    MESSAGE e001(00) WITH gv_textline.
  ENDIF.
* end of insert MOD-001

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_dwerk.

  SELECT SINGLE name1 INTO g_ktext5
      FROM t001w WHERE werks = p_dwerk.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e08.
  ENDIF.

* authority check
  AUTHORITY-CHECK OBJECT 'I_IWERK'
             ID 'TCD'   FIELD sy-tcode
             ID 'IWERK' FIELD p_dwerk.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e07 p_dwerk.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON BLOCK b1b.

  IF p_iqnum = 'X'.
    IF p_bismt IS INITIAL.
      MESSAGE e001(00) WITH text-e16.
    ELSE.
      gv_len = STRLEN( p_bismt ).
      IF gv_len < 12 OR
         gv_len > 16.
        MESSAGE e001(00) WITH text-e15.
      ENDIF.
    ENDIF.
  ENDIF.

  IF p_gener = 'X'.
* begin of change MOD-005
*    IF ( p_dismm IS INITIAL OR p_mtpos IS INITIAL OR
*         p_matkl IS INITIAL ).
    if p_matkl is initial.
* end of change MOD-005
      MESSAGE e001(00) WITH text-e17.
    ELSE.
* begin of delete MOD-005
*      SELECT SINGLE * FROM tptm WHERE mtpos = p_mtpos.
*      IF sy-subrc <> 0.
*        MESSAGE e001(00) WITH text-e18.
*      ENDIF.
*      SELECT SINGLE * FROM t438a WHERE dismm = p_dismm.
*      IF sy-subrc <> 0.
*        MESSAGE e001(00) WITH text-e19.
*      ENDIF.
* end of delete MOD-005
      SELECT SINGLE * FROM t023 WHERE matkl = p_matkl.
      IF sy-subrc <> 0.
        MESSAGE e001(00) WITH text-e21.
      ENDIF.
    ENDIF.
* begin of insert MOD-005
    if not ( p_matkl(3) = '042' or p_matkl(3) = '043' or
             p_matkl    = '041C40000' or
             p_matkl(3) = '044' ).
      message e001(00) with text-e30.
    endif.
* end of insert MOD-005
    IF ( p_tasklg IS INITIAL OR
         p_tasklc IS INITIAL ).
      SET CURSOR FIELD 'P_TASKLG'.
*      message e001(00) with text-e24.
    ENDIF.
    SELECT SINGLE * FROM plko WHERE plnty = 'A'
                                AND plnnr = p_tasklg
                                AND plnal = p_tasklc.
    IF sy-subrc <> 0.
*      MESSAGE e001(00) WITH text-e25.
    ENDIF.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_prdha.

  SELECT SINGLE * FROM t179 WHERE prodh = p_prdha.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e09.
  ENDIF.

*-----------------------------------------------------------------*
AT SELECTION-SCREEN ON p_prctr.

  DATA: lv_kokrs       TYPE kokrs.

  CALL FUNCTION 'COPA_ERKRS_FIND'
      EXPORTING
        bukrs              = gv_bukrs
        gsber              = ' '
        kokrs              = ' '
    IMPORTING
*       ERKRS              =
        kokrs              = lv_kokrs
    EXCEPTIONS
        error_kokrs_find   = 1
        kokrs_wrong        = 2
        no_erkrs_defined   = 3
        no_erkrs_for_kokrs = 4
        OTHERS             = 5.

  SELECT SINGLE * FROM cepc_bukrs WHERE prctr = p_prctr
                                    AND bukrs = gv_bukrs
                                    AND kokrs = lv_kokrs.
  IF sy-subrc <> 0.
    MESSAGE e001(00) WITH text-e13.
  ENDIF.

**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_durat.
*
*  check not p_durat is initial.
*
*  read table tmerk with key atnam = c_zam_duration
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_durat.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_epart.
*
*  check not p_epart is initial.
*
*  read table tmerk with key atnam = c_ZAM_ELEC_PARTS
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_epart.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_eover.
*
*  check not p_eover is initial.
*
*  read table tmerk with key atnam = c_ZAM_ELT_OVERHAUL
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_eover.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_mover.
*
*  check not p_mover is initial.
*
*  read table tmerk with key atnam = c_ZAM_MOT_OVERHAUL
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_mover.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_mserv.
*
*  check not p_mserv is initial.
*
*  read table tmerk with key atnam = c_ZAM_MOTPOW_SERVICE
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_mserv.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_oil.
*
*  check not p_oil is initial.
*
*  read table tmerk with key atnam = c_ZAM_OIL
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_oil.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_rhour.
*
*  check not p_rhour is initial.
*
*  read table tmerk with key atnam = c_ZAM_RUNNING_HOURS
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_rhour.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_sprod.
*
*  check not p_sprod is initial.
*
*  read table tmerk with key atnam = c_ZAM_SERVICE_PRODUCT
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_sprod.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_srang.
*
*  check not p_srang is initial.
*
*  read table tmerk with key atnam = c_ZAM_SERVICE_RANGE
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_srang.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_oiltp.
*
*  check not p_oiltp is initial.
*
*  read table tmerk with key atnam = c_ZAM_OILTYPE
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_oiltp.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_comp.
*
*  check not p_comp is initial.
*
*  read table tmerk with key atnam = c_ZAM_COMPANY
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_comp.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_visit.
*
*  check not p_visit is initial.
*
*  read table tmerk with key atnam = c_ZAM_VISIT_FREQ_CHAR
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_visit.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_servh.
*
*  check not p_servh is initial.
*
*  read table tmerk with key atnam = c_ZAM_SERVICE_HOURS
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_servh.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.
*
**-----------------------------------------------------------------*
*AT SELECTION-SCREEN ON p_engoil.
*
*  check not p_engoil is initial.
*
*  read table tmerk with key atnam = c_ZAM_ENGINEOIL
*                        binary search.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e11 ' ' c_class.
*  ENDIF.
*
*  read table tvalues with key atinn = tmerk-atinn
*                              atwrt = p_engoil.
*  IF NOT sy-subrc = 0.
*    MESSAGE e001(00) WITH text-e12.
*  ENDIF.

*---------------------------------------------------------------------*
*--- F4 Inputhelp
*---------------------------------------------------------------------*
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_durat.
*
*  PERFORM help_f4 using c_zam_duration
*               changing p_durat.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_epart.
*
*  PERFORM help_f4 using c_ZAM_ELEC_PARTS
*               changing p_epart.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_eover.
*
*  PERFORM help_f4 using c_ZAM_ELT_OVERHAUL
*               changing p_eover.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_mover.
*
*  PERFORM help_f4 using c_ZAM_MOT_OVERHAUL
*               changing p_mover.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_mserv.
*
*  PERFORM help_f4 using c_ZAM_MOTPOW_SERVICE
*               changing p_mserv.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_oil.
*
*  PERFORM help_f4 using c_ZAM_OIL
*               changing p_oil.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_rhour.
*
*  PERFORM help_f4 using c_ZAM_RUNNING_HOURS
*               changing p_rhour.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_sprod.
*
*  PERFORM help_f4 using c_ZAM_SERVICE_PRODUCT
*               changing p_sprod.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_srang.
*
*  PERFORM help_f4 using c_ZAM_SERVICE_RANGE
*               changing p_srang.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_oiltp.
*
*  PERFORM help_f4 using c_ZAM_OILTYPE
*               changing p_oiltp.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_comp.
*
*  PERFORM help_f4 using c_ZAM_COMPANY
*               changing p_comp.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_visit.
*
*  PERFORM help_f4 using c_ZAM_VISIT_FREQ_CHAR
*               changing p_visit.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_servh.
*
*  PERFORM help_f4 using c_ZAM_SERVICE_HOURS
*               changing p_servh.
*
**
*AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_engoil.
*
*  PERFORM help_f4 using c_ZAM_ENGINEOIL
*               changing p_engoil.


*--------- S T A R T   O F   M A I N   P R O C E S S I N G -----------*

*---------------------------------------------------------------------*
* START-OF-SELECTION                                                  *
*---------------------------------------------------------------------*
START-OF-SELECTION.

  CALL METHOD ycl_statistics=>record_transaction.

* Get the currency with which the prices are to be stored
  SELECT SINGLE waers INTO gv_curr
     FROM tvko
     WHERE vkorg = p_vkorg.

** Fill int. table with char. + values
*  refresh gt_char.
*
*  if not p_durat is initial.
*    move c_zam_duration       to gt_char-name.
*    move p_durat              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_epart is initial.
*    move c_ZAM_ELEC_PARTS     to gt_char-name.
*    move p_epart              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_eover is initial.
*    move c_zam_ELT_OVERHAUL   to gt_char-name.
*    move p_eover              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_mover is initial.
*    move c_zam_MOT_OVERHAUL   to gt_char-name.
*    move p_mover              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_mserv is initial.
*    move c_zam_MOTPOW_SERVICE to gt_char-name.
*    move p_mserv              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_oil is initial.
*    move c_zam_oil            to gt_char-name.
*    move p_oil                to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_rhour is initial.
*    move c_zam_running_hours  to gt_char-name.
*    move p_rhour              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_sprod is initial.
*    move c_zam_service_product to gt_char-name.
*    move p_sprod               to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_srang is initial.
*    move c_zam_service_range  to gt_char-name.
*    move p_srang              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_oiltp is initial.
*    move c_zam_oiltype        to gt_char-name.
*    move p_oiltp              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_comp is initial.
*    move c_zam_company        to gt_char-name.
*    move p_comp               to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_visit is initial.
*    move c_zam_visit_freq_char to gt_char-name.
*    move p_visit               to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_servh is initial.
*    move c_zam_service_hours  to gt_char-name.
*    move p_servh              to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.
*  if not p_engoil is initial.
*    move c_zam_engineoil      to gt_char-name.
*    move p_engoil             to gt_char-value.
*    append gt_char.
*    clear gt_char.
*  endif.

* begin of delete MOD-001
** Get purchasing group via translationtable in LSMW
*  CLEAR gv_ekgrp.
*  select single valueto into gv_ekgrp
*      from /SAPDMC/LSRVLO
*      where project   = 'YSE_INIT'
*        and ruletype  = 'TR'
*        and rulename  = 'Y_EKGRP'
*        and valuefrom = p_werks.
* end of delete MOD-001

  CLEAR: gv_textline,
         gv_plant_exist.

* Check existance of service product
  IF p_iqnum = c_x.
    SELECT matnr INTO gv_matnr
       FROM mara
       WHERE bismt = p_bismt.
    ENDSELECT.

    IF sy-subrc = 0.
*.... check existance of plant data
      SELECT SINGLE werks INTO gv_werks
         FROM marc
         WHERE matnr = gv_matnr
           AND werks = p_werks.

      IF sy-subrc = 0.
        gv_plant_exist = c_x.
      ENDIF.

*.... check existance of sales organization data
      SELECT SINGLE vkorg INTO gv_vkorg
         FROM mvke
         WHERE matnr = gv_matnr
           AND vkorg = p_vkorg
           AND vtweg = c_11.

      IF sy-subrc = 0.
        IF gv_plant_exist = c_x.
          SKIP 15.
          WRITE: 30 text-020.
          WRITE: /33 text-i01,
                 /30 text-020.
        ELSE.
*........ create only Plant data
          gv_type = c_plant.
          PERFORM create_sp_and_cond USING gv_type.
        ENDIF.
      ELSE.
        IF gv_plant_exist NE c_x.
*........ create S.O. and Plant data and condition
          gv_type = c_salesplant.
          PERFORM create_sp_and_cond USING gv_type.
        ELSE.
*........ create S.O. data
          gv_type = c_sales.
          PERFORM create_sp_and_cond USING gv_type.
        ENDIF.
      ENDIF.
    ELSE.
*.... create service product, S.O.data, Plant data and condition
      gv_type = c_basic.
      PERFORM create_sp_and_cond USING gv_type.
    ENDIF.
  ELSE.
*.. create generic service product, S.O.data, Plant data and condition
    IF p_genmat IS INITIAL.
      gv_type = c_basic.
      PERFORM create_sp_and_cond USING gv_type.
    ELSE.
*.... Look for matnr. and extend
      SELECT SINGLE matnr INTO gv_matnr
              FROM mara WHERE matnr = p_genmat.

      IF sy-subrc = 0.
*...... check existance of plant data
        SELECT SINGLE werks INTO gv_werks
           FROM marc
           WHERE matnr = gv_matnr
             AND werks = p_werks.

        IF sy-subrc = 0.
          gv_plant_exist = c_x.
        ENDIF.

*...... check existance of sales organization data
        SELECT SINGLE vkorg INTO gv_vkorg
           FROM mvke
           WHERE matnr = gv_matnr
             AND vkorg = p_vkorg
             AND vtweg = c_11.

        IF sy-subrc = 0.
          IF gv_plant_exist = c_x.
            SKIP 15.
            WRITE: 30 text-020.
            WRITE: /33 text-i06,
                   /30 text-020.
          ELSE.
*.......... create only Plant data
            gv_type = c_plant.
            PERFORM create_sp_and_cond USING gv_type.
          ENDIF.
        ELSE.
          IF gv_plant_exist NE c_x.
*.......... create S.O. and Plant data and condition
            gv_type = c_salesplant.
            PERFORM create_sp_and_cond USING gv_type.
          ELSE.
*.......... create S.O. data
            gv_type = c_sales.
            PERFORM create_sp_and_cond USING gv_type.
          ENDIF.
        ENDIF.
      ELSE.
        SKIP 15.
        WRITE: 30 text-020.
        WRITE: /33 text-i05,
               /30 text-020.
      ENDIF.
    ENDIF.
  ENDIF.

*----------------------------------------------------------------------*
* END-OF-SELECTION                                                     *
*----------------------------------------------------------------------*
END-OF-SELECTION.

*-S U B R O U T I N E S------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Form  HELP_F4
*&---------------------------------------------------------------------*
*       Inputhelp                                                      *
*----------------------------------------------------------------------*
FORM help_f4 USING r_char_tab-atnam
          CHANGING r_char_atwrt.

  READ TABLE tmerk WITH KEY atnam = r_char_tab-atnam
                        BINARY SEARCH.
  CHECK sy-subrc = 0.
  REFRESH g_api_values.

  CALL FUNCTION 'CTMS_CHAR_VALUE_F4'
       EXPORTING
            imp_characteristic = tmerk-atinn
*           IMP_MODE           = ' '
*           IMP_DISPLAY        = ' '
*           IMP_LANGUAGE       = SY-LANGU
*           IMP_DATE           = SY-DATUM
       TABLES
            exp_values         = g_api_values.

  READ TABLE g_api_values INDEX 1.
  IF sy-subrc = 0.
    r_char_atwrt = g_api_values-atwrt.
  ENDIF.

ENDFORM.                                                    "help_f4

*&---------------------------------------------------------------------*
*&      Form  create_sp_and_cond
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM create_sp_and_cond USING p_type.

* derive FP or SP service product --> item category group
* gv_len = strlen( p_bismt ).
  IF p_prdha+4(4) = '8140' OR
     p_prdha+4(4) = '8141' OR
     p_prdha+4(4) = '8142' OR
     p_prdha+4(4) = '8431'.
    gv_off = gv_len - 10.
  ELSE.
    gv_off = gv_len - 9.
  ENDIF.
  gv_char = p_bismt+gv_off(1).

* Fill MRP type, Item category group and condition type
  IF p_gener = c_x.
* begin of change MOD-005
*   gv_dismm = p_dismm.
*   gv_mtpos = p_mtpos.
    case p_matkl(3).
      when '041'.
        gv_mtpos = 'ZS01'.
        gv_dismm = 'Z1'.
      when '042'.
        gv_mtpos = 'ZS02'.
        gv_dismm = c_z3.
      when '043'.
        gv_mtpos = 'ZS03'.
        gv_dismm = c_z3.
      when '044'.
        gv_mtpos = 'ZS04'.
        gv_dismm = c_z4.
    endcase.
*   IF p_mtpos NE c_zs04.
    if gv_mtpos ne c_zs04.
* end of change MOD-005
      gv_kschl = c_zpro.
    ELSE.
      gv_kschl = c_zpn0.       "SP
    ENDIF.
  ELSE.
    IF gv_char = '4'.          "FP
      gv_mtpos = c_zs02.
      gv_dismm = c_z3.
      gv_kschl = c_zpro.
    ELSE.                      "SP
      gv_mtpos = c_zs04.
      gv_dismm = c_z4.
      gv_kschl = c_zpn0.
    ENDIF.
  ENDIF.

  CLEAR gv_so.

  IF p_type = c_basic.
*.. get next external material number
    CALL FUNCTION 'YAM_GET_NEXT_MATNR'
      EXPORTING
        p_ls_mtart         = c_mtart
      IMPORTING
        p_matnr            = gv_newmatnr
      EXCEPTIONS
        end_of_range       = 1
        wrong_materialtype = 2
        locked             = 3
        OTHERS             = 4.
    IF sy-subrc <> 0.
      SKIP 15.
      WRITE: 30 text-020.
      WRITE: /33 text-e14,
             /30 text-020.
      RETURN.
    ENDIF.

*.. create product, S.O.data and condition record
    IF p_iqnum = c_x.

*.... determine materialclass on base of old material number
      CLEAR gv_matkl.
      CALL FUNCTION 'YAM_CONVERT_MATKL'
        EXPORTING
          p_bismt       = p_bismt
          p_prdha       = p_prdha
        CHANGING
          p_matkl       = gv_matkl
        EXCEPTIONS
          no_parameters = 1
          OTHERS        = 2.

      IF sy-subrc <> 0.
        SKIP 15.
        WRITE: 30 text-020.
        WRITE: /33 text-e23,
               /30 text-020.
        RETURN.
      ENDIF.
      gv_bismt = p_bismt.
    ELSE.
*     clear gv_bismt.
*     gv_bismt = c_generic.
      gv_bismt = p_bismt.
      gv_matkl = p_matkl.
    ENDIF.
    PERFORM bdc_filldata_mat.
    gv_so = c_x.
  ELSEIF p_type = c_sales.

*.. create only S.O.data and condition record
    gv_so = c_x.
    PERFORM bdc_filldata_so.
  ELSEIF p_type = c_salesplant.

*.. create S.O.data, Plant data and condition record
    gv_so = c_x.
    PERFORM bdc_filldata_so_plant.
  ELSE.

*.. create only Plant data
    PERFORM bdc_filldata_plant.
  ENDIF.

  CALL TRANSACTION c_transmat USING i_bdcdata
* begin of change MOD-003
*               mode 'N' update 'S' messages into gt_err.
                MODE gv_mode UPDATE 'S' MESSAGES INTO gt_err.
* end of change MOD-003

  SKIP 15.
  WRITE: 30 text-020.

  IF sy-subrc IS INITIAL.
    GET PARAMETER ID 'MAT' FIELD gv_matnr.
    WRITE: /33 text-i02, gv_matnr.

*   Add tasklist in table T399A
* begin of change MOD-005
*    IF NOT p_tasklg IS INITIAL.
    IF sy-calld ne 'X'.
* end of change MOD-005
      PERFORM fill_t399a.
    ENDIF.

    gv_textline = text-i03.

    REFRESH: i_bdcdata,
             gt_err.

    IF gv_so = c_x.
      REPLACE '&1' WITH p_vkorg INTO gv_textline.
      WRITE: /33 gv_textline.
      PERFORM bdc_filldata_cond USING gv_matnr.
      CALL TRANSACTION c_transcon USING i_bdcdata
* begin of change MOD-003
*                   mode 'N' update 'S' messages into gt_err.
                     MODE gv_mode UPDATE 'S' MESSAGES INTO gt_err.
* end of change MOD-003

      IF NOT sy-subrc IS INITIAL.
        WRITE: /33 text-e03.
        LOOP AT gt_err.
          gv_msgnr = gt_err-msgnr.
          CALL FUNCTION 'RH_MESSAGE_GET'
            EXPORTING
*           SPRSL                   = SY-LANGU
              arbgb                   = sy-msgid
              msgnr                   = gv_msgnr
              msgv1                   = sy-msgv1
              msgv2                   = sy-msgv2
              msgv3                   = sy-msgv3
              msgv4                   = sy-msgv4
            IMPORTING
              msgtext                 = gv_mestx
            EXCEPTIONS
              message_not_found       = 1
              OTHERS                  = 2.

          IF sy-subrc = 0.
            FORMAT COLOR COL_NEGATIVE.
            WRITE: /33 gv_mestx.
          ENDIF.
        ENDLOOP.
        FORMAT RESET.
        WRITE: /30 text-020.
        RETURN.
      ELSE.
        gv_textline = text-i04.
        REPLACE '&1' WITH gv_kschl INTO gv_textline.
        WRITE: /33 gv_textline,
               /30 text-020.
      ENDIF.
    ELSE.
      REPLACE '&1' WITH p_werks INTO gv_textline.
      WRITE: /33 gv_textline.
      WRITE: /30 text-020.
    ENDIF.
  ELSE.
    WRITE: /33 text-e02.
    LOOP AT gt_err.
      gv_msgnr = gt_err-msgnr.
      CALL FUNCTION 'RH_MESSAGE_GET'
        EXPORTING
*         SPRSL                   = SY-LANGU
          arbgb                   = sy-msgid
          msgnr                   = gv_msgnr
          msgv1                   = sy-msgv1
          msgv2                   = sy-msgv2
          msgv3                   = sy-msgv3
          msgv4                   = sy-msgv4
        IMPORTING
          msgtext                 = gv_mestx
        EXCEPTIONS
          message_not_found       = 1
          OTHERS                  = 2.

      IF sy-subrc = 0.
        FORMAT COLOR COL_NEGATIVE.
        WRITE: /33 gv_mestx.
      ENDIF.
    ENDLOOP.
    FORMAT RESET.
    gv_textline = text-e04.
    REPLACE '&1' WITH p_vkorg INTO gv_textline.
    WRITE: /33 gv_textline,
           /33 text-e05,
           /30 text-020.
    RETURN.
  ENDIF.

ENDFORM.                    "create_sp_and_cond

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_so
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_so.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0060'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MATNR' gv_matnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MBRSH'  c_mbrsh
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MTART'  c_mtart
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1_REF-MATNR'  '!'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SELA'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0080'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VKORG'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VTWEG'  c_11
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP04'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-DWERK'  p_dwerk
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MG03STEUER-TAXKM(01)'  c_taxkm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4200'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KONDM'  c_kondm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KTGRM'  c_ktgrm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-MTPOS'  gv_mtpos
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_so

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_mat
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_mat.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0060'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MATNR'  gv_newmatnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MBRSH'  c_mbrsh
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MTART'  c_mtart
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1_REF-MATNR'  '!'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SELA'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0080'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-WERKS'  p_werks
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VKORG'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VTWEG'  c_11
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4004'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MAKT-MAKTX'  p_maktx
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-BISMT'  gv_bismt
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-MEINS'  c_meins
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-MATKL'  gv_matkl
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
* begin of insert MOD-001
*          USING    ''  ''  ''  'MARA-SPART'  c_01
           USING    ''  ''  ''  'MARA-SPART'  p_spart
* end of insert MOD-001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-PRDHA'  p_prdha
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP03'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Classification
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCLCA'  '0602'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMCLF-KLART'  c_001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTE'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCLFM'  '0500'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMCLF-CLASS(01)'  c_class
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCTMS'  '0109'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  CLEAR gv_idx.

  LOOP AT gt_char.
    ADD 1 TO gv_idx.

    IF gv_idx > 10.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      gv_idx = 1.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    'SAPLCLFM'  '0500'  'X'  ''  ''
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    ''  ''  ''  'BDC_OKCODE'  '/00'
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
               USING    'SAPLCTMS'  '0109'  'X'  ''  ''
               CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

    ENDIF.

    CONCATENATE 'RCTMS-MNAME(' gv_idx ')' INTO gv_scr_field.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  gv_scr_field  gt_char-name
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    CONCATENATE 'RCTMS-MWERT(' gv_idx ')' INTO gv_scr_field.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  gv_scr_field  gt_char-value
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
  ENDLOOP.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLCLFM'  '0500'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=WEI1'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-DWERK'  p_dwerk
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MG03STEUER-TAXKM(01)'  c_taxkm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4200'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KONDM'  c_kondm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KTGRM'  c_ktgrm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-MTPOS'  gv_mtpos
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP06'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARA-TRAGR'  c_z001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-LADGR'  c_z001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-PRCTR'  p_prctr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP09'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-EKGRP' gv_ekgrp
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP11'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4040'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP12'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-DISMM' gv_dismm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP24'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Accounting
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-BKLAS'  gc_bklas
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-STPRS'  gv_costpr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP26'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Costing and Save
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-HKMAT'  c_x
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_mat

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_cond
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_cond USING r_matnr.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPMV13A'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RV13A-KSCHL'  gv_kschl
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  IF gv_kschl = c_zpn0.                         "SP contracts
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLV14A'  '0100'  'X'  ''  ''
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'RV130-SELKZ(02)'  c_x
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'BDC_OKCODE'  '=WEIT'
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
* 070906 added MJ
  ELSE.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLV14A'  '0100'  'X'  ''  ''
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
            USING    ''  ''  ''  'RV130-SELKZ(06)'  c_x
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'BDC_OKCODE'  '=WEIT'
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
* 070906 added MJ
  ENDIF.

*
  IF gv_kschl = c_zpn0.                         "SP contracts
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPMV13A'  '1004'  'X'  ''  ''
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VKORG'  p_vkorg
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VTWEG'  c_11
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
  ELSE.
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPMV13A'  '1954'  'X'  ''  ''
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'KOMG-VKORG'  p_vkorg
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
* begin of change MOD-005
*            USING    ''  ''  ''  'KOMG-SPART'  c_01
             USING    ''  ''  ''  'KOMG-SPART'  p_spart
* end of change MOD-005
             CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.
  ENDIF.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'KOMG-MATNR(01)'  r_matnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_kbetr TO gv_kbetr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'KONP-KBETR(01)'  gv_kbetr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* begin of insertion MOD-004
  IF p_vkorg+0(2) = c_ru .
    CLEAR gv_calledfrom.
    IMPORT gv_calledfrom FROM MEMORY ID 'YAM_IQQ'.
    FREE MEMORY ID 'YAM_IQQ'.
    IF gv_calledfrom = 'YAM_IQQ'.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'KONP-KONWA(01)'  gv_curr
           CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.
  ENDIF.
* end of insertion MOD-004

* begin of change MOD-006
*  WRITE sy-datum TO l_date.
  DATA: lv_res(4)   TYPE n,
        lv_new_date TYPE dats.

  lv_new_date = sy-datum.
  lv_res = sy-datum+0(4) - 1.
  lv_new_date+0(4) = lv_res.
  WRITE lv_new_date TO l_date.
* end of change MOD-006
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RV13A-DATAB(01)'  l_date
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SICH'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_cond

*&---------------------------------------------------------------------*
*&      Form  prepare_matkl
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM prepare_matkl USING r_char
                         r_p_prdha
                CHANGING r_matkl.

  CASE r_char.
    WHEN '1'.
      r_matkl = '044ZIP'.
    WHEN '2'.
      r_matkl = '044ZPM'.
    WHEN '3'.
      r_matkl = '044ZTR'.
    WHEN '4'.
      r_matkl = '042Z10000'.
    WHEN '5'.
      r_matkl = '044ZPP'.
    WHEN '6'.
      IF r_p_prdha(3) = '84M' OR
         r_p_prdha(3) = '81M'.
        r_matkl = '044ZCC'.
      ELSE.
        r_matkl = '044ZXT'.
      ENDIF.
    WHEN '7'.
      r_matkl = '044ZXT'.
    WHEN OTHERS.
      r_matkl = '044Z'.
  ENDCASE.

ENDFORM.                    " prepare_matkl

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_plant
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_plant.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0060'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MATNR'  gv_matnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MBRSH'  c_mbrsh
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MTART'  c_mtart
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1_REF-MATNR'  '!'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SELA'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0080'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-WERKS'  p_werks
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* begin of delete MOD-002
*  perform fill_bdcdata in program yam_common_routines
*           using    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
*           changing struct_bdcdata.
*  append struct_bdcdata  to i_bdcdata.
*  clear  struct_bdcdata.
*
*  perform fill_bdcdata in program yam_common_routines
*           using    'SAPLMGMM'  '4000'  'X'  ''  ''
*           changing struct_bdcdata.
*  append struct_bdcdata  to i_bdcdata.
*  clear  struct_bdcdata.
* end of delete MOD-002

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP06'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Sales general/plant
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-LADGR'  c_z001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-PRCTR'  p_prctr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP09'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-EKGRP' gv_ekgrp
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP12'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* MRP1
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-DISMM' gv_dismm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP24'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Accounting
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-BKLAS'  gc_bklas
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-STPRS'  gv_costpr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP26'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Costing and Save
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-HKMAT'  c_x
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_plant

*&---------------------------------------------------------------------*
*&      Form  bdc_filldata_so_plant
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM bdc_filldata_so_plant.

* initial screen
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0060'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MATNR' gv_matnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MBRSH'  c_mbrsh
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-MTART'  c_mtart
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1_REF-MATNR'  '!'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SELA'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0070'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=ENTR'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '0080'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-WERKS'  p_werks
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VKORG'  p_vkorg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RMMG1-VTWEG'  c_11
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP04'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Sales org 1
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-DWERK'  p_dwerk
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MG03STEUER-TAXKM(01)'  c_taxkm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4200'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '/00'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP05'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Sales org 2
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KONDM'  c_kondm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-KTGRM'  c_ktgrm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MVKE-MTPOS'  gv_mtpos
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP06'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Sales general/plant
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-LADGR'  c_z001
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-PRCTR'  p_prctr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP09'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-EKGRP' gv_ekgrp
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP12'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* MRP1
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MARC-DISMM' gv_dismm
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP24'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Accounting
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-BKLAS'  gc_bklas
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-STPRS'  gv_costpr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SP26'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

* Costing and Save
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLMGMM'  '4000'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  WRITE p_stprs TO gv_costpr CURRENCY gv_curr.
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'MBEW-HKMAT'  c_x
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BU'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.        "bdc_filldata_so_plant

*&---------------------------------------------------------------------*
*&      Form  fill_t399a
*&---------------------------------------------------------------------*
*       Add tasklist/counter in table T399A
*----------------------------------------------------------------------*
FORM fill_t399a .

  DATA: lv_werks TYPE werks_d,
        lv_stdnr TYPE plnnr,
        lv_stdal TYPE plnal.

  REFRESH: i_bdcdata,
           gt_err.

  SELECT SINGLE werks INTO lv_werks
      FROM plko
      WHERE plnty = 'A'
        AND plnnr = p_tasklg
        AND plnal = p_tasklc.

  IF lv_werks(3) = 'GMI'.
    SELECT SINGLE stdnr stdal
        INTO (lv_stdnr, lv_stdal)
        FROM t399a
        WHERE iwerk    = lv_werks
          AND svobj_id = '01'
          AND svobj    = gv_matnr.

    IF sy-subrc = 0.
      IF lv_stdnr = p_tasklg AND
         lv_stdal = p_tasklc.
*       ok
      ELSE.
        FORMAT COLOR COL_NEGATIVE.
        WRITE: /33 text-e26.
        FORMAT RESET.
      ENDIF.
    ELSE.
      PERFORM create_entry_t399a USING lv_werks.
      CALL TRANSACTION c_transoisd USING i_bdcdata
* begin of change MOD-003
*              mode 'N' update 'S' messages into gt_err.
               MODE gv_mode UPDATE 'S' MESSAGES INTO gt_err.
* end of change MOD-003

      IF sy-subrc NE 0.
        WRITE: /33 text-e28.
        LOOP AT gt_err.
          gv_msgnr = gt_err-msgnr.
          CALL FUNCTION 'RH_MESSAGE_GET'
            EXPORTING
*           SPRSL                   = SY-LANGU
              arbgb                   = sy-msgid
              msgnr                   = gv_msgnr
              msgv1                   = sy-msgv1
              msgv2                   = sy-msgv2
              msgv3                   = sy-msgv3
              msgv4                   = sy-msgv4
            IMPORTING
              msgtext                 = gv_mestx
            EXCEPTIONS
              message_not_found       = 1
              OTHERS                  = 2.

          IF sy-subrc = 0.
            FORMAT COLOR COL_NEGATIVE.
            WRITE: /33 gv_mestx.
          ENDIF.
        ENDLOOP.
        FORMAT RESET.
      ELSE.
        WRITE: /33 text-i07.
      ENDIF.
    ENDIF.
  ELSE.
    SELECT SINGLE stdnr stdal
        INTO (lv_stdnr, lv_stdal)
        FROM t399a
        WHERE iwerk    = p_werks
          AND svobj_id = '01'
          AND svobj    = gv_matnr.

    IF sy-subrc = 0.
      IF lv_stdnr = p_tasklg AND
         lv_stdal = p_tasklc.
*       ok
      ELSE.
        FORMAT COLOR COL_NEGATIVE.
        WRITE: /33 text-e27.
        FORMAT RESET.
      ENDIF.
    ELSE.
      PERFORM create_entry_t399a USING p_werks.
      CALL TRANSACTION c_transoisd USING i_bdcdata
* begin of change MOD-003
*              mode 'N' update 'S' messages into gt_err.
               MODE gv_mode UPDATE 'S' MESSAGES INTO gt_err.
* end of change MOD-003

      IF sy-subrc NE 0.
        WRITE: /33 text-e28.
        LOOP AT gt_err.
          gv_msgnr = gt_err-msgnr.
          CALL FUNCTION 'RH_MESSAGE_GET'
            EXPORTING
*           SPRSL                   = SY-LANGU
              arbgb                   = sy-msgid
              msgnr                   = gv_msgnr
              msgv1                   = sy-msgv1
              msgv2                   = sy-msgv2
              msgv3                   = sy-msgv3
              msgv4                   = sy-msgv4
            IMPORTING
              msgtext                 = gv_mestx
            EXCEPTIONS
              message_not_found       = 1
              OTHERS                  = 2.

          IF sy-subrc = 0.
            FORMAT COLOR COL_NEGATIVE.
            WRITE: /33 gv_mestx.
          ENDIF.
        ENDLOOP.
        FORMAT RESET.
      ELSE.
        WRITE: /33 text-i07.
      ENDIF.
    ENDIF.
  ENDIF.

ENDFORM.                    " fill_t399a

*&---------------------------------------------------------------------*
*&      Form  create_entry_t399a
*&---------------------------------------------------------------------*
*       Create
*----------------------------------------------------------------------*
*      -->P_LV_WERKS  text
*----------------------------------------------------------------------*
FORM create_entry_t399a  USING    p_lv_werks.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLIM02'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=NEWL'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLIM02'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-IWERK(01)'  p_lv_werks
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-VAPLZ(01)'  p_lv_werks
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-VAWRK(01)'  p_lv_werks
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'SERVPROD(01)'  gv_matnr
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-STDNR(01)'  p_tasklg
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-STDAL(01)'  p_tasklc
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-BZGSART(01)'  '02'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'V_T399A_SD-BZGSOBJTYP(01)'  '02'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=SAVE'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLIM02'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

*
  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    'SAPLIM02'  '0100'  'X'  ''  ''
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

  PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'BDC_OKCODE'  '=BACK'
           CHANGING struct_bdcdata.
  APPEND struct_bdcdata  TO i_bdcdata.
  CLEAR  struct_bdcdata.

ENDFORM.                    " create_entry_t399a

*Text symbol text
*001:Basic data
*002:Classification
*020:*------------------------------*
*E01:You have no authorisation for sales area :
*E02:Transaction MM01 failed
*E03:Transaction VK11 failed
*E04:Views for &1 not created
*E05:Condition ZPN0 not created
*E06:You have no authorisation for plant :
*E07:You have no authorisation for delivering plant :
*E08:Invalid plant
*E09:Invalid product hierarchy
*E10:No characteristics exist for
*E11:Characteristic not in class
*E12:Value is not valid
*E13:Invalid profit center
*E14:No new material number could be reserved !
*E15:Length should be >11 and <17
*E16:Fill in Old Service Product number
*E17:Fill in Material Group
*E18:Invalid Item category group
*E19:Invalid MRP Type
*E20:Invalid Purchasing group
*E21:Invalid Material Group
*E22:Plant &1 not valid for Sales Organisation &2
*E23:Material group could not be derived !
*E24:Fill in Tasklist group and counter
*E25:Invalid Tasklist group and counter
*E26:Different GMIX task list already linked with this service product
*E27:Different GMIX task list already linked with this service product for this plant
*E28:Transaction OISD failed
*E29:No purch.grp for plant &1 in YSE_PLANT_EKGRP
*E30:Can not create these type of service products with this transaction
*I01:SP and Views already exist
*I02:SP number :
*I03:Views for &1 created
*I04:Condition &1 created
*I05:Generic mat. does not exist
*I06:Generic mat. already exists
*I07:SP linked to tasklist
*SC1:Sales Organization
*SC2:Distribution Channel
*SC3:Division
*SC4:Plant
*SC5:Delivering Plant
*SC6:IQ number
*SC7:Generic
*SC8:Old Service Product number
*SC9:Item cat. group
*SCA:MRP Type
*SCB:Material Group
*SCC:Mat.to be extended

*SCD:Tasklist group/counter
*Selection text
*P_BISMT:        Old Service Product number
*P_DWERK:D       .
*P_KBETR:        Sales price
*P_MAKTX:        Service Product description
*P_PRCTR:D       .
*P_PRDHA:D       .
*P_SPART:        ?
*P_STPRS:D       .
*P_VKORG:D       .
