*&---------------------------------------------------------------------*
*& Report  YSE_TVO_TEST13                                              *
*&                                                                     *
*&---------------------------------------------------------------------*
*&                                                                     *
*&                                                                     *
*&---------------------------------------------------------------------*

REPORT  YSE_TVO_TEST13.

PARAMETER: P_NUMBER TYPE QMNUM DEFAULT '00300000439'.
*           P_VBELN  TYPE VBELN,
*           P_POSNR  TYPE POSNR.

DATA:
      WA_NOTIFHEADER   TYPE BAPI2080_NOTHDRE,
      WA_NOTIFHDTEXT   TYPE BAPI2080_NOTHDTXTE,
      WA_NOTLONGTEXT   TYPE BAPI2080_NOTFULLTXTE,
      WA_NOTITEM       TYPE BAPI2080_NOTITEME,
      WA_NOTIFCAUS     TYPE BAPI2080_NOTCAUSE,
      WA_NOTIFACTV     TYPE BAPI2080_NOTACTVE,
      WA_NOTIFTASK     TYPE BAPI2080_NOTTASKE,
      WA_NOTIFPARTNR   TYPE BAPI2080_NOTPARTNRE,
      WA_NOTIFHEADER_I TYPE BAPI2080_NOTHDRI,
      WA_NOTLONGTEXT_I TYPE BAPI2080_NOTFULLTXTI,
      WA_NOTITEM_I     TYPE BAPI2080_NOTITEMI,
      WA_NOTIFCAUS_I   TYPE BAPI2080_NOTCAUSI,
      WA_NOTIFACTV_I   TYPE BAPI2080_NOTACTVI,
      WA_NOTIFTASK_I   TYPE BAPI2080_NOTTASKI,
      WA_NOTIFPARTNR_I TYPE BAPI2080_NOTPARTNRI,
      LT_NOTLONGTEXT   TYPE BAPI2080_NOTFULLTXTE OCCURS 0,
      LT_NOTITEM       TYPE BAPI2080_NOTITEME OCCURS 0,
      LT_NOTIFCAUS     TYPE BAPI2080_NOTCAUSE OCCURS 0,
      LT_NOTIFACTV     TYPE BAPI2080_NOTACTVE OCCURS 0,
      LT_NOTIFTASK     TYPE BAPI2080_NOTTASKE OCCURS 0,
      LT_NOTIFPARTNR   TYPE BAPI2080_NOTPARTNRE OCCURS 0,
      LT_NOTLONGTEXT_I TYPE BAPI2080_NOTFULLTXTI OCCURS 0,
      LT_NOTITEM_I     TYPE BAPI2080_NOTITEMI OCCURS 0,
      LT_NOTIFCAUS_I   TYPE BAPI2080_NOTCAUSI OCCURS 0,
      LT_NOTIFACTV_I   TYPE BAPI2080_NOTACTVI OCCURS 0,
      LT_NOTIFTASK_I   TYPE BAPI2080_NOTTASKI OCCURS 0,
      LT_NOTIFPARTNR_I TYPE BAPI2080_NOTPARTNRI OCCURS 0,
      LT_RETURN TYPE BAPIRET2 OCCURS 0.

* Read the template service notification
CALL FUNCTION 'BAPI_SERVNOT_GET_DETAIL'
  EXPORTING
    NUMBER            = P_NUMBER
  IMPORTING
    NOTIFHEADER       = WA_NOTIFHEADER
    NOTIFHDTEXT       = WA_NOTIFHDTEXT
  TABLES
    NOTLONGTEXT       = LT_NOTLONGTEXT
    NOTITEM           = LT_NOTITEM
    NOTIFCAUS         = LT_NOTIFCAUS
    NOTIFACTV         = LT_NOTIFACTV
    NOTIFTASK         = LT_NOTIFTASK
    NOTIFPARTNR       = LT_NOTIFPARTNR
    RETURN            = LT_RETURN.

* Copy the Notification details to tables/struct of different type
  MOVE-CORRESPONDING WA_NOTIFHEADER TO WA_NOTIFHEADER_I.
*  wa_notifheader_i-SHORT_TEXT =...
  LOOP AT LT_NOTLONGTEXT INTO WA_NOTLONGTEXT.
    MOVE-CORRESPONDING WA_NOTLONGTEXT TO WA_NOTLONGTEXT_I.
    APPEND WA_NOTLONGTEXT_I TO LT_NOTLONGTEXT_I.
  ENDLOOP. " LT_NOTLONGTEXT.
  LOOP AT LT_NOTITEM INTO WA_NOTITEM.
    MOVE-CORRESPONDING WA_NOTITEM TO WA_NOTITEM_I.
    APPEND WA_NOTITEM_I TO LT_NOTITEM_I.
  ENDLOOP. " LT_NOTITEM.
  LOOP AT LT_NOTIFCAUS INTO WA_NOTIFCAUS.
    MOVE-CORRESPONDING WA_NOTIFCAUS TO WA_NOTIFCAUS_I.
    APPEND WA_NOTIFCAUS_I TO LT_NOTIFCAUS_I.
  ENDLOOP. " LT_NOTIFCAUS.
  LOOP AT LT_NOTIFACTV INTO WA_NOTIFACTV.
    MOVE-CORRESPONDING WA_NOTIFACTV TO WA_NOTIFACTV_I.
    APPEND WA_NOTIFACTV_I TO LT_NOTIFACTV_I.
  ENDLOOP. " LT_NOTIFACTV.
  LOOP AT LT_NOTIFTASK INTO WA_NOTIFTASK.
    MOVE-CORRESPONDING WA_NOTIFTASK TO WA_NOTIFTASK_I.
    APPEND WA_NOTIFTASK_I TO LT_NOTIFTASK_I.
  ENDLOOP. " LT_NOTIFTASK.
  LOOP AT LT_NOTIFPARTNR INTO WA_NOTIFPARTNR.
    MOVE-CORRESPONDING WA_NOTIFPARTNR TO WA_NOTIFPARTNR_I.
    APPEND WA_NOTIFPARTNR_I TO LT_NOTIFPARTNR_I.
  ENDLOOP. " LT_NOTIFPARTNR.

break-point.

* Create the new service notification
CALL FUNCTION 'BAPI_SERVNOT_CREATE'
  EXPORTING
*   EXTERNAL_NUMBER          =
    NOTIF_TYPE               = 'XA'
    NOTIFHEADER              = WA_NOTIFHEADER_I
*   TASK_DETERMINATION       = ' '
*   SENDER                   =
*   ORDERID                  =
  IMPORTING
    NOTIFHEADER_EXPORT       = WA_NOTIFHEADER    " This has the templ notif. upto now, it will now be filled with the new notif details
  TABLES
    NOTITEM                  = LT_NOTITEM_I
    NOTIFCAUS                = LT_NOTIFCAUS_I
    NOTIFACTV                = LT_NOTIFACTV_I
    NOTIFTASK                = LT_NOTIFTASK_I
    NOTIFPARTNR              = LT_NOTIFPARTNR_I
    LONGTEXTS                = LT_NOTLONGTEXT_I
*    KEY_RELATIONSHIPS        =
    RETURN                   = LT_RETURN.

CALL FUNCTION 'BAPI_SERVNOT_SAVE'
  EXPORTING
    NUMBER            = WA_NOTIFHEADER-NOTIF_NO
  IMPORTING
    NOTIFHEADER       = WA_NOTIFHEADER
  TABLES
    RETURN            = LT_RETURN.

COMMIT WORK.

write: 'Number of new notification:',
       WA_NOTIFHEADER-NOTIF_NO.

*Selection text£º
*P_NUMBER:        Service notif. template
*P_POSNR:        Originating delivery item
*P_VBELN:        Originating delivery
