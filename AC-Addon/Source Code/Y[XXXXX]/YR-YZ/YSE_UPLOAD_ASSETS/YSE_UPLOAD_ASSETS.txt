********************************************************************
* Program ID           : YSE_UPLOAD_ASSETS                         *
* Program Title        : Upload G/L Accounts - Batch Input         *
* Author               : Marc Jacobs                               *
* Date                 : 05/02/2009                                *
* Change Request Number: CR1155                                    *
* Description          : The purpose of this program is to upload  *
*                        the assets                                *
*==================================================================*
*==================================================================*
* Change History Log                                               *
*------------------------------------------------------------------*
*Mod. no.|  Date    | Name           | Transport Nr  | Chg Ref. #  *
*------------------------------------------------------------------*

REPORT yse_upload_assets.

*******************
* data definition *
*******************

TYPE-POOLS: abap.

TABLES : usr01.

CONSTANTS : c_type_a         TYPE bapiret2-type     VALUE 'A',
            c_type_e         TYPE bapiret2-type     VALUE 'E',
            c_en             TYPE spras             VALUE 'E',
            c_01(3)          TYPE c                 VALUE '001'.

DATA : BEGIN OF i_data OCCURS 0,
          anlkl            LIKE anla-anlkl,
          bukrs            LIKE anla-bukrs,
          txt501           LIKE anla-txt50,
          txt502           LIKE anla-txt50,
          anlhtxt          LIKE anlh-anlhtxt,
          sernr            LIKE anla-sernr,
          invnr            LIKE anla-invnr,
          menge(18)        TYPE c,
          meins            LIKE anla-meins,
          invzu            LIKE anla-invzu,
          inken            LIKE anla-inken,
          kostl            LIKE anlz-kostl,
          aktiv(10)        TYPE c,
          caufn            LIKE anlz-caufn,
          pernr            LIKE anlz-pernr,
          ord41            LIKE anla-ord41,
          ord42            LIKE anla-ord42,
          ord43            LIKE anla-ord43,
          ord44            LIKE anla-ord44,
          lifnr            LIKE anla-lifnr,
          herst            LIKE anla-herst,
          xneu_am          LIKE ra02s-xneu_am,
          xgbr_am          LIKE ra02s-xgbr_am,
          land1            LIKE anla-land1,
          glo_rus_okof     LIKE glofaaassetdata-glo_rus_okof,
          glo_rus_depgr    LIKE glofaaassetdata-glo_rus_depgr,
          glo_rus_sernr    LIKE glofaaassetdata-glo_rus_sernr,
          glo_rus_txb_type LIKE glofaatmdpndnt-glo_rus_txb_type,
          glo_rus_txb_unit(17) TYPE c,
          glo_rus_ttx_lnum LIKE glofaatmdpndnt-glo_rus_ttx_lnum,
          glo_rus_ttx_okt1 LIKE glofaatmdpndnt-glo_rus_ttx_okt1,
          glo_rus_ttx_okt2 LIKE glofaatmdpndnt-glo_rus_ttx_okt2,
          glo_rus_ttx_okt3 LIKE glofaatmdpndnt-glo_rus_ttx_okt3,
          glo_rus_ttx_okt4 LIKE glofaatmdpndnt-glo_rus_ttx_okt4,
          glo_rus_prt_okt1 LIKE glofaatmdpndnt-glo_rus_prt_okt1,
          glo_rus_prt_okt2 LIKE glofaatmdpndnt-glo_rus_prt_okt2,
          glo_rus_prt_okt3 LIKE glofaatmdpndnt-glo_rus_prt_okt3,
          glo_rus_prt_okt4 LIKE glofaatmdpndnt-glo_rus_prt_okt4,
          glo_rus_ttx_rgsd(10) TYPE c,
          glo_rus_ttx_rmvd(10) TYPE c,
          afabe1           LIKE anlb-afabe,
          afasl1           LIKE anlb-afasl,
          ndjar1           LIKE anlb-ndjar,
          ndper1           LIKE anlb-ndper,
          afabg1(10)       TYPE c,
          afabe2           LIKE anlb-afabe,
          afasl2           LIKE anlb-afasl,
          ndjar2           LIKE anlb-ndjar,
          ndper2           LIKE anlb-ndper,
          afabg2(10)       TYPE c,
          afabe3           LIKE anlb-afabe,
          afasl3           LIKE anlb-afasl,
          ndjar3           LIKE anlb-ndjar,
          ndper3           LIKE anlb-ndper,
          afabg3(10)       TYPE c,
          anbtr01(16)      TYPE c,
          anbtr01_06(16)   TYPE c,
          anbtr02(16)      TYPE c,
          anbtr02_06(16)   TYPE c,
          anbtr03(16)      TYPE c,
          anbtr03_06(16)   TYPE c,
          anbtr04(16)      TYPE c,
          anbtr04_06(16)   TYPE c,
      END OF i_data.



DATA : BEGIN OF i_errors OCCURS 0,
         bktxt LIKE bkpf-bktxt,
         xblnr LIKE bkpf-xblnr,
         zuonr LIKE bseg-zuonr,
         message(100) TYPE c,
       END OF i_errors.

DATA: BEGIN OF gt_messtab OCCURS 0.
        INCLUDE STRUCTURE merrdat.
DATA: END   OF gt_messtab.

DATA: struct_bdcdata  TYPE bdcdata.
DATA: i_bdcdata  TYPE STANDARD TABLE OF bdcdata.
DATA: l_date TYPE d.

DATA :   g_text                LIKE t100-text,
         g_mstring(100)        TYPE c,
         lv_mode(1)            TYPE c,
         lv_wrbtr(16)          TYPE c,
         lv_wrbtr_p            TYPE wrbtr,
         lv_wmwst(16)          TYPE c,
         lv_wmwst_p            TYPE wmwst,
         lv_newbs              LIKE rf05a-newbs,
         lv_taxvendor(1)       TYPE c.


**************
* Parameters *
**************

SELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE text-009.


SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT (30) text-001.
SELECTION-SCREEN POSITION 35.
PARAMETERS p_fname LIKE cffile-filename OBLIGATORY MEMORY ID gxd.
SELECTION-SCREEN END OF LINE.

PARAMETER : p_header TYPE c AS CHECKBOX .

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT 1(30) text-016 MODIF ID sc1.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_comma  LIKE kcd_doku_struc-decimal_sep
            RADIOBUTTON GROUP dec  DEFAULT 'X' MODIF ID sc1.
SELECTION-SCREEN COMMENT 4(20) text-003 MODIF ID sc1.
PARAMETERS: p_point  LIKE kcd_doku_struc-decimal_sep
            RADIOBUTTON GROUP dec MODIF ID sc1.
SELECTION-SCREEN COMMENT 27(20) text-004 MODIF ID sc1.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
SELECTION-SCREEN COMMENT 1(30) text-017 MODIF ID sc1.
SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: p_dmj  RADIOBUTTON GROUP dat DEFAULT 'X' MODIF ID sc1.
SELECTION-SCREEN COMMENT 4(20) text-005 MODIF ID sc1.
PARAMETERS: p_jmd  RADIOBUTTON GROUP dat MODIF ID sc1.
SELECTION-SCREEN COMMENT 27(20) text-006 MODIF ID sc1.
SELECTION-SCREEN END OF LINE.

PARAMETERS : p_view TYPE c AS CHECKBOX.

SELECTION-SCREEN END OF BLOCK b1.

AT SELECTION-SCREEN ON VALUE-REQUEST FOR p_fname.

  CALL FUNCTION 'WS_FILENAME_GET'
    EXPORTING
      def_filename     = p_fname
      def_path         = '\'
      mask             = ',*.*,*.csv;*.txt.'
      mode             = 'O'
      title            = text-005
    IMPORTING
      filename         = p_fname
    EXCEPTIONS
      inv_winsys       = 01
      no_batch         = 02
      selection_cancel = 03
      selection_error  = 04.

START-OF-SELECTION.

  PERFORM read_file.

  PERFORM process_data.

*&---------------------------------------------------------------------*
*&      Form  read_file
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM read_file.

  DATA : w_filename TYPE string.

  SELECT SINGLE * FROM usr01 WHERE bname = sy-uname.

  w_filename = p_fname.

  CALL FUNCTION 'GUI_UPLOAD'
    EXPORTING
      filename                = w_filename
      filetype                = 'ASC'
      has_field_separator     = 'X'
    TABLES
      data_tab                = i_data
    EXCEPTIONS
      file_open_error         = 1
      file_read_error         = 2
      no_batch                = 3
      gui_refuse_filetransfer = 4
      invalid_type            = 5
      no_authority            = 6
      unknown_error           = 7
      bad_data_format         = 8
      header_not_allowed      = 9
      separator_not_allowed   = 10
      header_too_long         = 11
      unknown_dp_error        = 12
      access_denied           = 13
      dp_out_of_memory        = 14
      disk_full               = 15
      dp_timeout              = 16
      OTHERS                  = 17.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
          WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.
* Delete first row from file if user indicated that a header line is
* included
  IF p_header = 'X'.
    DELETE i_data INDEX 1.
  ENDIF.

* Convert data if required
  IF p_point = 'X' AND usr01-dcpfm <> 'X'.
    PERFORM convert_into_comma.
  ELSEIF p_comma = 'X' AND usr01-dcpfm = 'X'.
    PERFORM convert_into_point.
  ENDIF.

  PERFORM change_date.

  IF p_view = 'X'.
    lv_mode = 'A'.
  ELSE.
    lv_mode = 'N'.
  ENDIF.

ENDFORM.                    " READ_FILE


*&---------------------------------------------------------------------*
*&      Form  CONVERT_INTO_COMMA
*&---------------------------------------------------------------------*
FORM convert_into_comma.

  LOOP AT i_data.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-menge WITH '/'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-menge WITH '.'.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-menge WITH ','.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr01 WITH '/'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr01 WITH '.'.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr01 WITH ','.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr02 WITH '/'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr02 WITH '.'.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr02 WITH ','.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr03 WITH '/'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr03 WITH '.'.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr03 WITH ','.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr04 WITH '/'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr04 WITH '.'.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr04 WITH ','.
    MODIFY i_data INDEX sy-tabix.
  ENDLOOP.

ENDFORM.                    " CONVERT_INTO_COMMA
*&---------------------------------------------------------------------*
*&      FORM  CONVERT_INTO_POINT
*&---------------------------------------------------------------------*
FORM convert_into_point.

  LOOP AT i_data.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-menge WITH '/'.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-menge WITH ','.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-menge WITH '.'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr01 WITH '/'.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr01 WITH ','.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr01 WITH '.'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr02 WITH '/'.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr02 WITH ','.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr02 WITH '.'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr03 WITH '/'.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr03 WITH ','.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr03 WITH '.'.
    REPLACE ALL OCCURRENCES OF ',' IN i_data-anbtr04 WITH '/'.
    REPLACE ALL OCCURRENCES OF '.' IN i_data-anbtr04 WITH ','.
    REPLACE ALL OCCURRENCES OF '/' IN i_data-anbtr04 WITH '.'.
    MODIFY i_data INDEX sy-tabix.
  ENDLOOP.

ENDFORM.                    " CONVERT_INTO_POINT

*&---------------------------------------------------------------------*
*&      Form  CHANGE_DATE
*&---------------------------------------------------------------------*
FORM change_date.

  DATA : wl_date(10) TYPE c.

  IF p_dmj = 'X' AND usr01-datfm <> '1'.
    LOOP AT i_data.


      wl_date = i_data-aktiv.
      REPLACE ALL OCCURRENCES OF '.' IN wl_date WITH ''.
      CLEAR i_data-aktiv.
      i_data-aktiv+0(4) = wl_date+4(4).
      i_data-aktiv+4(2) = wl_date+2(2).
      i_data-aktiv+6(2) = wl_date+0(2).

      wl_date = i_data-glo_rus_ttx_rgsd.
      REPLACE ALL OCCURRENCES OF '.' IN wl_date WITH ''.
      CLEAR i_data-glo_rus_ttx_rgsd.
      i_data-glo_rus_ttx_rgsd+0(4) = wl_date+4(4).
      i_data-glo_rus_ttx_rgsd+4(2) = wl_date+2(2).
      i_data-glo_rus_ttx_rgsd+6(2) = wl_date+0(2).

      wl_date = i_data-glo_rus_ttx_rmvd.
      REPLACE ALL OCCURRENCES OF '.' IN wl_date WITH ''.
      CLEAR i_data-glo_rus_ttx_rmvd.
      i_data-glo_rus_ttx_rmvd+0(4) = wl_date+4(4).
      i_data-glo_rus_ttx_rmvd+4(2) = wl_date+2(2).
      i_data-glo_rus_ttx_rmvd+6(2) = wl_date+0(2).

      wl_date = i_data-afabg1.
      REPLACE ALL OCCURRENCES OF '.' IN wl_date WITH ''.
      CLEAR i_data-afabg1.
      i_data-afabg1+0(4) = wl_date+4(4).
      i_data-afabg1+4(2) = wl_date+2(2).
      i_data-afabg1+6(2) = wl_date+0(2).

      wl_date = i_data-afabg2.
      REPLACE ALL OCCURRENCES OF '.' IN wl_date WITH ''.
      CLEAR i_data-afabg2.
      i_data-afabg2+0(4) = wl_date+4(4).
      i_data-afabg2+4(2) = wl_date+2(2).
      i_data-afabg2+6(2) = wl_date+0(2).

      wl_date = i_data-afabg3.
      REPLACE ALL OCCURRENCES OF '.' IN wl_date WITH ''.
      CLEAR i_data-afabg3.
      i_data-afabg3+0(4) = wl_date+4(4).
      i_data-afabg3+4(2) = wl_date+2(2).
      i_data-afabg3+6(2) = wl_date+0(2).

      MODIFY i_data TRANSPORTING
            aktiv
            glo_rus_ttx_rgsd
            glo_rus_ttx_rmvd
            afabg1
            afabg2
            afabg3.
    ENDLOOP.

  ELSE.
    LOOP AT i_data.
      REPLACE ALL OCCURRENCES OF '.' IN i_data-aktiv WITH ''.
      REPLACE ALL OCCURRENCES OF '.' IN i_data-glo_rus_ttx_rgsd WITH ''.
      REPLACE ALL OCCURRENCES OF '.' IN i_data-glo_rus_ttx_rgsd WITH ''.
      REPLACE ALL OCCURRENCES OF '.' IN i_data-afabg1 WITH ''.
      REPLACE ALL OCCURRENCES OF '.' IN i_data-afabg2 WITH ''.
      REPLACE ALL OCCURRENCES OF '.' IN i_data-afabg3 WITH ''.
      MODIFY i_data TRANSPORTING
        aktiv
        glo_rus_ttx_rgsd
        glo_rus_ttx_rmvd
        afabg1
        afabg2
        afabg3.
    ENDLOOP.
  ENDIF.

ENDFORM.                    " CHANGE_DATE


*&---------------------------------------------------------------------*
*&      Form  PROCESS_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM process_data .

  CLEAR:   gt_messtab[], i_bdcdata[].

  LOOP AT i_data.

* initial screen
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    'SAPLAIST'  '0105'  'X'  ''  ''
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    IF NOT i_data-anlkl IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-ANLKL'  i_data-anlkl
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-bukrs IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-BUKRS'  i_data-bukrs
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    ''  ''  ''  'RA02S-NASSETS'  c_01
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    ''  ''  ''  'BDC_OKCODE'  '/00'
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

* next screen
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    'SAPLAIST'  '1000'  'X'  ''  ''
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    IF NOT i_data-txt501 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-TXT50'  i_data-txt501
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-txt502 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-TXA50'  i_data-txt502
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anlhtxt IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLH-ANLHTXT'  i_data-anlhtxt
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-sernr IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-SERNR'  i_data-sernr
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-invnr IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-INVNR'  i_data-invnr
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-menge IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-MENGE'  i_data-menge
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-meins IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-MEINS'  i_data-meins
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-invzu IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-INVZU'  i_data-invzu
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-inken IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-INKEN'  i_data-inken
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF i_data-anlkl = '1271' OR i_data-anlkl+0(2) = '97'.
      IF NOT i_data-kostl IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLZ-KOSTL'  i_data-kostl
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.
    ENDIF.

    IF NOT i_data-pernr IS INITIAL AND i_data-anlkl+0(2) = '97'.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLZ-PERNR'  i_data-pernr
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-aktiv IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'ANLA-AKTIV'  i_data-aktiv
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anlkl+0(2) = '97'.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'BDC_OKCODE'  '=TAB02'
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

*tab2
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      IF NOT i_data-anlkl+0(2) = '97'.
        IF NOT i_data-kostl IS INITIAL.
          PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'ANLZ-KOSTL'  i_data-kostl
             CHANGING struct_bdcdata.
          APPEND struct_bdcdata  TO i_bdcdata.
          CLEAR  struct_bdcdata.
        ENDIF.
      ENDIF.

      IF NOT i_data-caufn IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLZ-CAUFN'  i_data-caufn
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-pernr IS INITIAL AND i_data-anlkl+0(2) <> '97'.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLZ-PERNR'  i_data-pernr
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '=TAB03'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

* tab3
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      IF NOT i_data-ord41 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-ORD41'  i_data-ord41
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ord42 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-ORD42'  i_data-ord42
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ord43 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-ORD43'  i_data-ord43
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ord44 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-ORD44'  i_data-ord44
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '=TAB04'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
* tab04
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      IF NOT i_data-lifnr IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-LIFNR'  i_data-lifnr
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-herst IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-HERST'  i_data-herst
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-xneu_am IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'RA02S-XNEU_AM'  i_data-xneu_am
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ELSE.
        IF NOT i_data-xgbr_am IS INITIAL.
          PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    ''  ''  ''  'RA02S-XGBR_AM'  i_data-xgbr_am
             CHANGING struct_bdcdata.
          APPEND struct_bdcdata  TO i_bdcdata.
          CLEAR  struct_bdcdata.
        ENDIF.
      ENDIF.

      IF NOT i_data-land1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLA-LAND1'  i_data-land1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '=TAB06'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
* tab06
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      IF NOT i_data-glo_rus_okof IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAAASSETDATA-GLO_RUS_OKOF'  i_data-glo_rus_okof
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_depgr IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAAASSETDATA-GLO_RUS_DEPGR'  i_data-glo_rus_depgr
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_sernr IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAAASSETDATA-GLO_RUS_SERNR'  i_data-glo_rus_sernr
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_txb_type IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TXB_TYPE'  i_data-glo_rus_txb_type
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_txb_unit IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TXB_UNIT'  i_data-glo_rus_txb_unit
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_lnum IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_LNUM'  i_data-glo_rus_ttx_lnum
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_okt1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_OKT1'  i_data-glo_rus_ttx_okt1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_okt2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_OKT2'  i_data-glo_rus_ttx_okt2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_okt3 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_OKT3'  i_data-glo_rus_ttx_okt3
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_okt4 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_OKT4'  i_data-glo_rus_ttx_okt4
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_prt_okt1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_PRT_OKT1'  i_data-glo_rus_prt_okt1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_prt_okt2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_PRT_OKT2'  i_data-glo_rus_prt_okt2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_prt_okt3 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_PRT_OKT3'  i_data-glo_rus_prt_okt3
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_prt_okt4 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_PRT_OKT4'  i_data-glo_rus_prt_okt4
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_rgsd IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_RGSD'  i_data-glo_rus_ttx_rgsd
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-glo_rus_ttx_rmvd IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'GLOFAATMDPNDNT-GLO_RUS_TTX_RMVD'  i_data-glo_rus_ttx_rmvd
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '=TAB08'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

* tab08
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.


      IF NOT i_data-ndjar1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDJAR(01)'  i_data-ndjar1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndjar2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDJAR(02)'  i_data-ndjar2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndjar3 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDJAR(04)'  i_data-ndjar3
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndper1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDPER(01)'  i_data-ndper1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndper2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDPER(02)'  i_data-ndper2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndper3 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDPER(04)'  i_data-ndper3
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-afabg1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-AFABG(01)'  i_data-afabg1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-afabg2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-AFABG(02)'  i_data-afabg2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-afabg3 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-AFABG(04)'  i_data-afabg3
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '/00'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

* and save
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.


      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '=BUCH'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ELSE.
* for 97xx

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'BDC_OKCODE'  '=TAB07'
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    'SAPLAIST'  '1000'  'X'  ''  ''
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

      IF NOT i_data-ndjar1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDJAR(01)'  i_data-ndjar1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndjar2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDJAR(02)'  i_data-ndjar2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndper1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDPER(01)'  i_data-ndper1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-ndper2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-NDPER(02)'  i_data-ndper2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-afabg1 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-AFABG(01)'  i_data-afabg1
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      IF NOT i_data-afabg2 IS INITIAL.
        PERFORM fill_bdcdata IN PROGRAM yam_common_routines
           USING    ''  ''  ''  'ANLB-AFABG(02)'  i_data-afabg2
           CHANGING struct_bdcdata.
        APPEND struct_bdcdata  TO i_bdcdata.
        CLEAR  struct_bdcdata.
      ENDIF.

      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'BDC_OKCODE'  '/00'
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

* and save
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
             USING    'SAPLAIST'  '1000'  'X'  ''  ''
             CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.


      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
     USING    ''  ''  ''  'BDC_OKCODE'  '=BUCH'
     CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.

    ENDIF.

    IF NOT i_bdcdata[] IS INITIAL.

*.. Perform Call Transaction to update the customer
      CALL TRANSACTION 'AS01' USING i_bdcdata
           MODE  lv_mode UPDATE 'S' MESSAGES INTO gt_messtab.

      IF sy-subrc NE 0 .
        LOOP AT gt_messtab.
          IF gt_messtab-msgty = c_type_a OR
             gt_messtab-msgty = c_type_e .
            SELECT SINGLE text FROM t100 INTO g_text
                                  WHERE sprsl = c_en
                                    AND arbgb = gt_messtab-msgid
                                    AND msgnr = gt_messtab-msgno.
            IF sy-subrc = 0.
              g_mstring = g_text.
              IF g_mstring CS '&1'.
                REPLACE '&1' WITH gt_messtab-msgv1 INTO g_mstring.
                REPLACE '&2' WITH gt_messtab-msgv2 INTO g_mstring.
                REPLACE '&3' WITH gt_messtab-msgv3 INTO g_mstring.
                REPLACE '&4' WITH gt_messtab-msgv4 INTO g_mstring.
              ELSE.
                REPLACE '&' WITH gt_messtab-msgv1 INTO g_mstring.
                CONDENSE g_mstring.
                REPLACE '&' WITH gt_messtab-msgv2 INTO g_mstring.
                CONDENSE g_mstring.
                REPLACE '&' WITH gt_messtab-msgv3 INTO g_mstring.
                REPLACE '&' WITH gt_messtab-msgv4 INTO g_mstring.
              ENDIF.
              CONDENSE g_mstring.
            ENDIF.

            EXIT.
          ENDIF .
        ENDLOOP.
      ENDIF .

    ENDIF .

    CLEAR   i_bdcdata.
    REFRESH i_bdcdata.
* as92
* initial screen
    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    'SAPLAIST'  '0100'  'X'  ''  ''
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
   USING    ''  ''  ''  'BDC_OKCODE'  '/00'
   CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    'SAPLAIST'  '1000'  'X'  ''  ''
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
       USING    ''  ''  ''  'BDC_OKCODE'  '=ALTD'
       CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
   USING    'SAPLALTD'  '1100'  'X'  ''  ''
   CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    IF NOT i_data-anbtr01 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR01(01)'  i_data-anbtr01
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr01_06 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR01(06)'  i_data-anbtr01_06
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr02 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR02(01)'  i_data-anbtr02
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr02_06 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR02(06)'  i_data-anbtr02_06
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr03 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR03(01)'  i_data-anbtr03
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr03_06 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR03(06)'  i_data-anbtr03_06
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr04 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR04(01)'  i_data-anbtr04
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    IF NOT i_data-anbtr04_06 IS INITIAL.
      PERFORM fill_bdcdata IN PROGRAM yam_common_routines
         USING    ''  ''  ''  'RALT_DYNP_STRUC-ANBTR04(06)'  i_data-anbtr04_06
         CHANGING struct_bdcdata.
      APPEND struct_bdcdata  TO i_bdcdata.
      CLEAR  struct_bdcdata.
    ENDIF.

    PERFORM fill_bdcdata IN PROGRAM yam_common_routines
   USING    ''  ''  ''  'BDC_OKCODE'  '=BUCH'
   CHANGING struct_bdcdata.
    APPEND struct_bdcdata  TO i_bdcdata.
    CLEAR  struct_bdcdata.

    IF NOT i_bdcdata[] IS INITIAL.

*.. Perform Call Transaction to update the customer
      CALL TRANSACTION 'AS92' USING i_bdcdata
           MODE  lv_mode UPDATE 'S' MESSAGES INTO gt_messtab.

      IF sy-subrc NE 0 .
        LOOP AT gt_messtab.
          IF gt_messtab-msgty = c_type_a OR
             gt_messtab-msgty = c_type_e .
            SELECT SINGLE text FROM t100 INTO g_text
                                  WHERE sprsl = c_en
                                    AND arbgb = gt_messtab-msgid
                                    AND msgnr = gt_messtab-msgno.
            IF sy-subrc = 0.
              g_mstring = g_text.
              IF g_mstring CS '&1'.
                REPLACE '&1' WITH gt_messtab-msgv1 INTO g_mstring.
                REPLACE '&2' WITH gt_messtab-msgv2 INTO g_mstring.
                REPLACE '&3' WITH gt_messtab-msgv3 INTO g_mstring.
                REPLACE '&4' WITH gt_messtab-msgv4 INTO g_mstring.
              ELSE.
                REPLACE '&' WITH gt_messtab-msgv1 INTO g_mstring.
                CONDENSE g_mstring.
                REPLACE '&' WITH gt_messtab-msgv2 INTO g_mstring.
                CONDENSE g_mstring.
                REPLACE '&' WITH gt_messtab-msgv3 INTO g_mstring.
                REPLACE '&' WITH gt_messtab-msgv4 INTO g_mstring.
              ENDIF.
              CONDENSE g_mstring.
            ENDIF.

            EXIT.
          ENDIF .
        ENDLOOP.
      ENDIF .

    ENDIF .


    CLEAR   i_bdcdata.
    REFRESH i_bdcdata.

  ENDLOOP.

  LOOP AT i_errors.
    WRITE : /.
    WRITE : i_errors-bktxt , i_errors-xblnr,
            i_errors-zuonr , i_errors-message.
  ENDLOOP.

ENDFORM.                    " PROCESS_DATA

*&---------------------------------------------------------------------*
*&      Form  copy_data
*&---------------------------------------------------------------------*
*      make 2 records
*----------------------------------------------------------------------*

*&---------------------------------------------------------------------*
*&      Form  read_lifnr
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_BUKRS    text
*      -->P_LIFNR    text
*      -->P_PRZN     text
*----------------------------------------------------------------------*
FORM read_lifnr  USING p_bukrs CHANGING p_lifnr p_przn.

  TABLES : thead.
  DATA: tname LIKE thead-tdname, num_line TYPE i.
  DATA: BEGIN OF line OCCURS 0.  "Text lines
          INCLUDE STRUCTURE tline.
  DATA: END OF line.

  CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
    EXPORTING
      input  = p_lifnr
    IMPORTING
      output = p_lifnr.

  MOVE p_lifnr+7(10) TO tname.
  MOVE p_bukrs TO tname+10.
  CLEAR line.
  CALL FUNCTION 'READ_TEXT'          "read text
    EXPORTING
       id         =  'P101'
*         language   = 'R'
       language   =  sy-langu
       name       =  tname
       object     = 'LFB1'
    IMPORTING
       header     = thead
    TABLES
       lines      = line
    EXCEPTIONS OTHERS = 8.
  DESCRIBE TABLE line LINES num_line.   " line content
  IF num_line > 0.
    READ TABLE line INDEX 1.
    IF line-tdline <> space.
      p_przn = 'X'.
    ENDIF.
  ENDIF.

ENDFORM.                    "read_lifnr

*Text symbol text£º
*001:Upload File
*002:Decimal notation
*003:1234567,89
*004:1234567.89
*005:ddmmjjjj
*006:jjjjmmdd
*007: records out of
*008: (total transactions in upload file) unsuccessfully posted:
*009:Inputfile
*010:1 Record
*011:2 Records
*016:Decimal notation
*017:Date format

*018:Company Code
*Selection text£º
*P_HEADER:        First line is header line
*P_VIEW:        View screens
