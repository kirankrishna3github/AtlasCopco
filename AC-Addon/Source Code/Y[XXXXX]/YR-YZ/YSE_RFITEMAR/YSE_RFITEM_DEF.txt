*----------------------------------------------------------------------*
*   INCLUDE RFITEM_DEF                                                 *
*----------------------------------------------------------------------*

TYPE-POOLS: SLIS, TPIT, RSDS.

TABLES: B0SG, RFXPO, ITEMSET.
TABLES: SSCRFIELDS.

DATA: G_REPID        LIKE SY-REPID,
      GS_VARIANT     LIKE DISVARIANT,
      GS_LAYOUT      TYPE SLIS_LAYOUT_ALV,
      S_EPOSITEM     TYPE TPIT_EPOSITEM.

* expiring currencies:
DATA: GD_EXPCUR_FLAG TYPE C,
      GD_EXPCUR_PROC TYPE TPRCPROC,
      GD_EXPCUR_BSEG TYPE C.

DATA: X_STOP         TYPE C,
      X_GL_OPVW      TYPE C,
      GD_SAKNR_MSG   TYPE SAKNR,
      GD_BUKRS_MSG   TYPE BUKRS,
      N_LINES        LIKE SY-TABIX,
      P_KEYDATE      LIKE SY-DATUM,
      GD_ALVSAVE     TYPE C VALUE 'A',
      GD_WL_ON       TYPE C,
      GD_DDSEL_ON    TYPE C,
      GT_COSEL       TYPE TCOSEL WITH HEADER LINE,
      X_GRID         TYPE C,
      GD_DYNP_FUN    TYPE I,
      GD_DYNP_VAL    TYPE I,
      SUBRC          LIKE SY-SUBRC,
      X_CHANGE       TYPE C.

DATA: IT_T021S       LIKE T021S OCCURS 1     WITH HEADER LINE,
      IT_SPECTAB     TYPE TPIT_T_TABSTAT     WITH HEADER LINE,
      IT_SPECFLD     TYPE TPIT_T_FLDSTAT     WITH HEADER LINE,
      IT_MOVEFLD     TYPE TPIT_T_FLDMOVE     WITH HEADER LINE,
      IT_MOVEREF     TYPE TPIT_T_REFMOVE     WITH HEADER LINE,
      IT_KKCURR      TYPE TPIT_T_KKCURR      WITH HEADER LINE,
      IT_SELSCREEN   LIKE RSPARAMS OCCURS 10 WITH HEADER LINE,
      IT_DYN_TRANGE  TYPE RSDS_TRANGE        WITH HEADER LINE,
      IT_DYN_TEXPR   TYPE RSDS_TEXPR         WITH HEADER LINE,
      IT_CALLBACK    LIKE LDBCB OCCURS 10    WITH HEADER LINE,
      GT_SELSCREEN   LIKE RSPARAMS OCCURS 10,
      GT_DYN_TRANGE  TYPE RSDS_TRANGE,
      GT_SEARCHPATTERN TYPE SYLDB_SP,
      GT_DYN_TEXPR   TYPE RSDS_TEXPR,
      IT_CENTRAL     TYPE TPIT_T_CENTRAL     WITH HEADER LINE,
      GT_FIELDCAT    TYPE SLIS_T_FIELDCAT_ALV WITH HEADER LINE.

*... accounts and companies tables, needed for open FI:
DATA: IT_ACCTS       TYPE TPIT_T_RFEPK   WITH HEADER LINE,
      IT_COMPS       TYPE TPIT_T_RFEPB   WITH HEADER LINE.

DATA: WA_POS         LIKE RFPOSXEXT,
      IT_POS         LIKE YSE_RFPOSXEXT OCCURS 1 WITH HEADER LINE,
*>>>> Begin of EXTUVE  20090618
*      GT_POS_INV     TYPE STANDARD TABLE OF RFPOSXEXT,
*      GT_POS_NO_INV  TYPE STANDARD TABLE OF RFPOSXEXT,
*      GT_POS_DWN_PY  TYPE STANDARD TABLE OF RFPOSXEXT.
      GT_POS_INV     TYPE STANDARD TABLE OF YSE_RFPOSXEXT,
      GT_POS_NO_INV  TYPE STANDARD TABLE OF YSE_RFPOSXEXT,
      GT_POS_DWN_PY  TYPE STANDARD TABLE OF YSE_RFPOSXEXT.
*>>>> End of EXTUVE 20090618

*... tables needed for transfer prices:
DATA: IT_TP_AUTH     TYPE TPIT_T_TP_AUTH_T001A WITH HEADER LINE,
      IT_TP_FIELDS   TYPE TPIT_T_TPFIELDS WITH HEADER LINE.

DATA: WA_BKPF        LIKE BKPF,
      WA_VBKPF       LIKE VBKPF,
      WA_BSEG        LIKE BSEG,
      WA_VBSEGD      LIKE VBSEGD,
      WA_VBSEGK      LIKE VBSEGK,
      WA_VBSEGS      LIKE VBSEGS,
      WA_BSEGC       LIKE BSEGC,
      WA_BSEC        LIKE BSEC,
      WA_VBSEC       LIKE VBSEC,
      WA_BSED        LIKE BSED,
      WA_BSBV        LIKE BSBV,
      WA_PAYR        LIKE PAYR,
      WA_BSEGP       LIKE BSEGP,
      WA_X001        LIKE X001.

* Table for optimized reading of special fields.
* Same structure as analogous table (TRATAB) in the old line item
* display (RFEPOS00)
TYPES: BEGIN OF TYPE_SPEC_FIELDS,
           FNAME TYPE DFIES-LFIELDNAME,
         END OF TYPE_SPEC_FIELDS.
DATA: GT_SPEC_FIELDS TYPE STANDARD TABLE OF TYPE_SPEC_FIELDS
                     WITH KEY FNAME.

* Copy of pa_stida for fixing keydates.
DATA: PA_STIDA_DEFAULT LIKE SY-DATUM.

CONSTANTS:
      C_GUICNT       LIKE SY-TABIX    VALUE 100,
      C_REPID_AR     LIKE SY-REPID    VALUE 'YSE_RFITEMAR',
      C_REPID_AP     LIKE SY-REPID    VALUE 'YSE_RFITEMAP',
      C_REPID_GL     LIKE SY-REPID    VALUE 'YSE_RFITEMGL',
      C_KOART_AR     LIKE BSEG-KOART  VALUE 'D',
      C_KOART_AP     LIKE BSEG-KOART  VALUE 'K',
      C_KOART_GL     LIKE BSEG-KOART  VALUE 'S',
      C_TRUE         TYPE C           VALUE 'X',
      C_FALSE        TYPE C           VALUE SPACE,
      C_X            TYPE C           VALUE 'X'.


* Tables for reading from archive:
DATA:   YBSEG        TYPE BSEG OCCURS 10,
        XBSEG        TYPE HASHED TABLE OF BSEG
                     WITH UNIQUE KEY BUKRS BELNR GJAHR BUZEI,
        YBKPF        TYPE BKPF OCCURS 10,
        XBKPF        TYPE HASHED TABLE OF BKPF
                     WITH UNIQUE KEY BUKRS BELNR GJAHR.

TYPES : BEGIN OF GTY_POS_REDUCED,
        BUKRS TYPE SKB1-BUKRS,
        BELNR TYPE BSEG-BELNR,
        GJAHR TYPE BSEG-GJAHR,
        BUZEI TYPE BSEG-BUZEI,
        BUDAT TYPE BKPF-BUDAT,
        END OF GTY_POS_REDUCED.
DATA: GT_POS_POSTED    TYPE SORTED TABLE OF GTY_POS_REDUCED
                       WITH UNIQUE KEY BUKRS BELNR GJAHR BUZEI BUDAT,
      GT_POS_PARKED    TYPE SORTED TABLE OF GTY_POS_REDUCED
                       WITH UNIQUE KEY BUKRS BELNR GJAHR BUZEI BUDAT,
      GT_POS_ARCHIVED  TYPE SORTED TABLE OF GTY_POS_REDUCED
                       WITH UNIQUE KEY BUKRS BELNR GJAHR BUZEI BUDAT,
      GD_POS_REDUCED TYPE GTY_POS_REDUCED.

FIELD-SYMBOLS : <GFS_POS_REDUCED> TYPE GTY_POS_REDUCED.

DATA: GD_READ_MEMO_DONE  TYPE C.

DATA: GD_USEAR TYPE BOOLE_D,
      GD_USEDB TYPE BOOLE_D,
      GD_MEMOR TYPE C.



*SEED*******
TYPES: BEGIN OF LTY_VBAK,
          VBELN TYPE VBELN,
          NETWR TYPE NETWR_AK,
          WAERK TYPE WAERK,
         END OF LTY_VBAK,

         BEGIN OF LTY_VBPA,
          VBELN TYPE VBELN,
          PERNR TYPE PERNR_D,
          PARVW TYPE PARVW,
         END OF LTY_VBPA,



         BEGIN OF LTY_PA0002,
          PERNR TYPE PERNR_D,
          RUFNM TYPE PAD_RUFNM,
         END OF LTY_PA0002,




         BEGIN OF LTY_KNVP,
            KUNNR TYPE KUNNR,
            PARVW TYPE PARVW,
            PERNR TYPE PERNR_D,
         END OF LTY_KNVP,

         BEGIN OF LTY_KNVK,
            KUNNR TYPE KUNNR,
            NAME1 TYPE NAME1_GP,
            TELF1 TYPE TELF1,
         END OF LTY_KNVK,

         BEGIN OF LTY_PRCTR,
           BUKRS TYPE BUKRS,
           BELNR TYPE BELNR_D,
           GJAHR TYPE GJAHR,
           BUZEI TYPE BUZEI,
           PRCTR TYPE PRCTR,
         END OF LTY_PRCTR.

RANGES: LR_PARVW FOR VBPA-PARVW.

DATA: LT_VBRK TYPE STANDARD TABLE OF VBRK,
      LT_VBRP TYPE STANDARD TABLE OF VBRP,
      LT_VBAK TYPE STANDARD TABLE OF LTY_VBAK,
      LT_VBPA TYPE STANDARD TABLE OF LTY_VBPA,
      LT_PA   TYPE STANDARD TABLE OF LTY_PA0002,
      LT_PRCTR TYPE STANDARD TABLE OF LTY_PRCTR,

LS_VBRK TYPE VBRK,
LS_VBRP TYPE VBRP,
LS_VBAK TYPE LTY_VBAK,
LS_VBPA TYPE LTY_VBPA,
LS_PA   TYPE LTY_PA0002,

LT_KNVV TYPE STANDARD TABLE OF KNVV,
LT_KNVP TYPE STANDARD TABLE OF LTY_KNVP,
LT_KNA1 TYPE STANDARD TABLE OF KNA1,
LT_KNVK TYPE STANDARD TABLE OF LTY_KNVK,

LS_KNVV TYPE KNVV,
LS_KNVP TYPE LTY_KNVP,
LS_KNA1 TYPE KNA1,
LS_KNVK TYPE LTY_KNVK,
LS_PRCTR TYPE LTY_PRCTR,

LT_BSAD TYPE STANDARD TABLE OF BSAD.

FIELD-SYMBOLS: <FS_VBRK> TYPE VBRK,
               <FS_VBRP> TYPE VBRP,
               <FS_VBAK> TYPE LTY_VBAK,
               <FS_VBPA> TYPE LTY_VBPA,
               <FS_PA>   TYPE LTY_PA0002,
               <FS_PRCTR> TYPE LTY_PRCTR,

               <FS_KNVV> TYPE KNVV,
               <FS_KNVP> TYPE LTY_KNVP,
               <FS_KNA1> TYPE KNA1,
               <FS_KNVK> TYPE LTY_KNVK,

               <FS_BSAD> TYPE BSAD.


LR_PARVW-SIGN   = 'I'.
LR_PARVW-OPTION = 'EQ'.

LR_PARVW-LOW    = 'VE'.
APPEND LR_PARVW.
LR_PARVW-LOW    = 'PE'.
APPEND LR_PARVW.
LR_PARVW-LOW    = 'ZX'.
APPEND LR_PARVW.
LR_PARVW-LOW    = 'ZY'.
APPEND LR_PARVW.
