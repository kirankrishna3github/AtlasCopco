************************************************************************
* Include YSE_SDMM_SURPLUS_POLA_TOP                                    *
************************************************************************

************************************************************************
* TYPE POOLS                                                           *
************************************************************************
TYPE-POOLS : SLIS.


************************************************************************
* TABLES                                                               *
************************************************************************
TABLES:
  MARD,
  MARC,
  MARA,
  VBAP,
*  EORD,
  MSEG.

************************************************************************
* INTERNAL TYPES                                                       *
************************************************************************
TYPES:
  BEGIN OF STR_REC,            " Receipt/issue dates per storage loc mat
    MATNR TYPE MATNR,
    WERKS LIKE MSEG-WERKS,
    LGORT LIKE MSEG-LGORT,
    BUDAT TYPE BUDAT,
  END OF STR_REC.


TYPES: BEGIN OF TY_EKKO,
         EBELN    TYPE EBELN,
         BSART    TYPE BSART,
       END OF TY_EKKO.


TYPES : BEGIN OF TY_MARC,
          MATNR TYPE MARC-MATNR,
          WERKS TYPE MARC-WERKS,
          MMSTA TYPE MARC-MMSTA,
          DISMM TYPE MARC-DISMM,
          EISBE TYPE MARC-EISBE,
          MAXLZ TYPE MARC-MAXLZ,
        END OF TY_MARC.



TYPES : BEGIN OF TY_MARD,
          MATNR TYPE MARD-MATNR,
          WERKS TYPE MARD-WERKS,
          LGORT TYPE MARD-LGORT,
          LABST TYPE MARD-LABST,
          UMLME TYPE MARD-UMLME,
          INSME TYPE MARD-INSME,
          EINME TYPE MARD-EINME,
          SPEME TYPE MARD-SPEME,
          RETME TYPE MARD-RETME,
          KLABS TYPE MARD-KLABS,
          KINSM TYPE MARD-KINSM,
          KEINM TYPE MARD-KEINM,
          KSPEM TYPE MARD-KSPEM,
        END OF TY_MARD.



TYPES : BEGIN OF TY_MARA,
          MATNR TYPE MARA-MATNR,
          MTART TYPE MARA-MTART,
          MATKL TYPE MARA-MATKL,
          MEINS TYPE MARA-MEINS,
          BRGEW TYPE MARA-BRGEW,
          GEWEI TYPE MARA-GEWEI,
          PRDHA TYPE MARA-PRDHA,
        END OF TY_MARA.


TYPES : BEGIN OF TY_MAKT,
          MATNR TYPE MAKT-MATNR,
          MAKTX TYPE MAKT-MAKTX,
        END OF TY_MAKT.

TYPES : BEGIN OF TY_PRICE ,
          MATNR   TYPE MATNR,          " Material nr
          BWKEY   LIKE MBEW-BWKEY,
         END   OF TY_PRICE.

TYPES : BEGIN OF TY_MSEG,
           MBLNR TYPE MSEG-MBLNR,
           MJAHR TYPE MSEG-MJAHR,
           ZEILE TYPE MSEG-ZEILE,
           BWART TYPE MSEG-BWART,
           MATNR TYPE MSEG-MATNR,
           WERKS TYPE MSEG-WERKS,
           LGORT TYPE MSEG-LGORT,
           MENGE TYPE MSEG-MENGE,
           MEINS TYPE MSEG-MEINS,
           ERFMG TYPE MSEG-ERFMG,
           ERFME TYPE MSEG-ERFME,
           EBELN TYPE MSEG-EBELN,
       END OF TY_MSEG.


TYPES : BEGIN OF TY_MKPF,
        MBLNR TYPE MKPF-MBLNR,
        MJAHR TYPE MKPF-MJAHR,
        BUDAT TYPE MKPF-BUDAT,
      END OF TY_MKPF.

TYPES : BEGIN OF TY_VBAK,
         VBELN TYPE VBAK-VBELN,
        END OF TY_VBAK.

TYPES : BEGIN OF TY_VBAP,
        VBELN TYPE VBAP-VBELN,
        POSNR TYPE VBAP-POSNR,
        MATNR TYPE VBAP-MATNR,
        KWMENG TYPE VBAP-KWMENG,
        WERKS TYPE VBAP-WERKS,
        LGORT TYPE VBAP-LGORT,
      END OF TY_VBAP.

TYPES : BEGIN OF TY_VBFA,
          VBELV TYPE VBFA-VBELV,
          POSNV TYPE VBFA-POSNV,
          VBELN TYPE VBFA-VBELN,
          POSNN TYPE VBFA-POSNN,
        END OF TY_VBFA.

TYPES : BEGIN OF TY_LIPS,
         VBELN TYPE LIPS-VBELN,
         POSNR TYPE LIPS-POSNR,
         MATNR TYPE LIPS-MATNR,
         WERKS TYPE LIPS-WERKS,
         LGORT TYPE LIPS-LGORT,
         LFIMG TYPE LIPS-LFIMG,
       END OF TY_LIPS.

TYPES : BEGIN OF TY_VBUK,
         VBELN TYPE VBUK-VBELN,
        END OF TY_VBUK.


TYPES: BEGIN OF TY_MVKE,
        MATNR TYPE MVKE-MATNR,
        VKORG TYPE MVKE-VKORG,
        PRODH TYPE MVKE-PRODH,
        PGC   TYPE YSE_PRCTR_DERIV-PGC,
      END OF TY_MVKE.

TYPES: BEGIN OF TY_YSE_PRCTR_DERIV,
        PGC TYPE YSE_PRCTR_DERIV-PGC,
        PRCTR TYPE YSE_PRCTR_DERIV-PRCTR,
      END OF TY_YSE_PRCTR_DERIV.


TYPES: BEGIN OF TY_YSE_PRCTR_BL,
        PRCTR TYPE YSE_PRCTR_BL-PRCTR,
        SEGMENT TYPE YSE_PRCTR_BL-SEGMENT,
      END OF TY_YSE_PRCTR_BL.


TYPES:   BEGIN OF TY_T156,
           BWART LIKE T156-BWART,
         END OF TY_T156.


************************************************************************
* INTERNAL TABLES                                                      *
************************************************************************
DATA:
  BEGIN OF GT_MARA OCCURS 0,
    MATNR LIKE MARA-MATNR,
    MTART LIKE MARA-MTART,
    MATKL LIKE MARA-MATKL,
    MMSTA LIKE MARC-MMSTA,
    MEINS LIKE MARA-MEINS,
    PRDHA LIKE MARA-PRDHA,
    MAKTX LIKE MAKT-MAKTX,
    WERKS LIKE MARC-WERKS,
    DISMM LIKE MARC-DISMM,
    MAXLZ LIKE MARC-MAXLZ,
    LGORT LIKE MARD-LGORT,
    EISBE LIKE MARC-EISBE,
    LABST LIKE MARD-LABST,
    EINME LIKE MARD-EINME,
    INSME LIKE MARD-INSME,
    SPEME LIKE MARD-SPEME,
    RETME LIKE MARD-RETME,
    UMLME LIKE MARD-UMLME,
    KLABS LIKE MARD-KLABS,
    KEINM LIKE MARD-KEINM,
    KINSM LIKE MARD-KINSM,
    KSPEM LIKE MARD-KSPEM,
*    LIFNR LIKE EORD-LIFNR,
    BRGEW LIKE MARA-BRGEW,
    GEWEI LIKE MARA-GEWEI,
  END OF GT_MARA,
  BEGIN OF GT_PRICE OCCURS 0,
    MATNR   TYPE MATNR,          " Material nr
    BWKEY   LIKE MBEW-BWKEY,
    STPRS   TYPE STPRS,          " Standard price
    PEINH   TYPE PEINH,          " Unit
    ZKDAT   TYPE DZKDAT,         " Valid from date
    VERPR   TYPE VERPR,          " Moving average price
  END OF GT_PRICE,
  BEGIN OF GT_MRP_DESCR OCCURS 0,
    DISMM TYPE DISMM,
    DIBEZ TYPE DIBEZ,
  END OF GT_MRP_DESCR,
  BEGIN OF GT_MAT_STAT_DESCR OCCURS 0,
    MMSTA TYPE MMSTA,
    MTSTB TYPE MTSTB,
  END OF GT_MAT_STAT_DESCR,
  BEGIN OF GT_MAT_GRP_DESCR OCCURS 0,
    MATKL TYPE MATKL,
    WGBEZ TYPE WGBEZ,
  END OF GT_MAT_GRP_DESCR,
  BEGIN OF GT_T001W  OCCURS 0,
    WERKS TYPE WERKS_D,
    VKORG TYPE VKOIV,
  END OF GT_T001W,
  BEGIN OF IT_T001W  OCCURS 0,
    WERKS LIKE T001W-WERKS,
    BWKEY LIKE T001W-BWKEY,
  END OF IT_T001W,
  BEGIN OF GT_ALLOCS OCCURS 0,
    MATNR LIKE MARA-MATNR,
    WERKS LIKE MARC-WERKS,
    LGORT LIKE MARD-LGORT,
    ALLOC_QUANTITY LIKE VBAP-KWMENG,
  END OF GT_ALLOCS,
  BEGIN OF IT_VBAP OCCURS 0,
    VBELN  LIKE VBAP-VBELN,
    POSNR  LIKE VBAP-POSNR,
    MATNR  LIKE VBAP-MATNR,
    KWMENG LIKE VBAP-KWMENG,
    WERKS  LIKE VBAP-WERKS,
    LGORT  LIKE VBAP-LGORT,
  END OF  IT_VBAP,
  BEGIN OF IT_LIPS OCCURS 0,
    VBELN LIKE LIPS-VBELN,
    POSNR LIKE LIPS-POSNR,
    MATNR LIKE LIPS-MATNR,
    LGORT LIKE LIPS-LGORT,
    LFIMG LIKE LIPS-LFIMG,
    WERKS LIKE LIPS-WERKS,
  END OF  IT_LIPS,
  BEGIN OF IT_RESB OCCURS 0,
    MATNR LIKE VBAP-MATNR,
    WERKS LIKE RESB-WERKS,
    LGORT LIKE RESB-LGORT,
    BDMNG LIKE RESB-BDMNG,
    ENMNG LIKE RESB-ENMNG,
  END OF IT_RESB,
  BEGIN OF IT_WAERS OCCURS 0,
    WERKS LIKE T001W-WERKS,
    WAERS LIKE T001-WAERS,
  END OF IT_WAERS,
  BEGIN OF IT_MSEG OCCURS 0,
    MBLNR LIKE MSEG-MBLNR,
    MJAHR LIKE MSEG-MJAHR,
    ZEILE LIKE MSEG-ZEILE,
    MATNR LIKE MSEG-MATNR,
    WERKS LIKE MSEG-WERKS,
    LGORT LIKE MSEG-LGORT,
    MENGE LIKE MSEG-MENGE,
    MEINS LIKE MSEG-MEINS,
    ERFMG LIKE MSEG-ERFMG,
    ERFME LIKE MSEG-ERFME,
    BWART LIKE MSEG-BWART,
    BUDAT LIKE MKPF-BUDAT,
    EBELN LIKE MSEG-EBELN,
  END OF IT_MSEG,
  BEGIN OF IT_REC_QTY_6MTH OCCURS 0,
    MATNR LIKE MSEG-MATNR,
    WERKS LIKE MSEG-WERKS,
    LGORT LIKE MSEG-LGORT,
    MENGE LIKE MSEG-MENGE,
  END OF IT_REC_QTY_6MTH,

  BEGIN OF IT_REC_QTY_12MTH OCCURS 0,
    MATNR LIKE MSEG-MATNR,
    WERKS LIKE MSEG-WERKS,
    LGORT LIKE MSEG-LGORT,
    MENGE LIKE MSEG-MENGE,
  END OF IT_REC_QTY_12MTH,

  BEGIN OF IT_CONS OCCURS 0,
    MATNR LIKE MSEG-MATNR,
    WERKS LIKE MSEG-WERKS,
    LGORT LIKE MSEG-LGORT,
    BUDAT LIKE MKPF-BUDAT,
    MENGE LIKE MSEG-MENGE,
  END OF IT_CONS,
  BEGIN OF IT_MSKU OCCURS 0,
    MATNR LIKE MSKU-MATNR,
    WERKS LIKE MSKU-WERKS,
    KULAB LIKE MSKU-KULAB,
  END OF IT_MSKU,
  BEGIN OF IT_EBAN OCCURS 0,
    MATNR LIKE EBAN-MATNR,
    RESWK LIKE EBAN-RESWK,
    MENGE LIKE EBAN-MENGE,
  END OF IT_EBAN,
  BEGIN OF IT_EKPO OCCURS 0,
    EBELN LIKE EKPO-EBELN,
    EBELP LIKE EKPO-EBELP,
    MATNR LIKE EKPO-MATNR,
    RESWK LIKE EKKO-RESWK,
    LGORT LIKE EKPO-LGORT,
    MENGE LIKE EKPO-MENGE,
  END OF IT_EKPO,
  BEGIN OF IT_EKBE OCCURS 0,
    EBELN LIKE EKPO-EBELN,
    EBELP LIKE EKPO-EBELP,
    MATNR LIKE VBAP-MATNR,
    MENGE LIKE EKPO-MENGE,
    BELNR LIKE EKBE-BELNR,
    BWART LIKE EKBE-BWART,
  END OF IT_EKBE,

*  BEGIN OF IT_A017 OCCURS 0,
*    KAPPL LIKE A017-KAPPL,
*    KSCHL LIKE A017-KSCHL,
**    LIFNR LIKE A017-LIFNR,
*    MATNR LIKE A017-MATNR,
*    EKORG LIKE A017-EKORG,
*    WERKS LIKE A017-WERKS,
*    ESOKZ LIKE A017-ESOKZ,
*    DATBI LIKE A017-DATBI,
*    DATAB LIKE A017-DATAB,
*    KNUMH LIKE A017-KNUMH,
*    KOPOS LIKE KONP-KOPOS,
*    KBETR LIKE KONP-KBETR,
*    KPEIN LIKE KONP-KPEIN,
*    KONWA LIKE KONP-KONWA,
*  END OF IT_A017,

*  IT_T024W TYPE T024W OCCURS 0 WITH HEADER LINE,
  GT_REC_DAT      TYPE TABLE OF STR_REC        WITH HEADER LINE,
  GT_ISS_DAT      TYPE TABLE OF STR_REC        WITH HEADER LINE,
  GT_MAT_SURPLUS  TYPE YSE_SDMM_SURPLUS_OUTPUT_POLA OCCURS 0 WITH HEADER LINE,
  GT_SURPLUS_HD   TYPE YSE_SURPLUS_HD01        OCCURS 0 WITH HEADER LINE,
  GT_FIELDCAT     TYPE LVC_T_FCAT,
  GT_FIELDCAT_BG  TYPE SLIS_T_FIELDCAT_ALV,
  IT_T179         TYPE T179                    OCCURS 0.


DATA: IT_EKKO TYPE SORTED TABLE OF TY_EKKO
              WITH UNIQUE KEY EBELN
              WITH HEADER LINE.

DATA: IT_PLC  TYPE TABLE OF K9RCD11000010
              WITH HEADER LINE.


DATA : LT_MARC TYPE STANDARD TABLE OF  TY_MARC WITH HEADER LINE,
       LT_MARD TYPE STANDARD TABLE OF  TY_MARD WITH HEADER LINE,
       LT_MARA TYPE STANDARD TABLE OF  TY_MARA WITH HEADER LINE,
       LT_MAKT TYPE STANDARD TABLE OF  TY_MAKT WITH HEADER LINE,
       LT_PRICE TYPE STANDARD TABLE OF TY_PRICE WITH HEADER LINE,
       LT_MSEG TYPE STANDARD TABLE OF  TY_MSEG WITH HEADER LINE,
       LT_MKPF TYPE STANDARD TABLE OF  TY_MKPF WITH HEADER LINE,
       LT_VBAP TYPE STANDARD TABLE OF  TY_VBAP WITH HEADER LINE,
       LT_VBAK TYPE STANDARD TABLE OF  TY_VBAK WITH HEADER LINE,
       LT_VBFA TYPE STANDARD TABLE OF TY_VBFA WITH HEADER LINE,
       LT_LIPS TYPE STANDARD TABLE OF TY_LIPS WITH HEADER LINE,
       LT_VBUK TYPE STANDARD TABLE OF TY_VBUK WITH HEADER LINE,
       LT_MVKE TYPE STANDARD TABLE OF TY_MVKE WITH HEADER LINE,
       LT_YSE_PRCTR_DERIV TYPE STANDARD TABLE OF TY_YSE_PRCTR_DERIV WITH HEADER LINE,
       LT_YSE_PRCTR_BL    TYPE STANDARD TABLE OF TY_YSE_PRCTR_BL    WITH HEADER LINE.


DATA : IT_T156     TYPE STANDARD TABLE OF TY_T156 WITH HEADER LINE,
       GT_T156_REC TYPE STANDARD TABLE OF TY_T156 WITH HEADER LINE,
       GT_T156_ISS TYPE STANDARD TABLE OF TY_T156 WITH HEADER LINE.


************************************************************************
* GLOBAL CONSTANTS                                                     *
************************************************************************
CONSTANTS:
  GC_TRUE    TYPE C     VALUE 'X',
  GC_ENGLISH TYPE SPRAS VALUE 'E',
  C_PO_REPLENISHMENT(4) TYPE C VALUE 'ZNB1',
  C_PSTYP_STOCK_TR(1)   TYPE C VALUE '7',
  GC_ZUB1(4) TYPE C VALUE 'ZUB1',
*  GC_ZUB4(4) TYPE C VALUE 'ZUB4',
  GC_C(1) TYPE C VALUE 'C',
  GC_J(1) TYPE C VALUE 'J',
  GC_N(1) TYPE C VALUE 'N',
  GC_01(2) TYPE C VALUE '01'.


************************************************************************
* GLOBAL VARIABLES                                                     *
************************************************************************
DATA:
* GV_PRDHA                    TYPE PRODH_D,
  V_DAT                       LIKE SY-DATUM,
  V_TIM                       LIKE SY-UZEIT,
  USER_NAME                   LIKE SY-UNAME,
  OK_CODE                     TYPE SYUCOMM,
  GS_VARIANT                  TYPE DISVARIANT,
  GS_LAYOUT                   TYPE LVC_S_LAYO,
  GV_CUR_MINUS_12             TYPE DATS,
  GV_CUR_MINUS_24             TYPE DATS,
  GV_CUR_MINUS_6              TYPE DATS,
  GV_3_MONTHS_AGO             TYPE DATS,
  GV_6_MONTHS_AGO             TYPE DATS,
  GV_12_MONTHS_AGO            TYPE DATS,
  GV_GAC(4)                   TYPE C,
  GV_PGC(4)                   TYPE C.


DATA: GV_PLC_TEMP(10)         TYPE C,
      GV_VKORG                TYPE VKORG,
*      GV_BUKRS                TYPE BUKRS,
*      GV_PRCTR                TYPE PRCTR,
      GV_PRODH                TYPE MVKE-PRODH,
      GV_MESSAGE(100)         TYPE C.


************************************************************************
* OBJECTS                                                              *
************************************************************************
DATA:
  MY_CONTAINER TYPE REF TO CL_GUI_DOCKING_CONTAINER,
  MY_ALV       TYPE REF TO CL_GUI_ALV_GRID.

************************************************************************
* FIELD-SYMBOLS                                                        *
************************************************************************
FIELD-SYMBOLS:
  <FS_MARA>           LIKE LINE OF GT_MARA.

************************************************************************
* RANGES                                                               *
************************************************************************
RANGES:
  GR_PRDHA     FOR MARA-PRDHA,
  GR_BWART_REC FOR MSEG-BWART, " MovtTypes for receipts
  GR_BWART_ISS FOR MSEG-BWART, " MovtTypes for issues
  GR_BWART_ALL FOR MSEG-BWART. " MovtTypes iss + rec + select option

DATA:
  LS_BWART_RANGE     LIKE LINE OF GR_BWART_ALL,
  GS_BWART_RANGE_ISS LIKE LINE OF GR_BWART_ISS,
  GS_BWART_RANGE_REC LIKE LINE OF GR_BWART_REC.

************************************************************************
* WORK AREAS                                                           *
************************************************************************
 DATA :  WA_LAYOUT_BG    TYPE SLIS_LAYOUT_ALV.
