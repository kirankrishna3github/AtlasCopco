***INCLUDE RFKORI80 .


*-------Includes f¨¹r syntax-check---------------------------------------
*NCLUDE RFKORI00.

*=======================================================================
*       Includebaustein Formulardruck: Leseroutinen
*=======================================================================

*=======================================================================
*       Interne Perform-Routinen
*=======================================================================

*-----------------------------------------------------------------------
*       FORM BVORG_BKPF
*-----------------------------------------------------------------------
FORM bvorg_bkpf.
* CLEAR   BVORG_BSEG.
* REFRESH BVORG_BSEG.

  LOOP AT hbvor.
    IF  hbvor-bukrs =  save2_bukrs
    AND hbvor-gjahr =  save2_gjahr
    AND hbvor-belnr =  save2_belnr.
    ELSE.
      save_bukrs = hbvor-bukrs.
      save_gjahr = hbvor-gjahr.
      save_belnr = hbvor-belnr.
      PERFORM read_bkpf.
      APPEND hbkpf.
    ENDIF.
  ENDLOOP.
ENDFORM.                    "BVORG_BKPF

*-----------------------------------------------------------------------
*       FORM BVORG_BSEG
*-----------------------------------------------------------------------
FORM bvorg_bseg.
* CLEAR   BVORG_BSEG.
* REFRESH BVORG_BSEG.

  LOOP AT hbvor.
    IF  hbvor-bukrs =  save2_bukrs
    AND hbvor-gjahr =  save2_gjahr
    AND hbvor-belnr =  save2_belnr.
    ELSE.
      save_bukrs = hbvor-bukrs.
      save_gjahr = hbvor-gjahr.
      save_belnr = hbvor-belnr.
      PERFORM read_bseg.
      LOOP AT hbseg.
**      PERFORM FILL_WAEHRUNGSFELDER_BSEG.
        MOVE-CORRESPONDING hbseg TO save_bseg.
        APPEND save_bseg.
*       IF HBSEG-BELNR = HBSEG-AUGBL.
*         IF HBSEG-KOART = 'D'.
*           SAVE_KUNNR = HBSEG-KUNNR.
*           SAVE_AUGBL = HBSEG-AUGBL.
*           SAVE_AUGDT = HBSEG-AUGDT.
**          PERFORM READ_BSAD_4.
*           PERFORM READ_BSAD.
*           PERFORM BVORG_BSAD.
**          MOVE HBSEG-BUKRS TO KUNNR_BSEG-BUKRS.
**          MOVE HBSEG-KUNNR TO KUNNR_BSEG-KUNNR.
**          MOVE RF140-ZLSHB TO KUNNR_BSEG-ZLSHB.
**          COLLECT KUNNR_BSEG.
*         ENDIF.
*         IF HBSEG-KOART = 'K'.
*           SAVE_LIFNR = HBSEG-LIFNR.
*           SAVE_AUGBL = HBSEG-AUGBL.
*           SAVE_AUGDT = HBSEG-AUGDT.
**          PERFORM READ_BSAK_4.
*           PERFORM READ_BSAK.
*           PERFORM BVORG_BSAK.
**          MOVE HBSEG-BUKRS TO LIFNR_BSEG-BUKRS.
**          MOVE HBSEG-LIFNR TO LIFNR_BSEG-LIFNR.
**          MOVE RF140-ZLSHB TO LIFNR_BSEG-ZLSHB.
**          COLLECT LIFNR_BSEG.
*         ENDIF.
*       ENDIF.
      ENDLOOP.
    ENDIF.
  ENDLOOP.
ENDFORM.                    "BVORG_BSEG

*----------------------------------------------------------------------*
* FORM FIND_BUKRS_ADRESSE.
* Buchungskreisadressnummer und KZ intern Adr. lesen und sichern
*----------------------------------------------------------------------*
FORM find_bukrs_adresse.
*   SELECT SINGLE * FROM T001E
*     WHERE BUKRS = KNB1-BUKRS
*     AND   EVENT = 'BUKRS'
*     AND   ADRID = '     '.

  IF NOT t001-adrnr IS INITIAL.
*   SELECT SINGLE * FROM SADR
*     WHERE ADRNR = T001-ADRNR
*     AND   NATIO = ' '.               "mu# noch in t001
    selection-addrnumber = t001-adrnr.
    CALL FUNCTION 'ADDR_GET'
      EXPORTING
        address_selection = selection
        address_group     = 'CA01'
      IMPORTING
        address_value     = address_value
        sadr              = sadr
      EXCEPTIONS
        address_not_exist = 1
        OTHERS            = 2.                              "SADR40A

    IF sy-subrc NE 0.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '361'.
      fimsg-msgv1 = t001-adrnr.
      fimsg-msgv2 = t001-bukrs.
      PERFORM message_append.
    ENDIF.
  ELSE.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '360'.
    fimsg-msgv1 = t001-bukrs.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "FIND_BUKRS_ADRESSE

*-----------------------------------------------------------------------
*       FORM READ_BKORM
*-----------------------------------------------------------------------
FORM read_bkorm.
* SELECT * FROM BKORM
*   WHERE EVENT = SAVE_EVENT.
*   IF NOT BKORM-ERLDT IS INITIAL.
  IF  NOT xerdt IS INITIAL.
*       IF    BKORM-EVENT =  SAVE_EVENT
*       AND   BKORM-BUKRS IN HBUKRS
*       AND   BKORM-KOART IN HKOART
*       AND   BKORM-KONTO IN HKONTO
*       AND   BKORM-BELNR IN HBELNR
*       AND   BKORM-GJAHR IN HGJAHR
*       AND   BKORM-USNAM IN HUSNAM
*       AND   BKORM-DATUM IN HDATUM
*       AND   BKORM-UZEIT IN HUZEIT
*       AND   BKORM-ERLDT IN HERLDT.
**      AND   BKORM-USNAM IN HUSNAM
**      AND   BKORM-DATUM IN HDATUM
**      AND   BKORM-UZEIT IN HUZEIT.
    SELECT        * FROM  bkorm
           WHERE  event       =  save_event
           AND    bukrs       IN hbukrs
           AND    koart       IN hkoart
           AND    konto       IN hkonto
           AND    belnr       IN hbelnr
           AND    gjahr       IN hgjahr
           AND    usnam       IN husnam
           AND    datum       IN hdatum
           AND    uzeit       IN huzeit
           AND    erldt       IN herldt.

      IF NOT kautofl IS INITIAL.
        CHECK bkorm-param+79(1) NE space.
      ENDIF.
      PERFORM extract_felder_bkorm.
      IF sortid IS INITIAL.
        PERFORM debi_kred_daten.
        PERFORM sortierung USING 'K' 'K' ' '.
        PERFORM extract.
      ENDIF.
    ENDSELECT.
*       ENDIF.
*     ENDIF.
*   ELSE.
*     IF XERDT IS INITIAL.
  ELSE.
*       IF    BKORM-EVENT =  SAVE_EVENT
*       AND   BKORM-BUKRS IN HBUKRS
*       AND   BKORM-KOART IN HKOART
*       AND   BKORM-KONTO IN HKONTO
*       AND   BKORM-BELNR IN HBELNR
*       AND   BKORM-GJAHR IN HGJAHR
*       AND   BKORM-USNAM IN HUSNAM
*       AND   BKORM-DATUM IN HDATUM
*       AND   BKORM-UZEIT IN HUZEIT.
**      AND   BKORM-USNAM IN HUSNAM
**      AND   BKORM-DATUM IN HDATUM
**      AND   BKORM-UZEIT IN HUZEIT.
    SELECT        * FROM  bkorm
           WHERE  event       =  save_event
           AND    bukrs       IN hbukrs
           AND    koart       IN hkoart
           AND    konto       IN hkonto
           AND    belnr       IN hbelnr
           AND    gjahr       IN hgjahr
           AND    usnam       IN husnam
           AND    datum       IN hdatum
           AND    uzeit       IN huzeit
           AND    erldt       =  '00000000'.

      IF NOT kautofl IS INITIAL.
        CHECK bkorm-param+79(1) NE space.
      ENDIF.
      PERFORM extract_felder_bkorm.
      IF sortid IS INITIAL.
        PERFORM debi_kred_daten.
        PERFORM sortierung USING 'K' 'K' ' '.
        PERFORM extract.
      ENDIF.
*            endif.
    ENDSELECT.
*     ENDIF.
  ENDIF.
* ENDSELECT.
  CLEAR bkorm.
ENDFORM.                    "READ_BKORM

*-----------------------------------------------------------------------
*       FORM READ_BKDF
*-----------------------------------------------------------------------
FORM read_bkdf.
* CLEAR HBKDF.

  SELECT SINGLE * FROM bkdf
    WHERE bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr.

*   MOVE-CORRESPONDING BKdF TO HBKDF.
*   message erfolgt bei Aufrufer falls sy-subrc <> 0
ENDFORM.                    "READ_BKDF

*-----------------------------------------------------------------------
*       FORM READ_BKPF
*-----------------------------------------------------------------------
FORM read_bkpf.
  CLEAR hbkpf.

  SELECT SINGLE * FROM bkpf
    WHERE bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr.

  MOVE-CORRESPONDING bkpf TO hbkpf.
*   message erfolgt bei Aufrufer falls sy-subrc <> 0
ENDFORM.                    "READ_BKPF

*-----------------------------------------------------------------------
*       FORM READ_BKPF_2
*-----------------------------------------------------------------------
FORM read_bkpf_2.
  CLEAR hbkpf.

  SELECT SINGLE * FROM bkpf
    WHERE bukrs = save2_bukrs
    AND   belnr = save2_belnr
    AND   gjahr = save2_gjahr.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '547'.
    fimsg-msgv1 = save2_bukrs.
    fimsg-msgv2 = save2_belnr.
    fimsg-msgv3 = save2_gjahr.
    PERFORM message_append.
  ENDIF.
  MOVE-CORRESPONDING bkpf TO hbkpf.

ENDFORM.                    "READ_BKPF_2

*-----------------------------------------------------------------------
*       FORM READ_BNKA_2
*-----------------------------------------------------------------------
FORM read_bnka_2.
  save2_land1 = save_banks.
  PERFORM read_t005_2.
  IF t005-bnkey = '2'.
    save_bankl = save_bankn.
  ELSE.
    save_bankl = save_bankl.
  ENDIF.

  CALL FUNCTION 'READ_BANK_ADDRESS'
    EXPORTING
      bank_country = save_banks
      bank_number  = save_bankl
    IMPORTING
      bnka_wa      = *bnka
    EXCEPTIONS
      not_found    = 4.
  IF sy-subrc NE 0.
    CLEAR *bnka.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '571'.
    fimsg-msgv1 = save_banks.
    fimsg-msgv2 = save_bankl.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_BNKA_2

*-----------------------------------------------------------------------
*       FORM READ_BSAD
*-----------------------------------------------------------------------
*       f¨¹r Zahlungsmitteilungen und Wechselspesen
*-----------------------------------------------------------------------
FORM read_bsad.
  CLEAR   hbsad.
  REFRESH hbsad.
  SELECT * FROM bsad
    WHERE kunnr IN skunnr
    AND   bukrs =  save_bukrs
    AND   augdt =  save_augdt
    AND   augbl =  save_augbl.
*   AND   GJAHR =  SAVE_GJAHR.
*   AND   AUGDT IN HAUGDT.

    IF bsad-augbl NE bsad-belnr.
*     SAVE_SUBRC = SY-SUBRC.
*     LOOP AT HBSAD
*       WHERE BUKRS = BSAD-BUKRS
*       AND   KUNNR = BSAD-KUNNR
*       AND   UMSKS = BSAD-UMSKS
*       AND   UMSKZ = BSAD-UMSKZ
*       AND   AUGDT = BSAD-AUGDT
*       AND   AUGBL = BSAD-AUGBL
*       AND   ZUONR = BSAD-ZUONR
*       AND   GJAHR = BSAD-GJAHR
*       AND   BELNR = BSAD-BELNR
*       AND   BUZEI = BSAD-BUZEI.
*
*       EXIT.
*     ENDLOOP.

*     IF SY-SUBRC NE 0.
      MOVE-CORRESPONDING bsad TO hbsad.
      APPEND hbsad.
*       CLEAR SY-SUBRC.
*     ENDIF.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_BSAD

*-----------------------------------------------------------------------
*       FORM READ_BSAD_2
*-----------------------------------------------------------------------
*       f¨¹r Kontoauszug
*-----------------------------------------------------------------------
FORM read_bsad_2.
  IF ( NOT save_rxekvb IS INITIAL )
  OR ( NOT  knb1-knrze IS INITIAL
  AND NOT *knb1-xdezv IS INITIAL
  AND NOT save_rxdezv IS INITIAL
  AND     save_rxekvb IS INITIAL ).
  ELSE.
    CLEAR   hbsad.
    REFRESH hbsad.
  ENDIF.
  SELECT * FROM bsad
    WHERE bukrs IN ubukrs
    AND   kunnr = save_kunnr
*   AND   BUDAT LE DATUM02
    AND   augdt GE datum01
    AND   bschl IN hbschl
    AND   umskz IN humskz
    AND   (bsa_where).                 "Datum
*   CASE SAVE_RDATAR.
*     WHEN ' '.
*       CHECK BSAD-BUDAT LE DATUM02.
*     WHEN '1'.
*       CHECK BSAD-CPUDT LE DATUM02.
*     WHEN '2'.
*       CHECK BSAD-BLDAT LE DATUM02.
*   ENDCASE.
    IF NOT bsad-bstat IS INITIAL.
      IF bsad-bstat = 'S'.
        IF NOT save_statbl IS INITIAL.
          MOVE-CORRESPONDING bsad TO hbsad.
          IF NOT bsad-filkd IS INITIAL.
            xzent = 'X'.
          ENDIF.
          IF  NOT save_rxdezv IS INITIAL
          AND NOT knb1-xdezv  IS INITIAL
          AND NOT bsad-filkd  IS INITIAL.
          ELSE.
            IF  NOT  knb1-knrze IS INITIAL
            AND NOT *knb1-xdezv IS INITIAL
            AND NOT save_rxdezv IS INITIAL
            AND     save_rxekvb IS INITIAL
            AND     save_kunnr  =  knb1-knrze.
              CHECK save2_kunnr = bsad-filkd.
            ENDIF.
            APPEND hbsad.
          ENDIF.
        ENDIF.
      ENDIF.
    ELSE.
      MOVE-CORRESPONDING bsad TO hbsad.
      IF NOT bsad-filkd IS INITIAL.
        xzent = 'X'.
      ENDIF.
      IF  NOT save_rxdezv IS INITIAL
      AND NOT knb1-xdezv  IS INITIAL
      AND NOT bsad-filkd  IS INITIAL.
      ELSE.
        IF  NOT  knb1-knrze IS INITIAL
        AND NOT *knb1-xdezv IS INITIAL
        AND NOT save_rxdezv IS INITIAL
        AND     save_rxekvb IS INITIAL
        AND     save_kunnr  =  knb1-knrze.
          CHECK save2_kunnr = bsad-filkd.
        ENDIF.
        APPEND hbsad.
      ENDIF.

    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_BSAD_2

*-----------------------------------------------------------------------
*       FORM READ_BSAK
*-----------------------------------------------------------------------
*       f¨¹r Zahlungsmitteilungen und Wechselspesen
*-----------------------------------------------------------------------
FORM read_bsak.
  CLEAR   hbsak.
  REFRESH hbsak.
  SELECT * FROM bsak
    WHERE lifnr IN slifnr
    AND   bukrs =  save_bukrs
    AND   augdt =  save_augdt
    AND   augbl =  save_augbl.
*   AND   GJAHR =  SAVE_GJAHR.
*   AND   AUGDT IN HAUGDT.

    IF bsak-augbl NE bsak-belnr.
*     SAVE_SUBRC = SY-SUBRC.
*     LOOP AT HBSAK
*       WHERE BUKRS = BSAK-BUKRS
*       AND   LIFNR = BSAK-LIFNR
*       AND   UMSKS = BSAK-UMSKS
*       AND   UMSKZ = BSAK-UMSKZ
*       AND   AUGDT = BSAK-AUGDT
*       AND   AUGBL = BSAK-AUGBL
*       AND   ZUONR = BSAK-ZUONR
*       AND   GJAHR = BSAK-GJAHR
*       AND   BELNR = BSAK-BELNR
*       AND   BUZEI = BSAK-BUZEI.
*
*       EXIT.
*     ENDLOOP.

*     IF SY-SUBRC NE 0.
      MOVE-CORRESPONDING bsak TO hbsak.
      APPEND hbsak.
*       CLEAR SY-SUBRC.
*     ENDIF.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_BSAK

*-----------------------------------------------------------------------
*       FORM READ_BSAK_2
*-----------------------------------------------------------------------
*       f¨¹r Kontoauszug
*-----------------------------------------------------------------------
FORM read_bsak_2.
  IF  NOT  lfb1-lnrze IS INITIAL
  AND NOT *lfb1-xdezv IS INITIAL
  AND NOT save_rxdezv IS INITIAL.
  ELSE.
    CLEAR   hbsak.
    REFRESH hbsak.
  ENDIF.
  SELECT * FROM bsak
    WHERE bukrs IN ubukrs
    AND   lifnr = save_lifnr
*   AND   BUDAT LE DATUM02
    AND   augdt GE datum01
    AND   bschl IN hbschl
    AND   umskz IN humskz
    AND   (bsa_where).                 "Datum
*   CASE SAVE_RDATAR.
*     WHEN ' '.
*       CHECK BSAK-BUDAT LE DATUM02.
*     WHEN '1'.
*       CHECK BSAK-CPUDT LE DATUM02.
*     WHEN '2'.
*       CHECK BSAK-BLDAT LE DATUM02.
*   ENDCASE.
    IF NOT bsak-bstat IS INITIAL.
      IF bsak-bstat = 'S'.
        IF NOT save_statbl IS INITIAL.
          IF NOT bsak-filkd IS INITIAL.
            xzent = 'X'.
          ENDIF.
          IF xverr IS INITIAL.
            MOVE-CORRESPONDING bsak TO hbsak.
            IF  NOT save_rxdezv IS INITIAL
            AND NOT lfb1-xdezv  IS INITIAL
            AND NOT bsak-filkd  IS INITIAL.
            ELSE.
              IF  NOT  lfb1-lnrze IS INITIAL
              AND NOT *lfb1-xdezv IS INITIAL
              AND NOT save_rxdezv IS INITIAL
              AND     save_rxekvb IS INITIAL
              AND     save_lifnr  =  lfb1-lnrze.
                CHECK save2_lifnr = bsak-filkd.
              ENDIF.
              APPEND hbsak.
            ENDIF.
          ELSE.
            MOVE-CORRESPONDING bsak TO hbsad.
            IF  NOT save_rxdezv IS INITIAL
            AND NOT lfb1-xdezv  IS INITIAL
            AND NOT bsak-filkd  IS INITIAL.
            ELSE.
              IF  NOT  lfb1-lnrze IS INITIAL
              AND NOT *lfb1-xdezv IS INITIAL
              AND NOT save_rxdezv IS INITIAL
              AND     save_rxekvb IS INITIAL
              AND     save_lifnr  =  lfb1-lnrze.
                CHECK save2_lifnr = bsak-filkd.
              ENDIF.
              APPEND hbsad.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
    ELSE.
      IF NOT bsak-filkd IS INITIAL.
        xzent = 'X'.
      ENDIF.
      IF xverr IS INITIAL.
        MOVE-CORRESPONDING bsak TO hbsak.
        IF  NOT save_rxdezv IS INITIAL
        AND NOT lfb1-xdezv  IS INITIAL
        AND NOT bsak-filkd  IS INITIAL.
        ELSE.
          IF  NOT  lfb1-lnrze IS INITIAL
          AND NOT *lfb1-xdezv IS INITIAL
          AND NOT save_rxdezv IS INITIAL
          AND     save_rxekvb IS INITIAL
          AND     save_lifnr  =  lfb1-lnrze.
            CHECK save2_lifnr = bsak-filkd.
          ENDIF.
          APPEND hbsak.
        ENDIF.
      ELSE.
        MOVE-CORRESPONDING bsak TO hbsad.
        IF  NOT save_rxdezv IS INITIAL
        AND NOT lfb1-xdezv  IS INITIAL
        AND NOT bsak-filkd  IS INITIAL.
        ELSE.
          IF  NOT  lfb1-lnrze IS INITIAL
          AND NOT *lfb1-xdezv IS INITIAL
          AND NOT save_rxdezv IS INITIAL
          AND     save_rxekvb IS INITIAL
          AND     save_lifnr  =  lfb1-lnrze.
            CHECK save2_lifnr = bsak-filkd.
          ENDIF.
          APPEND hbsad.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_BSAK_2

*-----------------------------------------------------------------------
*       FORM READ_BSEC
*-----------------------------------------------------------------------
FORM read_bsec.
  CLEAR bsec.
  SELECT SINGLE * FROM bsec
    WHERE bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr
    AND   buzei = save_buzei.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '572'.
    fimsg-msgv1 = save_bukrs.
    fimsg-msgv2 = save_belnr.
    fimsg-msgv3 = save_gjahr.
    fimsg-msgv4 = save_buzei.
    PERFORM message_append.
  ELSE.
*------- Alte Verschl¨¹sselung vor 3.0E ? -> Neu verschl¨¹sseln ----------
    IF bsec-empfg+5(1) = '0'.
      MOVE-CORRESPONDING bsec TO cpdvs.
      CALL FUNCTION 'FI_ONETIMEACNT_RECEIVER_DECODE'
        EXPORTING
          i_cpdvs = cpdvs
        IMPORTING
          e_empfg = bsec-empfg.
    ENDIF.
  ENDIF.
ENDFORM.                    "READ_BSEC

*-----------------------------------------------------------------------
*       FORM READ_VBSEC
*-----------------------------------------------------------------------
FORM read_vbsec.
  CLEAR bsec.
  LOOP AT hvbsec
    WHERE ausbk = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr
    AND   buzei = save_buzei.
    EXIT.
  ENDLOOP.

  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '572'.
    fimsg-msgv1 = save_bukrs.
    fimsg-msgv2 = save_belnr.
    fimsg-msgv3 = save_gjahr.
    fimsg-msgv4 = save_buzei.
    PERFORM message_append.
  ELSE.
    MOVE-CORRESPONDING hvbsec TO bsec.
    MOVE hvbsec-ausbk TO bsec-bukrs.                        "N978890
*------- Alte Verschl¨¹sselung vor 3.0E ? -> Neu verschl¨¹sseln ----------
    IF bsec-empfg+5(1) = '0'.
      MOVE-CORRESPONDING bsec TO cpdvs.
      CALL FUNCTION 'FI_ONETIMEACNT_RECEIVER_DECODE'
        EXPORTING
          i_cpdvs = cpdvs
        IMPORTING
          e_empfg = bsec-empfg.
    ENDIF.
  ENDIF.
ENDFORM.                    "READ_VBSEC

*-----------------------------------------------------------------------
*       FORM READ_BSED
*-----------------------------------------------------------------------
FORM read_bsed.
  CLEAR bsed.
  CLEAR save_subrc.
  SELECT SINGLE * FROM bsed
    WHERE bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr
    AND   buzei = save_buzei.
  save_subrc  = sy-subrc.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '573'.
    fimsg-msgv1 = save_bukrs.
    fimsg-msgv2 = save_belnr.
    fimsg-msgv3 = save_gjahr.
    fimsg-msgv3 = save_buzei.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_BSED

*-----------------------------------------------------------------------
*       FORM READ_BSEG
*-----------------------------------------------------------------------
FORM read_bseg.
  CLEAR   hbseg.
  REFRESH hbseg.

  SELECT  * FROM bseg
    WHERE bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr.

    MOVE-CORRESPONDING bseg TO hbseg.
    APPEND hbseg.
  ENDSELECT.
* message bei Aufrufer
ENDFORM.                    "READ_BSEG

*-----------------------------------------------------------------------
*       FORM READ_VBSEG
*-----------------------------------------------------------------------
FORM read_vbseg.
  CLEAR   hbseg.
  REFRESH hbseg.

  LOOP AT hvbseg.
    MOVE-CORRESPONDING hvbseg TO hbseg.
    MOVE hvbseg-ps_psp_pnr TO hbseg-projk.
    APPEND hbseg.
  ENDLOOP.
ENDFORM.                    "READ_VBSEG

*-----------------------------------------------------------------------
*       FORM READ_BSEG_2
*-----------------------------------------------------------------------
FORM read_bseg_2.

  SELECT SINGLE * FROM bseg
    WHERE bukrs = save2_bukrs
    AND   belnr = save2_belnr
    AND   gjahr = save2_gjahr
    AND   buzei = save2_buzei.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '566'.
    fimsg-msgv1 = save2_bukrs.
    fimsg-msgv2 = save2_belnr.
    fimsg-msgv3 = save2_gjahr.
    fimsg-msgv4 = save2_buzei.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_BSEG_2

*-----------------------------------------------------------------------
*       FORM READ_BSEG_ARC
*-----------------------------------------------------------------------
FORM read_bseg_arc.
  CLEAR   xbseg.
  REFRESH xbseg.
  CLEAR   habkpf.
  REFRESH habkpf.
  farc_xread-xbseg = 'X'.

  DATA: hrfcu_fidoc LIKE rfcu_fidoc.
  hrfcu_fidoc-srchstrats = '1'.
  DATA: hcust       LIKE  datatype-boolean.
  CALL FUNCTION 'FI_DOCUMENT_ARCH_READ_SINGLE'
       EXPORTING
            i_bukrs                     = save2_bukrs
            i_belnr                     = save2_belnr
            i_gjahr                     = save2_gjahr
*           BLART                       = '*'
            i_group_xread               = farc_xread
       TABLES
            c_abkpf                     = habkpf
            c_bseg                      = xbseg
       CHANGING
            c_xreadcustomizing         = hcust
            c_readarchparms            = hrfcu_fidoc
       EXCEPTIONS
            document_not_found          = 1
            document_not_in_arch_or_idx = 2
            document_misorder           = 3
            archive_failure             = 4
            user_not_authorized         = 5
            user_aborted_access         = 6
            OTHERS                      = 7.
  IF sy-subrc = 0.
    LOOP AT xbseg
      WHERE bukrs = save2_bukrs
      AND   belnr = save2_belnr
      AND   gjahr = save2_gjahr
      AND   buzei = save2_buzei.
      bseg = xbseg.
      EXIT.
    ENDLOOP.
  ELSE.
    CLEAR bseg.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '566'.
    fimsg-msgv1 = save2_bukrs.
    fimsg-msgv2 = save2_belnr.
    fimsg-msgv3 = save2_gjahr.
    fimsg-msgv4 = save2_buzei.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_BSEG_ARC

*-----------------------------------------------------------------------
*       FORM READ_BSET
*-----------------------------------------------------------------------
FORM read_bset.
  CLEAR   bset.
  CLEAR   hbset.
  REFRESH hbset.
  SELECT * FROM bset
    WHERE bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr.
*   AND   TXGRP = SAVE_TXGRP.

    MOVE-CORRESPONDING bset TO hbset.
    APPEND hbset.
  ENDSELECT.
ENDFORM.                    "READ_BSET

*-----------------------------------------------------------------------
*       FORM READ_VBSET
*-----------------------------------------------------------------------
FORM read_vbset.
  CLEAR   hbset.
  REFRESH hbset.
  LOOP AT hvbset.
    MOVE-CORRESPONDING hvbset TO hbset.
    APPEND hbset.
  ENDLOOP.
ENDFORM.                    "READ_VBSET

*-----------------------------------------------------------------------
*       FORM READ_BSID
*-----------------------------------------------------------------------
*       f¨¹r Kontoauszug
*-----------------------------------------------------------------------
FORM read_bsid.
  IF ( NOT save_rxekvb IS INITIAL )
  OR ( NOT  knb1-knrze IS INITIAL
  AND NOT *knb1-xdezv IS INITIAL
  AND NOT save_rxdezv IS INITIAL
  AND     save_rxekvb IS INITIAL ).
  ELSE.
    CLEAR   hbsid.
    REFRESH hbsid.
  ENDIF.
  SELECT * FROM bsid
    WHERE bukrs IN ubukrs
    AND   kunnr =  save_kunnr
*   AND   BUDAT LE DATUM02
    AND   bschl IN hbschl
    AND   umskz IN humskz
    AND   (bsi_where).
*   CASE SAVE_RDATAR.
*     WHEN ' '.
*       CHECK BSID-BUDAT LE DATUM02.
*     WHEN '1'.
*       CHECK BSID-CPUDT LE DATUM02.
*     WHEN '2'.
*       CHECK BSID-BLDAT LE DATUM02.
*   ENDCASE.
    IF NOT bsid-bstat IS INITIAL.
      IF bsid-bstat = 'S'.
        IF NOT save_statbl IS INITIAL.
          MOVE-CORRESPONDING bsid TO hbsid.
          IF NOT bsid-filkd IS INITIAL.
            xzent = 'X'.
          ENDIF.
          IF  NOT save_rxdezv IS INITIAL
          AND NOT knb1-xdezv  IS INITIAL
          AND NOT bsid-filkd  IS INITIAL.
          ELSE.
            IF  NOT  knb1-knrze IS INITIAL
            AND NOT *knb1-xdezv IS INITIAL
            AND NOT save_rxdezv IS INITIAL
            AND     save_rxekvb IS INITIAL
            AND     save_kunnr  =  knb1-knrze.
              CHECK save2_kunnr = bsid-filkd.
            ENDIF.
            APPEND hbsid.
          ENDIF.
        ENDIF.
      ENDIF.
    ELSE.
      MOVE-CORRESPONDING bsid TO hbsid.
      IF NOT bsid-filkd IS INITIAL.
        xzent = 'X'.
      ENDIF.
      IF  NOT save_rxdezv IS INITIAL
      AND NOT knb1-xdezv  IS INITIAL
      AND NOT bsid-filkd  IS INITIAL.
      ELSE.
        IF  NOT  knb1-knrze IS INITIAL
        AND NOT *knb1-xdezv IS INITIAL
        AND NOT save_rxdezv IS INITIAL
        AND     save_rxekvb IS INITIAL
        AND     save_kunnr  =  knb1-knrze.
          CHECK save2_kunnr = bsid-filkd.
        ENDIF.
        APPEND hbsid.
      ENDIF.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_BSID

*-----------------------------------------------------------------------
*       FORM READ_VBSID
*-----------------------------------------------------------------------
*       f¨¹r Kontoauszug
*-----------------------------------------------------------------------
FORM read_vbsid.
* IF SAVE_RXEKVB IS INITIAL.
*   CLEAR   HBSID.
*   REFRESH HBSID.
* ENDIF.
  SELECT * FROM v_vbsegd
    WHERE ausbk IN ubukrs
    AND   kunnr =  save_kunnr
*   AND   BUDAT LE DATUM02
    AND   bschl IN hbschl
    AND   umskz IN humskz
    AND   (bsi_where).
    CLEAR bsid.
    MOVE-CORRESPONDING v_vbsegd TO bsid.
    bsid-pswsl = v_vbsegd-waers.
    bsid-pswbt = v_vbsegd-wrbtr.
    MOVE-CORRESPONDING bsid TO hbsid.
    IF NOT bsid-filkd IS INITIAL.
      xzent = 'X'.
    ENDIF.
    IF  NOT save_rxdezv IS INITIAL
    AND NOT knb1-xdezv  IS INITIAL
    AND NOT bsid-filkd  IS INITIAL.
    ELSE.
      IF  NOT  knb1-knrze IS INITIAL
      AND NOT *knb1-xdezv IS INITIAL
      AND NOT save_rxdezv IS INITIAL
      AND     save_rxekvb IS INITIAL
      AND     save_kunnr  =  knb1-knrze.
        CHECK save2_kunnr = bsid-filkd.
      ENDIF.
      APPEND hbsid.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_VBSID

*-----------------------------------------------------------------------
*       FORM READ_BSIK
*-----------------------------------------------------------------------
*       f¨¹r Kontoauszug
*-----------------------------------------------------------------------
FORM read_bsik.
  IF  NOT  lfb1-lnrze IS INITIAL
  AND NOT *lfb1-xdezv IS INITIAL
  AND NOT save_rxdezv IS INITIAL.
  ELSE.
    CLEAR   hbsik.
    REFRESH hbsik.
  ENDIF.
  SELECT * FROM bsik
    WHERE bukrs IN ubukrs
    AND   lifnr =  save_lifnr
*   AND   BUDAT LE DATUM02
    AND   bschl IN hbschl
    AND   umskz IN humskz
    AND   (bsi_where).
*   CASE SAVE_RDATAR.
*     WHEN ' '.
*       CHECK BSIK-BUDAT LE DATUM02.
*     WHEN '1'.
*       CHECK BSIK-CPUDT LE DATUM02.
*     WHEN '2'.
*       CHECK BSIK-BLDAT LE DATUM02.
*   ENDCASE.
    IF NOT bsik-bstat IS INITIAL.
      IF bsik-bstat = 'S'.
        IF NOT save_statbl IS INITIAL.
          IF NOT bsik-filkd IS INITIAL.
            xzent = 'X'.
          ENDIF.
          IF xverr IS INITIAL.
            MOVE-CORRESPONDING bsik TO hbsik.
            IF  NOT save_rxdezv IS INITIAL
            AND NOT lfb1-xdezv  IS INITIAL
            AND NOT bsik-filkd  IS INITIAL.
            ELSE.
              IF  NOT  lfb1-lnrze IS INITIAL
              AND NOT *lfb1-xdezv IS INITIAL
              AND NOT save_rxdezv IS INITIAL
              AND     save_rxekvb IS INITIAL
              AND     save_lifnr  =  lfb1-lnrze.
                CHECK save2_lifnr = bsik-filkd.
              ENDIF.
              APPEND hbsik.
            ENDIF.
          ELSE.
            MOVE-CORRESPONDING bsik TO hbsid.
            IF  NOT save_rxdezv IS INITIAL
            AND NOT lfb1-xdezv  IS INITIAL
            AND NOT bsik-filkd  IS INITIAL.
            ELSE.
              IF  NOT  lfb1-lnrze IS INITIAL
              AND NOT *lfb1-xdezv IS INITIAL
              AND NOT save_rxdezv IS INITIAL
              AND     save_rxekvb IS INITIAL
              AND     save_lifnr  =  lfb1-lnrze.
                CHECK save2_lifnr = bsik-filkd.
              ENDIF.
              APPEND hbsid.
            ENDIF.
          ENDIF.
        ENDIF.
      ENDIF.
    ELSE.
      IF NOT bsik-filkd IS INITIAL.
        xzent = 'X'.
      ENDIF.
      IF xverr IS INITIAL.
        MOVE-CORRESPONDING bsik TO hbsik.
        IF  NOT save_rxdezv IS INITIAL
        AND NOT lfb1-xdezv  IS INITIAL
        AND NOT bsik-filkd  IS INITIAL.
        ELSE.
          IF  NOT  lfb1-lnrze IS INITIAL
          AND NOT *lfb1-xdezv IS INITIAL
          AND NOT save_rxdezv IS INITIAL
          AND     save_rxekvb IS INITIAL
          AND     save_lifnr  =  lfb1-lnrze.
            CHECK save2_lifnr = bsik-filkd.
          ENDIF.
          APPEND hbsik.
        ENDIF.
      ELSE.
        MOVE-CORRESPONDING bsik TO hbsid.
        IF  NOT save_rxdezv IS INITIAL
        AND NOT lfb1-xdezv  IS INITIAL
        AND NOT bsik-filkd  IS INITIAL.
        ELSE.
          IF  NOT  lfb1-lnrze IS INITIAL
          AND NOT *lfb1-xdezv IS INITIAL
          AND NOT save_rxdezv IS INITIAL
          AND     save_rxekvb IS INITIAL
          AND     save_lifnr  =  lfb1-lnrze.
            CHECK save2_lifnr = bsik-filkd.
          ENDIF.
          APPEND hbsid.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_BSIK

*-----------------------------------------------------------------------
*       FORM READ_VBSIK
*-----------------------------------------------------------------------
*       f¨¹r Kontoauszug
*-----------------------------------------------------------------------
FORM read_vbsik.
* IF SAVE_RXEKVB IS INITIAL.
*   CLEAR   HBSIK.
*   REFRESH HBSIK.
* ENDIF.
  SELECT * FROM v_vbsegk
    WHERE ausbk IN ubukrs
    AND   lifnr =  save_lifnr
*   AND   BUDAT LE DATUM02
    AND   bschl IN hbschl
    AND   umskz IN humskz
    AND   (bsi_where).
    CLEAR bsik.
    MOVE-CORRESPONDING v_vbsegk TO bsik.
    bsik-pswsl = v_vbsegk-waers.
    bsik-pswbt = v_vbsegk-wrbtr.
    IF NOT bsik-filkd IS INITIAL.
      xzent = 'X'.
    ENDIF.
    IF xverr IS INITIAL.
      MOVE-CORRESPONDING bsik TO hbsik.
      IF  NOT save_rxdezv IS INITIAL
      AND NOT lfb1-xdezv  IS INITIAL
      AND NOT bsik-filkd  IS INITIAL.
      ELSE.
        IF  NOT  lfb1-lnrze IS INITIAL
        AND NOT *lfb1-xdezv IS INITIAL
        AND NOT save_rxdezv IS INITIAL
        AND     save_rxekvb IS INITIAL
        AND     save_lifnr  =  lfb1-lnrze.
          CHECK save2_lifnr = bsik-filkd.
        ENDIF.
        APPEND hbsik.
      ENDIF.
    ELSE.
      MOVE-CORRESPONDING bsik TO hbsid.
      IF  NOT save_rxdezv IS INITIAL
      AND NOT lfb1-xdezv  IS INITIAL
      AND NOT bsik-filkd  IS INITIAL.
      ELSE.
        IF  NOT  lfb1-lnrze IS INITIAL
        AND NOT *lfb1-xdezv IS INITIAL
        AND NOT save_rxdezv IS INITIAL
        AND     save_rxekvb IS INITIAL
        AND     save_lifnr  =  lfb1-lnrze.
          CHECK save2_lifnr = bsik-filkd.
        ENDIF.
        APPEND hbsid.
      ENDIF.
    ENDIF.
  ENDSELECT.
ENDFORM.                    "READ_VBSIK

*-----------------------------------------------------------------------
*       FORM READ_BVOR
*-----------------------------------------------------------------------
FORM read_bvor.
  CLEAR   hbvor.
  REFRESH hbvor.

  SELECT * FROM bvor
    WHERE bvorg = save_bvorg.
    MOVE-CORRESPONDING bvor TO hbvor.
    APPEND hbvor.
  ENDSELECT.
ENDFORM.                    "READ_BVOR

*-----------------------------------------------------------------------
*       FORM READ_DD07L_DD07T
*-----------------------------------------------------------------------
*ORM READ_DD07L_DD07T.
* REFRESH HDD07T.
*
* SELECT * FROM DD07L
*   WHERE DOMNAME  = SAVE_DOMNAME
*   AND   AS4LOCAL = 'A'.
*
* SELECT * FROM DD07T
*   WHERE DDLANGUAGE = LANGUAGE
*   AND   DOMNAME    = SAVE_DOMNAME
*   AND   VALPOS     = DD07L-VALPOS
*   AND   AS4LOCAL   = 'A'.
*   CLEAR HDD07T.
*   MOVE-CORRESPONDING DD07L TO HDD07T.
*   MOVE-CORRESPONDING DD07T TO HDD07T.
*   APPEND HDD07T.
* ENDSELECT.
* IF SY-SUBRC NE 0.
*   CASE FLSPRAS.
*     WHEN ' '.
*         IF LANGUAGE NE SY-LANGU.
*           SELECT * FROM DD07T
*             WHERE DDLANGUAGE = SY-LANGU
*             AND   DOMNAME    = SAVE_DOMNAME
*             AND   VALPOS     = DD07L-VALPOS
*             AND   AS4LOCAL   = 'A'.
*             CLEAR HDD07T.
*             MOVE-CORRESPONDING DD07L TO HDD07T.
*             MOVE-CORRESPONDING DD07T TO HDD07T.
*             APPEND HDD07T.
*           ENDSELECT.
*           IF SY-SUBRC NE 0.
*             IF LANGUAGE NE 'D'.
*               SELECT * FROM DD07T
*                 WHERE DDLANGUAGE = 'D'
*                 AND   DOMNAME    = SAVE_DOMNAME
*                 AND   VALPOS     = DD07L-VALPOS
*                 AND   AS4LOCAL   = 'A'.
*                 CLEAR HDD07T.
*                 MOVE-CORRESPONDING DD07L TO HDD07T.
*                 MOVE-CORRESPONDING DD07T TO HDD07T.
*                 APPEND HDD07T.
*               ENDSELECT.
*               IF SY-SUBRC NE 0.
*                 LANGUAGE2 = '$'.
**                PERFORM MESSAGE_DD07T.
*               ELSE.
*                 LANGUAGE2 = 'D'.
**                PERFORM MESSAGE_DD07T.
*               ENDIF.
*             ELSE.
*               LANGUAGE2 = '$'.
**              PERFORM MESSAGE_DD07T.
*             ENDIF.
*           ELSE.
*             LANGUAGE2 = SY-LANGU.
**            PERFORM MESSAGE_DD07T.
*           ENDIF.
*         ELSE.
*           IF LANGUAGE NE 'D'.
*             SELECT * FROM DD07T
*               WHERE DDLANGUAGE = 'D'
*               AND   DOMNAME    = SAVE_DOMNAME
*               AND   VALPOS     = DD07L-VALPOS
*               AND   AS4LOCAL   = 'A'.
*               CLEAR HDD07T.
*               MOVE-CORRESPONDING DD07L TO HDD07T.
*               MOVE-CORRESPONDING DD07T TO HDD07T.
*               APPEND HDD07T.
*             ENDSELECT.
*             IF SY-SUBRC NE 0.
*               LANGUAGE2 = '$'.
**              PERFORM MESSAGE_DD07T.
*             ELSE.
*               LANGUAGE2 = 'D'.
**              PERFORM MESSAGE_DD07T.
*             ENDIF.
*           ELSE.
*             LANGUAGE2 = '$'.
**            PERFORM MESSAGE_DD07T.
*           ENDIF.
*         ENDIF.
*     WHEN OTHERS.
**      message
*   ENDCASE.
* ENDIF.
* ENDSELECT.
* IF SY-SUBRC NE 0.                                   "DD07L
**  message
* ENDIF.
*NDFORM.

*-----------------------------------------------------------------------
*       FORM READ_DOMVALUETEXT
*-----------------------------------------------------------------------
FORM read_domvaluetext.
  CLEAR save_ddtext.
  CLEAR save2_spras.

  CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
    EXPORTING
      domname        = save_domname
      domvalue       = save_domvalue
      spras          = language
    IMPORTING
      ddtext         = save_ddtext
    EXCEPTIONS
      text_not_found = 01.
*             VALUE_NOT_FOUND = 02.

  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
            EXPORTING
              domname        = save_domname
              domvalue       = save_domvalue
              spras          = sy-langu
            IMPORTING
              ddtext         = save_ddtext
            EXCEPTIONS
              text_not_found = 01.
*                       VALUE_NOT_FOUND = 02.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
                EXPORTING
                  domname        = save_domname
                  domvalue       = save_domvalue
                  spras          = 'D'
                IMPORTING
                  ddtext         = save_ddtext
                EXCEPTIONS
                  text_not_found = 01.
*                             VALUE_NOT_FOUND = 02.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '836'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '837'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '836'.
              fimsg-msgv1 = save_domname.
              fimsg-msgv2 = save_domvalue.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '837'.
            fimsg-msgv1 = save_domname.
            fimsg-msgv2 = save_domvalue.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
              EXPORTING
                domname        = save_domname
                domvalue       = save_domvalue
                spras          = 'D'
              IMPORTING
                ddtext         = save_ddtext
              EXCEPTIONS
                text_not_found = 01.
*                             VALUE_NOT_FOUND = 02.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '836'.
              fimsg-msgv1 = save_domname.
              fimsg-msgv2 = save_domvalue.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '837'.
              fimsg-msgv1 = save_domname.
              fimsg-msgv2 = save_domvalue.
              fimsg-msgv3 = language.
              fimsg-msgv4 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '836'.
            fimsg-msgv1 = save_domname.
            fimsg-msgv2 = save_domvalue.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN 'X'.
        save2_spras = save_langu.
*         IF SAVE_KOART = 'D'.
*           SAVE2_SPRAS = KNA1-SPRAS.
*         ELSE.
*           SAVE2_SPRAS = LFA1-SPRAS.
*         ENDIF.
        IF language NE save2_spras.
          CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
            EXPORTING
              domname        = save_domname
              domvalue       = save_domvalue
              spras          = save2_spras
            IMPORTING
              ddtext         = save_ddtext
            EXCEPTIONS
              text_not_found = 01.
*                     VALUE_NOT_FOUND = 02.
          IF sy-subrc NE 0.
            IF language NE sy-langu.
              CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
                EXPORTING
                  domname        = save_domname
                  domvalue       = save_domvalue
                  spras          = sy-langu
                IMPORTING
                  ddtext         = save_ddtext
                EXCEPTIONS
                  text_not_found = 01.
*                           VALUE_NOT_FOUND = 02.
              IF sy-subrc NE 0.
                IF language NE 'D'.
                  CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
                    EXPORTING
                      domname        = save_domname
                      domvalue       = save_domvalue
                      spras          = 'D'
                    IMPORTING
                      ddtext         = save_ddtext
                    EXCEPTIONS
                      text_not_found = 01.
*                                 VALUE_NOT_FOUND = 02.
                  IF sy-subrc NE 0.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '836'.
                    fimsg-msgv1 = save_domname.
                    fimsg-msgv2 = save_domvalue.
                    PERFORM message_append.
                  ELSE.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '837'.
                    fimsg-msgv1 = save_domname.
                    fimsg-msgv2 = save_domvalue.
                    fimsg-msgv3 = language.
                    fimsg-msgv4 = 'D'.
                    PERFORM message_append.
                  ENDIF.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '836'.
                  fimsg-msgv1 = save_domname.
                  fimsg-msgv2 = save_domvalue.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '837'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                fimsg-msgv3 = language.
                fimsg-msgv4 = sy-langu.
                PERFORM message_append.
              ENDIF.
            ELSE.
              IF language NE 'D'.
                CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
                  EXPORTING
                    domname        = save_domname
                    domvalue       = save_domvalue
                    spras          = 'D'
                  IMPORTING
                    ddtext         = save_ddtext
                  EXCEPTIONS
                    text_not_found = 01.
*                             VALUE_NOT_FOUND = 02.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '836'.
                  fimsg-msgv1 = save_domname.
                  fimsg-msgv2 = save_domvalue.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '837'.
                  fimsg-msgv1 = save_domname.
                  fimsg-msgv2 = save_domvalue.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '836'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                PERFORM message_append.
              ENDIF.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '837'.
            fimsg-msgv1 = save_domname.
            fimsg-msgv2 = save_domvalue.
            fimsg-msgv3 = language.
            fimsg-msgv4 = save2_spras.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE sy-langu.
            CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
              EXPORTING
                domname        = save_domname
                domvalue       = save_domvalue
                spras          = sy-langu
              IMPORTING
                ddtext         = save_ddtext
              EXCEPTIONS
                text_not_found = 01.
*                       VALUE_NOT_FOUND = 02.
            IF sy-subrc NE 0.
              IF language NE 'D'.
                CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
                  EXPORTING
                    domname        = save_domname
                    domvalue       = save_domvalue
                    spras          = 'D'
                  IMPORTING
                    ddtext         = save_ddtext
                  EXCEPTIONS
                    text_not_found = 01.
*                             VALUE_NOT_FOUND = 02.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '836'.
                  fimsg-msgv1 = save_domname.
                  fimsg-msgv2 = save_domvalue.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '837'.
                  fimsg-msgv1 = save_domname.
                  fimsg-msgv2 = save_domvalue.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '836'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '837'.
              fimsg-msgv1 = save_domname.
              fimsg-msgv2 = save_domvalue.
              fimsg-msgv3 = language.
              fimsg-msgv4 = sy-langu.
              PERFORM message_append.
            ENDIF.
          ELSE.
            IF language NE 'D'.
              CALL FUNCTION 'FI_CUST_READ_DOMVALUETEXT'
                EXPORTING
                  domname        = save_domname
                  domvalue       = save_domvalue
                  spras          = 'D'
                IMPORTING
                  ddtext         = save_ddtext
                EXCEPTIONS
                  text_not_found = 01.
*                         VALUE_NOT_FOUND = 02.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '836'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '837'.
                fimsg-msgv1 = save_domname.
                fimsg-msgv2 = save_domvalue.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '836'.
              fimsg-msgv1 = save_domname.
              fimsg-msgv2 = save_domvalue.
              PERFORM message_append.
            ENDIF.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.

ENDFORM.                    "READ_DOMVALUETEXT

*-----------------------------------------------------------------------
*       FORM READ_KNA1
*-----------------------------------------------------------------------
FORM read_kna1.
  CLEAR kna1.
  SELECT SINGLE * FROM kna1
    WHERE kunnr = save_kunnr.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '574'.
    fimsg-msgv1 = save_kunnr.
    PERFORM message_append.
  ENDIF.
ENDFORM.                                                    "READ_KNA1

*-----------------------------------------------------------------------
*       FORM READ_KNA1_2
*-----------------------------------------------------------------------
*       Lesen von Daten zu Filialen
*-----------------------------------------------------------------------
FORM read_kna1_2.
  CLEAR *kna1.
  SELECT SINGLE * FROM kna1 INTO *kna1
    WHERE kunnr = save2_kunnr.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '575'.
    fimsg-msgv1 = save2_kunnr.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_KNA1_2

*-----------------------------------------------------------------------
*       FORM READ_KNB1
*-----------------------------------------------------------------------
FORM read_knb1.
  CLEAR knb1.
  SELECT SINGLE * FROM knb1
    WHERE kunnr = save_kunnr
    AND   bukrs = save_bukrs.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '576'.
    fimsg-msgv1 = save_kunnr.
    fimsg-msgv2 = save_bukrs.
    PERFORM message_append.
  ENDIF.
ENDFORM.                                                    "READ_KNB1

*-----------------------------------------------------------------------
*       FORM READ_KNB1_2
*-----------------------------------------------------------------------
*       Lesen von Daten zu Filialen
*-----------------------------------------------------------------------
FORM read_knb1_2.
  CLEAR *knb1.
  SELECT SINGLE * FROM knb1 INTO *knb1
    WHERE kunnr = save2_kunnr
    AND   bukrs = save2_bukrs.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '577'.
    fimsg-msgv1 = save2_kunnr.
    fimsg-msgv2 = save2_bukrs.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_KNB1_2

*-----------------------------------------------------------------------
*       FORM READ_LFA1
*-----------------------------------------------------------------------
FORM read_lfa1.
  CLEAR lfa1.
  SELECT SINGLE * FROM lfa1
    WHERE lifnr = save_lifnr.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '578'.
    fimsg-msgv1 = save_lifnr.
    PERFORM message_append.
  ENDIF.
ENDFORM.                                                    "READ_LFA1

*-----------------------------------------------------------------------
*       FORM READ_LFA1_2
*-----------------------------------------------------------------------
*       Lesen von Daten zu Filialen
*-----------------------------------------------------------------------
FORM read_lfa1_2.
  CLEAR *lfa1.
  SELECT SINGLE * FROM lfa1 INTO *lfa1
    WHERE lifnr = save2_lifnr.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '579'.
    fimsg-msgv1 = save2_lifnr.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_LFA1_2

*-----------------------------------------------------------------------
*       FORM READ_LFB1
*-----------------------------------------------------------------------
FORM read_lfb1.
  CLEAR lfb1.
  SELECT SINGLE * FROM lfb1
    WHERE lifnr = save_lifnr
    AND   bukrs = save_bukrs.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '580'.
    fimsg-msgv1 = save_lifnr.
    fimsg-msgv2 = save_bukrs.
    PERFORM message_append.
  ENDIF.
ENDFORM.                                                    "READ_LFB1

*-----------------------------------------------------------------------
*       FORM READ_LFB1_2
*-----------------------------------------------------------------------
*       Lesen von Daten zu Filialen
*-----------------------------------------------------------------------
FORM read_lfb1_2.
  CLEAR *lfb1.
  SELECT SINGLE * FROM lfb1 INTO *lfb1
    WHERE lifnr = save2_lifnr
    AND   bukrs = save2_bukrs.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'. fimsg-msgty = 'I'.
    fimsg-msgno = '581'.
    fimsg-msgv1 = save2_lifnr.
    fimsg-msgv2 = save2_bukrs.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_LFB1_2

*-----------------------------------------------------------------------
*       FORM READ_SKAT
*-----------------------------------------------------------------------
FORM read_skat.
  CLEAR skat.

  SELECT SINGLE * FROM skat
    WHERE spras = language
    AND   ktopl = save_ktopl
    AND   saknr = save_saknr.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM skat
            WHERE spras = sy-langu
            AND   ktopl = save_ktopl
            AND   saknr = save_saknr.
          IF sy-subrc NE 0.
            IF language NE t004-dspra.
              SELECT SINGLE * FROM skat
                WHERE spras = t004-dspra
                AND   ktopl = save_ktopl
                AND   saknr = save_saknr.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '583'.
                fimsg-msgv1 = save_ktopl.
                fimsg-msgv2 = save_saknr.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '582'.
                fimsg-msgv1 = save_ktopl.
                fimsg-msgv2 = save_saknr.
                fimsg-msgv3 = language.
                fimsg-msgv4 = t004-dspra.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '583'.
              fimsg-msgv1 = save_ktopl.
              fimsg-msgv2 = save_saknr.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '582'.
            fimsg-msgv1 = save_ktopl.
            fimsg-msgv2 = save_saknr.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE t004-dspra.
            SELECT SINGLE * FROM skat
              WHERE spras = t004-dspra
              AND   ktopl = save_ktopl
              AND   saknr = save_saknr.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '583'.
              fimsg-msgv1 = save_ktopl.
              fimsg-msgv2 = save_saknr.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '582'.
              fimsg-msgv1 = save_ktopl.
              fimsg-msgv2 = save_saknr.
              fimsg-msgv3 = language.
              fimsg-msgv4 = t004-dspra.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '583'.
            fimsg-msgv1 = save_ktopl.
            fimsg-msgv2 = save_saknr.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                    "READ_SKAT

*-----------------------------------------------------------------------
*       FORM READ_TABWT
*-----------------------------------------------------------------------
FORM read_tabwt.
  CLEAR tabwt.

  SELECT SINGLE * FROM tabwt
    WHERE spras = language
    AND   bwasl = save_anbwa.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM tabwt
            WHERE spras = sy-langu
            AND   bwasl = save_anbwa.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM tabwt
                WHERE spras = 'D'
                AND   bwasl = save_anbwa.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '585'.
                fimsg-msgv1 = save_anbwa.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '586'.
                fimsg-msgv1 = save_anbwa.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '585'.
              fimsg-msgv1 = save_anbwa.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '586'.
            fimsg-msgv1 = save_anbwa.
            fimsg-msgv2 = language.
            fimsg-msgv3 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM tabwt
              WHERE spras = 'D'
              AND   bwasl = save_anbwa.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '585'.
              fimsg-msgv1 = save_anbwa.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '586'.
              fimsg-msgv1 = save_anbwa.
              fimsg-msgv2 = language.
              fimsg-msgv3 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '585'.
            fimsg-msgv1 = save_anbwa.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                    "READ_TABWT

*-----------------------------------------------------------------------
*       FORM READ_TBSLT
*-----------------------------------------------------------------------
FORM read_tbslt.
  CLEAR tbslt.

  SELECT SINGLE * FROM tbslt
    WHERE spras = language
    AND   bschl = save_bschl
    AND   umskz = save_umskz.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM tbslt
            WHERE spras = sy-langu
            AND   bschl = save_bschl
            AND   umskz = save_umskz.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM tbslt
                WHERE spras = 'D'
                AND   bschl = save_bschl
                AND   umskz = save_umskz.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '587'.
                fimsg-msgv1 = save_bschl.
                fimsg-msgv2 = save_umskz.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '588'.
                fimsg-msgv1 = save_bschl.
                fimsg-msgv2 = save_umskz.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '587'.
              fimsg-msgv1 = save_bschl.
              fimsg-msgv2 = save_umskz.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '588'.
            fimsg-msgv1 = save_bschl.
            fimsg-msgv2 = save_umskz.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM tbslt
              WHERE spras = 'D'
              AND   bschl = save_bschl
              AND   umskz = save_umskz.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '587'.
              fimsg-msgv1 = save_bschl.
              fimsg-msgv2 = save_umskz.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '588'.
              fimsg-msgv1 = save_bschl.
              fimsg-msgv2 = save_umskz.
              fimsg-msgv3 = language.
              fimsg-msgv4 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '587'.
            fimsg-msgv1 = save_bschl.
            fimsg-msgv2 = save_umskz.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                    "READ_TBSLT

*-----------------------------------------------------------------------
*       FORM READ_TBSLT_2
*-----------------------------------------------------------------------
FORM read_tbslt_2.
  CLEAR   htbslt.
  REFRESH htbslt.

  SELECT * FROM tbslt
    WHERE spras = language.
    CLEAR htbslt.
    MOVE-CORRESPONDING tbslt TO htbslt.
    APPEND htbslt.
  ENDSELECT.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT * FROM tbslt
            WHERE spras = sy-langu.
            CLEAR htbslt.
            MOVE-CORRESPONDING tbslt TO htbslt.
            APPEND htbslt.
          ENDSELECT.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT * FROM tbslt
                WHERE spras = 'D'.
                CLEAR htbslt.
                MOVE-CORRESPONDING tbslt TO htbslt.
                APPEND htbslt.
              ENDSELECT.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '589'.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '590'.
                fimsg-msgv1 = language.
                fimsg-msgv2 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '589'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '590'.
            fimsg-msgv1 = language.
            fimsg-msgv2 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT * FROM tbslt
              WHERE spras = 'D'.
              CLEAR htbslt.
              MOVE-CORRESPONDING tbslt TO htbslt.
              APPEND htbslt.
            ENDSELECT.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '589'.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '590'.
              fimsg-msgv1 = language.
              fimsg-msgv2 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '589'.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                    "READ_TBSLT_2

*-----------------------------------------------------------------------
*       FORM READ_TTXJT
*-----------------------------------------------------------------------
FORM read_ttxjt.
  CLEAR ttxjt.

  PERFORM check_jurisdiction.

  IF xexter IS INITIAL.
    SELECT SINGLE * FROM ttxjt
      WHERE spras = language
      AND   kalsm = save_kalsm
      AND   txjcd = save_txjcd.
    IF sy-subrc NE 0.
      CASE flspras.
        WHEN ' '.
          IF language NE sy-langu.
            SELECT SINGLE * FROM ttxjt
              WHERE spras = sy-langu
              AND   kalsm = save_kalsm
              AND   txjcd = save_txjcd.
            IF sy-subrc NE 0.
              IF language NE 'D'.
                SELECT SINGLE * FROM ttxjt
                  WHERE spras = 'D'
                  AND   kalsm = save_kalsm
                  AND   txjcd = save_txjcd.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '591'.
                  fimsg-msgv1 = save_kalsm.
                  fimsg-msgv2 = save_txjcd.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '592'.
                  fimsg-msgv1 = save_kalsm.
                  fimsg-msgv2 = save_txjcd.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '591'.
                fimsg-msgv1 = save_kalsm.
                fimsg-msgv2 = save_txjcd.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '592'.
              fimsg-msgv1 = save_kalsm.
              fimsg-msgv2 = save_txjcd.
              fimsg-msgv3 = language.
              fimsg-msgv4 = sy-langu.
              PERFORM message_append.
            ENDIF.
          ELSE.
            IF language NE 'D'.
              SELECT SINGLE * FROM ttxjt
                WHERE spras = 'D'
                AND   kalsm = save_kalsm
                AND   txjcd = save_txjcd.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '591'.
                fimsg-msgv1 = save_kalsm.
                fimsg-msgv2 = save_txjcd.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '592'.
                fimsg-msgv1 = save_kalsm.
                fimsg-msgv2 = save_txjcd.
                fimsg-msgv3 = language.
                fimsg-msgv4 = sy-langu.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '591'.
              fimsg-msgv1 = save_kalsm.
              fimsg-msgv2 = save_txjcd.
              PERFORM message_append.
            ENDIF.
          ENDIF.
        WHEN OTHERS.
          CLEAR fimsg.
          fimsg-msort = '    '. fimsg-msgid = 'FB'.
          fimsg-msgty = 'I'.
          fimsg-msgno = '584'.
          PERFORM message_append.
      ENDCASE.
    ENDIF.
  ENDIF.
ENDFORM.                    "READ_TTXJT

*-----------------------------------------------------------------------
*       FORM READ_TZB0T
*-----------------------------------------------------------------------
FORM read_tzb0t.
* noch nicht unterst¨¹tzt
ENDFORM.                                                    "READ_TZB0T

*-----------------------------------------------------------------------
*       FORM READ_T001
*-----------------------------------------------------------------------
FORM read_t001.
  CLEAR t001.

  SELECT SINGLE * FROM t001
    WHERE bukrs = save_bukrs.
  IF sy-subrc NE 0.
    MESSAGE e593 WITH save_bukrs.
  ENDIF.
ENDFORM.                                                    "READ_T001

*-----------------------------------------------------------------------
*       FORM READ_T001F
*-----------------------------------------------------------------------
FORM read_t001f.
  CLEAR t001f.

  SELECT SINGLE * FROM t001f
    WHERE bukrs     = save_bukrs
    AND   programm  = save_repid
    AND   event     = save_forid
    AND   koart     = ' '.
  IF sy-subrc NE 0.
    SELECT SINGLE * FROM t001f
      WHERE bukrs     = '   '
      AND   programm  = save_repid
      AND   event     = save_forid
      AND   koart     = ' '.
    IF sy-subrc NE 0.
      IF save_forid IS INITIAL.
        MESSAGE e595 WITH save_bukrs save_repid.
      ELSE.
        MESSAGE e594 WITH save_bukrs save_repid save_forid.
      ENDIF.
    ENDIF.
  ENDIF.
  IF sy-subrc = 0.
    IF t001f-fornr IS INITIAL.
      MESSAGE e228 WITH save_bukrs save_repid save_forid.
    ELSE.
      CALL FUNCTION 'FORM_CHECK'
        EXPORTING
          i_pzfor     = t001f-fornr
        EXCEPTIONS
          not_defined = 4.
      IF sy-subrc = 4.
        MESSAGE e848 WITH t001f-fornr save_bukrs save_repid
                          save_forid.
      ENDIF.
    ENDIF.
  ENDIF.
ENDFORM.                                                    "READ_T001F

*-----------------------------------------------------------------------
*       FORM READ_T001G
*-----------------------------------------------------------------------
FORM read_t001g.
  CLEAR t001g.

  SELECT SINGLE * FROM t001g
    WHERE bukrs     = save_bukrs
    AND   programm  = save_repid
    AND   txtid     = save_tkoid.
  IF sy-subrc NE 0.
    SELECT SINGLE * FROM t001g
      WHERE bukrs     = '   '
      AND   programm  = save_repid
      AND   txtid     = save_tkoid.
    IF sy-subrc NE 0.
      IF save_tkoid IS INITIAL.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '597'.
        fimsg-msgv1 = save_bukrs.
        fimsg-msgv2 = save_repid.
        PERFORM message_append.
      ELSE.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '596'.
        fimsg-msgv1 = save_bukrs.
        fimsg-msgv2 = save_repid.
        fimsg-msgv3 = save_tkoid.
        PERFORM message_append.
      ENDIF.
    ENDIF.
  ENDIF.

ENDFORM.                                                    "READ_T001G

*-----------------------------------------------------------------------
*       FORM READ_T001S
*-----------------------------------------------------------------------
FORM read_t001s.
  CLEAR t001s.
  CLEAR fsabe.
  IF NOT save_busab IS INITIAL.
    CALL FUNCTION 'CORRESPONDENCE_DATA_BUSAB'
      EXPORTING
        i_bukrs         = save_bukrs
        i_busab         = save_busab
        i_langu         = language
      IMPORTING
        e_t001s         = t001s
        e_fsabe         = fsabe
      EXCEPTIONS
        busab_not_found = 01
        OTHERS          = 02.

    IF sy-subrc = 01.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '598'.
      fimsg-msgv1 = save_bukrs.
      fimsg-msgv2 = save_busab.
      PERFORM message_append.
    ENDIF.
    IF sy-subrc = 02.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '849'.
      fimsg-msgv1 = save_bukrs.
      fimsg-msgv2 = save_busab.
      PERFORM message_append.
    ENDIF.
  ENDIF.
ENDFORM.                                                    "READ_T001S

*-----------------------------------------------------------------------
*       FORM READ_T001S_2
*-----------------------------------------------------------------------
FORM read_t001s_2.
  CLEAR *t001s.
  CLEAR *fsabe.
  IF NOT save2_busab IS INITIAL.
    CALL FUNCTION 'CORRESPONDENCE_DATA_BUSAB'
      EXPORTING
        i_bukrs         = save_bukrs
        i_busab         = save2_busab
        i_langu         = language
      IMPORTING
        e_t001s         = *t001s
        e_fsabe         = *fsabe
      EXCEPTIONS
        busab_not_found = 01
        OTHERS          = 02.

    IF sy-subrc = 01.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '598'.
      fimsg-msgv1 = save_bukrs.
      fimsg-msgv2 = save2_busab.
      PERFORM message_append.
    ENDIF.
    IF sy-subrc = 02.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '849'.
      fimsg-msgv1 = save_bukrs.
      fimsg-msgv2 = save2_busab.
      PERFORM message_append.
    ENDIF.
  ENDIF.
ENDFORM.                    "READ_T001S_2

*-----------------------------------------------------------------------
*       FORM READ_T001W
*-----------------------------------------------------------------------
FORM read_t001w.
  CLEAR t001w.

  SELECT SINGLE * FROM t001w
    WHERE werks = save_werks.
  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '599'.
    fimsg-msgv1 = save_werks.
    PERFORM message_append.
  ENDIF.

ENDFORM.                                                    "READ_T001W

*-----------------------------------------------------------------------
*       FORM READ_T003T
*-----------------------------------------------------------------------
FORM read_t003t.
* No SAPScript error logging. We're using SmartForms!
  EXIT.
  CLEAR t003t.
  CLEAR save2_spras.
* SELECT SINGLE * FROM T003T
*   WHERE SPRAS = SAVE_LANGU
*   AND   BLART = SAVE_BLART.
*
*   IF SY-SUBRC NE 0.
*     SELECT SINGLE * FROM T003T
*       WHERE SPRAS = T001-SPRAS
*       AND   BLART = SAVE_BLART.
*   ENDIF.

  SELECT SINGLE * FROM t003t
    WHERE spras = hkna1-spras
    AND   blart = save_blart.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t003t
            WHERE spras = sy-langu
            AND   blart = save_blart.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t003t
                WHERE spras = 'D'
                AND   blart = save_blart.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '218'.
                fimsg-msgv1 = save_blart.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '219'.
                fimsg-msgv1 = save_blart.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '218'.
              fimsg-msgv1 = save_blart.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '219'.
            fimsg-msgv1 = save_blart.
            fimsg-msgv2 = language.
            fimsg-msgv3 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t003t
              WHERE spras = 'D'
              AND   blart = save_blart.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '218'.
              fimsg-msgv1 = save_blart.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '219'.
              fimsg-msgv1 = save_blart.
              fimsg-msgv2 = language.
              fimsg-msgv3 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '218'.
            fimsg-msgv1 = save_blart.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN 'X'.
        save2_spras = save_langu.
*         IF SAVE_KOART = 'D'.
*           SAVE2_SPRAS = KNA1-SPRAS.
*         ELSE.
*           SAVE2_SPRAS = LFA1-SPRAS.
*         ENDIF.
        IF language NE save2_spras.
          SELECT SINGLE * FROM t003t
            WHERE spras = save2_spras
            AND   blart = save_blart.
          IF sy-subrc NE 0.
            IF language NE sy-langu.
              SELECT SINGLE * FROM t003t
                WHERE spras = sy-langu
                AND   blart = save_blart.
              IF sy-subrc NE 0.
                IF language NE 'D'.
                  SELECT SINGLE * FROM t003t
                    WHERE spras = 'D'
                    AND   blart = save_blart.
                  IF sy-subrc NE 0.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '218'.
                    fimsg-msgv1 = save_blart.
                    PERFORM message_append.
                  ELSE.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '219'.
                    fimsg-msgv1 = save_blart.
                    fimsg-msgv2 = language.
                    fimsg-msgv3 = 'D'.
                    PERFORM message_append.
                  ENDIF.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '218'.
                  fimsg-msgv1 = save_blart.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '219'.
                fimsg-msgv1 = save_blart.
                fimsg-msgv2 = language.
                fimsg-msgv3 = sy-langu.
                PERFORM message_append.
              ENDIF.
            ELSE.
              IF language NE 'D'.
                SELECT SINGLE * FROM t003t
                  WHERE spras = 'D'
                  AND   blart = save_blart.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '218'.
                  fimsg-msgv1 = save_blart.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '219'.
                  fimsg-msgv1 = save_blart.
                  fimsg-msgv2 = language.
                  fimsg-msgv3 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '218'.
                fimsg-msgv1 = save_blart.
                PERFORM message_append.
              ENDIF.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '219'.
            fimsg-msgv1 = save_blart.
            fimsg-msgv2 = language.
            fimsg-msgv3 = save2_spras.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE sy-langu.
            SELECT SINGLE * FROM t003t
              WHERE spras = sy-langu
              AND   blart = save_blart.
            IF sy-subrc NE 0.
              IF language NE 'D'.
                SELECT SINGLE * FROM t003t
                  WHERE spras = 'D'
                  AND   blart = save_blart.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '218'.
                  fimsg-msgv1 = save_blart.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '219'.
                  fimsg-msgv1 = save_blart.
                  fimsg-msgv2 = language.
                  fimsg-msgv3 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '218'.
                fimsg-msgv1 = save_blart.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '219'.
              fimsg-msgv1 = save_blart.
              fimsg-msgv2 = language.
              fimsg-msgv3 = sy-langu.
              PERFORM message_append.
            ENDIF.
          ELSE.
            IF language NE 'D'.
              SELECT SINGLE * FROM t003t
                WHERE spras = 'D'
                AND   blart = save_blart.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '218'.
                fimsg-msgv1 = save_blart.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '219'.
                fimsg-msgv1 = save_blart.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '218'.
              fimsg-msgv1 = save_blart.
              PERFORM message_append.
            ENDIF.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                                                    "READ_T003T

*-----------------------------------------------------------------------
*       FORM READ_T004
*-----------------------------------------------------------------------
FORM read_t004.
  SELECT SINGLE * FROM t004
    WHERE ktopl = save_ktopl.
  IF sy-subrc NE 0.
    MESSAGE e220 WITH save_ktopl.
  ENDIF.
ENDFORM.                                                    "READ_T004

*-----------------------------------------------------------------------
*       FORM READ_T005
*-----------------------------------------------------------------------
FORM read_t005.
  SELECT SINGLE * FROM t005
    WHERE land1 = save_land1.
  IF sy-subrc NE 0.
    MESSAGE e221 WITH save_land1.
  ENDIF.
ENDFORM.                                                    "READ_T005

*-----------------------------------------------------------------------
*       FORM READ_T005_2
*-----------------------------------------------------------------------
FORM read_t005_2.
  SELECT SINGLE * FROM t005 INTO *t005
    WHERE land1 = save2_land1.
  IF sy-subrc NE 0.
    MESSAGE e221 WITH save2_land1.
  ENDIF.
ENDFORM.                    "READ_T005_2

*-----------------------------------------------------------------------
*       FORM READ_T005T
*-----------------------------------------------------------------------
FORM read_t005t.
  CLEAR t005t.

  SELECT SINGLE * FROM t005t
    WHERE spras = language
    AND   land1 = save3_land1.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t005t
            WHERE spras = sy-langu
            AND   land1 = save3_land1.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t005t
                WHERE spras = 'D'
                AND   land1 = save3_land1.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '222'.
                fimsg-msgv1 = save3_land1.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '223'.
                fimsg-msgv1 = save3_land1.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '222'.
              fimsg-msgv1 = save3_land1.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '223'.
            fimsg-msgv1 = save3_land1.
            fimsg-msgv2 = language.
            fimsg-msgv3 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t005t
              WHERE spras = 'D'
              AND   land1 = save3_land1.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '222'.
              fimsg-msgv1 = save3_land1.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '223'.
              fimsg-msgv1 = save3_land1.
              fimsg-msgv2 = language.
              fimsg-msgv3 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '222'.
            fimsg-msgv1 = save3_land1.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                                                    "READ_T005T

*-----------------------------------------------------------------------
*       FORM READ_T007B
*-----------------------------------------------------------------------
FORM read_t007b.
  SELECT SINGLE * FROM t007b
    WHERE ktosl = save_ktosl.
  IF sy-subrc NE 0.
    MESSAGE e224 WITH save_ktosl.
  ENDIF.
ENDFORM.                                                    "READ_T007B

*-----------------------------------------------------------------------
*       FORM READ_T007S
*-----------------------------------------------------------------------
FORM read_t007s.
  CLEAR t007s.

  SELECT SINGLE * FROM t007s
    WHERE spras = language
    AND   kalsm = save_kalsm
    AND   mwskz = save_mwskz.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t007s
            WHERE spras = sy-langu
            AND   kalsm = save_kalsm
            AND   mwskz = save_mwskz.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t007s
                WHERE spras = 'D'
                AND   kalsm = save_kalsm
                AND   mwskz = save_mwskz.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '225'.
                fimsg-msgv1 = save_kalsm.
                fimsg-msgv2 = save_mwskz.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '226'.
                fimsg-msgv1 = save_kalsm.
                fimsg-msgv2 = save_mwskz.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '225'.
              fimsg-msgv1 = save_kalsm.
              fimsg-msgv2 = save_mwskz.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '226'.
            fimsg-msgv1 = save_kalsm.
            fimsg-msgv2 = save_mwskz.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t007s
              WHERE spras = 'D'
              AND   kalsm = save_kalsm
              AND   mwskz = save_mwskz.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '225'.
              fimsg-msgv1 = save_kalsm.
              fimsg-msgv2 = save_mwskz.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '226'.
              fimsg-msgv1 = save_kalsm.
              fimsg-msgv2 = save_mwskz.
              fimsg-msgv3 = language.
              fimsg-msgv4 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '225'.
            fimsg-msgv1 = save_kalsm.
            fimsg-msgv2 = save_mwskz.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                                                    "READ_T007S

*-----------------------------------------------------------------------
*       FORM READ_T015L
*-----------------------------------------------------------------------
FORM read_t015l.
  CLEAR t015l.

  SELECT SINGLE * FROM t015l
    WHERE lzbkz = save_lzbkz.
  IF sy-subrc NE 0.
*     message
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '227'.
    fimsg-msgv1 = save_lzbkz.
    PERFORM message_append.
  ENDIF.
ENDFORM.                                                    "READ_T015L

*-----------------------------------------------------------------------
*       FORM READ_T030
*-----------------------------------------------------------------------
*ORM READ_T030.
* CLEAR T030.
*
* SELECT SINGLE * FROM T030
*   WHERE KTOPL = SAVE_KTOPL
*   AND   KTOSL = SAVE_KTOSL
*   AND   BWMOD = ' '
*   AND   KOMOK = ' '
*   AND   BKLAS = ' '.
*
*NDFORM.

*-----------------------------------------------------------------------
*       FORM READ_T048
*-----------------------------------------------------------------------
FORM read_t048.
  CLEAR t048.
  SELECT SINGLE * FROM t048
    WHERE event = save_event.
* message bei Ausrufer
ENDFORM.                                                    "READ_T048

*-----------------------------------------------------------------------
*       FORM READ_T048B
*-----------------------------------------------------------------------
FORM read_t048b.
  CLEAR t048b.
  SELECT SINGLE * FROM t048b
    WHERE bukrs = save_bukrs
    AND   event = save_event.
  IF sy-subrc NE 0.
    SELECT SINGLE * FROM t048b
      WHERE bukrs = space
      AND   event = save_event.
* message bei Ausrufer
  ENDIF.
ENDFORM.                                                    "READ_T048B

*-----------------------------------------------------------------------
*       FORM READ_T050T
*-----------------------------------------------------------------------
FORM read_t050t.
  CLEAR t050t.

  SELECT SINGLE * FROM t050t
    WHERE spras = language
    AND   msgid = 'RF'
    AND   txtnr = save_txtnr.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t050t
            WHERE spras = sy-langu
            AND   msgid = 'RF'
            AND   txtnr = save_txtnr.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t050t
                WHERE spras = 'D'
                AND   msgid = 'RF'
                AND   txtnr = save_txtnr.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '230'.
                fimsg-msgv1 = 'RF'.
                fimsg-msgv2 = save_txtnr.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '231'.
                fimsg-msgv1 = 'RF'.
                fimsg-msgv2 = save_txtnr.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '230'.
              fimsg-msgv1 = 'RF'.
              fimsg-msgv2 = save_txtnr.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '231'.
            fimsg-msgv1 = 'RF'.
            fimsg-msgv2 = save_txtnr.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t050t
              WHERE spras = 'D'
              AND   msgid = 'RF'
              AND   txtnr = save_txtnr.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '230'.
              fimsg-msgv1 = 'RF'.
              fimsg-msgv2 = save_txtnr.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '231'.
              fimsg-msgv1 = 'RF'.
              fimsg-msgv2 = save_txtnr.
              fimsg-msgv3 = language.
              fimsg-msgv4 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '230'.
            fimsg-msgv1 = 'RF'.
            fimsg-msgv2 = save_txtnr.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                                                    "READ_T050T

*-----------------------------------------------------------------------
*       FORM READ_T050T_2
*-----------------------------------------------------------------------
FORM read_t050t_2.
  CLEAR   ht050t.
  REFRESH ht050t.

  SELECT * FROM t050t
    WHERE spras = language
    AND   msgid = 'RF'.
    CLEAR ht050t.
    MOVE-CORRESPONDING t050t TO ht050t.
    APPEND ht050t.
  ENDSELECT.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT * FROM t050t
            WHERE spras = sy-langu
            AND   msgid = 'RF'.
            CLEAR ht050t.
            MOVE-CORRESPONDING t050t TO ht050t.
            APPEND ht050t.
          ENDSELECT.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT * FROM t050t
                WHERE spras = 'D'
                AND   msgid = 'RF'.
                CLEAR ht050t.
                MOVE-CORRESPONDING t050t TO ht050t.
                APPEND ht050t.
              ENDSELECT.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '232'.
                fimsg-msgv1 = 'RF'.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '233'.
                fimsg-msgv1 = 'RF'.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '232'.
              fimsg-msgv1 = 'RF'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '233'.
            fimsg-msgv1 = 'RF'.
            fimsg-msgv2 = language.
            fimsg-msgv3 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT * FROM t050t
              WHERE spras = 'D'
              AND   msgid = 'RF'.
              CLEAR ht050t.
              MOVE-CORRESPONDING t050t TO ht050t.
              APPEND ht050t.
            ENDSELECT.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '232'.
              fimsg-msgv1 = 'RF'.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '233'.
              fimsg-msgv1 = 'RF'.
              fimsg-msgv2 = language.
              fimsg-msgv3 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '232'.
            fimsg-msgv1 = 'RF'.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                    "READ_T050T_2

*-----------------------------------------------------------------------
*       FORM READ_T057T
*-----------------------------------------------------------------------
FORM read_t057t.
  CLEAR t057t.

  SELECT SINGLE * FROM t057t
    WHERE spras = language
    AND   blnkz = save_blnkz.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t057t
            WHERE spras = sy-langu
            AND   blnkz = save_blnkz.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t057t
                WHERE spras = 'D'
                AND   blnkz = save_blnkz.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '234'.
                fimsg-msgv1 = save_blnkz.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '235'.
                fimsg-msgv1 = save_blnkz.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '234'.
              fimsg-msgv1 = save_blnkz.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '235'.
            fimsg-msgv1 = save_blnkz.
            fimsg-msgv2 = language.
            fimsg-msgv3 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t057t
              WHERE spras = 'D'
              AND   blnkz = save_blnkz.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '234'.
              fimsg-msgv1 = save_blnkz.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '235'.
              fimsg-msgv1 = save_blnkz.
              fimsg-msgv2 = language.
              fimsg-msgv3 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '234'.
            fimsg-msgv1 = save_blnkz.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                                                    "READ_T057T

*----------------------------------------------------------------------*
*       FORM READ_T074T
*----------------------------------------------------------------------*
*       Bezeichnung der Sonderhauptbuchkennzeichen
*----------------------------------------------------------------------*
FORM read_t074t.
  CLEAR t074t.
  CLEAR save2_spras.
  SELECT SINGLE * FROM t074t
    WHERE spras = language
    AND   koart = save_koart
    AND   shbkz = save_umskz.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t074t
            WHERE spras = sy-langu
            AND   koart = save_koart
            AND   shbkz = save_umskz.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t074t
                WHERE spras = 'D'
                AND   koart = save_koart
                AND   shbkz = save_umskz.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '236'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '237'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '236'.
              fimsg-msgv1 = save_koart.
              fimsg-msgv2 = save_umskz.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '237'.
            fimsg-msgv1 = save_koart.
            fimsg-msgv2 = save_umskz.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t074t
              WHERE spras = 'D'
              AND   koart = save_koart
              AND   shbkz = save_umskz.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '236'.
              fimsg-msgv1 = save_koart.
              fimsg-msgv2 = save_umskz.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '237'.
              fimsg-msgv1 = save_koart.
              fimsg-msgv2 = save_umskz.
              fimsg-msgv3 = language.
              fimsg-msgv4 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '236'.
            fimsg-msgv1 = save_koart.
            fimsg-msgv2 = save_umskz.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN 'X'.
        save2_spras = save_langu.
*         IF SAVE_KOART = 'D'.
*           SAVE2_SPRAS = KNA1-SPRAS.
*         ELSE.
*           SAVE2_SPRAS = LFA1-SPRAS.
*         ENDIF.
        IF language NE save2_spras.
          SELECT SINGLE * FROM t074t
            WHERE spras = save2_spras
            AND   koart = save_koart
            AND   shbkz = save_umskz.
          IF sy-subrc NE 0.
            IF language NE sy-langu.
              SELECT SINGLE * FROM t074t
                WHERE spras = sy-langu
                AND   koart = save_koart
                AND   shbkz = save_umskz.
              IF sy-subrc NE 0.
                IF language NE 'D'.
                  SELECT SINGLE * FROM t074t
                    WHERE spras = 'D'
                    AND   koart = save_koart
                    AND   shbkz = save_umskz.
                  IF sy-subrc NE 0.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '236'.
                    fimsg-msgv1 = save_koart.
                    fimsg-msgv2 = save_umskz.
                    PERFORM message_append.
                  ELSE.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '237'.
                    fimsg-msgv1 = save_koart.
                    fimsg-msgv2 = save_umskz.
                    fimsg-msgv3 = language.
                    fimsg-msgv4 = 'D'.
                    PERFORM message_append.
                  ENDIF.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '236'.
                  fimsg-msgv1 = save_koart.
                  fimsg-msgv2 = save_umskz.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '237'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                fimsg-msgv3 = language.
                fimsg-msgv4 = sy-langu.
                PERFORM message_append.
              ENDIF.
            ELSE.
              IF language NE 'D'.
                SELECT SINGLE * FROM t074t
                  WHERE spras = 'D'
                  AND   koart = save_koart
                  AND   shbkz = save_umskz.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '236'.
                  fimsg-msgv1 = save_koart.
                  fimsg-msgv2 = save_umskz.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '237'.
                  fimsg-msgv1 = save_koart.
                  fimsg-msgv2 = save_umskz.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '236'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                PERFORM message_append.
              ENDIF.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '237'.
            fimsg-msgv1 = save_koart.
            fimsg-msgv2 = save_umskz.
            fimsg-msgv3 = language.
            fimsg-msgv4 = save2_spras.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE sy-langu.
            SELECT SINGLE * FROM t074t
              WHERE spras = sy-langu
              AND   koart = save_koart
              AND   shbkz = save_umskz.
            IF sy-subrc NE 0.
              IF language NE 'D'.
                SELECT SINGLE * FROM t074t
                  WHERE spras = 'D'
                  AND   koart = save_koart
                  AND   shbkz = save_umskz.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '236'.
                  fimsg-msgv1 = save_koart.
                  fimsg-msgv2 = save_umskz.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '237'.
                  fimsg-msgv1 = save_koart.
                  fimsg-msgv2 = save_umskz.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '236'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '237'.
              fimsg-msgv1 = save_koart.
              fimsg-msgv2 = save_umskz.
              fimsg-msgv3 = language.
              fimsg-msgv4 = sy-langu.
              PERFORM message_append.
            ENDIF.
          ELSE.
            IF language NE 'D'.
              SELECT SINGLE * FROM t074t
                WHERE spras = 'D'
                AND   koart = save_koart
                AND   shbkz = save_umskz.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '236'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '237'.
                fimsg-msgv1 = save_koart.
                fimsg-msgv2 = save_umskz.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '236'.
              fimsg-msgv1 = save_koart.
              fimsg-msgv2 = save_umskz.
              PERFORM message_append.
            ENDIF.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.
ENDFORM.                                                    "READ_T074T

*-----------------------------------------------------------------------
*       FORM READ_T687T
*-----------------------------------------------------------------------
*       Lesen der Bezeichnungen der Steuerarten
*-----------------------------------------------------------------------
FORM read_t687t.
  CLEAR save_vtext.
  CLEAR t687t.
* LOOP AT TAXTXT
*   WHERE KVSL1 = SAVE_KTOSL
*   AND   SPRAS = LANGUAGE.
*     SAVE_VTEXT = TAXTXT-VTEXT.
* ENDLOOP.
* IF SY-SUBRC NE 0.
*   SELECT SINGLE * FROM T687T
*     WHERE SPRAS = LANGUAGE.
*     AND   KAPPL = 'TX'
*     AND   KVSL1 = SAVE_KTOSL.
*     SAVE_VTEXT  = T687T-VTEXT.
*     CLEAR TAXTXT.
*     MOVE-CORRESPONDING T687T TO TAXTXT.
*     APPEND TAXTXT.
*     IF SY-SUBRC NE 0.
**      message
*     ENDIF.
* ENDIF.
  SELECT SINGLE * FROM t687t
    WHERE spras = language
    AND   kappl = 'TX'
    AND   kvsl1 = save_ktosl.
  IF sy-subrc NE 0.
    CASE flspras.
      WHEN ' '.
        IF language NE sy-langu.
          SELECT SINGLE * FROM t687t
            WHERE spras = sy-langu
            AND   kappl = 'TX'
            AND   kvsl1 = save_ktosl.
          IF sy-subrc NE 0.
            IF language NE 'D'.
              SELECT SINGLE * FROM t687t
                WHERE spras = 'D'
                AND   kappl = 'TX'
                AND   kvsl1 = save_ktosl.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '238'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '239'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '238'.
              fimsg-msgv1 = 'TX'.
              fimsg-msgv2 = save_ktosl.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '239'.
            fimsg-msgv1 = 'TX'.
            fimsg-msgv2 = save_ktosl.
            fimsg-msgv3 = language.
            fimsg-msgv4 = sy-langu.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE 'D'.
            SELECT SINGLE * FROM t687t
              WHERE spras = 'D'
              AND   kappl = 'TX'
              AND   kvsl1 = save_ktosl.
            IF sy-subrc NE 0.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '238'.
              fimsg-msgv1 = 'TX'.
              fimsg-msgv2 = save_ktosl.
              PERFORM message_append.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '239'.
              fimsg-msgv1 = 'TX'.
              fimsg-msgv2 = save_ktosl.
              fimsg-msgv3 = language.
              fimsg-msgv4 = 'D'.
              PERFORM message_append.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '238'.
            fimsg-msgv1 = 'TX'.
            fimsg-msgv2 = save_ktosl.
            PERFORM message_append.
          ENDIF.
        ENDIF.
      WHEN 'X'.
        save2_spras = save_langu.
*         IF SAVE_KOART = 'D'.
*           SAVE2_SPRAS = KNA1-SPRAS.
*         ELSE.
*           SAVE2_SPRAS = LFA1-SPRAS.
*         ENDIF.
        IF language NE save2_spras.
          SELECT SINGLE * FROM t687t
            WHERE spras = save2_spras
            AND   kappl = 'TX'
            AND   kvsl1 = save_ktosl.
          IF sy-subrc NE 0.
            IF language NE sy-langu.
              SELECT SINGLE * FROM t687t
                WHERE spras = sy-langu
                AND   kappl = 'TX'
                AND   kvsl1 = save_ktosl.
              IF sy-subrc NE 0.
                IF language NE 'D'.
                  SELECT SINGLE * FROM t687t
                    WHERE spras = 'D'
                    AND   kappl = 'TX'
                    AND   kvsl1 = save_ktosl.
                  IF sy-subrc NE 0.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '238'.
                    fimsg-msgv1 = 'TX'.
                    fimsg-msgv2 = save_ktosl.
                    PERFORM message_append.
                  ELSE.
                    CLEAR fimsg.
                    fimsg-msort = '    '. fimsg-msgid = 'FB'.
                    fimsg-msgty = 'I'.
                    fimsg-msgno = '239'.
                    fimsg-msgv1 = 'TX'.
                    fimsg-msgv2 = save_ktosl.
                    fimsg-msgv3 = language.
                    fimsg-msgv4 = 'D'.
                    PERFORM message_append.
                  ENDIF.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '238'.
                  fimsg-msgv1 = 'TX'.
                  fimsg-msgv2 = save_ktosl.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '239'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                fimsg-msgv3 = language.
                fimsg-msgv4 = sy-langu.
                PERFORM message_append.
              ENDIF.
            ELSE.
              IF language NE 'D'.
                SELECT SINGLE * FROM t687t
                  WHERE spras = 'D'
                  AND   kappl = 'TX'
                  AND   kvsl1 = save_ktosl.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '238'.
                  fimsg-msgv1 = 'TX'.
                  fimsg-msgv2 = save_ktosl.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '239'.
                  fimsg-msgv1 = 'TX'.
                  fimsg-msgv2 = save_ktosl.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '238'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                PERFORM message_append.
              ENDIF.
            ENDIF.
          ELSE.
            CLEAR fimsg.
            fimsg-msort = '    '. fimsg-msgid = 'FB'.
            fimsg-msgty = 'I'.
            fimsg-msgno = '239'.
            fimsg-msgv1 = 'TX'.
            fimsg-msgv2 = save_ktosl.
            fimsg-msgv3 = language.
            fimsg-msgv4 = save2_spras.
            PERFORM message_append.
          ENDIF.
        ELSE.
          IF language NE sy-langu.
            SELECT SINGLE * FROM t687t
              WHERE spras = sy-langu
              AND   kappl = 'TX'
              AND   kvsl1 = save_ktosl.
            IF sy-subrc NE 0.
              IF language NE 'D'.
                SELECT SINGLE * FROM t687t
                  WHERE spras = 'D'
                  AND   kappl = 'TX'
                  AND   kvsl1 = save_ktosl.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '238'.
                  fimsg-msgv1 = 'TX'.
                  fimsg-msgv2 = save_ktosl.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '239'.
                  fimsg-msgv1 = 'TX'.
                  fimsg-msgv2 = save_ktosl.
                  fimsg-msgv3 = language.
                  fimsg-msgv4 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '238'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '239'.
              fimsg-msgv1 = 'TX'.
              fimsg-msgv2 = save_ktosl.
              fimsg-msgv3 = language.
              fimsg-msgv4 = sy-langu.
              PERFORM message_append.
            ENDIF.
          ELSE.
            IF language NE 'D'.
              SELECT SINGLE * FROM t687t
                WHERE spras = 'D'
                AND   kappl = 'TX'
                AND   kvsl1 = save_ktosl.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '238'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '239'.
                fimsg-msgv1 = 'TX'.
                fimsg-msgv2 = save_ktosl.
                fimsg-msgv3 = language.
                fimsg-msgv4 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '238'.
              fimsg-msgv1 = 'TX'.
              fimsg-msgv2 = save_ktosl.
              PERFORM message_append.
            ENDIF.
          ENDIF.
        ENDIF.
      WHEN OTHERS.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '584'.
        PERFORM message_append.
    ENDCASE.
  ENDIF.

  save_vtext = t687t-vtext.
ENDFORM.                                                    "READ_T687T

*-----------------------------------------------------------------------
*       FORM READ_TINSO
*-----------------------------------------------------------------------
FORM read_tinso.
  SELECT SINGLE * FROM tinso
    WHERE repid = save2_repid
    AND   bukrs = save_bukrs
    AND   belnr = save_belnr
    AND   gjahr = save_gjahr
    AND   idpos = save_idpos.

*   message beim Aufrufer
ENDFORM.                    "READ_TINSO

*-----------------------------------------------------------------------
*       FORM READ_USR03
*-----------------------------------------------------------------------
FORM read_usr03.
  CLEAR usr03.                                              "USR0340A
* SELECT SINGLE * FROM USR03
*   WHERE BNAME = SAVE_USNAM.

  CALL FUNCTION 'SUSR_USER_ADDRESS_READ'
    EXPORTING
      user_name              = save_usnam
    IMPORTING
      user_address           = user_address
      user_usr03             = usr03
    EXCEPTIONS
      user_address_not_found = 1
      OTHERS                 = 2.                           "USR0340A

  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '240'.
    fimsg-msgv1 = save_usnam.
    PERFORM message_append.
  ENDIF.
ENDFORM.                                                    "READ_USR03

*-----------------------------------------------------------------------
*       FORM READ_USR03_2
*-----------------------------------------------------------------------
FORM read_usr03_2.
  CLEAR *usr03.
* SELECT SINGLE * FROM USR03 INTO *USR03
*   WHERE BNAME = SAVE_USNAM.

  CALL FUNCTION 'SUSR_USER_ADDRESS_READ'
    EXPORTING
      user_name              = save_usnam
    IMPORTING
      user_address           = user_address
      user_usr03             = *usr03
    EXCEPTIONS
      user_address_not_found = 1
      OTHERS                 = 2.                           "USR0340A

  IF sy-subrc NE 0.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '240'.
    fimsg-msgv1 = save_usnam.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_USR03_2

*-----------------------------------------------------------------------
*       FORM READ_HAUSBANK_DATEN
*-----------------------------------------------------------------------
FORM read_hausbank_daten.
  CLEAR t012.
  CLEAR t012k.
  CLEAR bnka.
  CLEAR save_bankl.

  SELECT SINGLE * FROM t012
    WHERE bukrs = save_bukrs
    AND   hbkid = save_hbkid.
  IF sy-subrc = 0.
    save2_land1 = t012-banks.
    PERFORM read_t005_2.
    IF  *t005-bnkey = '2'.
      SELECT * FROM t012k
        WHERE bukrs = save_bukrs
        AND   hbkid = save_hbkid.

        save_bankl = t012k-bankn.      "nur ein Eintrag sollte
        EXIT.                          "vorhanden sein
      ENDSELECT.
      IF sy-subrc NE 0.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '245'.
        fimsg-msgv1 = save_hbkid.
        fimsg-msgv2 = save_bukrs.
        PERFORM message_append.
      ENDIF.
    ELSE.
      save_bankl = t012-bankl.
    ENDIF.

    CALL FUNCTION 'READ_BANK_ADDRESS'
      EXPORTING
        bank_country = t012-banks
        bank_number  = save_bankl
      IMPORTING
        bnka_wa      = bnka
      EXCEPTIONS
        not_found    = 4.
    IF sy-subrc NE 0.
      CLEAR bnka.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '571'.
      fimsg-msgv1 = t012-banks.
      fimsg-msgv2 = save_bankl.
      PERFORM message_append.
    ENDIF.
  ELSE.
    CLEAR fimsg.
    fimsg-msort = '    '. fimsg-msgid = 'FB'.
    fimsg-msgty = 'I'.
    fimsg-msgno = '244'.
    fimsg-msgv1 = save_hbkid.
    fimsg-msgv2 = save_bukrs.
    PERFORM message_append.
  ENDIF.
ENDFORM.                    "READ_HAUSBANK_DATEN

*-----------------------------------------------------------------------
*       FORM READ_PARTNERBANK
*-----------------------------------------------------------------------
FORM read_partnerbank.
  CLEAR *bnka.
  CASE save_koart.
    WHEN 'D'.
      SELECT * FROM knbk
        WHERE kunnr = save_kunnr
        AND   bvtyp = save_bvtyp.

        CLEAR save_bankl.
        CLEAR save_bankn.
        CLEAR save_banks.
        save_bankl = knbk-bankl.
        save_bankn = knbk-bankn.
        save_banks = knbk-banks.
        PERFORM read_bnka_2.
        EXIT.
      ENDSELECT.
      IF sy-subrc NE 0.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '241'.
        fimsg-msgv1 = save_kunnr.
        fimsg-msgv2 = save_bvtyp.
        PERFORM message_append.
      ENDIF.
    WHEN 'K'.
      SELECT * FROM lfbk
        WHERE lifnr = save_lifnr
        AND   bvtyp = save_bvtyp.

        CLEAR save_bankl.
        CLEAR save_bankn.
        CLEAR save_banks.
        save_bankl = lfbk-bankl.
        save_bankn = lfbk-bankn.
        save_banks = lfbk-banks.
        PERFORM read_bnka_2.
        EXIT.
      ENDSELECT.
      IF sy-subrc NE 0.
        CLEAR fimsg.
        fimsg-msort = '    '. fimsg-msgid = 'FB'.
        fimsg-msgty = 'I'.
        fimsg-msgno = '242'.
        fimsg-msgv1 = save_lifnr.
        fimsg-msgv2 = save_bvtyp.
        PERFORM message_append.
      ENDIF.
    WHEN OTHERS.
      CLEAR fimsg.
      fimsg-msort = '    '. fimsg-msgid = 'FB'.
      fimsg-msgty = 'I'.
      fimsg-msgno = '243'.
      fimsg-msgv1 = save_koart.
      PERFORM message_append.
  ENDCASE.
ENDFORM.                    "READ_PARTNERBANK

*-----------------------------------------------------------------------
*       FORM READ_PREL_DOCUMENT
*-----------------------------------------------------------------------
FORM read_prel_document.
  CLEAR   hvbkpf.
  CLEAR   hvbseg.
  CLEAR   hvbsec.
  CLEAR   hvbset.
  REFRESH hvbkpf.
  REFRESH hvbseg.
  REFRESH hvbsec.
  REFRESH hvbset.

  CALL FUNCTION 'PRELIMINARY_POSTING_DOC_READ'
    EXPORTING
      belnr                   = save_belnr
      bukrs                   = save_bukrs
      gjahr                   = save_gjahr
    TABLES
      t_vbkpf                 = hvbkpf
      t_vbsec                 = hvbsec
      t_vbseg                 = hvbseg
      t_vbset                 = hvbset
    EXCEPTIONS
      document_line_not_found = 1
      document_not_found      = 2
      OTHERS                  = 3.

ENDFORM.                    "READ_PREL_DOCUMENT

*-----------------------------------------------------------------------
*       FORM READ_TAX_DATA
*-----------------------------------------------------------------------
*       Lesen der Steuerarten, Prozents#tze und Abzugsf#higkeit
*       als Steuerbasis wird hier immer 100000 ¨¹bergeben
*-----------------------------------------------------------------------
FORM read_tax_data.
  CLEAR   htax.
  REFRESH htax.
  CLEAR   mwdat.
  REFRESH mwdat.
  CLEAR save_fwnav.
  CLEAR save_fwste.
  LOOP AT tax
    WHERE bukrs = save_bukrs
    AND   mwskz = save_mwskz.
    MOVE-CORRESPONDING tax TO htax.
    APPEND htax.
  ENDLOOP.
  IF sy-subrc NE 0.
    CALL FUNCTION 'CALCULATE_TAX_FROM_NET_AMOUNT'
                                        EXPORTING i_bukrs = save_bukrs
                                                  i_mwskz = save_mwskz
*                                                 I_TXJCD = SAVE_TXJCD
                                                  i_waers = save_waers
                                                  i_wrbtr = taxbasis
                                        IMPORTING e_fwnav = save_fwnav
                                                  e_fwste = save_fwste
                                        TABLES    t_mwdat = mwdat
                                        EXCEPTIONS OTHERS = 4.
    LOOP AT mwdat.
      MOVE-CORRESPONDING mwdat TO htax.
      MOVE-CORRESPONDING mwdat TO tax.
      MOVE save_mwskz          TO htax-mwskz.
      MOVE save_mwskz          TO tax-mwskz.
      MOVE save_bukrs          TO htax-bukrs.
      MOVE save_bukrs          TO tax-bukrs.
      SELECT SINGLE * FROM t007b
        WHERE ktosl = mwdat-ktosl.
      IF sy-subrc NE 0.
        MESSAGE e224 WITH mwdat-ktosl.
      ELSE.
        MOVE t007b-stazf TO htax-stazf.
        MOVE t007b-stazf TO tax-stazf.
      ENDIF.
      APPEND htax.
      APPEND tax.
    ENDLOOP.
  ENDIF.
ENDFORM.                    "READ_TAX_DATA

*-----------------------------------------------------------------------
*       FORM READ_WECHSELVERWENDUNG_TEXT
*-----------------------------------------------------------------------
FORM read_wechselverwendung_text.
  CLEAR dd07l.
  CLEAR dd07t.
  CLEAR save_domname.
  save_domname = 'WEVWV'.
  SELECT * FROM dd07l
    WHERE domname  = save_domname
    AND   as4local = 'A'
    AND   domvalue_l = save_wevwv.

    SELECT * FROM dd07t
      WHERE ddlanguage = language
      AND   domname    = save_domname
      AND   valpos     = dd07l-valpos
      AND   as4local   = 'A'.
    ENDSELECT.
    IF sy-subrc NE 0.
      CASE flspras.
        WHEN ' '.
          IF language NE sy-langu.
            SELECT * FROM dd07t
              WHERE ddlanguage = sy-langu
              AND   domname    = save_domname
              AND   valpos     = dd07l-valpos
              AND   as4local   = 'A'.
            ENDSELECT.
            IF sy-subrc NE 0.
              IF language NE 'D'.
                SELECT * FROM dd07t
                  WHERE ddlanguage = 'D'
                  AND   domname    = save_domname
                  AND   valpos     = dd07l-valpos
                  AND   as4local   = 'A'.
                ENDSELECT.
                IF sy-subrc NE 0.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '246'.
                  fimsg-msgv1 = dd07l-valpos.
                  PERFORM message_append.
                ELSE.
                  CLEAR fimsg.
                  fimsg-msort = '    '. fimsg-msgid = 'FB'.
                  fimsg-msgty = 'I'.
                  fimsg-msgno = '247'.
                  fimsg-msgv1 = dd07l-valpos.
                  fimsg-msgv2 = language.
                  fimsg-msgv3 = 'D'.
                  PERFORM message_append.
                ENDIF.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '246'.
                fimsg-msgv1 = dd07l-valpos.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '247'.
              fimsg-msgv1 = dd07l-valpos.
              fimsg-msgv2 = language.
              fimsg-msgv3 = sy-langu.
              PERFORM message_append.
            ENDIF.
          ELSE.
            IF language NE 'D'.
              SELECT * FROM dd07t
                WHERE ddlanguage = 'D'
                AND   domname    = save_domname
                AND   valpos     = dd07l-valpos
                AND   as4local   = 'A'.
              ENDSELECT.
              IF sy-subrc NE 0.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '246'.
                fimsg-msgv1 = dd07l-valpos.
                PERFORM message_append.
              ELSE.
                CLEAR fimsg.
                fimsg-msort = '    '. fimsg-msgid = 'FB'.
                fimsg-msgty = 'I'.
                fimsg-msgno = '247'.
                fimsg-msgv1 = dd07l-valpos.
                fimsg-msgv2 = language.
                fimsg-msgv3 = 'D'.
                PERFORM message_append.
              ENDIF.
            ELSE.
              CLEAR fimsg.
              fimsg-msort = '    '. fimsg-msgid = 'FB'.
              fimsg-msgty = 'I'.
              fimsg-msgno = '246'.
              fimsg-msgv1 = dd07l-valpos.
              PERFORM message_append.
            ENDIF.
          ENDIF.
        WHEN OTHERS.
          CLEAR fimsg.
          fimsg-msort = '    '. fimsg-msgid = 'FB'.
          fimsg-msgty = 'I'.
          fimsg-msgno = '584'.
          PERFORM message_append.
      ENDCASE.
    ENDIF.
  ENDSELECT.
  IF sy-subrc NE 0.                                         "DD07L
*   message
  ENDIF.
ENDFORM.                    "READ_WECHSELVERWENDUNG_TEXT

*-----------------------------------------------------------------------
*       FORM READ_ZAHLUNGS_BSCHL
*-----------------------------------------------------------------------
*       Lesen der Buchungsschl¨¹ssel f¨¹r Ein- und Auszahlungen
*-----------------------------------------------------------------------
FORM read_zahlungs_bschl.
  SELECT SINGLE * FROM t041a
    WHERE auglv = 'AUSGZAHL'.
  MOVE  t041a-bskso TO auszbsk.
  MOVE  t041a-bsdso TO auszbsd.
  IF sy-subrc NE 0.
    MESSAGE e248 WITH 'AUSGZAHL'.
  ENDIF.

  SELECT SINGLE * FROM t041a
    WHERE auglv = 'EINGZAHL'.
  MOVE  t041a-bsdha TO einzbsd.
  MOVE  t041a-bskha TO einzbsk.
  IF sy-subrc NE 0.
    MESSAGE e248 WITH 'EINGZAHL'.
  ENDIF.
ENDFORM.                    "READ_ZAHLUNGS_BSCHL

*-----------------------------------------------------------------------
*       FORM TAX_PERCENT_AND_TEXT
*-----------------------------------------------------------------------
FORM tax_percent_and_text.
  CLEAR   atax.
  REFRESH atax.

  LOOP AT htax
    WHERE bukrs = save_bukrs
    AND   mwskz = save_mwskz.

    save_ktosl = htax-ktosl.

    PERFORM read_t687t.

    atax-msatz = htax-msatz.
    atax-vtext = save_vtext.
    APPEND atax.
  ENDLOOP.
ENDFORM.                    "TAX_PERCENT_AND_TEXT

*-----------------------------------------------------------------------
*       FORM FILL_HBSEG
*-----------------------------------------------------------------------
FORM fill_hbseg.
  CLEAR   hbseg.
  REFRESH hbseg.
  LOOP AT hextract.
    save2_bukrs = hextract-bukrs.
    save2_belnr = hextract-belnr.
    save2_gjahr = hextract-gjahr.
    save2_buzei = hextract-buzei.
    PERFORM read_bseg_2.
    MOVE-CORRESPONDING bseg TO hbseg.
    APPEND hbseg.
    IF NOT hbseg-xcpdd IS INITIAL.
      save_bukrs = hextract-bukrs.
      save_belnr = hextract-belnr.
      save_gjahr = hextract-gjahr.
      save_buzei = hextract-buzei.
      PERFORM read_bsec.
      MOVE-CORRESPONDING bsec TO hbsec.
      APPEND hbsec.
    ENDIF.
  ENDLOOP.
ENDFORM.                    "FILL_HBSEG

*-----------------------------------------------------------------------
*       FORM PRUEFEN_BVORG
*-----------------------------------------------------------------------
FORM pruefen_bvorg.
  CLEAR xbvorg.
  CLEAR save_bvorg.
  IF NOT hbkpf-bvorg IS INITIAL.
    xbvorg = 'X'.
    save_bvorg = hbkpf-bvorg.
    PERFORM read_bvor.
  ENDIF.
ENDFORM.                    "PRUEFEN_BVORG

*-----------------------------------------------------------------------
*       FORM RESTORE_BSEG
*-----------------------------------------------------------------------
FORM restore_bseg.
  CLEAR   hbseg.
  REFRESH hbseg.
  hbseg[] = save_bseg[].
ENDFORM.                    "RESTORE_BSEG

*-----------------------------------------------------------------------
*       FORM SAVE_BSEG
*-----------------------------------------------------------------------
FORM save_bseg.
  CLEAR   save_bseg.
  REFRESH save_bseg.
  LOOP AT hbseg.
    MOVE-CORRESPONDING hbseg TO save_bseg.
    APPEND save_bseg.
  ENDLOOP.
ENDFORM.                    "SAVE_BSEG
