*&---------------------------------------------------------------------*
*& Report  YSE_FI_CNYNREP
* PROGRAM TITLE : New OR&OI Detail report for CT China                 *
* AUTHOR        : Anda Wu                                              *
* DATE          : 12/09/2013                                           *
* DEVELOPMENT ID:                                                      *
*                                                                      *
* CHANGE REQUEST NUMBER:                                               *
*                                                                      *
* Program Description: China-MR:Legal requirements:Financial Report    *
*                      of Yunnan branch                                *
*&---------------------------------------------------------------------*
* CHANGE HISTORY LOG                                                   *
*----------------------------------------------------------------------*
*  DATE    | NAME     |TRANSPORT  | CR# and short Description          *
*----------------------------------------------------------------------*
*26/09/2013|Anda Wu   |CD1K975666 |CR2983: Initial version             *
*----------------------------------------------------------------------*

REPORT  yse_fi_cnynrep_back_130923 MESSAGE-ID ab.
************************************************************************
* TYPE SPOOLS                                                          *
************************************************************************
TYPE-POOLS slis.

************************************************************************
* TABLES                                                               *
************************************************************************
TABLES:   anlz,
          vbrk,
          bsad,
          bsak,
          rfsdo.
********************For LDB     ****************************************
NODES: anla0,               " Einstiegstabelle log.Datenbank ADA
       anlav,               " Anlagenreporting: ANLA-Felder + Kst...
       anlb,                           " Abschreibungsparameter
       anek,                           " Belegkopf Anlagenbuchung
       anepv,               " Anlagen-Einzelposten (ANEP + ANEA + ANEK)
       anlcv.               " Anlagenreporting: ANLC-Felder + Summen
INCLUDE rasort_alv04.
INCLUDE rasort_alv_data_fieldcat.
FIELD-GROUPS: header.
********************For LDB     ****************************************
************************************************************************
* TYPES                                                                *
************************************************************************
TYPES:
  BEGIN OF ty_alv_output,
    line          TYPE yse_fi_cnynrep-line,
    ltext         TYPE yse_fi_cnynrep_t-ltext,
    item          TYPE yse_fi_cnynrep-item,
    saknr(10)     TYPE c,
    txt20         TYPE skat-txt20,
    dtres         TYPE yse_fi_cnynrep-dtres,
    r_amount      TYPE faglflext-hsl01,
    c_amount      TYPE faglflext-hsl01,
    diff          TYPE faglflext-hsl01,
  END OF ty_alv_output,

  BEGIN OF ty_k810032,
    gjahr         TYPE k810032-gjahr,
    perde         TYPE k810032-perde,
    vrgar         TYPE k810032-vrgar,
    vv100         TYPE k810032-vv100,
    vv130         TYPE k810032-vv130,
    vv200         TYPE k810032-vv200,
    vv300         TYPE k810032-vv300,
    vv400         TYPE k810032-vv400,
    vv500         TYPE k810032-vv500,
    vv600         TYPE k810032-vv600,
  END OF ty_k810032,

  BEGIN OF ty_fi_cnynrep,
    line          TYPE yse_fi_cnynrep-line,
    item          TYPE yse_fi_cnynrep-item,
    saknr         TYPE yse_fi_cnynrep-saknr,
    dtres         TYPE yse_fi_cnynrep-dtres,
    ltext         TYPE yse_fi_cnynrep_t-ltext,
  END OF ty_fi_cnynrep,

  BEGIN OF ty_bkpf,
    bukrs         TYPE bkpf-bukrs,
    belnr         TYPE bkpf-belnr,
    gjahr         TYPE bkpf-gjahr,
    monat         TYPE bkpf-monat,
    bktxt         TYPE bkpf-bktxt,
    xreversal     TYPE bkpf-xreversal,
  END OF ty_bkpf,

  BEGIN OF ty_bsad,
    bukrs         TYPE bsad-bukrs,
    belnr         TYPE bsad-belnr,
    gjahr         TYPE bsad-gjahr,
    kunnr         TYPE bsad-kunnr,
    hkont         TYPE bsad-hkont,
    augdt         TYPE bsad-augdt,
    budat         TYPE bsad-budat,
    shkzg         TYPE bsad-shkzg,
    dmbtr         TYPE bsad-dmbtr,
    vbeln         TYPE bsad-vbeln,
    bzirk         TYPE vbrk-bzirk,
  END OF ty_bsad,

  BEGIN OF ty_bsas,
    bukrs         TYPE bsas-bukrs,
    belnr         TYPE bsas-belnr,
    gjahr         TYPE bsas-gjahr,
    hkont         TYPE bsas-hkont,
    augdt         TYPE bsas-augdt,
    budat         TYPE bsas-budat,
    zuonr         TYPE bsas-zuonr,
    shkzg         TYPE bsas-shkzg,
    dmbtr         TYPE bsas-dmbtr,
  END OF ty_bsas,

  BEGIN OF ty_bsak,
    bukrs         TYPE bsak-bukrs,
    belnr         TYPE bsak-belnr,
    gjahr         TYPE bsak-gjahr,
    lifnr         TYPE bsak-lifnr,
    hkont         TYPE bsak-hkont,
    augdt         TYPE bsak-augdt,
    budat         TYPE bsak-budat,
    shkzg         TYPE bsak-shkzg,
    dmbtr         TYPE bsak-dmbtr,
  END OF ty_bsak,

  BEGIN OF ty_faglflext,
    ryear         TYPE faglflext-ryear,
    rldnr         TYPE faglflext-rldnr,
    racct         TYPE faglflext-racct,
    rbukrs        TYPE faglflext-rbukrs,
    rcntr         TYPE faglflext-rcntr,
    hslvt         TYPE faglflext-hslvt,
    hsl01         TYPE faglflext-hsl01,
    hsl02         TYPE faglflext-hsl01,
    hsl03         TYPE faglflext-hsl01,
    hsl04         TYPE faglflext-hsl01,
    hsl05         TYPE faglflext-hsl01,
    hsl06         TYPE faglflext-hsl01,
    hsl07         TYPE faglflext-hsl01,
    hsl08         TYPE faglflext-hsl01,
    hsl09         TYPE faglflext-hsl01,
    hsl10         TYPE faglflext-hsl01,
    hsl11         TYPE faglflext-hsl01,
    hsl12         TYPE faglflext-hsl01,
    hsl13         TYPE faglflext-hsl01,
    hsl14         TYPE faglflext-hsl01,
    hsl15         TYPE faglflext-hsl01,
    hsl16         TYPE faglflext-hsl01,
  END OF ty_faglflext,

  BEGIN OF ty_vbak,
    vbeln             TYPE vbak-vbeln,            "Sales Document
    erdat             TYPE vbak-erdat,            "Record Create Date
    vkorg             TYPE vbak-vkorg,            "Sales Org.
    vkbur             TYPE vbak-vkbur,            "Sales Office
    bstnk             TYPE vbak-bstnk,            "Customer PO
    kunnr             TYPE vbak-kunnr,            "Sold-to party
  END OF ty_vbak,

  BEGIN OF ty_acc_sum,
    hkont         TYPE bsas-hkont,
    sum_rept      TYPE faglflext-hsl01,
    sum_comp      TYPE faglflext-hsl01,
  END OF ty_acc_sum.

************************************************************************
* INTERNAL TABLES                                                      *
************************************************************************
DATA:
  gt_k810032          TYPE STANDARD TABLE OF ty_k810032,
  gt_fi_cnynrep       TYPE STANDARD TABLE OF ty_fi_cnynrep,
  gt_alv_output       TYPE STANDARD TABLE OF ty_alv_output,
  gt_acc_sum          TYPE STANDARD TABLE OF ty_acc_sum,
  gt_bsad             TYPE STANDARD TABLE OF ty_bsad,
  gt_bsas             TYPE STANDARD TABLE OF ty_bsas,
  gt_bsak             TYPE STANDARD TABLE OF ty_bsak,
  gt_bkpf             TYPE STANDARD TABLE OF ty_bkpf,
  gt_faglflext        TYPE STANDARD TABLE OF ty_faglflext,
  gt_fieldcat         TYPE slis_t_fieldcat_alv,
  gt_kostl            TYPE RANGE OF csks-kostl.

************************************************************************
* WORKAREAS                                                            *
************************************************************************
DATA:
  gs_disvar           TYPE disvariant,
  gs_alv_output       TYPE ty_alv_output,
  gs_fi_cnynrep       TYPE ty_fi_cnynrep,
  gs_acc_sum          TYPE ty_acc_sum,
  gs_layout           TYPE slis_layout_alv.

************************************************************************
* VARIABLES                                                            *
************************************************************************
DATA:
  gv_text             TYPE string,
  gv_save             TYPE c,
  gv_lastday          TYPE bsad-budat,
  gv_lastday_2        TYPE bsad-budat,
  gv_callback         TYPE slis_formname.

************************************************************************
* CONSTANTS                                                            *
************************************************************************
CONSTANTS:
  gc_x                TYPE c VALUE 'X',
  gc_type_e           TYPE c VALUE 'E',
  gc_ktopl_scoa       TYPE t095-ktopl VALUE 'SCOA',
  gc_afabe_01         TYPE t095-afabe VALUE '01',
  gc_sortbkrs         TYPE bukrs VALUE 'SHTA',
  gc_callback_routine TYPE slis_formname VALUE 'USER_COMMAND'.

**************For LDB**************************************************
TYPES:
  BEGIN OF ty_apc_dep,
    ktansw            TYPE t095-ktansw,
    apc_amount        TYPE faglflext-hsl01,
    dep_amount        TYPE faglflext-hsl01,
    ktnafb            TYPE t095b-ktnafb,
  END OF ty_apc_dep.

DATA:
*     Anzahl der im Anforderungsbild erlaubten AfA-Bereiche.
      sav_anzbe(1) TYPE c VALUE '1',
*     Flag: Postenausgabe Ja='1'/Nein='0'.
      flg_postx(1) TYPE c VALUE '0',
*     Summenbericht: Maximale Anzahl Wertfelder/Zeile.
      con_wrtzl(2) TYPE p VALUE 3.

* Ausgabe-Wertfelder.
DATA: BEGIN OF x,
*       Kumulierter Anschaffungswert einschliesslich Inv-Zus und Aufw.
        kansw       LIKE anlcv-answ_gje,
*       Kumulierte Gesamt-AfA einschliesslich Aufw N-AfA.
        kumafa      LIKE rarep-kumafa,
*       Restbuchwert einschliesslich Inv-Zus und Aufw.
        bchwrt      LIKE anlcv-bchwrt_gje,
      END OF x.


DATA: itab_data LIKE fiaa_salvtab_rabest OCCURS 10 WITH HEADER LINE,
      gt_apc_dep TYPE STANDARD TABLE OF ty_apc_dep.
**************For LDB**************************************************

************************************************************************
* SELECTION-SCREEN                                                     *
************************************************************************
SELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE text-t01 .

SELECT-OPTIONS: s_kostl  FOR anlz-kostl
                    DEFAULT '152810' OBLIGATORY MODIF ID m1,
                s_bzirk  FOR vbrk-bzirk
                    DEFAULT 'CN0028' OBLIGATORY MODIF ID m1,
                s_kunnr  FOR bsad-kunnr MODIF ID m1,
                s_lifnr  FOR bsak-lifnr MODIF ID m1.
PARAMETERS:     bilbjahr TYPE bkpf-gjahr  OBLIGATORY MODIF ID m1.
SELECT-OPTIONS: b_monate FOR  rfsdo-bilabmon NO-EXTENSION
                               OBLIGATORY MODIF ID m1.
PARAMETERS:     bilvjahr TYPE bkpf-gjahr
                               OBLIGATORY MODIF ID m1.
SELECT-OPTIONS: v_monate FOR  rfsdo-bilavmon NO-EXTENSION
                               OBLIGATORY MODIF ID m1 .
PARAMETERS:     p_date   TYPE rbada-brdatu MODIF ID m1.
SELECTION-SCREEN END OF BLOCK b1.

**************For LDB**************************************************
SELECT-OPTIONS: so_deakt FOR anlav-deakt DEFAULT '18000101'
                                              TO '18000101'
                                         SIGN     E
                                         OPTION   BT
                                         NO-DISPLAY.
SELECT-OPTIONS:
*                 Anlagenbestandkonto.
                so_ktanw FOR anlav-ktansw NO DATABASE SELECTION,
*                 Aktivierungsdatum.
                so_aktiv FOR anlav-aktiv,
*                 Aktueller Anschaffungswert.
                so_kansw FOR x-kansw,
*                 Kumulierte gesamte AfA.
                so_kumaf FOR x-kumafa,
*                 Aktueller Buchwert.
                so_bchwr FOR x-bchwrt.
PARAMETERS:
* Gitterversion.
          pa_xgbaf LIKE anla0-xgbaf.
PARAMETERS:
          pa_titel LIKE rarep-titel DEFAULT space,
          pa_mikro LIKE bhdgd-miffl.
**************For LDB**************************************************

PARAMETERS: p_flag AS CHECKBOX, " Dynamic summarize
            p_ldb  AS CHECKBOX DEFAULT 'X' MODIF ID m1.
                                  " Use ldb to gain FA data

*&---------------------------------------------------------------------*
*& INITIALIZATION                                                      *
*&---------------------------------------------------------------------*
INITIALIZATION.
* Do initilization
  PERFORM frm_init.

*&---------------------------------------------------------------------*
*& AT SELECTION-SCREEN OUTPUT                                          *
*&---------------------------------------------------------------------*
AT SELECTION-SCREEN OUTPUT.
* screen initial set
  PERFORM frm_screen_set.

AT SELECTION-SCREEN ON b_monate.
  CALL FUNCTION 'BUILD_DEFAULT_PERIOD'
    EXPORTING
      i_use_msgty = 'E'
    TABLES
      xmonat      = b_monate.

* Pruefen Vergleichsperioden
* --------------------------
AT SELECTION-SCREEN ON v_monate.
  CALL FUNCTION 'BUILD_DEFAULT_PERIOD'
    EXPORTING
      i_use_msgty = 'E'
    TABLES
      xmonat      = v_monate.

AT SELECTION-SCREEN ON p_date.
  berdatum = p_date.

AT SELECTION-SCREEN ON s_kostl.
  REFRESH:   so_kostl.
  APPEND LINES OF s_kostl TO so_kostl.

* Allgemeine Verarbeitung der PA/SO-Eingaben.
  INCLUDE rasort_alv08.

*&---------------------------------------------------------------------*
*& START-OF-SELECTION                                                  *
*&---------------------------------------------------------------------*
START-OF-SELECTION.
**************For LDB**************************************************
* Titel #ndern bei gebuchter Abschreibung
  IF sy-tcode <> 'AR32'.
    IF NOT pa_xgbaf IS INITIAL.
      SET TITLEBAR 'POS' OF PROGRAM 'SAPLAREP'.
    ENDIF.
  ENDIF.

* Sichern der Selektionsoptionen bzw. Einlesen der Sortierwerte bei
* PickUp.
  PERFORM info_pick_up.

* Bestimmung des Sortierfeldes auf unterster Gruppenstufe.
  ASSIGN sav_dummy TO <b>.
* Bestimmung des Sortierfeldes fuer Gitterposition oder Einzelposten.
  ASSIGN sav_dummy TO <p>.
  ASSIGN sav_dummy TO <q>.

* Allgemeines Coding nach START-OF-SELECTION.
  INCLUDE rasort_alv10.

* Steuerungskennzeichen f¨¹r LDB setzen
   *anla0-xgbaf = pa_xgbaf.

* Setzen der UserStrukturen f¨¹r die log. Datenbank
* (2 St¨¹ck - f¨¹r Header und Item Tabelle)
   *anla0-selfield_structure1 = 'CI_REPRABEST'.
   *anla0-selfield_structure2 = ''.

GET anla0.
* Angabe der NICHT-KEY-Felder aus der Datenbank
GET anlav FIELDS aktiv  ktogr  txt50
             txa50  zugdt  deakt  xanlgr.

  CHECK SELECT-OPTIONS.

* sollte Folgendes nicht lieber in die logische DB?
* Nur Anlagen seleketieren, die aktiviert wurden ...
  CHECK NOT anlav-zugdt IS INITIAL.
* ... und zwar vor dem Berichtsdatum.
  CHECK     anlav-zugdt LE berdatum.

* Verarbeitungen ON CHANGE OF ANLAV-XXXXX.
  INCLUDE rasort14.

* Im VJ deaktivierte Anlagen nicht selektieren.
  IF NOT anlav-deakt IS INITIAL.
    CHECK anlav-deakt GE sav_gjbeg.
* Zeitpunktbezogene Liste -- alle deaktivierten vor dem Berichtsdatum
* nicht selektieren
    IF pa_xgbaf IS INITIAL.
      IF berdatum NE sav_gjbeg.
        CHECK anlav-deakt GT berdatum.
      ELSE.
* Falls Berichtsdatum = Jahresbeginn m¨¹ssen auch am 01.01 deaktivierte
* reinflie#en
        CHECK anlav-deakt GE berdatum.
      ENDIF.
    ENDIF.
  ENDIF.

  ON CHANGE OF anlav-bukrs.
*   Individueller Teil des Headers
    WRITE: '-'       TO head-info1,
           bereich1  TO head-info2,
           sav_afbe1 TO head-info3.
*
    CONDENSE head.
  ENDON.

* keine Bereichsdaten erforderlich
GET anlb FIELDS anln1.

GET anlcv.


* Kumulierter Anschaffungswert einschliesslich Inv-Zus und Aufw.
  x-kansw     = anlcv-answ_gje.
* Kumulierte Gesamt-AfA als Differenz.
  x-kumafa    = anlcv-afa_gje.         " x-bchwrt - x-kansw.
* Buchwert GJ-Ende.
  x-bchwrt    = anlcv-bchwrt_gje.

  CHECK x-kansw  IN so_kansw.
  CHECK x-kumafa IN so_kumaf.
  CHECK x-bchwrt IN so_bchwr.
*

* Daten gegen Sortierwerte beim PickUp checken.
  PERFORM sort_check.

  CLEAR itab_data.
  PERFORM sort_felder_vorbereiten.

  MOVE-CORRESPONDING anlb TO itab_data.                     "no 456965
  MOVE-CORRESPONDING anlav TO itab_data.

* Die 3 Wertfelder zur Ausgabe
  itab_data-btr1     = x-kansw.
  itab_data-btr2     = x-kumafa.
  itab_data-btr3     = x-bchwrt.

* Die W#hrung zur Ausgabe
  itab_data-waers = sav_waer1.
* Alles in der Tabelle ist ausw#hlbar!
  itab_data-flg_pick_up = 'X'.
* Alle Eintr#ge in der ersten Stufe
  itab_data-range = 1.
* Die Datenzeilen sind immer in der vollen Sortierung
  itab_data-hlp_level = con_srtst.     " == Anzahl Summenstufen

* Bestand f¨¹r Summenbericht aufbereiten
  IF summb NE space.
    PERFORM hashsum_collection USING itab_data.
  ELSE.
*   ITAB_DATA nur dann aufbauen, wenn KEIN Summenbericht
    APPEND itab_data.
  ENDIF.

  PERFORM store_errors.                                     "> 1002552
**************For LDB**************************************************

*&---------------------------------------------------------------------*
*& END-OF-SELECTION                                                    *
*&---------------------------------------------------------------------*
END-OF-SELECTION.
**************For LDB**************************************************
  PERFORM frm_ldb_endproc.
**************For LDB**************************************************
* get data
  PERFORM get_alv_data.
* alv property set
  PERFORM alv_prop_set.
* ALV display
  PERFORM alv_display.
*&---------------------------------------------------------------------*
*&      Form  FRM_INIT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM frm_init .
  CALL FUNCTION 'GET_CURRENT_YEAR'
    EXPORTING
      bukrs = gc_sortbkrs
    IMPORTING
      curry = bilbjahr
      prevy = bilvjahr.

  IF bilbjahr IS INITIAL.
    bilbjahr = sy-datum(4).
    bilvjahr = bilbjahr - 1.
  ENDIF.

* Vorschlagswerte Berichtsperioden
* --------------------------------
  CALL FUNCTION 'BUILD_DEFAULT_PERIOD'
    EXPORTING
      i_use_msgty = 'E'
    TABLES
      xmonat      = b_monate.

* Vorschlagswerte Vergleichsperioden
* ----------------------------------
  CALL FUNCTION 'BUILD_DEFAULT_PERIOD'
    EXPORTING
      i_use_msgty = 'E'
    TABLES
      xmonat      = v_monate.

  CALL FUNCTION 'LAST_DAY_OF_MONTHS'
    EXPORTING
      day_in            = sy-datum
    IMPORTING
      last_day_of_month = p_date
    EXCEPTIONS
      day_in_no_date    = 1
      OTHERS            = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

***************For LDB*************************************************
* Titel setzen bei Workflow.
  IF sy-tcode = 'AR32'.                " Erzeugen Arbeitsvorrat
    SET TITLEBAR '004' OF PROGRAM 'SAPLAREP'.
  ENDIF.

* Sortiervariante vorschlagen.
  MOVE: '0001' TO srtvr.
* ALV Grid NICHT als Standard vorschlagen
*  MOVE: ' '    TO p_grid.

* Report wird nicht von au#en aufgerufen. Lesen der PickUp-Informationen
* aus dem Memory d.h. der urspr¨¹nglich eingegebenen Programmabgrenzungen
  IMPORT flg_not_first FROM MEMORY ID 'flg'.

* Bei Gebuchtwerten auch deaktive Anlagen anzeigen
  IF NOT pa_xgbaf IS INITIAL.
    REFRESH so_deakt.
  ENDIF.

***************For LDB*************************************************
ENDFORM.                    " FRM_INIT
*&---------------------------------------------------------------------*
*&      Form  GET_ALV_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_alv_data .
  PERFORM get_last_day.
  PERFORM get_acc_assignment.
  PERFORM get_accout_10.
  PERFORM get_accout_11.
  PERFORM get_accout_12.
  PERFORM get_accout_20.
  PERFORM get_accout_30.
  PERFORM get_accout_40.
  PERFORM get_accout_41.
  PERFORM get_accout_42.
  PERFORM get_accout_43.
  IF NOT p_ldb IS  INITIAL.
    PERFORM get_accout_50_51_2.
  ELSE.
    PERFORM get_accout_50_51.
  ENDIF.

  PERFORM generate_alvdata.

ENDFORM.                    " GET_ALV_DATA
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_10
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_10 .

  DATA: ls_k810032      TYPE ty_k810032,
        lv_3210901      TYPE faglflext-hsl01,
        lv_4010002      TYPE faglflext-hsl01,
        lv_4210901      TYPE faglflext-hsl01,
        lv_3210901_2    TYPE faglflext-hsl01,
        lv_4010002_2    TYPE faglflext-hsl01,
        lv_4210901_2    TYPE faglflext-hsl01.

  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 10'(026).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 5
        text       = gv_text.
  ENDIF.

  REFRESH: gt_k810032.
  SELECT  gjahr
          perde
          vrgar
          vv100
          vv130
          vv200
          vv300
          vv400
          vv500
          vv600
    FROM  k810032
    INTO TABLE gt_k810032
    WHERE gjahr = bilbjahr
      AND perde IN b_monate
      AND (    vrgar = '3'
            OR vrgar = 'B'
            OR vrgar = 'C'
            OR vrgar = 'D'
            OR vrgar = 'F' ).
  IF sy-subrc = 0.
    IF p_flag IS INITIAL.
      LOOP AT gt_k810032 INTO ls_k810032.
        lv_3210901 =  ls_k810032-vv100 + lv_3210901.
        lv_4010002 =  ls_k810032-vv130 + lv_4010002.
        lv_4210901 =  ls_k810032-vv200 +
                      ls_k810032-vv300 +
                      ls_k810032-vv400 +
                      ls_k810032-vv500 +
                      ls_k810032-vv600 +
                      lv_4210901.
      ENDLOOP.
    ELSE.
      LOOP AT gt_k810032 INTO ls_k810032.
        CLEAR gs_acc_sum.
        gs_acc_sum-hkont    = '0003210901'.
        gs_acc_sum-sum_rept = ls_k810032-vv100.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
        gs_acc_sum-hkont    = '0004010002'.
        gs_acc_sum-sum_rept = ls_k810032-vv130.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        gs_acc_sum-hkont    = '0004210901'.
        gs_acc_sum-sum_rept =   ls_k810032-vv200 +
                                ls_k810032-vv300 +
                                ls_k810032-vv400 +
                                ls_k810032-vv500 +
                                ls_k810032-vv600.
        COLLECT gs_acc_sum INTO gt_acc_sum.
      ENDLOOP.
    ENDIF.
  ENDIF.

  REFRESH: gt_k810032.

  SELECT  gjahr
          perde
          vrgar
          vv100
          vv130
          vv200
          vv300
          vv400
          vv500
          vv600
    FROM  k810032
    INTO TABLE gt_k810032
    WHERE gjahr = bilvjahr
      AND perde IN v_monate
      AND (    vrgar = '3'
            OR vrgar = 'B'
            OR vrgar = 'C'
            OR vrgar = 'D'
            OR vrgar = 'F' ).
  IF sy-subrc = 0.
    IF p_flag IS INITIAL.
      LOOP AT gt_k810032 INTO ls_k810032.
        lv_3210901_2 =  ls_k810032-vv100 + lv_3210901_2.
        lv_4010002_2 =  ls_k810032-vv130 + lv_4010002_2.
        lv_4210901_2 =  ls_k810032-vv200 +
                      ls_k810032-vv300 +
                      ls_k810032-vv400 +
                      ls_k810032-vv500 +
                      ls_k810032-vv600 +
                      lv_4210901_2.
      ENDLOOP.
    ELSE.
      LOOP AT gt_k810032 INTO ls_k810032.
        CLEAR gs_acc_sum.
        gs_acc_sum-hkont    = '0003210901'.
        gs_acc_sum-sum_comp = ls_k810032-vv100.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
        gs_acc_sum-hkont    = '0004010002'.
        gs_acc_sum-sum_comp = ls_k810032-vv130.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        gs_acc_sum-hkont    = '0004210901'.
        gs_acc_sum-sum_comp =   ls_k810032-vv200 +
                                ls_k810032-vv300 +
                                ls_k810032-vv400 +
                                ls_k810032-vv500 +
                                ls_k810032-vv600.
        COLLECT gs_acc_sum INTO gt_acc_sum.
      ENDLOOP.
    ENDIF.
  ENDIF.

  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '10'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0003210901'.
          gs_alv_output-r_amount = lv_3210901.
          gs_alv_output-c_amount = lv_3210901_2.
          gs_alv_output-diff     = lv_3210901 - lv_3210901_2.
        WHEN '0004010002'.
          gs_alv_output-r_amount = lv_4010002.
          gs_alv_output-c_amount = lv_4010002_2.
          gs_alv_output-diff     = lv_4010002 - lv_4010002_2.
        WHEN '0004210901'.
          gs_alv_output-r_amount = lv_4210901.
          gs_alv_output-c_amount = lv_4210901_2.
          gs_alv_output-diff     = lv_4210901 - lv_4210901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
ENDFORM.                    " GET_ACCOUT_10
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_11
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_11 .

  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_bsad         TYPE ty_bsad,
        lv_1511901      TYPE faglflext-hsl01,
        lv_1511901_2    TYPE faglflext-hsl01.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 11'(036).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 10
        text       = gv_text.
  ENDIF.
  REFRESH: gt_bsad.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '11'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.

  SELECT      bsad~bukrs
              bsad~belnr
              bsad~gjahr
              bsad~kunnr
              bsad~hkont
              bsad~augdt
              bsad~budat
              bsad~shkzg
              bsad~dmbtr
              bsad~vbeln
              vbrk~bzirk
    FROM bsad
    INNER JOIN vbrk
    ON bsad~vbeln  = vbrk~vbeln
    INTO TABLE gt_bsad
    WHERE bsad~bukrs = gc_sortbkrs
      AND bsad~kunnr IN s_kunnr
      AND bsad~hkont IN lt_range_hkont
      AND bsad~augdt > gv_lastday
      AND bsad~budat <= gv_lastday
      AND vbrk~bzirk IN s_bzirk
      AND vbrk~vkorg = 'CN02'.

  SELECT      bsid~bukrs
              bsid~belnr
              bsid~gjahr
              bsid~kunnr
              bsid~hkont
              bsid~augdt
              bsid~budat
              bsid~shkzg
              bsid~dmbtr
              bsid~vbeln
              vbrk~bzirk
    FROM bsid
    INNER JOIN vbrk
    ON bsid~vbeln  = vbrk~vbeln
    APPENDING table gt_bsad
    WHERE bsid~bukrs = gc_sortbkrs
      AND bsid~kunnr IN s_kunnr
      AND bsid~hkont IN lt_range_hkont
      AND bsid~budat <= gv_lastday
      AND vbrk~bzirk IN s_bzirk.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsad INTO ls_bsad .
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      lv_1511901 = ls_bsad-dmbtr + lv_1511901.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsad BY hkont.
    LOOP AT gt_bsad INTO ls_bsad.
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      gs_acc_sum-sum_rept = ls_bsad-dmbtr + gs_acc_sum-sum_rept.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsad-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_bsad.

  SELECT      bsad~bukrs
              bsad~belnr
              bsad~gjahr
              bsad~kunnr
              bsad~hkont
              bsad~augdt
              bsad~budat
              bsad~shkzg
              bsad~dmbtr
              bsad~vbeln
              vbrk~bzirk
    FROM bsad
    INNER JOIN vbrk
    ON bsad~vbeln  = vbrk~vbeln
    INTO TABLE gt_bsad
    WHERE bsad~bukrs = gc_sortbkrs
      AND bsad~kunnr IN s_kunnr
      AND bsad~hkont IN lt_range_hkont
      AND bsad~augdt > gv_lastday_2
      AND bsad~budat <= gv_lastday_2
      AND vbrk~bzirk IN s_bzirk.

  SELECT      bsid~bukrs
              bsid~belnr
              bsid~gjahr
              bsid~kunnr
              bsid~hkont
              bsid~augdt
              bsid~budat
              bsid~shkzg
              bsid~dmbtr
              bsid~vbeln
              vbrk~bzirk
    FROM bsid
    INNER JOIN vbrk
    ON bsid~vbeln  = vbrk~vbeln
    APPENDING table gt_bsad
    WHERE bsid~bukrs = gc_sortbkrs
      AND bsid~kunnr IN s_kunnr
      AND bsid~hkont IN lt_range_hkont
      AND bsid~budat <= gv_lastday_2
      AND vbrk~bzirk IN s_bzirk.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsad INTO ls_bsad .
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      lv_1511901_2 = ls_bsad-dmbtr + lv_1511901_2.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsad BY hkont.
    LOOP AT gt_bsad INTO ls_bsad.
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      gs_acc_sum-sum_comp = ls_bsad-dmbtr + gs_acc_sum-sum_comp.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsad-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '11'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001511901'.
          gs_alv_output-r_amount = lv_1511901.
          gs_alv_output-c_amount = lv_1511901_2.
          gs_alv_output-diff     = lv_1511901 - lv_1511901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_bsad.
ENDFORM.                    " GET_ACCOUT_11
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_12
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_12 .
  TYPES:  BEGIN OF lty_vbkd,
            vbeln   TYPE vbkd-vbeln,
            posnr   TYPE vbkd-posnr,
            bzirk   TYPE vbkd-bzirk,
          END OF lty_vbkd.

  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_bsas         TYPE ty_bsas,
        ls_vbkd         TYPE lty_vbkd,
        lv_vbeln        TYPE vbkd-vbeln,
        lv_posnr        TYPE vbkd-posnr,
        lv_1441901      TYPE faglflext-hsl01,
        lv_1441901_2    TYPE faglflext-hsl01,
        lv_1441902      TYPE faglflext-hsl01,
        lv_1441902_2    TYPE faglflext-hsl01,
        lv_1441903      TYPE faglflext-hsl01,
        lv_1441903_2    TYPE faglflext-hsl01.

  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 12'(046).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 20
        text       = gv_text.
  ENDIF.

  REFRESH: gt_bsas.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '12'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.
  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsas
    INTO TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday
      AND budat <= gv_lastday.

  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsis
    APPENDING TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SPLIT ls_bsas-zuonr AT '/'  INTO lv_vbeln lv_posnr.
      SELECT SINGLE  vbeln
                     posnr
                     bzirk
        FROM vbkd
        INTO ls_vbkd
        WHERE vbeln = lv_vbeln
          AND posnr = lv_posnr
          AND bzirk IN s_bzirk.
      IF sy-subrc = 0.
        CASE ls_bsas-hkont.
          WHEN '0001441901'.
            lv_1441901 = lv_1441901 + ls_bsas-dmbtr.
          WHEN '0001441902'.
            lv_1441902 = lv_1441902 + ls_bsas-dmbtr.
          WHEN '0001441903'.
            lv_1441903 = lv_1441903 + ls_bsas-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsas BY hkont.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SPLIT ls_bsas-zuonr AT '/'  INTO lv_vbeln lv_posnr.
      SELECT SINGLE  vbeln
                     posnr
                     bzirk
        FROM vbkd
        INTO ls_vbkd
        WHERE vbeln = lv_vbeln
          AND posnr = lv_posnr
          AND bzirk IN s_bzirk.
      IF sy-subrc = 0.
        gs_acc_sum-sum_rept = ls_bsas-dmbtr + gs_acc_sum-sum_rept.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsas-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_bsas.

  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsas
    INTO TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday_2
      AND budat <= gv_lastday_2.

  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsis
    APPENDING TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday_2.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SPLIT ls_bsas-zuonr AT '/'  INTO lv_vbeln lv_posnr.
      SELECT SINGLE  vbeln
                     posnr
                     bzirk
        FROM vbkd
        INTO ls_vbkd
        WHERE vbeln = lv_vbeln
          AND posnr = lv_posnr
          AND bzirk IN s_bzirk.
      IF sy-subrc = 0.
        CASE ls_bsas-hkont.
          WHEN '0001441901'.
            lv_1441901_2 = lv_1441901_2 + ls_bsas-dmbtr.
          WHEN '0001441902'.
            lv_1441902_2 = lv_1441902_2 + ls_bsas-dmbtr.
          WHEN '0001441903'.
            lv_1441903_2 = lv_1441903_2 + ls_bsas-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsas BY hkont.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SPLIT ls_bsas-zuonr AT '/'  INTO lv_vbeln lv_posnr.
      SELECT SINGLE  vbeln
                     posnr
                     bzirk
        FROM vbkd
        INTO ls_vbkd
        WHERE vbeln = lv_vbeln
          AND posnr = lv_posnr
          AND bzirk IN s_bzirk.
      IF sy-subrc = 0.
        gs_acc_sum-sum_comp = ls_bsas-dmbtr + gs_acc_sum-sum_comp.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsas-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '12'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001441901'.
          gs_alv_output-r_amount = lv_1441901.
          gs_alv_output-c_amount = lv_1441901_2.
          gs_alv_output-diff     = lv_1441901 - lv_1441901_2.
        WHEN '0001441902'.
          gs_alv_output-r_amount = lv_1441902.
          gs_alv_output-c_amount = lv_1441902_2.
          gs_alv_output-diff     = lv_1441902 - lv_1441902_2.
        WHEN '0001441903'.
          gs_alv_output-r_amount = lv_1441903.
          gs_alv_output-c_amount = lv_1441903_2.
          gs_alv_output-diff     = lv_1441903 - lv_1441903_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_bsas.
ENDFORM.                    " GET_ACCOUT_12
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_20
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_20 .

  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_faglflext    TYPE ty_faglflext,
        lv_r_times      TYPE i,
        lv_c_times      TYPE i,
        lv_field        TYPE char20,
        lv_index(2)     TYPE n,
        lv_5831001      TYPE faglflext-hsl01,
        lv_5831001_2    TYPE faglflext-hsl01,
        lv_6490001      TYPE faglflext-hsl01,
        lv_6490001_2    TYPE faglflext-hsl01,
        lv_7211001      TYPE faglflext-hsl01,
        lv_7211001_2    TYPE faglflext-hsl01,
        lv_7832950      TYPE faglflext-hsl01,
        lv_7832950_2    TYPE faglflext-hsl01,
        lv_9971999      TYPE faglflext-hsl01,
        lv_9971999_2    TYPE faglflext-hsl01,
        lv_6570001      TYPE faglflext-hsl01,
        lv_6570001_2    TYPE faglflext-hsl01,
        lv_6570003      TYPE faglflext-hsl01,
        lv_6570003_2    TYPE faglflext-hsl01,
        lv_3972002      TYPE faglflext-hsl01,
        lv_3972002_2    TYPE faglflext-hsl01,
        lv_3972901      TYPE faglflext-hsl01,
        lv_3972901_2    TYPE faglflext-hsl01,
        lv_3972902      TYPE faglflext-hsl01,
        lv_3972902_2    TYPE faglflext-hsl01,
        lv_3973902      TYPE faglflext-hsl01,
        lv_3973902_2    TYPE faglflext-hsl01,
        lv_7971001      TYPE faglflext-hsl01,
        lv_7971001_2    TYPE faglflext-hsl01,
        lv_7971901      TYPE faglflext-hsl01,
        lv_7971901_2    TYPE faglflext-hsl01,
        lv_7972001      TYPE faglflext-hsl01,
        lv_7972001_2    TYPE faglflext-hsl01,
        lv_7972901      TYPE faglflext-hsl01,
        lv_7972901_2    TYPE faglflext-hsl01.
  FIELD-SYMBOLS: <fs_hslxx> TYPE ANY.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 20'(056).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 25
        text       = gv_text.
  ENDIF.
  lv_r_times = b_monate-high.
  lv_c_times = v_monate-high.
  REFRESH: gt_faglflext.

  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '20'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.
  SELECT  ryear
          rldnr
          racct
          rbukrs
          rcntr
          hslvt
          hsl01
          hsl02
          hsl03
          hsl04
          hsl05
          hsl06
          hsl07
          hsl08
          hsl09
          hsl10
          hsl11
          hsl12
          hsl13
          hsl14
          hsl15
          hsl16
    FROM faglflext
    INTO TABLE gt_faglflext
    WHERE ryear =  bilbjahr
      AND rldnr = '0L '
      AND racct IN lt_range_hkont
      AND rbukrs = gc_sortbkrs
      AND rcntr IN s_kostl.
  IF p_flag IS INITIAL.
    LOOP AT gt_faglflext INTO ls_faglflext.
      CASE ls_faglflext-racct.
        WHEN '0005831001'.
          lv_5831001 = ls_faglflext-hslvt + lv_5831001.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_5831001 = lv_5831001 + <fs_hslxx>.
          ENDDO.
        WHEN '0006490001'.
          lv_6490001 = ls_faglflext-hslvt + lv_6490001.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_6490001 = lv_6490001 + <fs_hslxx>.
          ENDDO.
        WHEN '0007211001'.
          lv_7211001 = ls_faglflext-hslvt + lv_7211001.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7211001 = lv_7211001 + <fs_hslxx>.
          ENDDO.
        WHEN '0007832950'.
          lv_7832950 = ls_faglflext-hslvt + lv_7832950.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7832950 = lv_7832950 + <fs_hslxx>.
          ENDDO.
        WHEN '0009971999'.
          lv_9971999 = ls_faglflext-hslvt + lv_9971999.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_9971999 = lv_9971999 + <fs_hslxx>.
          ENDDO.
        WHEN '0006570001'.
          lv_6570001 = ls_faglflext-hslvt + lv_6570001.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_6570001 = lv_6570001 + <fs_hslxx>.
          ENDDO.
        WHEN '0006570003'.
          lv_6570003 = ls_faglflext-hslvt + lv_6570003.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_6570003 = lv_6570003 + <fs_hslxx>.
          ENDDO.
        WHEN '0003972002'.
          lv_3972002 = ls_faglflext-hslvt + lv_3972002.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3972002 = lv_3972002 + <fs_hslxx>.
          ENDDO.
        WHEN '0003972901'.
          lv_3972901 = ls_faglflext-hslvt + lv_3972901.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3972901 = lv_3972901 + <fs_hslxx>.
          ENDDO.
        WHEN '0003972902'.
          lv_3972902 = ls_faglflext-hslvt + lv_3972902.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3972902 = lv_3972902 + <fs_hslxx>.
          ENDDO.
        WHEN '0003973902'.
          lv_3973902 = ls_faglflext-hslvt + lv_3973902.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3973902 = lv_3973902 + <fs_hslxx>.
          ENDDO.
        WHEN '0007971001'.
          lv_7971001 = ls_faglflext-hslvt + lv_7971001.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7971001 = lv_7971001 + <fs_hslxx>.
          ENDDO.
        WHEN '0007971901'.
          lv_7971901 = ls_faglflext-hslvt + lv_7971901.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7971901 = lv_7971901 + <fs_hslxx>.
          ENDDO.
        WHEN '0007972001'.
          lv_7972001 = ls_faglflext-hslvt + lv_7972001.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7972001 = lv_7972001 + <fs_hslxx>.
          ENDDO.
        WHEN '0007972901'.
          lv_7972901 = ls_faglflext-hslvt + lv_7972901.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7972901 = lv_7972901 + <fs_hslxx>.
          ENDDO.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_faglflext BY racct.

    LOOP AT gt_faglflext INTO ls_faglflext.
      gs_acc_sum-sum_comp = ls_faglflext-hslvt + gs_acc_sum-sum_comp.
      DO lv_r_times TIMES.
        CLEAR:  lv_field,
                lv_index.
        lv_index = sy-index .
        CONCATENATE 'HSL' lv_index INTO lv_field.
        ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
        gs_acc_sum-sum_comp =  gs_acc_sum-sum_comp + <fs_hslxx>.
      ENDDO.
      AT END OF racct.
        gs_acc_sum-hkont  = ls_faglflext-racct.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_faglflext.

  SELECT  ryear
          rldnr
          racct
          rbukrs
          rcntr
          hslvt
          hsl01
          hsl02
          hsl03
          hsl04
          hsl05
          hsl06
          hsl07
          hsl08
          hsl09
          hsl10
          hsl11
          hsl12
          hsl13
          hsl14
          hsl15
          hsl16
    FROM faglflext
    INTO TABLE gt_faglflext
    WHERE ryear =  bilvjahr
      AND rldnr = '0L '
      AND racct IN lt_range_hkont
      AND rbukrs = gc_sortbkrs
      AND rcntr IN s_kostl.
  IF p_flag IS INITIAL.
    LOOP AT gt_faglflext INTO ls_faglflext.
      CASE ls_faglflext-racct.
        WHEN '0005831001'.
          lv_5831001_2 = ls_faglflext-hslvt + lv_5831001_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_5831001_2 = lv_5831001_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0006490001'.
          lv_6490001_2 = ls_faglflext-hslvt + lv_6490001_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_6490001_2 = lv_6490001_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0007211001'.
          lv_7211001_2 = ls_faglflext-hslvt + lv_7211001_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7211001_2 = lv_7211001_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0007832950'.
          lv_7832950_2 = ls_faglflext-hslvt + lv_7832950_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7832950_2 = lv_7832950_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0009971999'.
          lv_9971999_2 = ls_faglflext-hslvt + lv_9971999_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_9971999_2 = lv_9971999_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0006570001'.
          lv_6570001_2 = ls_faglflext-hslvt + lv_6570001_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_6570001_2 = lv_6570001_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0006570003'.
          lv_6570003_2 = ls_faglflext-hslvt + lv_6570003_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_6570003_2 = lv_6570003_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0003972002'.
          lv_3972002_2 = ls_faglflext-hslvt + lv_3972002_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3972002_2 = lv_3972002_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0003972901'.
          lv_3972901_2 = ls_faglflext-hslvt + lv_3972901_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3972901_2 = lv_3972901_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0003972902'.
          lv_3972902_2 = ls_faglflext-hslvt + lv_3972902_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3972902_2 = lv_3972902_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0003973902'.
          lv_3973902_2 = ls_faglflext-hslvt + lv_3973902_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_3973902_2 = lv_3973902_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0007971001'.
          lv_7971001_2 = ls_faglflext-hslvt + lv_7971001_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7971001_2 = lv_7971001_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0007971901'.
          lv_7971901_2 = ls_faglflext-hslvt + lv_7971901_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7971901_2 = lv_7971901_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0007972001'.
          lv_7972001_2 = ls_faglflext-hslvt + lv_7972001_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7972001_2 = lv_7972001_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0007972901'.
          lv_7972901_2 = ls_faglflext-hslvt + lv_7972901_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_7972901_2 = lv_7972901_2 + <fs_hslxx>.
          ENDDO.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_faglflext BY racct.

    LOOP AT gt_faglflext INTO ls_faglflext.
      gs_acc_sum-sum_comp = ls_faglflext-hslvt + gs_acc_sum-sum_comp.
      DO lv_r_times TIMES.
        CLEAR:  lv_field,
                lv_index.
        lv_index = sy-index .
        CONCATENATE 'HSL' lv_index INTO lv_field.
        ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
        gs_acc_sum-sum_comp =  gs_acc_sum-sum_comp + <fs_hslxx>.
      ENDDO.
      AT END OF racct.
        gs_acc_sum-hkont  = ls_faglflext-racct.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '20'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0005831001'.
          gs_alv_output-r_amount = lv_5831001.
          gs_alv_output-c_amount = lv_5831001_2.
          gs_alv_output-diff     = lv_5831001 - lv_5831001_2.
        WHEN '0006490001'.
          gs_alv_output-r_amount = lv_6490001.
          gs_alv_output-c_amount = lv_6490001_2.
          gs_alv_output-diff     = lv_6490001 - lv_6490001_2.
        WHEN '0007211001'.
          gs_alv_output-r_amount = lv_7211001.
          gs_alv_output-c_amount = lv_7211001_2.
          gs_alv_output-diff     = lv_7211001 - lv_7211001_2.
        WHEN '0007832950'.
          gs_alv_output-r_amount = lv_7832950.
          gs_alv_output-c_amount = lv_7832950_2.
          gs_alv_output-diff     = lv_7832950 - lv_7832950_2.
        WHEN '0009971999'.
          gs_alv_output-r_amount = lv_9971999.
          gs_alv_output-c_amount = lv_9971999_2.
          gs_alv_output-diff     = lv_9971999 - lv_9971999_2.
        WHEN '0006570001'.
          gs_alv_output-r_amount = lv_6570001.
          gs_alv_output-c_amount = lv_6570001_2.
          gs_alv_output-diff     = lv_6570001 - lv_6570001_2.
        WHEN '0006570003'.
          gs_alv_output-r_amount = lv_6570003.
          gs_alv_output-c_amount = lv_6570003_2.
          gs_alv_output-diff     = lv_6570003 - lv_6570003_2.
        WHEN '0003972002'.
          gs_alv_output-r_amount = lv_3972002.
          gs_alv_output-c_amount = lv_3972002_2.
          gs_alv_output-diff     = lv_3972002 - lv_3972002_2.
        WHEN '0003972901'.
          gs_alv_output-r_amount = lv_3972901.
          gs_alv_output-c_amount = lv_3972901_2.
          gs_alv_output-diff     = lv_3972901 - lv_3972901_2.
        WHEN '0003972902'.
          gs_alv_output-r_amount = lv_3972902.
          gs_alv_output-c_amount = lv_3972902_2.
          gs_alv_output-diff     = lv_3972902 - lv_3972902_2.
        WHEN '0003973902'.
          gs_alv_output-r_amount = lv_3973902.
          gs_alv_output-c_amount = lv_3973902_2.
          gs_alv_output-diff     = lv_3973902 - lv_3973902_2.
        WHEN '0007971001'.
          gs_alv_output-r_amount = lv_7971001.
          gs_alv_output-c_amount = lv_7971001_2.
          gs_alv_output-diff     = lv_7971001 - lv_7971001_2.
        WHEN '0007971901'.
          gs_alv_output-r_amount = lv_7971901.
          gs_alv_output-c_amount = lv_7971901_2.
          gs_alv_output-diff     = lv_7971901 - lv_7971901_2.
        WHEN '0007972001'.
          gs_alv_output-r_amount = lv_7972001.
          gs_alv_output-c_amount = lv_7972001_2.
          gs_alv_output-diff     = lv_7972001 - lv_7972001_2.
        WHEN '0007972901'.
          gs_alv_output-r_amount = lv_7972901.
          gs_alv_output-c_amount = lv_7972901_2.
          gs_alv_output-diff     = lv_7972901 - lv_7972901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_faglflext.
ENDFORM.                    " GET_ACCOUT_20
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_30
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_30 .
  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_faglflext    TYPE ty_faglflext,
        lv_r_times      TYPE i,
        lv_c_times      TYPE i,
        lv_field        TYPE char20,
        lv_index(2)     TYPE n,
        lv_1930007      TYPE faglflext-hsl01,
        lv_1930007_2    TYPE faglflext-hsl01,
        lv_2611202      TYPE faglflext-hsl01,
        lv_2611202_2    TYPE faglflext-hsl01,
        lv_2641002      TYPE faglflext-hsl01,
        lv_2641002_2    TYPE faglflext-hsl01,
        lv_2650200      TYPE faglflext-hsl01,
        lv_2650200_2    TYPE faglflext-hsl01,
        lv_1960131      TYPE faglflext-hsl01,
        lv_1960131_2    TYPE faglflext-hsl01,
        lv_2998205      TYPE faglflext-hsl01,
        lv_2998205_2    TYPE faglflext-hsl01.
  FIELD-SYMBOLS: <fs_hslxx> TYPE ANY.

  lv_r_times = b_monate-high.
  lv_c_times = v_monate-high.
  REFRESH: gt_faglflext.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 30'(066).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 35
        text       = gv_text.
  ENDIF.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '30'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.
  SELECT  ryear
          rldnr
          racct
          rbukrs
          rcntr
          hslvt
          hsl01
          hsl02
          hsl03
          hsl04
          hsl05
          hsl06
          hsl07
          hsl08
          hsl09
          hsl10
          hsl11
          hsl12
          hsl13
          hsl14
          hsl15
          hsl16
    FROM faglflext
    INTO TABLE gt_faglflext
    WHERE ryear =  bilbjahr
      AND rldnr = '0L '
      AND racct IN lt_range_hkont
      AND rbukrs = gc_sortbkrs.
  IF p_flag IS INITIAL.
    LOOP AT gt_faglflext INTO ls_faglflext.
      CASE ls_faglflext-racct.
        WHEN '0001930007'.
          lv_1930007 = ls_faglflext-hslvt + lv_1930007.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_1930007 = lv_1930007 + <fs_hslxx>.
          ENDDO.
        WHEN '0002611202'.
          lv_2611202 = ls_faglflext-hslvt + lv_2611202.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2611202 = lv_2611202 + <fs_hslxx>.
          ENDDO.
        WHEN '0002641002'.
          lv_2641002 = ls_faglflext-hslvt + lv_2641002.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2641002 = lv_2641002 + <fs_hslxx>.
          ENDDO.
        WHEN '0002650200'.
          lv_2650200 = ls_faglflext-hslvt + lv_2650200.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2650200 = lv_2650200 + <fs_hslxx>.
          ENDDO.
        WHEN '0001960131'.
          lv_1960131 = ls_faglflext-hslvt + lv_1960131.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_1960131 = lv_1960131 + <fs_hslxx>.
          ENDDO.
        WHEN '0002998205'.
          lv_2998205 = ls_faglflext-hslvt + lv_2998205.
          DO lv_r_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2998205 = lv_2998205 + <fs_hslxx>.
          ENDDO.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_faglflext BY racct.

    LOOP AT gt_faglflext INTO ls_faglflext.
      gs_acc_sum-sum_rept = ls_faglflext-hslvt + gs_acc_sum-sum_rept.
      DO lv_r_times TIMES.
        CLEAR:  lv_field,
                lv_index.
        lv_index = sy-index .
        CONCATENATE 'HSL' lv_index INTO lv_field.
        ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
        gs_acc_sum-sum_rept =  gs_acc_sum-sum_rept + <fs_hslxx>.
      ENDDO.
      AT END OF racct.
        gs_acc_sum-hkont  = ls_faglflext-racct.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_faglflext.

  SELECT  ryear
          rldnr
          racct
          rbukrs
          rcntr
          hslvt
          hsl01
          hsl02
          hsl03
          hsl04
          hsl05
          hsl06
          hsl07
          hsl08
          hsl09
          hsl10
          hsl11
          hsl12
          hsl13
          hsl14
          hsl15
          hsl16
    FROM faglflext
    INTO TABLE gt_faglflext
    WHERE ryear =  bilvjahr
      AND rldnr = '0L '
      AND racct IN lt_range_hkont
      AND rbukrs = gc_sortbkrs.
  IF p_flag IS INITIAL.
    LOOP AT gt_faglflext INTO ls_faglflext.
      CASE ls_faglflext-racct.
        WHEN '0001930007'.
          lv_1930007_2 = ls_faglflext-hslvt + lv_1930007_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_1930007_2 = lv_1930007_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0002611202'.
          lv_2611202_2 = ls_faglflext-hslvt + lv_2611202_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2611202_2 = lv_2611202_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0002641002'.
          lv_2641002_2 = ls_faglflext-hslvt + lv_2641002_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2641002_2 = lv_2641002_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0002650200'.
          lv_2650200_2 = ls_faglflext-hslvt + lv_2650200_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2650200_2 = lv_2650200_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0001960131'.
          lv_1960131_2 = ls_faglflext-hslvt + lv_1960131_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_1960131_2 = lv_1960131_2 + <fs_hslxx>.
          ENDDO.
        WHEN '0002998205'.
          lv_2998205_2 = ls_faglflext-hslvt + lv_2998205_2.
          DO lv_c_times TIMES.
            CLEAR:  lv_field,
                    lv_index.
            lv_index = sy-index .
            CONCATENATE 'HSL' lv_index INTO lv_field.
            ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
            lv_2998205_2 = lv_2998205_2 + <fs_hslxx>.
          ENDDO.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_faglflext BY racct.

    LOOP AT gt_faglflext INTO ls_faglflext.
      gs_acc_sum-sum_comp = ls_faglflext-hslvt + gs_acc_sum-sum_comp.
      DO lv_r_times TIMES.
        CLEAR:  lv_field,
                lv_index.
        lv_index = sy-index .
        CONCATENATE 'HSL' lv_index INTO lv_field.
        ASSIGN COMPONENT lv_field OF STRUCTURE ls_faglflext TO <fs_hslxx>.
        gs_acc_sum-sum_comp =  gs_acc_sum-sum_comp + <fs_hslxx>.
      ENDDO.
      AT END OF racct.
        gs_acc_sum-hkont  = ls_faglflext-racct.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '30'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001930007'.
          gs_alv_output-r_amount = lv_1930007.
          gs_alv_output-c_amount = lv_1930007_2.
          gs_alv_output-diff     = lv_1930007 - lv_1930007_2.
        WHEN '0002611202'.
          gs_alv_output-r_amount = lv_2611202.
          gs_alv_output-c_amount = lv_2611202_2.
          gs_alv_output-diff     = lv_2611202 - lv_2611202_2.
        WHEN '0002641002'.
          gs_alv_output-r_amount = lv_2641002.
          gs_alv_output-c_amount = lv_2641002_2.
          gs_alv_output-diff     = lv_2641002 - lv_2641002_2.
        WHEN '0002650200'.
          gs_alv_output-r_amount = lv_2650200.
          gs_alv_output-c_amount = lv_2650200_2.
          gs_alv_output-diff     = lv_2650200 - lv_2650200_2.
        WHEN '0001960131'.
          gs_alv_output-r_amount = lv_1960131.
          gs_alv_output-c_amount = lv_1960131_2.
          gs_alv_output-diff     = lv_1960131 - lv_1960131_2.
        WHEN '0002998205'.
          gs_alv_output-r_amount = lv_2998205.
          gs_alv_output-c_amount = lv_2998205_2.
          gs_alv_output-diff     = lv_2998205 - lv_2998205_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_faglflext.
ENDFORM.                    " GET_ACCOUT_30
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_40
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_40 .

  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_bsas         TYPE ty_bsas,
        ls_bkpf         TYPE bkpf,
        lv_1680001      TYPE faglflext-hsl01,
        lv_1680001_2    TYPE faglflext-hsl01,
        lv_2511001      TYPE faglflext-hsl01,
        lv_2511001_2    TYPE faglflext-hsl01,
        lv_2710001      TYPE faglflext-hsl01,
        lv_2710001_2    TYPE faglflext-hsl01.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 40'(076).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 45
        text       = gv_text.
  ENDIF.
  REFRESH: gt_bsas.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '40'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.
  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsas
    INTO TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday
      AND budat <= gv_lastday.

  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsis
    APPENDING TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsas-belnr
          AND gjahr = ls_bsas-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        CASE ls_bsas-hkont.
          WHEN '0001680001'.
            lv_1680001 = lv_1680001 + ls_bsas-dmbtr.
          WHEN '0002511001'.
            lv_2511001 = lv_2511001 + ls_bsas-dmbtr.
          WHEN '0002710001'.
            lv_2710001 = lv_2710001 + ls_bsas-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsas BY hkont.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsas-belnr
          AND gjahr = ls_bsas-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        gs_acc_sum-sum_rept = ls_bsas-dmbtr + gs_acc_sum-sum_rept.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsas-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_bsas.

  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsas
    INTO TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday_2
      AND budat <= gv_lastday_2.

  SELECT    bukrs
            belnr
            gjahr
            hkont
            augdt
            budat
            zuonr
            shkzg
            dmbtr
    FROM bsis
    APPENDING TABLE gt_bsas
    WHERE bukrs = gc_sortbkrs
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday_2.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsas-belnr
          AND gjahr = ls_bsas-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        CASE ls_bsas-hkont.
          WHEN '0001680001'.
            lv_1680001_2 = lv_1680001_2 + ls_bsas-dmbtr.
          WHEN '0002511001'.
            lv_2511001_2 = lv_2511001_2 + ls_bsas-dmbtr.
          WHEN '0002710001'.
            lv_2710001_2 = lv_2710001_2 + ls_bsas-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsas BY hkont.
    LOOP AT gt_bsas INTO ls_bsas.
      IF ls_bsas-shkzg = 'H'.
        ls_bsas-dmbtr = ls_bsas-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsas-belnr
          AND gjahr = ls_bsas-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        gs_acc_sum-sum_comp = ls_bsas-dmbtr + gs_acc_sum-sum_comp.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsas-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '40'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001680001'.
          gs_alv_output-r_amount = lv_1680001.
          gs_alv_output-c_amount = lv_1680001_2.
          gs_alv_output-diff     = lv_1680001 - lv_1680001_2.
        WHEN '0002511001'.
          gs_alv_output-r_amount = lv_2511001.
          gs_alv_output-c_amount = lv_2511001_2.
          gs_alv_output-diff     = lv_2511001 - lv_2511001_2.
        WHEN '0002710001'.
          gs_alv_output-r_amount = lv_2710001.
          gs_alv_output-c_amount = lv_2710001_2.
          gs_alv_output-diff     = lv_2710001 - lv_2710001_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_bsas.
ENDFORM.                    " GET_ACCOUT_40
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_41
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_41 .

  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_bsak         TYPE ty_bsak,
        ls_bkpf         TYPE bkpf,
        lv_1480901      TYPE faglflext-hsl01,
        lv_1480901_2    TYPE faglflext-hsl01,
        lv_2441901      TYPE faglflext-hsl01,
        lv_2441901_2    TYPE faglflext-hsl01.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 41'(086).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 55
        text       = gv_text.
  ENDIF.
  REFRESH: gt_bsak.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '41'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.
  SELECT    bukrs
            belnr
            gjahr
            lifnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsak
    INTO TABLE gt_bsak
    WHERE bukrs = gc_sortbkrs
      AND lifnr IN s_lifnr
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday
      AND budat <= gv_lastday.

  SELECT    bukrs
            belnr
            gjahr
            lifnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsik
    APPENDING TABLE gt_bsak
    WHERE bukrs = gc_sortbkrs
      AND lifnr IN s_lifnr
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday.

  IF p_flag IS INITIAL.
    LOOP AT gt_bsak INTO ls_bsak.
      IF ls_bsak-shkzg = 'H'.
        ls_bsak-dmbtr = ls_bsak-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsak-belnr
          AND gjahr = ls_bsak-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        CASE ls_bsak-hkont.
          WHEN '0001480901'.
            lv_1480901 = lv_1480901 + ls_bsak-dmbtr.
          WHEN '0002441901'.
            lv_2441901 = lv_2441901 + ls_bsak-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsak BY hkont.
    LOOP AT gt_bsak INTO ls_bsak.
      IF ls_bsak-shkzg = 'H'.
        ls_bsak-dmbtr = ls_bsak-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsak-belnr
          AND gjahr = ls_bsak-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        gs_acc_sum-sum_rept = ls_bsak-dmbtr + gs_acc_sum-sum_rept.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsak-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_bsak.

  SELECT    bukrs
            belnr
            gjahr
            lifnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsak
    INTO TABLE gt_bsak
    WHERE bukrs = gc_sortbkrs
      AND lifnr IN s_lifnr
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday_2
      AND budat <= gv_lastday_2.

  SELECT    bukrs
            belnr
            gjahr
            lifnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsik
    APPENDING TABLE gt_bsak
    WHERE bukrs = gc_sortbkrs
      AND lifnr IN s_lifnr
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday_2.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsak INTO ls_bsak.
      IF ls_bsak-shkzg = 'H'.
        ls_bsak-dmbtr = ls_bsak-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsak-belnr
          AND gjahr = ls_bsak-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        CASE ls_bsak-hkont.
          WHEN '0001480901'.
            lv_1480901_2 = lv_1480901_2 + ls_bsak-dmbtr.
          WHEN '0002441901'.
            lv_2441901_2 = lv_2441901_2 + ls_bsak-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsak BY hkont.
    LOOP AT gt_bsak INTO ls_bsak.
      IF ls_bsak-shkzg = 'H'.
        ls_bsak-dmbtr = ls_bsak-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsak-belnr
          AND gjahr = ls_bsak-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        gs_acc_sum-sum_comp = ls_bsak-dmbtr + gs_acc_sum-sum_comp.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsak-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '41'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001480901'.
          gs_alv_output-r_amount = lv_1480901.
          gs_alv_output-c_amount = lv_1480901_2.
          gs_alv_output-diff     = lv_1480901 - lv_1480901_2.
        WHEN '0002441901'.
          gs_alv_output-r_amount = lv_2441901.
          gs_alv_output-c_amount = lv_2441901_2.
          gs_alv_output-diff     = lv_2441901 - lv_2441901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_bsak.
ENDFORM.                    " GET_ACCOUT_41
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_42
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_42 .

  DATA: lt_range_hkont  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont,
        ls_bsad         TYPE ty_bsad,
        ls_bkpf         TYPE bkpf,
        lv_2421901      TYPE faglflext-hsl01,
        lv_2421901_2    TYPE faglflext-hsl01.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 42'(096).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 65
        text       = gv_text.
  ENDIF.
  REFRESH: gt_bsad.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '42'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.
  SELECT    bukrs
            belnr
            gjahr
            kunnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsad
    INTO TABLE gt_bsad
    WHERE bukrs = gc_sortbkrs
      AND kunnr IN s_kunnr
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday
      AND budat <= gv_lastday.

  SELECT    bukrs
            belnr
            gjahr
            kunnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsid
    APPENDING TABLE gt_bsad
    WHERE bukrs = gc_sortbkrs
      AND kunnr IN s_kunnr
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday.

  IF p_flag IS INITIAL.
    LOOP AT gt_bsad INTO ls_bsad.
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsad-belnr
          AND gjahr = ls_bsad-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        CASE ls_bsad-hkont.
          WHEN '0002421901'.
            lv_2421901 = lv_2421901 + ls_bsad-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsad BY hkont.
    LOOP AT gt_bsad INTO ls_bsad.
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsad-belnr
          AND gjahr = ls_bsad-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        gs_acc_sum-sum_rept = ls_bsad-dmbtr + gs_acc_sum-sum_rept.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsad-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_bsad.

  SELECT    bukrs
            belnr
            gjahr
            kunnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsad
    INTO TABLE gt_bsad
    WHERE bukrs = gc_sortbkrs
      AND kunnr IN s_kunnr
      AND hkont IN lt_range_hkont
      AND augdt > gv_lastday_2
      AND budat <= gv_lastday_2.

  SELECT    bukrs
            belnr
            gjahr
            kunnr
            hkont
            augdt
            budat
            shkzg
            dmbtr
    FROM bsid
    APPENDING TABLE gt_bsad
    WHERE bukrs = gc_sortbkrs
      AND kunnr IN s_kunnr
      AND hkont IN lt_range_hkont
      AND budat <= gv_lastday_2.
  IF p_flag IS INITIAL.
    LOOP AT gt_bsad INTO ls_bsad.
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsad-belnr
          AND gjahr = ls_bsad-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        CASE ls_bsad-hkont.
          WHEN '0002421901'.
            lv_2421901_2 = lv_2421901_2 + ls_bsad-dmbtr.
          WHEN OTHERS.
        ENDCASE.
      ENDIF.
    ENDLOOP.
  ELSE.
    CLEAR gs_acc_sum.
    SORT gt_bsad BY hkont.
    LOOP AT gt_bsad INTO ls_bsad.
      IF ls_bsad-shkzg = 'H'.
        ls_bsad-dmbtr = ls_bsad-dmbtr * ( -1 ).
      ENDIF.
      SELECT SINGLE  *
        FROM bkpf
        INTO ls_bkpf
        WHERE bukrs = gc_sortbkrs
          AND belnr = ls_bsad-belnr
          AND gjahr = ls_bsad-gjahr
          AND bktxt IN gt_kostl.
      IF sy-subrc = 0.
        gs_acc_sum-sum_comp = ls_bsad-dmbtr + gs_acc_sum-sum_comp.
      ENDIF.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bsad-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.


  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '42'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0002421901'.
          gs_alv_output-r_amount = lv_2421901.
          gs_alv_output-c_amount = lv_2421901_2.
          gs_alv_output-diff     = lv_2421901 - lv_2421901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  REFRESH: gt_bsad.
ENDFORM.                    " GET_ACCOUT_42
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_43
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_43 .

  TYPES: BEGIN OF lty_bseg,
          bukrs         TYPE bseg-bukrs,
          belnr         TYPE bseg-belnr,
          gjahr         TYPE bseg-gjahr,
          hkont         TYPE bseg-hkont,
          shkzg         TYPE bseg-shkzg,
          dmbtr         TYPE bseg-dmbtr,
         END OF lty_bseg.
  DATA:  lt_range_hkont  TYPE RANGE OF bsad-hkont,
         ls_range_hkont  LIKE LINE OF lt_range_hkont,
         lt_bseg         TYPE STANDARD TABLE OF lty_bseg,
         ls_bseg         TYPE lty_bseg,
         lv_8910001      TYPE faglflext-hsl01,
         lv_8910001_2    TYPE faglflext-hsl01.

  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 43'(106).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 75
        text       = gv_text.
  ENDIF.
  REFRESH: gt_bsad.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '43'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont.
  ENDLOOP.
* If no item exist for data resource = 11, not contiue this form
  CHECK lt_range_hkont IS NOT INITIAL.

  SELECT    bkpf~bukrs
            bkpf~belnr
            bkpf~gjahr
            bkpf~monat
            bkpf~bktxt
            bkpf~xreversal
    FROM    bkpf
    INTO TABLE gt_bkpf
    WHERE bkpf~bukrs = gc_sortbkrs
      AND bkpf~gjahr = bilbjahr
      AND bkpf~monat IN b_monate
*      AND bkpf~bktxt IN gt_kostl
      AND bkpf~xblnr IN gt_kostl
      AND bkpf~xreversal = space.

  IF gt_bkpf IS NOT INITIAL.
    SELECT  bukrs
            belnr
            gjahr
            hkont
            shkzg
            dmbtr
      FROM bseg
      INTO TABLE lt_bseg
      FOR ALL ENTRIES IN gt_bkpf
      WHERE bukrs  =   gt_bkpf-bukrs
        AND belnr  =   gt_bkpf-belnr
        AND gjahr  =   gt_bkpf-gjahr
        AND hkont  IN  lt_range_hkont.

  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT lt_bseg INTO ls_bseg.
      IF ls_bseg-shkzg = 'H'.
        ls_bseg-dmbtr = ls_bseg-dmbtr * ( -1 ).
      ENDIF.
      CASE ls_bseg-hkont.
        WHEN '0008910001'.
          lv_8910001 = lv_8910001 + ls_bseg-dmbtr.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    SORT lt_bseg BY hkont.
    CLEAR gs_acc_sum.
    LOOP AT lt_bseg INTO ls_bseg.
      IF ls_bseg-shkzg = 'H'.
        ls_bseg-dmbtr = ls_bseg-dmbtr * ( -1 ).
      ENDIF.
      gs_acc_sum-sum_rept = ls_bseg-dmbtr + gs_acc_sum-sum_rept.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bseg-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  REFRESH: gt_bkpf,lt_bseg.

  SELECT    bkpf~bukrs
            bkpf~belnr
            bkpf~gjahr
            bkpf~monat
            bkpf~bktxt
            bkpf~xreversal
    FROM    bkpf
    INTO TABLE gt_bkpf
    WHERE bkpf~bukrs = gc_sortbkrs
      AND bkpf~gjahr = bilvjahr
      AND bkpf~monat IN v_monate
*      AND bkpf~bktxt IN gt_kostl
      AND bkpf~xblnr IN gt_kostl
      AND bkpf~xreversal = space.

  IF gt_bkpf IS NOT INITIAL.
    SELECT  bukrs
            belnr
            gjahr
            hkont
            shkzg
            dmbtr
      FROM bseg
      INTO TABLE lt_bseg
      FOR ALL ENTRIES IN gt_bkpf
      WHERE bukrs  =   gt_bkpf-bukrs
        AND belnr  =   gt_bkpf-belnr
        AND gjahr  =   gt_bkpf-gjahr
        AND hkont  IN  lt_range_hkont.

  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT lt_bseg INTO ls_bseg.
      IF ls_bseg-shkzg = 'H'.
        ls_bseg-dmbtr = ls_bseg-dmbtr * ( -1 ).
      ENDIF.
      CASE ls_bseg-hkont.
        WHEN '0008910001'.
          lv_8910001_2 = lv_8910001_2 + ls_bseg-dmbtr.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    SORT lt_bseg BY hkont.
    CLEAR gs_acc_sum.
    LOOP AT lt_bseg INTO ls_bseg.
      IF ls_bseg-shkzg = 'H'.
        ls_bseg-dmbtr = ls_bseg-dmbtr * ( -1 ).
      ENDIF.
      gs_acc_sum-sum_rept = ls_bseg-dmbtr + gs_acc_sum-sum_rept.
      AT END OF hkont.
        gs_acc_sum-hkont    = ls_bseg-hkont.
        COLLECT gs_acc_sum INTO gt_acc_sum.
        CLEAR gs_acc_sum.
      ENDAT.
    ENDLOOP.
  ENDIF.

  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '43'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0008910001'.
          gs_alv_output-r_amount = lv_8910001.
          gs_alv_output-c_amount = lv_8910001_2.
          gs_alv_output-diff     = lv_8910001 - lv_8910001_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
ENDFORM.                    " GET_ACCOUT_43
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_50
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_50_51 .

  TYPES:  BEGIN OF lty_anlz,
            bukrs     TYPE anlz-bukrs,
            anln1     TYPE anlz-anln1,
            anln2     TYPE anlz-anln2,
            kostl     TYPE anlz-kostl,
            bdatu     TYPE anlz-bdatu,
          END OF lty_anlz,
          BEGIN OF lty_anla,
            bukrs     TYPE anla-bukrs,
            anln1     TYPE anla-anln1,
            anln2     TYPE anla-anln2,
            deakt     TYPE anla-deakt,
            ktogr     TYPE anla-ktogr,
          END OF lty_anla,
          BEGIN OF lty_anlc,
            bukrs     TYPE anlc-bukrs,
            anln1     TYPE anlc-anln1,
            anln2     TYPE anlc-anln2,
            gjahr     TYPE anlc-gjahr,
            afabe     TYPE anlc-afabe,
            kansw     TYPE anlc-kansw,
            knafa     TYPE anlc-knafa,
          END OF lty_anlc,
          BEGIN OF lty_anlp,
            bukrs     TYPE anlp-bukrs,
            gjahr     TYPE anlp-gjahr,
            peraf     TYPE anlp-peraf,
            afbnr     TYPE anlp-afbnr,
            anln1     TYPE anlp-anln1,
            anln2     TYPE anlp-anln2,
            afaber    TYPE anlp-afaber,
            nafag     TYPE anlp-nafag,
            nafaz     TYPE anlp-nafaz,
            answl     TYPE anlp-answl,
          END OF lty_anlp,
          BEGIN OF lty_t095,
            ktopl	    TYPE t095-ktopl,
            ktogr	    TYPE t095-ktogr,
            afabe	    TYPE t095-afabe,
            ktansw    TYPE t095-ktansw,
          END OF lty_t095,
          BEGIN OF lty_t095b,
            ktopl     TYPE t095b-ktopl,
            ktogr     TYPE t095b-ktogr,
            afabe     TYPE t095b-afabe,
            ktnafb    TYPE t095b-ktnafb,
          END OF lty_t095b.
  DATA: ls_anla   TYPE lty_anla,
        ls_anlc   TYPE lty_anlc,
        ls_anlp   TYPE lty_anlp,
        ls_t095   TYPE lty_t095,
        ls_t095b  TYPE lty_t095b,
        lt_anlz   TYPE STANDARD TABLE OF lty_anlz,
        lt_anla   TYPE STANDARD TABLE OF lty_anla,
        lt_anlc   TYPE STANDARD TABLE OF lty_anlc,
        lt_anlp   TYPE STANDARD TABLE OF lty_anlp,
        lt_t095   TYPE STANDARD TABLE OF lty_t095,
        lt_t095b  TYPE STANDARD TABLE OF lty_t095b,
        lv_1110904      TYPE faglflext-hsl01,
        lv_1110904_2    TYPE faglflext-hsl01,
        lv_1221901      TYPE faglflext-hsl01,
        lv_1221901_2    TYPE faglflext-hsl01,
        lv_1224901      TYPE faglflext-hsl01,
        lv_1224901_2    TYPE faglflext-hsl01,
        lv_1225901      TYPE faglflext-hsl01,
        lv_1225901_2    TYPE faglflext-hsl01,
        lv_1241901      TYPE faglflext-hsl01,
        lv_1241901_2    TYPE faglflext-hsl01,
        lv_1251901      TYPE faglflext-hsl01,
        lv_1251901_2    TYPE faglflext-hsl01,
        lv_1119904      TYPE faglflext-hsl01,
        lv_1119904_2    TYPE faglflext-hsl01,
        lv_1229910      TYPE faglflext-hsl01,
        lv_1229910_2    TYPE faglflext-hsl01,
        lv_1229940      TYPE faglflext-hsl01,
        lv_1229940_2    TYPE faglflext-hsl01,
        lv_1229950      TYPE faglflext-hsl01,
        lv_1229950_2    TYPE faglflext-hsl01,
        lv_1249910      TYPE faglflext-hsl01,
        lv_1249910_2    TYPE faglflext-hsl01,
        lv_1259901      TYPE faglflext-hsl01,
        lv_1259901_2    TYPE faglflext-hsl01,
        lt_range_hkont_50  TYPE RANGE OF bsad-hkont,
        lt_range_hkont_51  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont_50.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 50&51'(116).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 85
        text       = gv_text.
  ENDIF.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '50'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont_50.
  ENDLOOP.

  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '51'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont_51.
  ENDLOOP.

  SELECT  bukrs
          anln1
          anln2
          kostl
          bdatu
    FROM  anlz
    INTO TABLE lt_anlz
    WHERE bukrs = gc_sortbkrs
      AND kostl IN s_kostl
      AND bdatu  >= gv_lastday.
  IF lt_anlz IS NOT INITIAL.
    SELECT  bukrs
            anln1
            anln2
            deakt
            ktogr
      FROM anla
      INTO TABLE lt_anla
      FOR ALL ENTRIES IN lt_anlz
      WHERE bukrs = gc_sortbkrs
        And anln1 = lt_anlz-anln1
        AND anln2 = lt_anlz-anln2
        AND (   deakt = '00000000'
             OR deakt >= gv_lastday ).
  ENDIF.
  IF lt_anla IS NOT INITIAL.
    SELECT  bukrs
            anln1
            anln2
            gjahr
            afabe
            kansw
            knafa
      FROM anlc
      INTO TABLE lt_anlc
      FOR ALL ENTRIES IN lt_anla
      WHERE bukrs = gc_sortbkrs
        And anln1 = lt_anla-anln1
        AND anln2 = lt_anla-anln2
        AND gjahr = bilbjahr
        AND afabe = gc_afabe_01.

    SELECT  bukrs
            gjahr
            peraf
            afbnr
            anln1
            anln2
            afaber
            nafag
            nafaz
            answl
      FROM anlp
      INTO TABLE lt_anlp
      FOR ALL ENTRIES IN lt_anla
      WHERE bukrs = gc_sortbkrs
        And anln1 = lt_anla-anln1
        AND anln2 = lt_anla-anln2
        AND gjahr = bilbjahr
        AND peraf IN b_monate
        AND afaber = gc_afabe_01.
    SORT lt_anlp BY anln1 ASCENDING
                    anln2 ASCENDING
                    peraf DESCENDING.
    DELETE ADJACENT DUPLICATES FROM lt_anlp
       COMPARING anln1  anln2.
    SELECT    ktopl
              ktogr
              afabe
              ktansw
      FROM t095
      INTO TABLE lt_t095
      FOR ALL ENTRIES IN lt_anla
      WHERE ktopl = gc_ktopl_scoa
        AND ktogr = lt_anla-ktogr
        AND ktansw IN lt_range_hkont_50
        AND afabe = gc_afabe_01.

    SELECT  ktopl
            ktogr
            afabe
            ktnafb
      FROM t095b
      INTO TABLE lt_t095b
      FOR ALL ENTRIES IN lt_anla
      WHERE ktopl = gc_ktopl_scoa
        AND ktogr = lt_anla-ktogr
        AND ktnafb IN lt_range_hkont_51
        AND afabe = gc_afabe_01.
  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT lt_anla INTO ls_anla.
      CLEAR: ls_anlc, ls_anlp,ls_t095,ls_t095b.
      LOOP AT lt_anlc INTO ls_anlc
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095-ktansw.
            WHEN '0001110904'.
              lv_1110904 = lv_1110904 + ls_anlc-kansw.
            WHEN '0001221901'.
              lv_1221901 = lv_1221901 + ls_anlc-kansw.
            WHEN '0001224901'.
              lv_1224901 = lv_1224901 + ls_anlc-kansw.
            WHEN '0001225901'.
              lv_1225901 = lv_1225901 + ls_anlc-kansw.
            WHEN '0001241901'.
              lv_1241901 = lv_1241901 + ls_anlc-kansw.
            WHEN '0001251901'.
              lv_1251901 = lv_1251901 + ls_anlc-kansw.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.
        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095b-ktnafb.
            WHEN '0001119904'.
              lv_1119904 = lv_1119904 + ls_anlc-knafa.
            WHEN '0001229910'.
              lv_1229910 = lv_1229910 + ls_anlc-knafa.
            WHEN '0001229940'.
              lv_1229940 = lv_1229940 + ls_anlc-knafa.
            WHEN '0001229950'.
              lv_1229950 = lv_1229950 + ls_anlc-knafa.
            WHEN '0001249910'.
              lv_1249910 = lv_1249910 + ls_anlc-knafa.
            WHEN '0001259901'.
              lv_1259901 = lv_1259901 + ls_anlc-knafa.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.
      ENDLOOP.
      LOOP AT lt_anlp INTO ls_anlp
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095-ktansw.
            WHEN '0001110904'.
              lv_1110904 = lv_1110904 + ls_anlp-answl.
            WHEN '0001221901'.
              lv_1221901 = lv_1221901 + ls_anlp-answl.
            WHEN '0001224901'.
              lv_1224901 = lv_1224901 + ls_anlp-answl.
            WHEN '0001225901'.
              lv_1225901 = lv_1225901 + ls_anlp-answl.
            WHEN '0001241901'.
              lv_1241901 = lv_1241901 + ls_anlp-answl.
            WHEN '0001251901'.
              lv_1251901 = lv_1251901 + ls_anlp-answl.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.

        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095b-ktnafb.
            WHEN '0001119904'.
              lv_1119904 = lv_1119904 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001229910'.
              lv_1229910 = lv_1229910 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001229940'.
              lv_1229940 = lv_1229940 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001229950'.
              lv_1229950 = lv_1229950 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001249910'.
              lv_1249910 = lv_1249910 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001259901'.
              lv_1259901 = lv_1259901 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.
      ENDLOOP.
    ENDLOOP.
  ELSE.
    LOOP AT lt_anla INTO ls_anla.
      CLEAR: ls_anlc, ls_anlp,ls_t095,ls_t095b.
      LOOP AT lt_anlc INTO ls_anlc
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_rept = ls_anlc-kansw.
          gs_acc_sum-hkont    = ls_t095-ktansw.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_rept = ls_anlc-knafa .
          gs_acc_sum-hkont    = ls_t095b-ktnafb.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
      ENDLOOP.
      LOOP AT lt_anlp INTO ls_anlp
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_rept = ls_anlp-answl.
          gs_acc_sum-hkont    = ls_t095-ktansw.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_rept = ls_anlp-nafag + ls_anlp-nafaz.
          gs_acc_sum-hkont    = ls_t095-ktansw.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
      ENDLOOP.
    ENDLOOP.
  ENDIF.

  REFRESH: lt_anla, lt_anlz,lt_anlc,lt_anlp,lt_t095,lt_t095b.

  SELECT  bukrs
          anln1
          anln2
          kostl
          bdatu
    FROM  anlz
    INTO TABLE lt_anlz
    WHERE bukrs = gc_sortbkrs
      AND kostl IN s_kostl
      AND bdatu  >= gv_lastday_2.
  IF lt_anlz IS NOT INITIAL.
    SELECT  bukrs
            anln1
            anln2
            deakt
            ktogr
      FROM anla
      INTO TABLE lt_anla
      FOR ALL ENTRIES IN lt_anlz
      WHERE bukrs = gc_sortbkrs
        And anln1 = lt_anlz-anln1
        AND anln2 = lt_anlz-anln2
        AND (   deakt = '00000000'
             OR deakt >= gv_lastday_2 ).
  ENDIF.
  IF lt_anla IS NOT INITIAL.
    SELECT  bukrs
            anln1
            anln2
            gjahr
            afabe
            kansw
            knafa
      FROM anlc
      INTO TABLE lt_anlc
      FOR ALL ENTRIES IN lt_anla
      WHERE bukrs = gc_sortbkrs
        And anln1 = lt_anla-anln1
        AND anln2 = lt_anla-anln2
        AND gjahr = bilvjahr
        AND afabe = gc_afabe_01.

    SELECT  bukrs
            gjahr
            peraf
            afbnr
            anln1
            anln2
            afaber
            nafag
            nafaz
            answl
      FROM anlp
      INTO TABLE lt_anlp
      FOR ALL ENTRIES IN lt_anla
      WHERE bukrs = gc_sortbkrs
        And anln1 = lt_anla-anln1
        AND anln2 = lt_anla-anln2
        AND gjahr = bilvjahr
        AND peraf IN v_monate
        AND afaber = gc_afabe_01.
    SORT lt_anlp BY anln1 ASCENDING
                    anln2 ASCENDING
                    peraf DESCENDING.
    DELETE ADJACENT DUPLICATES FROM lt_anlp
       COMPARING anln1  anln2.
    SELECT    ktopl
              ktogr
              afabe
              ktansw
      FROM t095
      INTO TABLE lt_t095
      FOR ALL ENTRIES IN lt_anla
      WHERE ktopl = gc_ktopl_scoa
        AND ktogr = lt_anla-ktogr
        AND ktansw IN lt_range_hkont_50
        AND afabe = gc_afabe_01.

    SELECT  ktopl
            ktogr
            afabe
            ktnafb
      FROM t095b
      INTO TABLE lt_t095b
      FOR ALL ENTRIES IN lt_anla
      WHERE ktopl = gc_ktopl_scoa
        AND ktogr = lt_anla-ktogr
        AND ktnafb IN lt_range_hkont_51
        AND afabe = gc_afabe_01.
  ENDIF.
  IF p_flag IS INITIAL.
    LOOP AT lt_anla INTO ls_anla.
      CLEAR: ls_anlc, ls_anlp,ls_t095,ls_t095b.
      LOOP AT lt_anlc INTO ls_anlc
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095-ktansw.
            WHEN '0001110904'.
              lv_1110904_2 = lv_1110904_2 + ls_anlc-kansw.
            WHEN '0001221901'.
              lv_1221901_2 = lv_1221901_2 + ls_anlc-kansw.
            WHEN '0001224901'.
              lv_1224901_2 = lv_1224901_2 + ls_anlc-kansw.
            WHEN '0001225901'.
              lv_1225901_2 = lv_1225901_2 + ls_anlc-kansw.
            WHEN '0001241901'.
              lv_1241901_2 = lv_1241901_2 + ls_anlc-kansw.
            WHEN '0001251901'.
              lv_1251901_2 = lv_1251901_2 + ls_anlc-kansw.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.
        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095b-ktnafb.
            WHEN '0001119904'.
              lv_1119904_2 = lv_1119904_2 + ls_anlc-knafa.
            WHEN '0001229910'.
              lv_1229910_2 = lv_1229910_2 + ls_anlc-knafa.
            WHEN '0001229940'.
              lv_1229940_2 = lv_1229940_2 + ls_anlc-knafa.
            WHEN '0001229950'.
              lv_1229950_2 = lv_1229950_2 + ls_anlc-knafa.
            WHEN '0001249910'.
              lv_1249910_2 = lv_1249910_2 + ls_anlc-knafa.
            WHEN '0001259901'.
              lv_1259901_2 = lv_1259901_2 + ls_anlc-knafa.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.
      ENDLOOP.
      LOOP AT lt_anlp INTO ls_anlp
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095-ktansw.
            WHEN '0001110904'.
              lv_1110904_2 = lv_1110904_2 + ls_anlp-answl.
            WHEN '0001221901'.
              lv_1221901_2 = lv_1221901_2 + ls_anlp-answl.
            WHEN '0001224901'.
              lv_1224901_2 = lv_1224901_2 + ls_anlp-answl.
            WHEN '0001225901'.
              lv_1225901_2 = lv_1225901_2 + ls_anlp-answl.
            WHEN '0001241901'.
              lv_1241901_2 = lv_1241901_2 + ls_anlp-answl.
            WHEN '0001251901'.
              lv_1251901_2 = lv_1251901_2 + ls_anlp-answl.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.

        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CASE ls_t095b-ktnafb.
            WHEN '0001119904'.
              lv_1119904_2 = lv_1119904_2 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001229910'.
              lv_1229910_2 = lv_1229910_2 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001229940'.
              lv_1229940_2 = lv_1229940_2 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001229950'.
              lv_1229950_2 = lv_1229950_2 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001249910'.
              lv_1249910_2 = lv_1249910_2 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN '0001259901'.
              lv_1259901_2 = lv_1259901_2 + ls_anlp-nafag + ls_anlp-nafaz.
            WHEN OTHERS.
          ENDCASE.
        ENDIF.
      ENDLOOP.
    ENDLOOP.
  ELSE.
    LOOP AT lt_anla INTO ls_anla.
      CLEAR: ls_anlc, ls_anlp,ls_t095,ls_t095b.
      LOOP AT lt_anlc INTO ls_anlc
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_comp = ls_anlc-kansw.
          gs_acc_sum-hkont    = ls_t095-ktansw.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_comp = ls_anlc-knafa .
          gs_acc_sum-hkont    = ls_t095b-ktnafb.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
      ENDLOOP.
      LOOP AT lt_anlp INTO ls_anlp
        WHERE anln1 = ls_anla-anln1
          AND anln2 = ls_anla-anln2.
        READ TABLE lt_t095 INTO ls_t095
            WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_comp = ls_anlp-answl.
          gs_acc_sum-hkont    = ls_t095-ktansw.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
        READ TABLE lt_t095b INTO ls_t095b
          WITH KEY ktogr = ls_anla-ktogr.
        IF sy-subrc = 0.
          CLEAR gs_acc_sum.
          gs_acc_sum-sum_comp = ls_anlp-nafag + ls_anlp-nafaz.
          gs_acc_sum-hkont    = ls_t095-ktansw.
          COLLECT gs_acc_sum INTO gt_acc_sum.
        ENDIF.
      ENDLOOP.
    ENDLOOP.
  ENDIF.

  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '50'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001110904'.
          gs_alv_output-r_amount = lv_1110904.
          gs_alv_output-c_amount = lv_1110904_2.
          gs_alv_output-diff     = lv_1110904 - lv_1110904_2.
        WHEN '0001221901'.
          gs_alv_output-r_amount = lv_1221901.
          gs_alv_output-c_amount = lv_1221901_2.
          gs_alv_output-diff     = lv_1221901 - lv_1221901_2.
        WHEN '0001224901'.
          gs_alv_output-r_amount = lv_1224901.
          gs_alv_output-c_amount = lv_1224901_2.
          gs_alv_output-diff     = lv_1224901 - lv_1224901_2.
        WHEN '0001225901'.
          gs_alv_output-r_amount = lv_1225901.
          gs_alv_output-c_amount = lv_1225901_2.
          gs_alv_output-diff     = lv_1225901 - lv_1225901_2.
        WHEN '0001241901'.
          gs_alv_output-r_amount = lv_1241901.
          gs_alv_output-c_amount = lv_1241901_2.
          gs_alv_output-diff     = lv_1241901 - lv_1241901_2.
        WHEN '0001251901'.
          gs_alv_output-r_amount = lv_1251901.
          gs_alv_output-c_amount = lv_1251901_2.
          gs_alv_output-diff     = lv_1251901 - lv_1251901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '51'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001119904'.
          gs_alv_output-r_amount = lv_1119904.
          gs_alv_output-c_amount = lv_1119904_2.
          gs_alv_output-diff     = lv_1119904 - lv_1119904_2.
        WHEN '0001229910'.
          gs_alv_output-r_amount = lv_1229910.
          gs_alv_output-c_amount = lv_1229910_2.
          gs_alv_output-diff     = lv_1229910 - lv_1229910_2.
        WHEN '0001229940'.
          gs_alv_output-r_amount = lv_1229940.
          gs_alv_output-c_amount = lv_1229940_2.
          gs_alv_output-diff     = lv_1229940 - lv_1229940_2.
        WHEN '0001229950'.
          gs_alv_output-r_amount = lv_1229950.
          gs_alv_output-c_amount = lv_1229950_2.
          gs_alv_output-diff     = lv_1229950 - lv_1229950_2.
        WHEN '0001249910'.
          gs_alv_output-r_amount = lv_1249910.
          gs_alv_output-c_amount = lv_1249910_2.
          gs_alv_output-diff     = lv_1249910 - lv_1249910_2.
        WHEN '0001259901'.
          gs_alv_output-r_amount = lv_1259901.
          gs_alv_output-c_amount = lv_1259901_2.
          gs_alv_output-diff     = lv_1259901 - lv_1259901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.

ENDFORM.                    " GET_ACCOUT_50
*&---------------------------------------------------------------------*
*&      Form  GET_LAST_DAY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_last_day .

  DATA: lv_date TYPE datum.
  lv_date(4) = bilbjahr.
  IF b_monate-high >= 12.
    lv_date+4(2) = '12'.
  ELSE.
    lv_date+4(2) = b_monate-high.
  ENDIF.

  lv_date+6(2) = '01'.
  CALL FUNCTION 'LAST_DAY_OF_MONTHS'
    EXPORTING
      day_in            = lv_date
    IMPORTING
      last_day_of_month = gv_lastday
    EXCEPTIONS
      day_in_no_date    = 1
      OTHERS            = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

  CLEAR lv_date.
  lv_date(4) = bilvjahr.
  IF v_monate-high >= 12.
    lv_date+4(2) = '12'.
  ELSE.
    lv_date+4(2) = v_monate-high.
  ENDIF.

  lv_date+6(2) = '01'.
  CALL FUNCTION 'LAST_DAY_OF_MONTHS'
    EXPORTING
      day_in            = lv_date
    IMPORTING
      last_day_of_month = gv_lastday_2
    EXCEPTIONS
      day_in_no_date    = 1
      OTHERS            = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.


  DATA: ls_csks   TYPE csks,
        lt_csks   TYPE STANDARD TABLE OF csks,
        ls_kostl  LIKE LINE OF gt_kostl.
  SELECT *
    FROM csks
    INTO TABLE lt_csks
    WHERE kokrs = '1000'
      AND kostl IN s_kostl
      AND bukrs = gc_sortbkrs.
  LOOP AT lt_csks INTO ls_csks.
    ls_kostl-option = 'EQ'.
    ls_kostl-sign   = 'I'.
    SHIFT ls_csks-kostl LEFT DELETING LEADING '0'.
    ls_kostl-low    = ls_csks-kostl.
    APPEND ls_kostl TO gt_kostl.
  ENDLOOP.
  CLEAR: gv_text.
  CONCATENATE 'Start report:'(006) sy-repid
                  INTO gv_text SEPARATED BY space.
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 1
        text       = gv_text.
  ENDIF.

ENDFORM.                    " GET_LAST_DAY
*&---------------------------------------------------------------------*
*&      Form  GET_ACC_ASSIGNMENT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_acc_assignment .
  CLEAR: gv_text.
  gv_text ='Begin to retrieve table YSE_FI_CNYNREP'(016).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 5
        text       = gv_text.
  ENDIF.
  SELECT    yse_fi_cnynrep~line
            yse_fi_cnynrep~item
            yse_fi_cnynrep~saknr
            yse_fi_cnynrep~dtres
            yse_fi_cnynrep_t~ltext
    FROM yse_fi_cnynrep
    INNER JOIN yse_fi_cnynrep_t
    ON yse_fi_cnynrep~line = yse_fi_cnynrep_t~line
    INTO TABLE gt_fi_cnynrep
    WHERE yse_fi_cnynrep_t~spras = sy-langu.
  IF gt_fi_cnynrep IS INITIAL.
    IF sy-subrc <> 0.
      CLEAR gv_text.
      gv_text ='No account assignment exist, please maintain'(017).
      MESSAGE i000(yse_sales_log) WITH gv_text.
      LEAVE LIST-PROCESSING.
    ENDIF.
  ENDIF.
ENDFORM.                    " GET_ACC_ASSIGNMENT
*&---------------------------------------------------------------------*
*&      Form  FRM_SCREEN_SET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM frm_screen_set .
  LOOP AT SCREEN.
    IF screen-group1 <> 'M1'.
*      IF not screen-name cs 'SO_KOSTL' .
*      ENDIF.
      screen-input = '0'.
      screen-invisible = '1'.
      MODIFY SCREEN.
    ENDIF.
    IF  screen-name CS 'BLOCK_1000'.
      screen-active = '1'.
      screen-invisible = '0'.
      MODIFY SCREEN.
    ENDIF.
  ENDLOOP.

  REFRESH: bukrs.
  bukrs-low = gc_sortbkrs.
  APPEND bukrs.

  REFRESH:   so_kostl.
  APPEND LINES OF s_kostl TO so_kostl.

  berdatum = p_date.
  summb = 'X'.
  CLEAR:  xeinzel,
          xuntnr.
ENDFORM.                    " FRM_SCREEN_SET
*&---------------------------------------------------------------------*
*&      Form  ALV_PROP_SET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM alv_prop_set .

* Display ALV process indicator
  PERFORM alv_progress_indicator.

* FIELDCAT set
  PERFORM alv_fieldcat_set.

* LAYOUT set
  PERFORM alv_layout_set.

* Set Others
  PERFORM alv_others_set.

ENDFORM.                    " ALV_PROP_SET
*&---------------------------------------------------------------------*
*&      Form  ALV_PROGRESS_INDICATOR
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM alv_progress_indicator .
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    CLEAR: gv_text.
    gv_text ='Begin to set ALV property'(011).
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CLEAR: gv_text.
    gv_text = text-011.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 75
        text       = gv_text.
  ENDIF.
ENDFORM.                    " ALV_PROGRESS_INDICATOR
*&---------------------------------------------------------------------*
*&      Form  ALV_FIELDCAT_SET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM alv_fieldcat_set .
  DATA:
     lv_linecnt  TYPE i,
     ls_fieldcat TYPE slis_fieldcat_alv.

* Line
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'LINE'.
  ls_fieldcat-seltext_s = 'Line'(003).
  ls_fieldcat-seltext_m = 'Line No.'(004).
  APPEND ls_fieldcat TO gt_fieldcat.

* Line text
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'LTEXT'.
  ls_fieldcat-seltext_s = 'Line text'(014).
  ls_fieldcat-seltext_m = 'Line text'(014).
  APPEND ls_fieldcat TO gt_fieldcat.

* Account
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'SAKNR'.
  ls_fieldcat-seltext_s = 'Acct'(023).
  ls_fieldcat-seltext_m = 'Account'(024).
  APPEND ls_fieldcat TO gt_fieldcat.

* Account description
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'TXT20'.
  ls_fieldcat-seltext_s = 'Acc Desc.'(033).
  ls_fieldcat-seltext_l = 'Account description'(034).
  APPEND ls_fieldcat TO gt_fieldcat.

* Data resoure
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'DTRES'.
  ls_fieldcat-seltext_s = 'Data Res.'(133).
  ls_fieldcat-seltext_l = 'Data Resource'(134).
  APPEND ls_fieldcat TO gt_fieldcat.

* Reporting period Amount
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'R_AMOUNT'.
  ls_fieldcat-seltext_s = 'Rep.Amt'(043).
  ls_fieldcat-seltext_l = 'Reporting period Amount'(044).
  APPEND ls_fieldcat TO gt_fieldcat.

* Comparison period Amount
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'C_AMOUNT'.
  ls_fieldcat-seltext_s = 'Comp.Amt'(053).
  ls_fieldcat-seltext_l = 'Comparison period Amount'(054).
  APPEND ls_fieldcat TO gt_fieldcat.

* Difference
  CLEAR ls_fieldcat.
  lv_linecnt = lv_linecnt + 1.
  ls_fieldcat-col_pos = lv_linecnt.
  ls_fieldcat-fieldname = 'DIFF'.
  ls_fieldcat-seltext_s = 'Diff'(063).
  ls_fieldcat-seltext_m = 'Difference'(064).
  APPEND ls_fieldcat TO gt_fieldcat.

ENDFORM.                    " ALV_FIELDCAT_SET
*&---------------------------------------------------------------------*
*&      Form  ALV_LAYOUT_SET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*  -->  p1        text
*  <--  p2        text
*----------------------------------------------------------------------*
FORM alv_layout_set .
  CLEAR: gs_layout.
  gs_layout-zebra = gc_x.               "ALV lines cross-color display
  gs_layout-colwidth_optimize = gc_x.   " Auto optimize column width
  gs_layout-detail_popup = gc_x.        " Show detail screen
ENDFORM.                    " ALV_LAYOUT_SET
*&---------------------------------------------------------------------*
*&      Form  ALV_OTHERS_SET
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM alv_others_set .
  gv_callback = gc_callback_routine.
ENDFORM.                    " ALV_OTHERS_SET
*&---------------------------------------------------------------------*
*&      Form  ALV_DISPLAY
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM alv_display .
  CLEAR: gv_text.
  gv_text ='Display ALV'(136).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 100
        text       = gv_text.
  ENDIF.
  IF gt_alv_output IS INITIAL.
    CLEAR: gv_text.
    gv_text = text-060.
    MESSAGE s000(yse_sales_log) WITH gv_text
      DISPLAY LIKE gc_type_e.
    LEAVE LIST-PROCESSING.
  ENDIF.

  CLEAR: gv_text.
  gv_text = text-010.
  CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
    EXPORTING
      percentage = 80
      text       = gv_text.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      i_callback_program      = sy-repid
      i_callback_user_command = gv_callback
      is_layout               = gs_layout
      it_fieldcat             = gt_fieldcat
      i_save                  = gv_save
      is_variant              = gs_disvar
    TABLES
      t_outtab                = gt_alv_output
    EXCEPTIONS
      program_error           = 1
      OTHERS                  = 2.
  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

ENDFORM.                    " ALV_DISPLAY
*&---------------------------------------------------------------------*
*&      Form  GENERATE_ALVDATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM generate_alvdata .
  DATA: lt_skat TYPE STANDARD TABLE OF skat,
        ls_skat TYPE skat.
  FIELD-SYMBOLS: <fs_alv_output> TYPE ty_alv_output.
  CLEAR: gv_text.
  gv_text ='Prepare the data to be display in ALV'(126).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 95
        text       = gv_text.
  ENDIF.
  IF p_flag IS NOT INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep.
      CLEAR: gs_alv_output,gs_acc_sum.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      READ TABLE gt_acc_sum INTO gs_acc_sum
        WITH KEY hkont = gs_fi_cnynrep-saknr.
      gs_alv_output-r_amount = gs_acc_sum-sum_rept.
      gs_alv_output-c_amount = gs_acc_sum-sum_comp.
      gs_alv_output-diff     = gs_acc_sum-sum_rept -
                               gs_acc_sum-sum_comp.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.
  IF gt_alv_output  IS NOT INITIAL.
    SELECT *
      FROM skat
      INTO TABLE lt_skat
      FOR ALL ENTRIES IN gt_alv_output
      WHERE spras   = 'E'
        AND ktopl  = gc_ktopl_scoa
        AND saknr  = gt_alv_output-saknr.
    LOOP AT gt_alv_output  ASSIGNING <fs_alv_output>.
      READ TABLE lt_skat INTO ls_skat
        WITH KEY saknr = <fs_alv_output>-saknr.
      IF sy-subrc = 0.
        <fs_alv_output>-txt20 = ls_skat-txt20.
      ENDIF.
      IF <fs_alv_output>-saknr = '0003210901'.
        <fs_alv_output>-r_amount = <fs_alv_output>-r_amount * ( -1 ).
        <fs_alv_output>-c_amount = <fs_alv_output>-c_amount * ( -1 ).
        <fs_alv_output>-diff   = <fs_alv_output>-diff * ( -1 ).
      ENDIF.
    ENDLOOP.
    SORT gt_alv_output BY line item ASCENDING.
  ENDIF.
ENDFORM.                    " GENERATE_ALVDATA
* Allgemeine FORM-Routinen.
INCLUDE rasort_alv_misc.

* Formroutinen f¨¹r den ABAP List Viewer
INCLUDE rasort_alv_prepare_table.      " Feldcatalog/Layout/Sort vorber.
INCLUDE rasort_alv_tools.              " diverse Forms
*&---------------------------------------------------------------------*
*&      Form  FRM_LDB_ENDPROC
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM frm_ldb_endproc .
  TYPES:
    BEGIN OF lty_t095,
      ktopl	    TYPE t095-ktopl,
      ktogr	    TYPE t095-ktogr,
      afabe	    TYPE t095-afabe,
      ktansw    TYPE t095-ktansw,
    END OF lty_t095,
    BEGIN OF lty_t095b,
      ktopl     TYPE t095b-ktopl,
      ktogr     TYPE t095b-ktogr,
      afabe     TYPE t095b-afabe,
      ktnafb    TYPE t095b-ktnafb,
    END OF lty_t095b.
  DATA: ls_apc_dep TYPE ty_apc_dep,
        lt_t095    TYPE STANDARD TABLE OF lty_t095,
        lt_t095b   TYPE STANDARD TABLE OF lty_t095b,
        ls_t095    TYPE lty_t095,
        ls_t095b   TYPE lty_t095b,
        lt_range_hkont_50  TYPE RANGE OF bsad-hkont,
        lt_range_hkont_51  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont_50.

  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '50'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont_50.
  ENDLOOP.

  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '51'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont_51.
  ENDLOOP.


  LOOP AT sumtab_data INTO sumline.
    MOVE-CORRESPONDING sumline TO sumtab_data_s.
    sumtab_data_s-flg_pick_up = 'X'.   " Summen darf man picken
    sumtab_data_s-hlp_level = con_srtst.      " Summenstufe merken
*   ANLAV f¨¹llen f¨¹r Textbezeichner lesen
    CLEAR anlav.                                            "<<<0433908
    MOVE sumtab_data_s-s1 TO <s1>.
    MOVE sumtab_data_s-s2 TO <s2>.
    MOVE sumtab_data_s-s3 TO <s3>.
    MOVE sumtab_data_s-s4 TO <s4>.
    MOVE sumtab_data_s-s5 TO <s5>.

    CASE con_srtst.
      WHEN 1.
*        PERFORM sort_text_lesen USING 1                        "<781218
*                                CHANGING sumtab_data_s-s1      "<781218
*                                         sumtab_data_s-text.   "<781218
        sumtab_data_s-text = sumtab_data_s-s1_text.         "<781218
      WHEN 2.
*        PERFORM sort_text_lesen USING 2                        "<781218
*                                CHANGING sumtab_data_s-s2      "<781218
*                                         sumtab_data_s-text.   "<781218
        sumtab_data_s-text = sumtab_data_s-s2_text.         "<781218
      WHEN 3.
*        PERFORM sort_text_lesen USING 3                        "<781218
*                                CHANGING sumtab_data_s-s3      "<781218
*                                         sumtab_data_s-text.   "<781218
        sumtab_data_s-text = sumtab_data_s-s3_text.         "<781218
      WHEN 4.
*        PERFORM sort_text_lesen USING 4                        "<781218
*                                CHANGING sumtab_data_s-s4      "<781218
*                                         sumtab_data_s-text.   "<781218
        sumtab_data_s-text = sumtab_data_s-s4_text.         "<781218
      WHEN 5.
*        PERFORM sort_text_lesen USING 5                        "<781218
*                                CHANGING sumtab_data_s-s5      "<781218
*                                         sumtab_data_s-text.   "<781218
        sumtab_data_s-text = sumtab_data_s-s5_text.         "<781218
    ENDCASE.
    APPEND sumtab_data_s.
  ENDLOOP.

  SELECT    t095~ktopl
            t095~ktogr
            t095~afabe
            t095~ktansw
    FROM t095
    INNER JOIN t093
    ON t095~afabe = t093~afaber
    INTO TABLE lt_t095
    WHERE ktopl = gc_ktopl_scoa
      AND ktansw IN lt_range_hkont_50
      AND afabe = gc_afabe_01.

  SELECT  ktopl
          ktogr
          afabe
          ktnafb
    FROM t095b
    INTO TABLE lt_t095b
    FOR ALL ENTRIES IN lt_t095
    WHERE ktopl = gc_ktopl_scoa
      AND ktogr = lt_t095-ktogr
      AND ktnafb IN lt_range_hkont_51
      AND afabe = gc_afabe_01.

  LOOP AT sumtab_data_s.
    CONDENSE: sumtab_data_s-s4.
    ls_apc_dep-ktansw        = sumtab_data_s-s4.
    ls_apc_dep-apc_amount    = sumtab_data_s-btr1.
    ls_apc_dep-dep_amount    = sumtab_data_s-btr2.
    READ TABLE lt_t095 INTO ls_t095
      WITH KEY ktansw = ls_apc_dep-ktansw.
    IF sy-subrc = 0.
      READ TABLE lt_t095b INTO ls_t095b
        WITH KEY ktogr = ls_t095-ktogr.
      IF sy-subrc = 0 .
        ls_apc_dep-ktnafb = ls_t095b-ktnafb.
      ENDIF.
    ENDIF.
    APPEND ls_apc_dep TO gt_apc_dep.
  ENDLOOP.

ENDFORM.                    " FRM_LDB_ENDPROC
*&---------------------------------------------------------------------*
*&      Form  GET_ACCOUT_50_51_2
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
FORM get_accout_50_51_2 .

  DATA: lv_1110904      TYPE faglflext-hsl01,
        lv_1110904_2    TYPE faglflext-hsl01,
        lv_1221901      TYPE faglflext-hsl01,
        lv_1221901_2    TYPE faglflext-hsl01,
        lv_1224901      TYPE faglflext-hsl01,
        lv_1224901_2    TYPE faglflext-hsl01,
        lv_1225901      TYPE faglflext-hsl01,
        lv_1225901_2    TYPE faglflext-hsl01,
        lv_1241901      TYPE faglflext-hsl01,
        lv_1241901_2    TYPE faglflext-hsl01,
        lv_1251901      TYPE faglflext-hsl01,
        lv_1251901_2    TYPE faglflext-hsl01,
        lv_1119904      TYPE faglflext-hsl01,
        lv_1119904_2    TYPE faglflext-hsl01,
        lv_1229910      TYPE faglflext-hsl01,
        lv_1229910_2    TYPE faglflext-hsl01,
        lv_1229940      TYPE faglflext-hsl01,
        lv_1229940_2    TYPE faglflext-hsl01,
        lv_1229950      TYPE faglflext-hsl01,
        lv_1229950_2    TYPE faglflext-hsl01,
        lv_1249910      TYPE faglflext-hsl01,
        lv_1249910_2    TYPE faglflext-hsl01,
        lv_1259901      TYPE faglflext-hsl01,
        lv_1259901_2    TYPE faglflext-hsl01,
        ls_apc_dep      TYPE ty_apc_dep,
        lt_range_hkont_50  TYPE RANGE OF bsad-hkont,
        lt_range_hkont_51  TYPE RANGE OF bsad-hkont,
        ls_range_hkont  LIKE LINE OF lt_range_hkont_50.
  CLEAR: gv_text.
  gv_text ='Begin to process Account Data Resource 50&51'(116).
* Progress indicator/ Log info generate
  IF sy-batch IS NOT INITIAL.
    MESSAGE i000(yse_sales_log) WITH gv_text.
  ELSE.
    CALL FUNCTION 'SAPGUI_PROGRESS_INDICATOR'
      EXPORTING
        percentage = 85
        text       = gv_text.
  ENDIF.
  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '50'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont_50.
  ENDLOOP.

  LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
    WHERE dtres  = '51'.
    ls_range_hkont-sign = 'I'.
    ls_range_hkont-option = 'EQ'.
    ls_range_hkont-low = gs_fi_cnynrep-saknr.
    APPEND ls_range_hkont TO lt_range_hkont_51.
  ENDLOOP.

  IF p_flag IS INITIAL.
    LOOP AT gt_apc_dep INTO ls_apc_dep.

      CASE ls_apc_dep-ktansw.
        WHEN '0001110904'.
          lv_1110904 = ls_apc_dep-apc_amount.
        WHEN '0001221901'.
          lv_1221901 = ls_apc_dep-apc_amount.
        WHEN '0001224901'.
          lv_1224901 = ls_apc_dep-apc_amount.
        WHEN '0001225901'.
          lv_1225901 = ls_apc_dep-apc_amount.
        WHEN '0001241901'.
          lv_1241901 = ls_apc_dep-apc_amount.
        WHEN '0001251901'.
          lv_1251901 = ls_apc_dep-apc_amount.
        WHEN OTHERS.
      ENDCASE.

      CASE ls_apc_dep-ktnafb.
        WHEN '0001119904'.
          lv_1119904 = ls_apc_dep-dep_amount.
        WHEN '0001229910'.
          lv_1229910 = ls_apc_dep-dep_amount.
        WHEN '0001229940'.
          lv_1229940 = ls_apc_dep-dep_amount.
        WHEN '0001229950'.
          lv_1229950 = ls_apc_dep-dep_amount.
        WHEN '0001249910'.
          lv_1249910 = ls_apc_dep-dep_amount.
        WHEN '0001259901'.
          lv_1259901 = ls_apc_dep-dep_amount.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.
  ELSE.
    LOOP AT gt_apc_dep INTO ls_apc_dep.
      CLEAR gs_acc_sum.
      gs_acc_sum-sum_rept = ls_apc_dep-apc_amount.
      gs_acc_sum-hkont    = ls_apc_dep-ktansw.
      COLLECT gs_acc_sum INTO gt_acc_sum.

      CLEAR gs_acc_sum.
      gs_acc_sum-sum_rept = ls_apc_dep-dep_amount.
      gs_acc_sum-hkont    = ls_apc_dep-ktnafb.
      COLLECT gs_acc_sum INTO gt_acc_sum.
    ENDLOOP.
  ENDIF.

  IF p_flag IS INITIAL.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '50'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001110904'.
          gs_alv_output-r_amount = lv_1110904.
          gs_alv_output-c_amount = lv_1110904_2.
          gs_alv_output-diff     = lv_1110904 - lv_1110904_2.
        WHEN '0001221901'.
          gs_alv_output-r_amount = lv_1221901.
          gs_alv_output-c_amount = lv_1221901_2.
          gs_alv_output-diff     = lv_1221901 - lv_1221901_2.
        WHEN '0001224901'.
          gs_alv_output-r_amount = lv_1224901.
          gs_alv_output-c_amount = lv_1224901_2.
          gs_alv_output-diff     = lv_1224901 - lv_1224901_2.
        WHEN '0001225901'.
          gs_alv_output-r_amount = lv_1225901.
          gs_alv_output-c_amount = lv_1225901_2.
          gs_alv_output-diff     = lv_1225901 - lv_1225901_2.
        WHEN '0001241901'.
          gs_alv_output-r_amount = lv_1241901.
          gs_alv_output-c_amount = lv_1241901_2.
          gs_alv_output-diff     = lv_1241901 - lv_1241901_2.
        WHEN '0001251901'.
          gs_alv_output-r_amount = lv_1251901.
          gs_alv_output-c_amount = lv_1251901_2.
          gs_alv_output-diff     = lv_1251901 - lv_1251901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
    LOOP AT gt_fi_cnynrep INTO gs_fi_cnynrep
      WHERE dtres = '51'.
      CLEAR gs_alv_output.
      MOVE-CORRESPONDING gs_fi_cnynrep TO gs_alv_output.
      CASE gs_fi_cnynrep-saknr.
        WHEN '0001119904'.
          gs_alv_output-r_amount = lv_1119904.
          gs_alv_output-c_amount = lv_1119904_2.
          gs_alv_output-diff     = lv_1119904 - lv_1119904_2.
        WHEN '0001229910'.
          gs_alv_output-r_amount = lv_1229910.
          gs_alv_output-c_amount = lv_1229910_2.
          gs_alv_output-diff     = lv_1229910 - lv_1229910_2.
        WHEN '0001229940'.
          gs_alv_output-r_amount = lv_1229940.
          gs_alv_output-c_amount = lv_1229940_2.
          gs_alv_output-diff     = lv_1229940 - lv_1229940_2.
        WHEN '0001229950'.
          gs_alv_output-r_amount = lv_1229950.
          gs_alv_output-c_amount = lv_1229950_2.
          gs_alv_output-diff     = lv_1229950 - lv_1229950_2.
        WHEN '0001249910'.
          gs_alv_output-r_amount = lv_1249910.
          gs_alv_output-c_amount = lv_1249910_2.
          gs_alv_output-diff     = lv_1249910 - lv_1249910_2.
        WHEN '0001259901'.
          gs_alv_output-r_amount = lv_1259901.
          gs_alv_output-c_amount = lv_1259901_2.
          gs_alv_output-diff     = lv_1259901 - lv_1259901_2.
        WHEN OTHERS.
      ENDCASE.
      APPEND gs_alv_output TO gt_alv_output.
      CLEAR gs_fi_cnynrep.
    ENDLOOP.
  ENDIF.

ENDFORM.                    " GET_ACCOUT_50_51_2

*Text symbol text£º
*003:Line
*004:Line No.
*006:Start report:
*010:Start to display ALV
*011:Begin to set ALV property
*014:Line text
*016:Begin to retrieve table YSE_FI_CNYNREP
*017:No account assignment exist, please maintain
*023:Acct
*024:Account
*026:Begin to process Account Data Resource 10
*033:Acc Desc.
*034:Account description
*036:Begin to process Account Data Resource 11
*043:Rep.Amt
*044:Reporting period Amount
*046:Begin to process Account Data Resource 12
*053:Comp.Amt
*054:Comparison period Amount
*056:Begin to process Account Data Resource 20
*060:No data extracted by selection screen
*063:Diff
*064:Difference
*066:Begin to process Account Data Resource 30
*076:Begin to process Account Data Resource 40
*086:Begin to process Account Data Resource 41
*096:Begin to process Account Data Resource 42
*106:Begin to process Account Data Resource 43
*116:Begin to process Account Data Resource 50&51
*126:Prepare the data to be display in ALV
*133:Data Res.
*134:Data Resource
*136:Display ALV

*T01:Selection Conditions
*Selection text£º
*BILBJAHR:        Reporting year
*BILVJAHR:        Comparison year
*B_MONATE:        Reporting periods
*PA_MIKRO:        Print microfiche line
*PA_TITEL:        Additional heading
*PA_XGBAF:        Current book value
*P_DATE:        Report date
*P_FLAG:        Flag to dynamic
*SO_AKTIV:        Capitalization date
*SO_BCHWR:        Book value
*SO_KANSW:        Acquisition value
*SO_KTANW:        Balance sheet account
*SO_KUMAF:        Accumulated depreciation
*S_BZIRK:D       .
*S_KOSTL:D       .
*S_KUNNR:D       .
*S_LIFNR:D       .
*V_MONATE:        Comparison periods
